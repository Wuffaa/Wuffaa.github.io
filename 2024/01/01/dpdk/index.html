<!DOCTYPE html>
<html lang="zh-Hans">
    
    <head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport" />
    <meta name="description" content="dpdk" />
    <meta name="hexo-theme-A4" content="v1.9.8" />
    <link rel="alternate icon" type="image/webp" href="/images/Neurothingy.jpg">
    <title>Wuffaa | Blog</title>

    
        
<link rel="stylesheet" href="/css/highlight/style1.css">

        
<link rel="stylesheet" href="/css/reset.css">

        
<link rel="stylesheet" href="/css/markdown.css">

        
<link rel="stylesheet" href="/css/fonts.css">
 
         <!--æ³¨æ„ï¼šé¦–é¡µæ—¢ä¸æ˜¯postä¹Ÿä¸æ˜¯page-->
        
        
        
<link rel="stylesheet" href="/css/ui.css">
 
        
<link rel="stylesheet" href="/css/style.css">


        
            <!--è¿”å›é¡¶éƒ¨css-->
            
<link rel="stylesheet" href="/css/returnToTop.css">

            
<link rel="stylesheet" href="/css/unicons.css">

        
        
            <!--ç›®å½•-->
            
<link rel="stylesheet" href="/css/toc.css">

        
    

    
        
<link rel="stylesheet" href="/css/returnToLastPage.css">

    
    
   
<link rel="stylesheet" href="/css/lightgallery-bundle.min.css">


   
        
<link rel="stylesheet" href="/css/custom.css">

    

<meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>
    
    

    
    



    

    
    




    
    

    
    <body>
        <script src="/js/darkmode-js.min.js"></script>
        
        <script>
            const options = {
                bottom: '40px', // default: '32px'
                right: 'unset', // default: '32px'
                left: '42px', // default: 'unset'
                time: '0.3s', // default: '0.3s'
                mixColor: '#fff', // default: '#fff'
                backgroundColor: ' #e4e4e4 ',  // default: '#fff'
                buttonColorDark: '#100f2c',  // default: '#100f2c'
                buttonColorLight: '#fff', // default: '#fff'
                saveInCookies: true, // default: true,
                label: 'ğŸŒ“', // default: ''
                autoMatchOsTheme: true // default: true
            }
            const darkmode = new Darkmode(options);
            darkmode.showWidget();
        </script>
        
        
            
                <div class="left-toc-container">
                    <nav id="toc" class="bs-docs-sidebar"></nav>
                </div>
            
        
        <div class="paper">
            
            
            
            
                <div class="shadow-drop-2-bottom paper-main">
                    


<div class="header">
    <div class="header-container">
        <style>
            .header-img {
                width: 56px;
                height: auto;
                object-fit: cover; /* ä¿æŒå›¾ç‰‡æ¯”ä¾‹ */
                transition: transform 0.3s ease-in-out; 
                border-radius: 50%; 
            }
            
        </style>
        <img 
            alt="^-^" 
            cache-control="max-age=86400" 
            class="header-img" 
            src="/images/Neurothingy.jpg" 
        />
        <div class="header-content">
            <a class="logo" href="/">Wuffaa</a> 
            <span class="description">el psy congroo</span> 
        </div>
    </div>
    
   
    <ul class="nav">
        
    </ul>
</div> 
        
                    
                    

                    
                    
                    
                    <!--è¯´æ˜æ˜¯æ–‡ç« posté¡µé¢-->
                    
                        <div class="post-main">
    

    
        
            
                <div class="post-main-title" style="text-align: center;">
                    dpdk
                </div>
            
        
      
    

    

        
            <div class="post-head-meta-center">
        
                
                    <span>æœ€è¿‘æ›´æ–°ï¼š2025-05-19</span> 
                
                
                    
                        &nbsp; | &nbsp;
                    
                     <span>å­—æ•°æ€»è®¡ï¼š30.4k</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span>é˜…è¯»ä¼°æ—¶ï¼š131åˆ†é’Ÿ</span>
                
                
                    
                        &nbsp; | &nbsp;
                    
                    <span id="busuanzi_container_page_pv">
                        é˜…è¯»é‡ï¼š<span id="busuanzi_value_page_pv"></span>æ¬¡
                    </span>
                
            </div>
    

    <div class="post-md">
        
            
                <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E7%BC%96%E8%AF%91"><span class="post-toc-text">ç¼–è¯‘</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#%E8%BF%90%E8%A1%8C%E5%8F%82%E6%95%B0"><span class="post-toc-text">è¿è¡Œå‚æ•°</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%89%8D%E7%BD%AE%E6%A6%82%E5%BF%B5"><span class="post-toc-text">å‰ç½®æ¦‚å¿µ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#lcore%E7%9B%B8%E5%85%B3%E9%80%89%E9%A1%B9"><span class="post-toc-text">lcoreç›¸å…³é€‰é¡¹</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B%E7%9B%B8%E5%85%B3%E9%80%89%E9%A1%B9"><span class="post-toc-text">å¤šè¿›ç¨‹ç›¸å…³é€‰é¡¹</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E9%80%89%E9%A1%B9"><span class="post-toc-text">å†…å­˜ç›¸å…³é€‰é¡¹</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Debugging%E9%80%89%E9%A1%B9"><span class="post-toc-text">Debuggingé€‰é¡¹</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%85%B6%E4%BB%96%E9%80%89%E9%A1%B9"><span class="post-toc-text">å…¶ä»–é€‰é¡¹</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#EAL-Environment-Abstraction-Layer"><span class="post-toc-text">EAL(Environment Abstraction Layer)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Plugin"><span class="post-toc-text">Plugin</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Trace"><span class="post-toc-text">Trace</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%BF%BD%E8%B8%AA%E7%82%B9%E7%9A%84%E5%BB%BA%E7%AB%8B"><span class="post-toc-text">è¿½è¸ªç‚¹çš„å»ºç«‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%BF%BD%E8%B8%AA%E7%82%B9%E7%9A%84%E6%B3%A8%E5%86%8C"><span class="post-toc-text">è¿½è¸ªç‚¹çš„æ³¨å†Œ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Trace%E5%8E%9F%E7%90%86"><span class="post-toc-text">TraceåŸç†</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Interrupt"><span class="post-toc-text">Interrupt</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Alarm"><span class="post-toc-text">Alarm</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Multi-process"><span class="post-toc-text">Multi-process</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B%E9%80%9A%E8%AE%AF"><span class="post-toc-text">å¤šè¿›ç¨‹é€šè®¯</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%A4%9A%E8%BF%9B%E7%A8%8B%E5%86%85%E5%AD%98%E5%85%B1%E4%BA%AB"><span class="post-toc-text">å¤šè¿›ç¨‹å†…å­˜å…±äº«</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Memory-Hugepage"><span class="post-toc-text">Memory&amp;Hugepage</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Heap"><span class="post-toc-text">Heap</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Memory-Zone"><span class="post-toc-text">Memory Zone</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Legacy-Memory-Mode"><span class="post-toc-text">Legacy Memory Mode</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Dynamic-Memory-Mode"><span class="post-toc-text">Dynamic Memory Mode</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Tailq"><span class="post-toc-text">Tailq</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Service-Core"><span class="post-toc-text">Service Core</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Log"><span class="post-toc-text">Log</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Command-line"><span class="post-toc-text">Command-line</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%91%BD%E4%BB%A4%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="post-toc-text">å‘½ä»¤å‚æ•°ç±»å‹</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%86%8C"><span class="post-toc-text">å‘½ä»¤æ³¨å†Œ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%AE%9E%E4%BE%8B%E7%9A%84%E5%88%9B%E5%BB%BA%E4%B8%8E%E8%BF%90%E8%A1%8C"><span class="post-toc-text">å‘½ä»¤è¡Œå®ä¾‹çš„åˆ›å»ºä¸è¿è¡Œ</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Generator-Script"><span class="post-toc-text">Generator Script</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Ring-Queue"><span class="post-toc-text">Ring(Queue)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E5%90%8C%E6%AD%A5%E6%A8%A1%E5%BC%8F"><span class="post-toc-text">ç”Ÿäº§è€…&#x2F;æ¶ˆè´¹è€…åŒæ­¥æ¨¡å¼</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Ring%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="post-toc-text">Ringçš„åˆ›å»º</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Ring%E7%9A%84%E5%85%A5%E9%98%9F"><span class="post-toc-text">Ringçš„å…¥é˜Ÿ</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Stack"><span class="post-toc-text">Stack</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%97%A0%E9%94%81%E5%8C%96%E6%96%B9%E5%BC%8F%E4%B8%8BABA%E9%97%AE%E9%A2%98"><span class="post-toc-text">æ— é”åŒ–æ–¹å¼ä¸‹ABAé—®é¢˜</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ABA%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="post-toc-text">ABAé—®é¢˜è§£å†³æ–¹æ¡ˆ</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#RCU-Read-Copy-Update"><span class="post-toc-text">RCU(Read, Copy, Update)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="post-toc-text">åˆå§‹åŒ–</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%AF%BB%E8%80%85"><span class="post-toc-text">è¯»è€…</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E5%86%99%E8%80%85"><span class="post-toc-text">å†™è€…</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E8%B5%84%E6%BA%90%E7%9A%84%E9%87%8A%E6%94%BE"><span class="post-toc-text">èµ„æºçš„é‡Šæ”¾</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Mempool"><span class="post-toc-text">Mempool</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mempool%E5%88%9B%E5%BB%BA"><span class="post-toc-text">Mempoolåˆ›å»º</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mempool%E5%AF%B9%E8%B1%A1%E7%9A%84%E7%94%B3%E8%AF%B7"><span class="post-toc-text">Mempoolå¯¹è±¡çš„ç”³è¯·</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Mbuf"><span class="post-toc-text">Mbuf</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Dynamic-field"><span class="post-toc-text">Dynamic field</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Dynamic-flag"><span class="post-toc-text">Dynamic flag</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Timer"><span class="post-toc-text">Timer</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Skiplist%E5%8E%9F%E7%90%86"><span class="post-toc-text">SkipliståŸç†</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Timer%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="post-toc-text">Timerçš„ä½¿ç”¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Hash"><span class="post-toc-text">Hash</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Cuckoo%E7%AE%97%E6%B3%95"><span class="post-toc-text">Cuckooç®—æ³•</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Hash%E8%A1%A8%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="post-toc-text">Hashè¡¨çš„åˆå§‹åŒ–</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Hash%E8%A1%A8%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="post-toc-text">Hashè¡¨çš„ä½¿ç”¨</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Toeplitz-Hash"><span class="post-toc-text">Toeplitz Hash</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Toeplitz-Hash%E4%BD%BF%E7%94%A8"><span class="post-toc-text">Toeplitz Hashä½¿ç”¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#LPM-Longest-Prefix-Match"><span class="post-toc-text">LPM(Longest Prefix Match)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#DIR-24-8%E7%AE%97%E6%B3%95%E5%8E%9F%E7%90%86"><span class="post-toc-text">DIR-24-8ç®—æ³•åŸç†</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%9C%B4%E7%B4%A0%E7%AE%97%E6%B3%95"><span class="post-toc-text">æœ´ç´ ç®—æ³•</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#DIR-24-8%E7%AE%97%E6%B3%95"><span class="post-toc-text">DIR-24-8ç®—æ³•</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#LPM%E4%BD%BF%E7%94%A8"><span class="post-toc-text">LPMä½¿ç”¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#LPM6"><span class="post-toc-text">LPM6</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#RIB-Routing-Information-Base"><span class="post-toc-text">RIB(Routing Information Base)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#RIB%E4%BD%BF%E7%94%A8"><span class="post-toc-text">RIBä½¿ç”¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#FIB-Forwarding-Information-Base"><span class="post-toc-text">FIB(Forwarding Information Base)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#DIR-24-8"><span class="post-toc-text">DIR-24-8</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#FIB%E4%BD%BF%E7%94%A8"><span class="post-toc-text">FIBä½¿ç”¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ACL-Access-Control-Lists"><span class="post-toc-text">ACL(Access Control Lists)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#AC%E8%A7%84%E5%88%99%E5%AE%9A%E4%B9%89"><span class="post-toc-text">ACè§„åˆ™å®šä¹‰</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ACL%E4%BD%BF%E7%94%A8"><span class="post-toc-text">ACLä½¿ç”¨</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ACL%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="post-toc-text">ACLå®ç°åŸç†</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Binary-Trie"><span class="post-toc-text">Binary Trie</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Multi-bit-Trie"><span class="post-toc-text">Multi-bit Trie</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Multi-bit-trie%E4%BC%98%E5%8C%96"><span class="post-toc-text">Multi-bit trieä¼˜åŒ–</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E4%BC%98%E5%8C%961"><span class="post-toc-text">ä¼˜åŒ–1</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E4%BC%98%E5%8C%962"><span class="post-toc-text">ä¼˜åŒ–2</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E4%BC%98%E5%8C%963"><span class="post-toc-text">ä¼˜åŒ–3</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E4%BC%98%E5%8C%964"><span class="post-toc-text">ä¼˜åŒ–4</span></a></li></ol></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Multi-bit-trie%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B"><span class="post-toc-text">Multi-bit trieæ„å»ºæµç¨‹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E8%A7%84%E5%88%99%E7%9A%84%E6%9E%84%E5%BB%BA"><span class="post-toc-text">è§„åˆ™çš„æ„å»º</span></a></li><li class="post-toc-item post-toc-level-5"><a class="post-toc-link" href="#%E8%A7%84%E5%88%99%E9%9B%86%E7%9A%84%E6%9E%84%E5%BB%BA"><span class="post-toc-text">è§„åˆ™é›†çš„æ„å»º</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Node-array"><span class="post-toc-text">Node_array</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#RT-Structure"><span class="post-toc-text">RT Structure</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95"><span class="post-toc-text">åŒ¹é…ç®—æ³•</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#EFD-Elastic-Flow-Distributor"><span class="post-toc-text">EFD(Elastic Flow Distributor)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#EFD%E4%BD%BF%E7%94%A8"><span class="post-toc-text">EFDä½¿ç”¨</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#EFD%E5%8E%9F%E7%90%86"><span class="post-toc-text">EFDåŸç†</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#offline-table%E7%9A%84%E6%9E%84%E5%BB%BA"><span class="post-toc-text">offline tableçš„æ„å»º</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#hash-index%E7%9A%84%E7%A1%AE%E5%AE%9A"><span class="post-toc-text">hash_indexçš„ç¡®å®š</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#chunk%E7%9A%84%E5%BC%95%E8%BF%9B"><span class="post-toc-text">chunkçš„å¼•è¿›</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%9F%A5%E6%89%BE%E6%B5%81%E7%A8%8B"><span class="post-toc-text">æŸ¥æ‰¾æµç¨‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E7%BB%84%E7%9A%84%E9%87%8D%E5%B9%B3%E8%A1%A1"><span class="post-toc-text">ç»„çš„é‡å¹³è¡¡</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Packet-Distributor"><span class="post-toc-text">Packet Distributor</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Distributor%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="post-toc-text">Distributorçš„ä½¿ç”¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Reorder"><span class="post-toc-text">Reorder</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#IP-Frag"><span class="post-toc-text">IP Frag</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Packet-fragmentation"><span class="post-toc-text">Packet fragmentation</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Packet-reassembly"><span class="post-toc-text">Packet reassembly</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Membership"><span class="post-toc-text">Membership</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Membership%E4%BD%BF%E7%94%A8"><span class="post-toc-text">Membershipä½¿ç”¨</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Membership%E5%8E%9F%E7%90%86"><span class="post-toc-text">MembershipåŸç†</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#HTSS-Hash-table-based-set-summary"><span class="post-toc-text">HTSS(Hash-table based set-summary)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#BF-Bloom-Filter"><span class="post-toc-text">BF(Bloom Filter)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%81%87%E9%98%B3%E7%8E%87%E7%9A%84%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="post-toc-text">å‡é˜³ç‡çš„è¡¨è¾¾å¼</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#BF%E6%89%80%E4%BD%BF%E7%94%A8%E7%9A%84bitmap%E4%BD%8D%E6%95%B0m%E7%9A%84%E7%A1%AE%E5%AE%9A"><span class="post-toc-text">BFæ‰€ä½¿ç”¨çš„bitmapä½æ•°mçš„ç¡®å®š</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#BF%E6%89%80%E4%BD%BF%E7%94%A8%E7%9A%84hash%E6%95%B0k%E7%9A%84%E7%A1%AE%E5%AE%9A"><span class="post-toc-text">BFæ‰€ä½¿ç”¨çš„hashæ•°kçš„ç¡®å®š</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E5%A4%9A%E9%9B%86%E5%90%88%E7%9A%84%E6%94%AF%E6%8C%81"><span class="post-toc-text">å¤šé›†åˆçš„æ”¯æŒ</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Sketch"><span class="post-toc-text">Sketch</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BC%98%E5%8C%961-1"><span class="post-toc-text">ä¼˜åŒ–1</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BC%98%E5%8C%962-1"><span class="post-toc-text">ä¼˜åŒ–2</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E4%BC%98%E5%8C%963-1"><span class="post-toc-text">ä¼˜åŒ–3</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#%E9%A2%9D%E5%A4%96API"><span class="post-toc-text">é¢å¤–API</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Graph"><span class="post-toc-text">Graph</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Node"><span class="post-toc-text">Node</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Node%E5%87%BA%E8%BE%B9%E7%9A%84%E6%9B%B4%E6%96%B0"><span class="post-toc-text">Nodeå‡ºè¾¹çš„æ›´æ–°</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Graph-object"><span class="post-toc-text">Graph object</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%9B%BE%E9%81%8D%E5%8E%86"><span class="post-toc-text">å›¾éå†</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Graph%E4%BD%BF%E7%94%A8"><span class="post-toc-text">Graphä½¿ç”¨</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#PacketFrame"><span class="post-toc-text">PacketFrame</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Port"><span class="post-toc-text">Port</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Table"><span class="post-toc-text">Table</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Pipeline"><span class="post-toc-text">Pipeline</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Ethdev"><span class="post-toc-text">Ethdev</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#%E7%BD%91%E5%8D%A1%E7%A1%AC%E4%BB%B6%E7%89%B9%E6%80%A7"><span class="post-toc-text">ç½‘å¡ç¡¬ä»¶ç‰¹æ€§</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#RSS-Receiver-Side-Scaling"><span class="post-toc-text">RSS(Receiver Side Scaling)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#LRO-Large-Receive-Offload"><span class="post-toc-text">LRO(Large Receive Offload)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#TSO-TCP-Segmentation-Offloading"><span class="post-toc-text">TSO(TCP Segmentation Offloading)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#VMDq-Virtual-Machine-Device-Queues"><span class="post-toc-text">VMDq(Virtual Machine Device Queues)</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#DCB-Data-Center-Bridging"><span class="post-toc-text">DCB(Data Center Bridging)</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Flow"><span class="post-toc-text">Flow</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E8%A7%84%E5%88%99%E5%B1%9E%E6%80%A7"><span class="post-toc-text">è§„åˆ™å±æ€§</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E6%A8%A1%E5%BC%8F%E5%8C%B9%E9%85%8D"><span class="post-toc-text">æ¨¡å¼åŒ¹é…</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Meta-item"><span class="post-toc-text">Meta item</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#Data-matching-item"><span class="post-toc-text">Data matching item</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%8A%A8%E4%BD%9C"><span class="post-toc-text">åŠ¨ä½œ</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Flow%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="post-toc-text">Flowçš„ä½¿ç”¨</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Misc"><span class="post-toc-text">Misc</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#ASAN-AddressSanitizer"><span class="post-toc-text">ASAN(AddressSanitizer)</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ASAN%E5%8E%9F%E7%90%86"><span class="post-toc-text">ASANåŸç†</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%86%85%E5%AD%98%E6%A3%80%E6%B5%8B"><span class="post-toc-text">å†…å­˜æ£€æµ‹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%84"><span class="post-toc-text">å†…å­˜æ˜ å°„</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#dpdk%E5%AF%B9asan%E7%9A%84%E6%94%AF%E6%8C%81"><span class="post-toc-text">dpdkå¯¹asançš„æ”¯æŒ</span></a></li></ol></li></ol>
            
        
        <div class=".article-gallery"><h1 id="ç¼–è¯‘"><a href="#ç¼–è¯‘" class="headerlink" title="ç¼–è¯‘"></a>ç¼–è¯‘</h1><p>ç¼–è¯‘ç›®å½•ä¸º<code>build</code>çš„æƒ…å†µä¸‹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meson configure build			<span class="comment">#æŸ¥çœ‹ç¼–è¯‘é€‰é¡¹</span></span><br><span class="line">meson configure build -Dxxx=xxx		<span class="comment">#æ›´æ”¹ç¼–è¯‘é€‰é¡¹</span></span><br></pre></td></tr></table></figure>



<h1 id="è¿è¡Œå‚æ•°"><a href="#è¿è¡Œå‚æ•°" class="headerlink" title="è¿è¡Œå‚æ•°"></a>è¿è¡Œå‚æ•°</h1><h2 id="å‰ç½®æ¦‚å¿µ"><a href="#å‰ç½®æ¦‚å¿µ" class="headerlink" title="å‰ç½®æ¦‚å¿µ"></a>å‰ç½®æ¦‚å¿µ</h2><ol>
<li>lcoreæŒ‡çš„æ˜¯å¤„ç†å™¨çš„é€»è¾‘æ‰§è¡Œå•å…ƒï¼Œæ›´å¤šçš„è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚ç¼–å·ä»0å¼€å§‹ï¼Œæœ€å¤§<strong>RTE_MAX_LCORE - 1</strong>ï¼Œå¯é€šè¿‡ç¼–è¯‘é€‰é¡¹<code>max_lcore</code>ä¿®æ”¹æ”¯æŒçš„æœ€å¤§lcoreæ•°é‡</li>
<li>åœ¨ä¸»æ¿ä¸Šä¸€ä¸ªç‰©ç†cpuå¯¹åº”ä¸€ä¸ªæ’æ§½ï¼ˆCPU Socketï¼‰ï¼Œè€Œæ¯ä¸ªç‰©ç†cpuä¸­åˆæœ‰å¤šä¸ªæ ¸å¿ƒï¼ˆCoreï¼‰ï¼Œå¦‚æœcpuæ”¯æŒè¶…çº¿ç¨‹ï¼ˆcoreå†…å…±äº«ALUï¼‰ä¸”å¼€å¯è¶…çº¿ç¨‹çš„è¯ï¼Œæ¯ä¸ªæ ¸å¿ƒä¼šå¯¹åº”ä¸¤ä¸ªé€»è¾‘æ ¸ï¼ˆLogical coreï¼‰ï¼Œå¦åˆ™æ¯ä¸ªæ ¸å¿ƒå¯¹åº”ä¸€ä¸ªé€»è¾‘æ ¸ã€‚</li>
</ol>
<h2 id="lcoreç›¸å…³é€‰é¡¹"><a href="#lcoreç›¸å…³é€‰é¡¹" class="headerlink" title="lcoreç›¸å…³é€‰é¡¹"></a>lcoreç›¸å…³é€‰é¡¹</h2><table>
<thead>
<tr>
<th align="center">é€‰é¡¹</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-c</td>
<td align="left">è®¾ç½®æ‰€å¯ç”¨çš„lcoreï¼Œ16è¿›åˆ¶æ©ç ï¼Œlcoreä¸å…¶æ‰€ä½¿ç”¨çš„cpuçš„é€»è¾‘æ ¸ä¸€ä¸€å¯¹åº”ã€‚</td>
</tr>
<tr>
<td align="center">-l</td>
<td align="left">è®¾ç½®æ‰€å¯ç”¨çš„lcoreï¼Œåˆ—è¡¨å½¢å¼ï¼ˆä¾‹ï¼š<code>-l 0-5,7</code>ï¼‰ï¼Œlcoreä¸å…¶æ‰€ä½¿ç”¨çš„cpuçš„é€»è¾‘æ ¸ä¸€ä¸€å¯¹åº”ã€‚</td>
</tr>
<tr>
<td align="center">â€“lcores</td>
<td align="left">è®¾ç½®æ‰€å¯ç”¨çš„lcoreï¼ŒåŒæ—¶è®¾ç½®lcoreæ‰€ä½¿ç”¨çš„cpuçš„é€»è¾‘æ ¸ã€‚<br>ä¾‹å¦‚ï¼š<code>--lcores 1,2@(5-7),(3-5)@(0,2),(0,6),7-8</code><br>lcore 0 runs on cpuset 0x41 (cpu 0,6) <br>lcore 1 runs on cpuset 0x2 (cpu 1) <br>lcore 2 runs on cpuset 0xe0 (cpu 5,6,7) <br>lcore 3,4,5 runs on cpuset 0x5 (cpu 0,2) <br>lcore 6 runs on cpuset 0x41 (cpu 0,6) <br>lcore 7 runs on cpuset 0x80 (cpu 7) <br>lcore 8 runs on cpuset 0x100 (cpu 8)</td>
</tr>
</tbody></table>
<h2 id="å¤šè¿›ç¨‹ç›¸å…³é€‰é¡¹"><a href="#å¤šè¿›ç¨‹ç›¸å…³é€‰é¡¹" class="headerlink" title="å¤šè¿›ç¨‹ç›¸å…³é€‰é¡¹"></a>å¤šè¿›ç¨‹ç›¸å…³é€‰é¡¹</h2><table>
<thead>
<tr>
<th align="center">é€‰é¡¹</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">â€“proc-type</td>
<td align="left">ä¸»å‰¯è¿›ç¨‹è®¾ç½®ï¼Œä¸è®¾ç½®çš„è¯é»˜è®¤ä½œä¸ºä¸»è¿›ç¨‹</td>
</tr>
<tr>
<td align="center">â€“file-prefix</td>
<td align="left">1. è¿è¡Œç›®å½•ï¼ˆç”¨äºå¤šè¿›ç¨‹æ•°æ®å…±äº«ï¼‰ä¸‹åˆ›å»ºæŒ‡å®šåç§°çš„è¿è¡Œå­ç›®å½•<br>2. å¤§é¡µæ–‡ä»¶åå‰ç¼€<br>ä¸é…ç½®çš„æƒ…å†µä¸‹é»˜è®¤ä¸ºrteï¼Œè¯¥é€‰é¡¹å…è®¸å¤šä¸ªç‹¬ç«‹çš„dpdkè¿è¡Œã€‚<br>ä¾‹ï¼š<br>DPDK-Aä½¿ç”¨<code>/user/1000/dpdk/a/</code>å…±äº«æ•°æ®<br>DPDK-Bä½¿ç”¨<code>/user/1000/dpdk/b/</code>å…±äº«æ•°æ®</td>
</tr>
</tbody></table>
<blockquote>
<p>å¤šè¿›ç¨‹æ—¶è¦ä¿è¯ä¸»å‰¯è¿›ç¨‹æ‰€ä½¿ç”¨çš„lcoreäº’æ–¥ï¼Œå¦åˆ™ä¼šäº§ç”Ÿå†…å­˜æ± ç¼“å­˜æŸåç­‰é—®é¢˜</p>
</blockquote>
<h2 id="å†…å­˜ç›¸å…³é€‰é¡¹"><a href="#å†…å­˜ç›¸å…³é€‰é¡¹" class="headerlink" title="å†…å­˜ç›¸å…³é€‰é¡¹"></a>å†…å­˜ç›¸å…³é€‰é¡¹</h2><table>
<thead>
<tr>
<th align="center">é€‰é¡¹</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">â€“in-memory</td>
<td align="left">ä¸åˆ›å»ºä»»ä½•å…±äº«æ•°æ®ï¼Œå®Œå…¨è¿è¡Œåœ¨å†…å­˜ä¸­ã€‚é…ç½®äº†è¯¥é€‰é¡¹é»˜è®¤é…ç½®äº†â€“no-shconfå’Œâ€“huge-unlink=alwaysã€‚<br>è¯¥é€‰é¡¹æ”¯æŒå¤§é¡µæ˜ å°„ï¼Œä¸éœ€è¦æŒ‚è½½hugetlbfsï¼Œä¸æ”¯æŒå¤šè¿›ç¨‹</td>
</tr>
<tr>
<td align="center">â€“huge-dir</td>
<td align="left">æŒ‡å®šè¯¥ç¨‹åºä½¿ç”¨å¤§é¡µçš„ç›®å½•ï¼Œè¯¥ç›®å½•è¦æ±‚å·²ç»æŒ‚è½½hugetlbfsæ–‡ä»¶ç³»ç»Ÿï¼Œä¸æŒ‡å®šè¯¥é€‰é¡¹é»˜è®¤é€‰æ‹©æŒ‚è½½hugetlbfsæ–‡ä»¶ç³»ç»Ÿçš„æ ¹ç›®å½•ä½œä¸ºè¯¥ç¨‹åºä½¿ç”¨å¤§é¡µçš„ç›®å½•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸€æ—¦è®¾ç½®äº†è¯¥é€‰é¡¹ï¼Œå°±è¡¨æ˜è¯¥ç¨‹åºåªèƒ½ä½¿ç”¨ä¸€ç§å¤§é¡µ</td>
</tr>
<tr>
<td align="center">â€“match-allocations</td>
<td align="left">å›æ”¶å†…å­˜æ—¶å¦‚æœç›¸é‚»å—ç©ºé—²èƒ½å¤Ÿè¿›è¡Œåˆå¹¶ï¼Œåˆ™ä»…åˆå¹¶ä¸ºæœ€åˆåˆ†é…æ—¶çš„å—å¤§å°ã€‚ä¸æ”¯æŒ<code>--legacy-mem</code>ï¼Œä¹Ÿä¸æ”¯æŒ<code>--no-huge</code></td>
</tr>
<tr>
<td align="center">â€“huge-worker-stack</td>
<td align="left">å¯ä»¥æŒ‡å®šä½¿ç”¨å¤§é¡µå†…å­˜ä½œä¸ºworkerçº¿ç¨‹çš„æ ˆ</td>
</tr>
<tr>
<td align="center">â€“huge-unlink</td>
<td align="left">alwaysï¼šdpdkåœ¨åˆ›å»ºå¤§é¡µæ–‡ä»¶æ—¶ï¼Œè‹¥å¾…åˆ›å»ºçš„å¤§é¡µæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™åˆ é™¤ååˆ›å»ºã€‚åˆ›å»ºååå°±æ‰§è¡Œunlinkå‡½æ•°ï¼Œåˆ é™¤å¯¹åº”å¤§é¡µæ–‡ä»¶ã€‚å› æ­¤å¤šè¿›ç¨‹æ¨¡å¼ä¸èƒ½é…ç½®è¯¥é€‰é¡¹ã€‚<br>existingï¼šdpdkåœ¨åˆ›å»ºå¤§é¡µæ–‡ä»¶æ—¶ï¼Œè‹¥å¾…åˆ›å»ºçš„å¤§é¡µæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™åˆ é™¤ååˆ›å»ºã€‚å¹¶ä¸”dpdké€€å‡ºåä¾ç„¶ä¿ç•™å¤§é¡µæ–‡ä»¶(è‹¥ä¸»è¿›ç¨‹æŒ‚æ‰ï¼Œæ­¤æ—¶å‰¯è¿›ç¨‹ä»å¯ä½¿ç”¨å¯¹åº”å¤§é¡µæ–‡ä»¶ï¼Œä¹Ÿæ˜¯dpdké»˜è®¤çš„é…ç½®)<br>neverï¼šdpdkåœ¨åˆ›å»ºå¤§é¡µæ–‡ä»¶æ—¶ï¼Œè‹¥å¾…åˆ›å»ºçš„å¤§é¡µæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨è¯¥å¤§é¡µæ–‡ä»¶ï¼Œå¹¶å¯¹ä½¿ç”¨è¯¥å¤§é¡µçš„å†…å­˜æ ‡è®°ä¸ºè„é¡µ</td>
</tr>
<tr>
<td align="center">â€“no-huge</td>
<td align="left">ä¸ä½¿ç”¨å¤§é¡µï¼Œé…ç½®äº†è¯¥é€‰é¡¹å°±é»˜è®¤é…ç½®äº†<code>--legacy-mem</code></td>
</tr>
<tr>
<td align="center">â€“legacy-mem</td>
<td align="left">è‹¥é…ç½®äº†-mï¼Œåˆ™æ˜ å°„æ—¶ä¸è€ƒè™‘å¤§é¡µæ‰€å±çš„nodeèŠ‚ç‚¹ï¼›è‹¥é…ç½®äº†â€“socket-memï¼Œåˆ™æŒ‰ç…§æ¯numaçš„å†…å­˜æ•°è¦æ±‚å»æ˜ å°„</td>
</tr>
</tbody></table>
<blockquote>
<p>â€“huge-unlink=neverè™½ç„¶å¯ä»¥åŠ é€Ÿdpdkçš„restartï¼Œä½†restartåæ— æ³•å¾—çŸ¥ä¿ç•™æ–‡ä»¶æ‰€å¤„çš„socketèŠ‚ç‚¹ï¼Œdpdkåœ¨ç»Ÿè®¡æ“ä½œç³»ç»Ÿä¸­å¤§é¡µä¿¡æ¯æ—¶é»˜è®¤å°±ç›´æ¥å°†å¤§é¡µæ•°é‡ç»Ÿè®¡åˆ°socket0ä¸Šï¼Œå¦‚æœdpdk applicationé…ç½®äº†â€“socket-memï¼Œrestartæ—¶å¾ˆå¯èƒ½æ— æ³•æ»¡è¶³éœ€æ±‚ï¼›è‹¥é…ç½®äº†-mï¼Œå¾ˆå¯èƒ½restartæ—¶éƒ½ç”³è¯·æˆsocket0ä¸Šçš„å†…å­˜ï¼Œå®é™…socket0ä¸Šæ‰€é…ç½®çš„å¤§é¡µè¿˜å¯èƒ½æ— æ³•æ»¡è¶³ã€‚</p>
</blockquote>
<h2 id="Debuggingé€‰é¡¹"><a href="#Debuggingé€‰é¡¹" class="headerlink" title="Debuggingé€‰é¡¹"></a>Debuggingé€‰é¡¹</h2><h2 id="å…¶ä»–é€‰é¡¹"><a href="#å…¶ä»–é€‰é¡¹" class="headerlink" title="å…¶ä»–é€‰é¡¹"></a>å…¶ä»–é€‰é¡¹</h2><table>
<thead>
<tr>
<th align="center">é€‰é¡¹</th>
<th align="left">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center">-s</td>
<td align="left">è®¾ç½®æ‰€å¯ç”¨çš„service coreï¼Œ16è¿›åˆ¶æ©ç ï¼Œè¯¥é€‰é¡¹éœ€è¦åœ¨lcoreç›¸å…³é€‰é¡¹ä¹‹åé…ç½®ï¼Œå°†å¯¹åº”çš„lcoreæ›¿æ¢ä¸ºservice coreã€‚</td>
</tr>
</tbody></table>
<h1 id="EAL-Environment-Abstraction-Layer"><a href="#EAL-Environment-Abstraction-Layer" class="headerlink" title="EAL(Environment Abstraction Layer)"></a>EAL(Environment Abstraction Layer)</h1><p>dpdkçš„åŸºæœ¬è¿è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p>
<p><a href="/images/linuxapp_launch.svg" title="init" class="gallery-item" style="box-shadow: none;"> <img src="/images/linuxapp_launch.svg" alt="init"></a></p>
<h2 id="Plugin"><a href="#Plugin" class="headerlink" title="Plugin"></a>Plugin</h2><p>ç”¨äºåŠ è½½å„ç±»ç”¨æˆ·æ€é©±åŠ¨ï¼Œè¿™äº›é©±åŠ¨soæ”¾åœ¨<code>/usr/local/lib/x86_64-linux-gnu/dpdk/pmds-24.1</code>ç›®å½•ä¸‹ï¼Œè¯¥ç›®å½•ä¸‹æ‰€æœ‰çš„soéƒ½å°†è¢«åŠ è½½åˆ°è¯¥è¿›ç¨‹ä¸­ã€‚(é™æ€ç¼–è¯‘çš„ç¨‹åºä¼šè·³è¿‡pluginåŠ è½½)</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">eal_plugins_init</span><span class="params">(<span class="type">void</span>)</span></span><br></pre></td></tr></table></figure>



<h2 id="Trace"><a href="#Trace" class="headerlink" title="Trace"></a>Trace</h2><p>å½“æˆ‘ä»¬æƒ³è¦è°ƒè¯•åˆ†æç¨‹åºï¼Œç‰¹åˆ«æ˜¯æƒ³è¦çŸ¥é“ç¨‹åºåœ¨è¿è¡Œæ—¶å¤šæ ¸åŒæ­¥æƒ…å†µï¼Œè¿™æ—¶ä½¿ç”¨DPDKæ‰€æä¾›çš„TraceåŠŸèƒ½æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚Traceæ¨¡å—é€šè¿‡æ³¨å†Œè¿½è¸ªç‚¹ï¼Œåœ¨ä»£ç ä¸­è®¾ç½®è¿½è¸ªå‡½æ•°æ¥è®°å½•ç¨‹åºçš„è¿è¡Œæ•°æ®ï¼Œè¿™ä¸å†…æ ¸ä¸­çš„<strong>é™æ€æ¢é’ˆ</strong>ç±»ä¼¼ã€‚ç¨‹åºå¯åŠ¨æ—¶å¿…é¡»é…ç½®<code>--trace=</code>é€‰é¡¹æ‰å¯ä½¿èƒ½traceåŠŸèƒ½ï¼Œç¨‹åºé€€å‡ºæ—¶å°†è®°å½•çš„ä¿¡æ¯ä»¥<a target="_blank" rel="noopener" href="https://diamon.org/ctf/">CTF</a>ï¼ˆCommon Trace Formatï¼‰æ ¼å¼å­˜æ”¾åœ¨<code>$/HOME/dpdk-traces</code>æˆ–è€…ç”¨æˆ·é…ç½®<code>--trace-dir</code>æŒ‡å®šçš„ç›®å½•ä¸­ã€‚</p>
<p>ä½¿ç”¨<code>babeltrace</code>å‘½ä»¤æŸ¥çœ‹traceä¿¡æ¯ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[wtc@wufa ~]$ babeltrace <span class="variable">$HOME</span>/dpdk-traces/rte-2023-12-30-PM-12-27-51</span><br><span class="line">[12:27:50.328509331] (+?.?????????) lib.eal.thread.lcore.ready: { cpu_id = 0x1, name = <span class="string">"dpdk-worker1"</span> }, { lcore_id = 0x1, cpuset = <span class="string">"1"</span> }</span><br><span class="line">[12:27:50.328567752] (+0.000058421) lib.eal.thread.lcore.ready: { cpu_id = 0x2, name = <span class="string">"dpdk-worker2"</span> }, { lcore_id = 0x2, cpuset = <span class="string">"2"</span> }</span><br><span class="line">[12:27:50.328584117] (+0.000016365) lib.eal.thread.lcore.running: { cpu_id = 0x1, name = <span class="string">"dpdk-worker1"</span> }, { lcore_id = 0x1, f = 0x7F2D9A54E362 }</span><br><span class="line">[12:27:50.328584343] (+0.000000226) lib.eal.thread.lcore.stopped: { cpu_id = 0x1, name = <span class="string">"dpdk-worker1"</span> }, { lcore_id = 0x1 }</span><br><span class="line">[12:27:50.328591812] (+0.000007469) lib.eal.thread.remote.launch: { cpu_id = 0x0, name = <span class="string">"dpdk-test"</span> }, { f = 0x7F2D9A54E362, arg = 0x0, worker_id = 0x1, rc = 0 }</span><br></pre></td></tr></table></figure>



<h3 id="è¿½è¸ªç‚¹çš„å»ºç«‹"><a href="#è¿½è¸ªç‚¹çš„å»ºç«‹" class="headerlink" title="è¿½è¸ªç‚¹çš„å»ºç«‹"></a>è¿½è¸ªç‚¹çš„å»ºç«‹</h3><p>è¿½è¸ªç‚¹è¢«å®šä¹‰ä¸ºä¸€ä¸ªå‡½æ•°ï¼ˆinlineï¼‰ï¼Œé€šè¿‡åœ¨ä»£ç ä¸­è°ƒç”¨è¿½è¸ªç‚¹å‡½æ•°æ¥å®ç°è¿½è¸ªä¿¡æ¯çš„è®°å½•ã€‚ä»¥<code>test_trace.h</code>æ–‡ä»¶æ¥ä¸¾ä¾‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;rte_trace_point.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿½è¸ªç‚¹å‡½æ•°å®šä¹‰å®</span></span><br><span class="line">RTE_TRACE_POINT(</span><br><span class="line">	app_dpdk_test_tp,						<span class="comment">//è¿½è¸ªç‚¹å‡½æ•°</span></span><br><span class="line">	RTE_TRACE_POINT_ARGS(<span class="type">const</span> <span class="type">char</span> *str),	<span class="comment">//è¿½è¸ªç‚¹å‡½æ•°å…¥å‚ï¼ˆè¯¥å…¥å‚å°±æ˜¯éœ€è¦è¿½è¸ªçš„å˜é‡ï¼‰</span></span><br><span class="line">	rte_trace_point_emit_string(str);		<span class="comment">//è¿½è¸ªç‚¹å‡½æ•°å†…éƒ¨çš„å…¥å‚è®°å½•å‡½æ•°ï¼ˆæ¯ä¸ªå…¥å‚éƒ½éœ€è¦å¯¹åº”å…¥å‚ç±»å‹çš„è®°å½•å‡½æ•°ï¼‰</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿½è¸ªç‚¹å‡½æ•°å®šä¹‰å®ï¼Œç”¨è¯¥å®å®šä¹‰çš„è¿½è¸ªç‚¹å‡½æ•°ï¼Œä»…åœ¨ç¼–è¯‘æ—¶ä½¿èƒ½enable_trace_fpé€‰é¡¹æ—¶ï¼Œè¿½è¸ªç‚¹å‡½æ•°æ‰ä¼šç”Ÿæ•ˆï¼Œå¦åˆ™è¯¥å‡½æ•°å®šä¹‰ä¸ºç©ºå‡½æ•°</span></span><br><span class="line">RTE_TRACE_POINT_FP(</span><br><span class="line">	app_dpdk_test_fp,</span><br><span class="line">	RTE_TRACE_POINT_ARGS(<span class="type">void</span>),</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>åœ¨å¤´æ–‡ä»¶æ²¡æœ‰åŒ…å«<code>rte_trace_point_register.h</code>çš„æƒ…å†µä¸‹ï¼Œ<code>app_dpdk_test_tp</code>å‡½æ•°å®šä¹‰ä¸ºè¿½è¸ªç‚¹å‡½æ•°ï¼Œè¿è¡Œæ—¶è°ƒç”¨ã€‚åœ¨éœ€è¦è¿½è¸ªçš„ä»£ç ä¸­ç›´æ¥åŒ…å«è¯¥å¤´æ–‡ä»¶ï¼Œè°ƒç”¨è¯¥å‡½æ•°å³å¯ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;test_trace.h&gt;</span></span></span><br><span class="line">...</span><br><span class="line"><span class="type">void</span> <span class="title function_">test</span><span class="params">(<span class="type">void</span>)</span> {</span><br><span class="line">    <span class="type">char</span> *t = <span class="string">"This is test"</span>;</span><br><span class="line">    app_dpdk_test_tp(t);</span><br><span class="line">}</span><br><span class="line">...</span><br></pre></td></tr></table></figure>



<h3 id="è¿½è¸ªç‚¹çš„æ³¨å†Œ"><a href="#è¿½è¸ªç‚¹çš„æ³¨å†Œ" class="headerlink" title="è¿½è¸ªç‚¹çš„æ³¨å†Œ"></a>è¿½è¸ªç‚¹çš„æ³¨å†Œ</h3><p>ä¸€ä¸ªè¿½è¸ªç‚¹è¦æƒ³å·¥ä½œï¼Œå…‰æ˜¯åœ¨ä»£ç ä¸­è°ƒç”¨è¿½è¸ªç‚¹å‡½æ•°æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦å°†æ¯ä¸ªè¿½è¸ªç‚¹æ³¨å†Œåˆ°Traceæ¨¡å—ä¸Šã€‚ä»¥<code>test_trace_register.c</code>æ–‡ä»¶æ¥ä¸¾ä¾‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;rte_trace_point_register.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">"test_trace.h"</span>		<span class="comment">//è¿½è¸ªç‚¹æ³¨å†Œå‡½æ•°ï¼Œåœ¨è¿™é‡Œå®šä¹‰</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¿½è¸ªç‚¹çš„æ³¨å†Œå®</span></span><br><span class="line">RTE_TRACE_POINT_REGISTER(</span><br><span class="line">    app_dpdk_test_tp, 		<span class="comment">//è¿½è¸ªç‚¹æ³¨å†Œå‡½æ•°ï¼Œåœ¨è¿™é‡Œè°ƒç”¨</span></span><br><span class="line">    app.dpdk.test.tp		<span class="comment">//è¿½è¸ªç‚¹åç§°ï¼Œè¿è¡Œæ—¶é€šè¿‡'--trace='é€‰é¡¹æ¥ä½¿èƒ½è¯¥æ³¨å†Œç‚¹</span></span><br><span class="line">)</span><br><span class="line">    </span><br><span class="line">RTE_TRACE_POINT_REGISTER(</span><br><span class="line">    app_dpdk_test_fp, </span><br><span class="line">    app.dpdk.test.fp</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>åœ¨å¤´æ–‡ä»¶åŒ…å«<code>rte_trace_point_register.h</code>çš„æƒ…å†µä¸‹ï¼Œ<code>app_dpdk_test_tp</code>å‡½æ•°å®šä¹‰ä¸ºè¿½è¸ªç‚¹æ³¨å†Œå‡½æ•°ï¼Œæ³¨å†Œæ—¶è°ƒç”¨ã€‚è™½ç„¶åå­—ä¸€æ ·ï¼Œä½†è¿™ä¸ä¸Šé¢æ‰€å®šä¹‰çš„è¿½è¸ªç‚¹å‡½æ•°æ˜¯ä¸¤ä¸ªå‡½æ•°ï¼Œä¸è¦å°†ä¸¤è€…æ··æ·†ã€‚</p>
<h3 id="TraceåŸç†"><a href="#TraceåŸç†" class="headerlink" title="TraceåŸç†"></a>TraceåŸç†</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_TRACE_POINT_REGISTER(trace, name) \</span></span><br><span class="line"><span class="meta">rte_trace_point_t __attribute__((section(<span class="string">"__rte_trace_point"</span>))) __##trace; \</span></span><br><span class="line"><span class="meta">static const char __##trace##_name[] = RTE_STR(name); \</span></span><br><span class="line"><span class="meta">RTE_INIT(trace##_init) \</span></span><br><span class="line"><span class="meta">{ \</span></span><br><span class="line"><span class="meta">	__rte_trace_point_register(&amp;__##trace, __##trace##_name, \</span></span><br><span class="line"><span class="meta">		(void (*)(void)) trace); \</span></span><br><span class="line"><span class="meta">}</span></span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­<code>rte_trace_point_t</code>ç±»å‹å°±æ˜¯å¯¹è¿½è¸ªç‚¹çš„æŠ½è±¡ï¼Œè¯¥ç±»å‹å„ä½çš„å«ä¹‰å¦‚ä¸‹ï¼š</p>
<ul>
<li>0~15ä½è®°å½•è¯¥tracepointéœ€è¦è®°å½•çš„æ•°æ®é•¿åº¦</li>
<li>16~47ä½è®°å½•åœ¨traceé“¾è¡¨ä¸­å¤„äºç¬¬å‡ ä¸ªï¼ˆç”¨ä½œctfä¸­çš„äº‹ä»¶idï¼‰</li>
<li>62ä½è®°å½•traceæ¨¡å¼ï¼ˆoverwrite/discardï¼‰,63ä½è®°å½•è¯¥tracepointæ˜¯å¦ä½¿èƒ½</li>
</ul>
<p>é‡è¦çš„æ˜¯<code>__rte_trace_point_register</code>å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¸»è¦çš„å·¥ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li>ç”Ÿæˆevent CTF metadata</li>
<li>è®¾ç½®è¯¥è¿½è¸ªç‚¹çš„<code>rte_trace_point_t</code></li>
<li>å°†ä¸Šè¿°å†…å®¹å°è£…æˆ<code>struct trace_point</code>ç»“æ„æŒ‚åˆ°<code>tp_list</code>è¿™ä¸ªå…¨å±€é“¾è¡¨ä¸Š</li>
</ul>
<p>è¿™äº›è¿½è¸ªç‚¹çš„æ³¨å†Œéƒ½æ˜¯åœ¨mainä¹‹å‰å®Œæˆï¼Œè€Œåä¼šåœ¨<code>eal_trace_init()</code>ä¸­åšæœ€ç»ˆçš„åˆå§‹åŒ–</p>
<p><code>eal_trace_init()</code>ä¸»è¦å·¥ä½œå¦‚ä¸‹ï¼š</p>
<ul>
<li>ç”ŸæˆCTF TSDL(<em>Trace Stream Description Language</em>) metadataï¼ŒåŒ…å«<code>tp_list</code>ä¸Šçš„event metadata</li>
<li>æ ¹æ®è¿è¡Œå‚æ•°ä½¿èƒ½å¯¹åº”çš„è¿½è¸ªç‚¹</li>
</ul>
<p>åˆå§‹åŒ–å®Œæˆåï¼Œtraceæ¨¡å—å°±å¼€å§‹è¿è¡Œäº†ã€‚åœ¨è¿è¡ŒæœŸé—´æ¯ä¸ªlcoreéƒ½ä¼šæœ‰ä¸€ä¸ª<code>struct __rte_trace_header</code>å˜é‡ï¼Œè¯¥ç»“æ„ç”¨äºè®°å½•CTFçš„stream dataï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¿½è¸ªçš„è¿è¡ŒæœŸé—´çš„æ•°æ®äº†ã€‚</p>
<p>æœ€ç»ˆCTFæ–‡ä»¶çš„ç”Ÿæˆå¯é€šè¿‡è°ƒç”¨<code>rte_trace_save()</code>å‡½æ•°ï¼Œæˆ–è€…ç›´æ¥ç»“æŸç¨‹åºä»è€Œå°†traceæ•°æ®dumpåˆ°æŒ‡å®šç›®å½•ä¸­è¿›è¡ŒæŸ¥çœ‹ã€‚</p>
<h2 id="Interrupt"><a href="#Interrupt" class="headerlink" title="Interrupt"></a>Interrupt</h2><p>ç”¨äºè¿›è¡Œä¸­æ–­å¤„ç†ï¼ŒåŒ…æ‹¬deviceä¸­æ–­å’Œalarmä¸­æ–­ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rte_eal_intr_init()</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºä¸­æ–­å¤„ç†çº¿ç¨‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> __rte_noreturn <span class="type">uint32_t</span> <span class="title function_">eal_intr_thread_main</span><span class="params">(__rte_unused <span class="type">void</span> *arg)</span></span><br></pre></td></tr></table></figure>



<h2 id="Alarm"><a href="#Alarm" class="headerlink" title="Alarm"></a>Alarm</h2><p>ä½¿ç”¨ä¸­æ–­æº<code>intr_handle</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">rte_eal_alarm_set</span><span class="params">(<span class="type">uint64_t</span> us, rte_eal_alarm_callback cb_fn, <span class="type">void</span> *cb_arg)</span>	<span class="comment">//alarmæ³¨å†Œ</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_eal_alarm_cancel</span><span class="params">(rte_eal_alarm_callback cb_fn, <span class="type">void</span> *cb_arg)</span>		<span class="comment">//alarmå–æ¶ˆ</span></span><br></pre></td></tr></table></figure>

<p>alarmæ³¨å†Œåé»˜è®¤åªè¿è¡Œä¸€æ¬¡<code>cb_fn</code>ï¼Œè¦æƒ³ä½¿ç”¨å‘¨æœŸæ€§çš„alarmï¼Œéœ€è¦æ‰‹åŠ¨åœ¨<code>cb_fn</code>ä¸­è°ƒç”¨<code>rte_eal_alarm_set</code>å‡½æ•°ã€‚</p>
<h2 id="Multi-process"><a href="#Multi-process" class="headerlink" title="Multi-process"></a>Multi-process</h2><h3 id="å¤šè¿›ç¨‹é€šè®¯"><a href="#å¤šè¿›ç¨‹é€šè®¯" class="headerlink" title="å¤šè¿›ç¨‹é€šè®¯"></a>å¤šè¿›ç¨‹é€šè®¯</h3><p>å¤šè¿›ç¨‹é€šè®¯ï¼ŒåŒ…å«ä¸¤ç§é€šè®¯æ¨¡å¼ï¼š</p>
<ul>
<li>å•æ’­é€šè®¯ï¼šsecondaryå‘primaryçš„é€šè®¯æ–¹å¼</li>
<li>å¹¿æ’­é€šè®¯ï¼šprimaryå‘secondaryçš„é€šè®¯æ–¹å¼</li>
</ul>
<p>DPDKçš„IPCåˆ†ä¸º3ç±»ï¼š</p>
<ol>
<li>Messageï¼šé€šçŸ¥ï¼Œä¸éœ€è¦å›å¤ã€‚</li>
<li>Synchronous requestï¼šåŒæ­¥çš„è¯·æ±‚ï¼Œå‘é€ç«¯å‘é€è¯·æ±‚åè¿›å…¥é˜»å¡ï¼ˆéœ€è®¾ç½®å“åº”è¶…æ—¶æ—¶é—´ï¼‰ï¼Œç›´åˆ°æ¥æ”¶åˆ°æ‰€æœ‰å“åº”æˆ–è€…é˜»å¡è¶…æ—¶è¿”å›åˆ°è¯·æ±‚å‡½æ•°ä¸­è¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œæˆåä»è¯·æ±‚ä¸­è¿”å›ã€‚</li>
<li>Asynchronous requestï¼šå¼‚æ­¥çš„è¯·æ±‚ï¼Œå‘é€ç«¯å‘é€è¯·æ±‚åï¼Œè®¾ç½®å“åº”è¶…æ—¶alarmä»¥åŠå›è°ƒå‡½æ•°ï¼Œè€Œåç«‹å³ä»è¯·æ±‚ä¸­è¿”å›ã€‚å½“æ”¶åˆ°æ‰€æœ‰å“åº”æˆ–è€…alarmè¶…æ—¶æ—¶ï¼Œè°ƒç”¨å›è°ƒå‡½æ•°è¿›è¡Œå¤„ç†ï¼ˆæ”¶åˆ°æ‰€æœ‰å“åº”çš„å¤„ç†åœ¨<code>mp-msg</code>çº¿ç¨‹ä¸­å¤„ç†ï¼Œalarmè¶…æ—¶åœ¨<code>intr</code>çº¿ç¨‹ä¸­å¤„ç†ï¼‰</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">rte_mp_action_register</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">rte_mp_t</span> action)</span>	<span class="comment">//æ¥æ”¶ç«¯æ³¨å†Œéœ€è¦å¤„ç†çš„ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">uint32_t</span> <span class="title function_">mp_handle</span><span class="params">(<span class="type">void</span> *arg __rte_unused)</span>		<span class="comment">//å¤šè¿›ç¨‹é€šè®¯æ§åˆ¶å‡½æ•°ï¼Œè´Ÿè´£æ¥æ”¶å’Œå¤„ç†æ”¶åˆ°æ•°æ®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯·æ±‚</span></span><br><span class="line"><span class="keyword">struct</span> rte_mp_msg {</span><br><span class="line">	<span class="type">char</span> name[RTE_MP_MAX_NAME_LEN];</span><br><span class="line">	<span class="type">int</span> len_param;</span><br><span class="line">	<span class="type">int</span> num_fds;</span><br><span class="line">	<span class="type">uint8_t</span> param[RTE_MP_MAX_PARAM_LEN];</span><br><span class="line">	<span class="type">int</span> fds[RTE_MP_MAX_FD_NUM];</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">//å“åº”</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_mp_reply</span> {</span></span><br><span class="line">	<span class="type">int</span> nb_sent;</span><br><span class="line">	<span class="type">int</span> nb_received;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_mp_msg</span> *<span class="title">msgs</span>;</span> <span class="comment">/* caller to free */</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘é€ç«¯å‘é€é€šçŸ¥</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_mp_sendmsg</span><span class="params">(<span class="keyword">struct</span> rte_mp_msg *msg)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å‘é€ç«¯å‘é€åŒæ­¥çš„è¯·æ±‚ï¼Œé˜»å¡çš„è¯·æ±‚æŒ‚åœ¨mp_request_listä¸Š</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_mp_request_sync</span><span class="params">(<span class="keyword">struct</span> rte_mp_msg *req, 		<span class="comment">//è¯·æ±‚çš„ä¿¡æ¯</span></span></span><br><span class="line"><span class="params">                        <span class="keyword">struct</span> rte_mp_reply *reply,		<span class="comment">//å“åº”çš„ä¿¡æ¯</span></span></span><br><span class="line"><span class="params">						<span class="type">const</span> <span class="keyword">struct</span> timespec *ts		<span class="comment">//è¶…æ—¶æ—¶é—´</span></span></span><br><span class="line"><span class="params">)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="title function_">int</span> <span class="params">(*<span class="type">rte_mp_async_reply_t</span>)</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_mp_msg *request,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="keyword">struct</span> rte_mp_reply *reply)</span></span><br><span class="line"><span class="comment">//å‘é€ç«¯å‘é€å¼‚æ­¥çš„è¯·æ±‚ï¼Œå¼‚æ­¥çš„è¯·æ±‚æŒ‚åœ¨pending_requestsä¸Š</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_mp_request_async</span><span class="params">(<span class="keyword">struct</span> rte_mp_msg *req, 		<span class="comment">//è¯·æ±‚çš„ä¿¡æ¯</span></span></span><br><span class="line"><span class="params">                         <span class="type">const</span> <span class="keyword">struct</span> timespec *ts,		<span class="comment">//è¶…æ—¶æ—¶é—´</span></span></span><br><span class="line"><span class="params">                         <span class="type">rte_mp_async_reply_t</span> clb		<span class="comment">//å›è°ƒå‡½æ•°</span></span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>

<p>åœ¨ä½¿ç”¨IPCè¿›è¡Œè¿›ç¨‹é—´é€šè®¯æ—¶ï¼Œä¸èƒ½ä½¿ç”¨dpdkçš„mallocå’Œfreeï¼Œå› ä¸ºdpdkçš„mallocå’Œfreeå†…éƒ¨ä¹Ÿä½¿ç”¨äº†IPCï¼Œè¿™æ ·åšå¯èƒ½ä¼šå¯¼è‡´æ­»é”ã€‚</p>
<h3 id="å¤šè¿›ç¨‹å†…å­˜å…±äº«"><a href="#å¤šè¿›ç¨‹å†…å­˜å…±äº«" class="headerlink" title="å¤šè¿›ç¨‹å†…å­˜å…±äº«"></a>å¤šè¿›ç¨‹å†…å­˜å…±äº«</h3><ul>
<li>primaryè¿›ç¨‹ï¼šè¿›è¡Œå¤§é¡µå†…å­˜çš„åˆå§‹åŒ–</li>
<li>secondaryè¿›ç¨‹ï¼šè¿›è¡Œå¤§é¡µå†…å­˜çš„åŒæ­¥</li>
</ul>
<p>åœ¨Dynamic Memory Modeä¸‹ï¼Œå¤§é¡µå†…å­˜çš„ç”³è¯·/é‡Šæ”¾åªåœ¨primaryè¿›ç¨‹ä¸­å¤„ç†ï¼Œsecondaryåœ¨è¿›è¡Œå †å†…å­˜ç”³è¯·/é‡Šæ”¾æ—¶ï¼Œå¦‚æœéœ€è¦å¯¹å †å¤§å°åšæ›´æ–°ï¼ˆä¹Ÿå°±æ˜¯éœ€è¦å¯¹å¤§é¡µå†…å­˜åšç”³è¯·æˆ–é‡Šæ”¾ï¼‰ï¼Œå°±éœ€è¦åˆ©ç”¨DPDKçš„IPCæœºåˆ¶å‘primaryè¿›ç¨‹è¯·æ±‚å¤§é¡µå†…å­˜çš„ç”³è¯·æˆ–é‡Šæ”¾ï¼Œè€Œåé€šè¿‡å¤§é¡µå†…å­˜çš„åŒæ­¥ï¼Œå®Œæˆå¯¹å †å¤§å°çš„è°ƒæ•´ï¼Œè¿›è€Œæ»¡è¶³å¯¹å†…å­˜ç”³è¯·/é‡Šæ”¾çš„è¦æ±‚ã€‚</p>
<blockquote>
<p>Noteï¼šç¦æ­¢ä½¿ç”¨å‡½æ•°æŒ‡é’ˆä½œä¸ºå…±äº«æ•°æ®ï¼ˆå› ä¸ºå†…æ ¸é»˜è®¤å¼€å¯ASLRï¼ˆAddress space layout randomizationï¼‰ï¼Œgccé»˜è®¤é…ç½®äº†PIEï¼ˆPosition-Independent Executable fileï¼‰ï¼Œä¼šä½¿å¾—ä»£ç æ®µå’Œæ•°æ®æ®µä¹Ÿå¯ä»¥é€‚ç”¨ASLRçš„éšæœºåŒ–ï¼Œè¿™æ ·å°±å¯¼è‡´äº†ä»£ç æ®µçš„å‡½æ•°çš„åœ°å€åœ¨å„è¿›ç¨‹ä¸­ä¸åŒï¼Œå› æ­¤ç¦æ­¢ä½¿ç”¨å‡½æ•°æŒ‡é’ˆä½œä¸ºå…±äº«æ•°æ®ï¼‰</p>
<p>readelf â€“headers XXX  å¯ä»¥æŸ¥çœ‹è¯¥elfæ–‡ä»¶æ˜¯å¦å¯ç”¨äº†PIEï¼ˆTypeå­—æ®µï¼‰ã€‚</p>
</blockquote>
<p>secondaryå¯¹å¤§é¡µå†…å­˜ç”³è¯·/é‡Šæ”¾çš„æµç¨‹æœ‰äº›å¤æ‚ï¼Œä¸‹é¢åˆ—å‡ºå…¶å·¥ä½œæµç¨‹</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * General workflow is the following:</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Allocation:</span></span><br><span class="line"><span class="comment"> * S: send request to primary</span></span><br><span class="line"><span class="comment"> * P: attempt to allocate memory</span></span><br><span class="line"><span class="comment"> *    if failed, sendmsg failure</span></span><br><span class="line"><span class="comment"> *    if success, send sync request</span></span><br><span class="line"><span class="comment"> * S: if received msg of failure, quit</span></span><br><span class="line"><span class="comment"> *    if received sync request, synchronize memory map and reply with result</span></span><br><span class="line"><span class="comment"> * P: if received sync request result</span></span><br><span class="line"><span class="comment"> *    if success, sendmsg success</span></span><br><span class="line"><span class="comment"> *    if failure, roll back allocation and send a rollback request</span></span><br><span class="line"><span class="comment"> * S: if received msg of success, quit</span></span><br><span class="line"><span class="comment"> *    if received rollback request, synchronize memory map and reply with result</span></span><br><span class="line"><span class="comment"> * P: if received sync request result</span></span><br><span class="line"><span class="comment"> *    sendmsg sync request result</span></span><br><span class="line"><span class="comment"> * S: if received msg, quit</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Aside from timeouts, there are three points where we can quit:</span></span><br><span class="line"><span class="comment"> *  - if allocation failed straight away</span></span><br><span class="line"><span class="comment"> *  - if allocation and sync request succeeded</span></span><br><span class="line"><span class="comment"> *  - if allocation succeeded, sync request failed, allocation rolled back and</span></span><br><span class="line"><span class="comment"> *    rollback request received (irrespective of whether it succeeded or failed)</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Deallocation:</span></span><br><span class="line"><span class="comment"> * S: send request to primary</span></span><br><span class="line"><span class="comment"> * P: attempt to deallocate memory</span></span><br><span class="line"><span class="comment"> *    if failed, sendmsg failure</span></span><br><span class="line"><span class="comment"> *    if success, send sync request</span></span><br><span class="line"><span class="comment"> * S: if received msg of failure, quit</span></span><br><span class="line"><span class="comment"> *    if received sync request, synchronize memory map and reply with result</span></span><br><span class="line"><span class="comment"> * P: if received sync request result</span></span><br><span class="line"><span class="comment"> *    sendmsg sync request result</span></span><br><span class="line"><span class="comment"> * S: if received msg, quit</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * There is no "rollback" from deallocation, as it's safe to have some memory</span></span><br><span class="line"><span class="comment"> * mapped in some processes - it's absent from the heap, so it won't get used.</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>secondaryå¯¹å¤§é¡µå†…å­˜çš„åŒæ­¥ï¼š</p>
<p>secondaryä¸ºä»€ä¹ˆè¦å•ç‹¬å¤åˆ¶ä¸€ä»½<code>local_memsegs[]</code>ï¼Ÿ</p>
<p>dpdkä»…åœ¨éœ€è¦ä½¿ç”¨å¤§é¡µå†…å­˜çš„æ—¶å€™å‘memsegsç”³è¯·å¹¶æ˜ å°„å¤§é¡µå†…å­˜ï¼Œåœ¨memsegsä¸­å¹¶ä¸æ˜¯æ‰€æœ‰çš„åœ°å€éƒ½è¿›è¡Œäº†å¤§é¡µæ˜ å°„ã€‚åœ¨å¤šè¿›ç¨‹ä¸‹ä¼šå¯¼è‡´ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯è¾…è¿›ç¨‹æ— æ³•å¾—çŸ¥å…±äº«å†…å­˜æ‰€æ˜ å°„çš„memsegsä¸­çš„å†…å­˜å“ªäº›æ˜¯å·²ç»è¿›è¡Œå¤§é¡µæ˜ å°„äº†çš„ï¼Œå“ªäº›æ²¡æœ‰è¿›è¡Œå¤§é¡µæ˜ å°„ã€‚å› æ­¤éœ€è¦ä¸€ä¸ªè¿›ç¨‹é—´åŒæ­¥çš„æœºåˆ¶ï¼Œåœ¨ä¸»è¿›ç¨‹è¿›è¡Œå¤§é¡µå†…å­˜çš„ç”³è¯·å’Œæ˜ å°„æ—¶ï¼Œå‘ŠçŸ¥æ‰€æœ‰è¾…è¿›ç¨‹ã€‚è¾…è¿›ç¨‹æƒ³è¦ç”³è¯·å¤§é¡µå†…å­˜æ—¶ï¼Œé€šçŸ¥ä¸»è¿›ç¨‹è¿›è¡Œå¤§é¡µå†…å­˜çš„ç”³è¯·å’Œæ˜ å°„ï¼Œä¸»è¿›ç¨‹ç”³è¯·å®Œæ¯•åå‘ŠçŸ¥è¾…è¿›ç¨‹ã€‚</p>
<p>dpdkæ¬¡è¿›ç¨‹éœ€è¦å•ç‹¬å¤åˆ¶ä¸€ä»½local_memsegs[]çš„åŸå› å°±åœ¨äºæ­¤ï¼Œæ¬¡è¿›ç¨‹æ‹¥æœ‰ä¸€ä»½æœ¬åœ°çš„memsegsï¼Œå½“ä¸»è¿›ç¨‹æ›´æ–°memsegsçš„æ˜ å°„å…³ç³»æ—¶ï¼Œæ¬¡è¿›ç¨‹å¯ä»¥é€šè¿‡local_memsegsè¿™ä¸ªæœ¬åœ°çš„memsegsä¸ä¸»è¿›ç¨‹ä¸­çš„memsegsè¿›è¡Œæ¯”è¾ƒï¼Œæ‰¾å‡ºéœ€è¦åŒæ­¥çš„å†…å­˜ï¼Œç„¶ååœ¨æ¬¡è¿›ç¨‹å®Œæˆæ˜ å°„å…³ç³»ã€‚</p>
<p>å¦‚æœæ¬¡è¿›ç¨‹ä¸ä½¿ç”¨local_memsegsï¼Œåœ¨æ¯æ¬¡ä¸»è¿›ç¨‹è¿›è¡Œmemsegsæ›´æ–°æ—¶(å¯èƒ½æ˜¯ç”³è¯·å¤§é¡µï¼Œä¹Ÿå¯èƒ½æ˜¯é‡Šæ”¾å¤§é¡µ)ï¼Œæ¬¡è¿›ç¨‹å°±æ— æ³•å¾—çŸ¥memsegså“ªéƒ¨åˆ†å†…å­˜åšäº†æ›´æ–°ï¼Œä¹Ÿå°±æ— æ³•åšåˆ°ä¸»æ¬¡è¿›ç¨‹çš„å¤§é¡µå†…å­˜çš„åŒæ­¥ã€‚</p>
<h2 id="Memory-Hugepage"><a href="#Memory-Hugepage" class="headerlink" title="Memory&Hugepage"></a>Memory&amp;Hugepage</h2><p>DPDKç›®å‰æ”¯æŒä¸¤ç§å†…å­˜æ¨¡å¼ï¼š</p>
<ul>
<li><p>Legacy Memory Modeï¼šå¦‚æœé…ç½®äº†<code>-m</code>æˆ–è€…<code>--socket-mem</code>é€‰é¡¹ï¼Œåˆ™é¢„å…ˆå ç”¨æ‰€é…ç½®çš„å¤§é¡µå†…å­˜ä½œä¸ºå †å†…å­˜ï¼Œå¦åˆ™å ç”¨ç³»ç»Ÿä¸­æ‰€æœ‰çš„å¤§é¡µå†…å­˜ã€‚è¯¥æ¨¡å¼ä¸‹è¿ç»­çš„vaå¯¹åº”çš„iovaä¸€å®šè¿ç»­ã€‚</p>
</li>
<li><p>Dynamic Memory Modeï¼šå¦‚æœé…ç½®äº†<code>-m</code>æˆ–è€…<code>--socket-mem</code>é€‰é¡¹ï¼Œåˆ™é¢„å…ˆå ç”¨æ‰€é…ç½®çš„å¤§é¡µå†…å­˜ä½œä¸ºå †å†…å­˜ï¼ˆè¿™äº›å†…å­˜ç¨‹åºè¿è¡ŒæœŸé—´ä¸ä¼šé‡Šæ”¾ï¼‰ï¼Œå¦åˆ™æŒ‰éœ€ç”³è¯·é‡Šæ”¾å†…å­˜ã€‚è¯¥æ¨¡å¼ä¸‹è¿ç»­çš„vaå¯¹åº”çš„iovaä¸ä¸€å®šè¿ç»­ã€‚</p>
</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®°å½•å¤§é¡µä¿¡æ¯ï¼Œä¸ä½¿ç”¨å¤§é¡µçš„æƒ…å†µä¸‹æ— éœ€é…ç½®è¯¥æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hugepage_info</span> {</span></span><br><span class="line">	<span class="type">uint64_t</span> hugepage_sz;   <span class="comment">/**&lt; size of a huge page */</span></span><br><span class="line">	<span class="comment">//è‹¥æŒ‡å®šäº†æŒ‚è½½ç‚¹åˆ™æ›´æ–°ä¸ºæŒ‡å®šçš„æŒ‚è½½ç‚¹</span></span><br><span class="line">	<span class="type">char</span> hugedir[PATH_MAX];    <span class="comment">/**&lt; dir where hugetlbfs is mounted */</span></span><br><span class="line">	<span class="type">uint32_t</span> num_pages[RTE_MAX_NUMA_NODES];</span><br><span class="line">	<span class="comment">/**&lt; number of hugepages of that size on each socket */</span></span><br><span class="line">	<span class="type">int</span> lock_descriptor;    <span class="comment">/**&lt; file descriptor for hugepage dir */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>VAåœ°å€ç©ºé—´çš„åˆ†é…ï¼ˆæ²¡æœ‰ä½¿èƒ½<code>--no-huge</code>çš„æƒ…å†µä¸‹ï¼Œåœ¨<code>rte_eal_hugepage_init()</code>ä¹‹å‰è¿è¡Œï¼‰ï¼š</p>
<ol>
<li><p>æ ¹æ®ç³»ç»Ÿçš„numaæ•°å’Œpagesizeæ•°äº§ç”Ÿnuma*pagesizeç§ç±»å‹ï¼ˆä¿è¯äº†æ¯ä¸ªsegmentæ‰€å¯¹åº”çš„ä¿ç•™æ–‡ä»¶æ‰€å¤„çš„socketåœ¨application restartåä¸å˜ï¼‰</p>
</li>
<li><p>æ¯ç§ç±»å‹åŒ…å«å¤šä¸ªsegment listï¼Œæ¯ä¸ªsegment liståŒ…å«å¤šä¸ªsegmentï¼Œæ¯ä¸ªsegmentå¯¹åº”ä¸€ä¸ªpage</p>
</li>
<li><p>æ‰€æœ‰segment listå­˜å‚¨åœ¨memsegs[RTE_MAX_MEMSEG_LISTS]ä¸­</p>
</li>
<li><p>æ¯ä¸ªsegment listä¸­çš„segmenté‡‡ç”¨<code>rte_fbarray</code>ç®¡ç†ï¼Œæ¯ä¸ªsegment listä¼šä¸€æ¬¡æ€§ç”³è¯·æ‰€æœ‰çš„segmentï¼Œè¿™äº›segmentæ˜¯vaè¿ç»­çš„</p>
</li>
<li><p>fd_list[RTE_MAX_MEMSEG_LISTS]å­˜å‚¨å¯¹åº”segment listçš„fd</p>
</li>
</ol>
<p>rte_fbarray(File-backed shared indexed array)ï¼šæ•°ç»„æœ«å°¾å­˜å‚¨ä½å›¾ï¼Œè®°å½•æ•°ç»„åˆ†é…çŠ¶å†µã€‚åˆ›å»ºæ–‡ä»¶ï¼Œå®ç°æ•°ç»„å…±äº«ã€‚</p>
<p>mem_area_tailqï¼šè®°å½•ç”¨äºå…±äº«å†…å­˜çš„æ–‡ä»¶fdåŠå…¶ç›¸å…³ä¿¡æ¯ï¼ˆç”¨äºæŸ¥çœ‹å¾…æ˜ å°„çš„åœ°å€æ˜¯å¦ä¸ä»¥æ˜ å°„çš„åœ°å€å†²çªï¼Œè§£é™¤æ˜ å°„æ—¶ç”¨äºæŸ¥æ‰¾fdå¹¶åˆ é™¤è¯¥æ–‡ä»¶ï¼‰</p>
<h3 id="Heap"><a href="#Heap" class="headerlink" title="Heap"></a>Heap</h3><p>dpdkçš„æ‰€æ˜ å°„çš„å¤§é¡µå†…å­˜æ˜¯é€šè¿‡heapæ¥è¿›è¡Œç®¡ç†çš„ï¼Œheapå°†å¤§é¡µå†…å­˜å°è£…æˆä¸€ä¸ªä¸ª<code>struct malloc_elem</code>å—ï¼Œå—å¤§å°åŒ…æ‹¬ç»“æ„ä½“æœ¬èº«ã€‚</p>
<p><a href="/images/malloc_heap.svg" title="heap" class="gallery-item" style="box-shadow: none;"> <img src="/images/malloc_heap.svg" alt="heap"></a></p>
<h3 id="Memory-Zone"><a href="#Memory-Zone" class="headerlink" title="Memory Zone"></a>Memory Zone</h3><p>ç”¨äºè®°å½•ä»Heapä¸­ç”³è¯·çš„å¤§ç‰‡VAè¿ç»­çš„å†…å­˜ï¼Œæ¯ä¸ªmemzoneéƒ½æœ‰å”¯ä¸€çš„åå­—ã€‚memzoneæœ¬èº«ä½¿ç”¨rte_fbarrayç®¡ç†ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Reserve a portion of physical memory with specified alignment and</span></span><br><span class="line"><span class="comment"> * boundary.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This function reserves some memory with specified alignment and</span></span><br><span class="line"><span class="comment"> * boundary, and returns a pointer to a correctly filled memzone</span></span><br><span class="line"><span class="comment"> * descriptor. If the allocation cannot be done or if the alignment</span></span><br><span class="line"><span class="comment"> * or boundary are not a power of 2, returns NULL.</span></span><br><span class="line"><span class="comment"> * Memory buffer is reserved in a way, that it wouldn't cross specified</span></span><br><span class="line"><span class="comment"> * boundary. That implies that requested length should be less or equal</span></span><br><span class="line"><span class="comment"> * then boundary.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @note Reserving memzones with len set to 0 will only attempt to allocate</span></span><br><span class="line"><span class="comment"> *   memzones from memory that is already available. It will not trigger any</span></span><br><span class="line"><span class="comment"> *   new allocations.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @note: When reserving memzones with len set to 0, it is preferable to also</span></span><br><span class="line"><span class="comment"> *   set a valid socket_id. Setting socket_id to SOCKET_ID_ANY is supported, but</span></span><br><span class="line"><span class="comment"> *   will likely not yield expected results. Specifically, the resulting memzone</span></span><br><span class="line"><span class="comment"> *   may not necessarily be the biggest memzone available, but rather biggest</span></span><br><span class="line"><span class="comment"> *   memzone available on socket id corresponding to an lcore from which</span></span><br><span class="line"><span class="comment"> *   reservation was called.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param name</span></span><br><span class="line"><span class="comment"> *   The name of the memzone. If it already exists, the function will</span></span><br><span class="line"><span class="comment"> *   fail and return NULL.</span></span><br><span class="line"><span class="comment"> * @param len</span></span><br><span class="line"><span class="comment"> *   The size of the memory to be reserved. If it</span></span><br><span class="line"><span class="comment"> *   is 0, the biggest contiguous zone will be reserved.</span></span><br><span class="line"><span class="comment"> * @param socket_id</span></span><br><span class="line"><span class="comment"> *   The socket identifier in the case of</span></span><br><span class="line"><span class="comment"> *   NUMA. The value can be SOCKET_ID_ANY if there is no NUMA</span></span><br><span class="line"><span class="comment"> *   constraint for the reserved zone.</span></span><br><span class="line"><span class="comment"> * @param flags</span></span><br><span class="line"><span class="comment"> *   The flags parameter is used to request memzones to be</span></span><br><span class="line"><span class="comment"> *   taken from specifically sized hugepages.</span></span><br><span class="line"><span class="comment"> *   - RTE_MEMZONE_2MB - Reserved from 2MB pages</span></span><br><span class="line"><span class="comment"> *   - RTE_MEMZONE_1GB - Reserved from 1GB pages</span></span><br><span class="line"><span class="comment"> *   - RTE_MEMZONE_16MB - Reserved from 16MB pages</span></span><br><span class="line"><span class="comment"> *   - RTE_MEMZONE_16GB - Reserved from 16GB pages</span></span><br><span class="line"><span class="comment"> *   - RTE_MEMZONE_256KB - Reserved from 256KB pages</span></span><br><span class="line"><span class="comment"> *   - RTE_MEMZONE_256MB - Reserved from 256MB pages</span></span><br><span class="line"><span class="comment"> *   - RTE_MEMZONE_512MB - Reserved from 512MB pages</span></span><br><span class="line"><span class="comment"> *   - RTE_MEMZONE_4GB - Reserved from 4GB pages</span></span><br><span class="line"><span class="comment"> *   - RTE_MEMZONE_SIZE_HINT_ONLY - Allow alternative page size to be used if</span></span><br><span class="line"><span class="comment"> *                                  the requested page size is unavailable.</span></span><br><span class="line"><span class="comment"> *                                  If this flag is not set, the function</span></span><br><span class="line"><span class="comment"> *                                  will return error on an unavailable size</span></span><br><span class="line"><span class="comment"> *                                  request.</span></span><br><span class="line"><span class="comment"> *   - RTE_MEMZONE_IOVA_CONTIG - Ensure reserved memzone is IOVA-contiguous.</span></span><br><span class="line"><span class="comment"> *                               This option should be used when allocating</span></span><br><span class="line"><span class="comment"> *                               memory intended for hardware rings etc.</span></span><br><span class="line"><span class="comment"> * @param align</span></span><br><span class="line"><span class="comment"> *   Alignment for resulting memzone. Must be a power of 2.</span></span><br><span class="line"><span class="comment"> * @param bound</span></span><br><span class="line"><span class="comment"> *   Boundary for resulting memzone. Must be a power of 2 or zero.</span></span><br><span class="line"><span class="comment"> *   Zero value implies no boundary condition.</span></span><br><span class="line"><span class="comment"> * @return</span></span><br><span class="line"><span class="comment"> *   A pointer to a correctly-filled read-only memzone descriptor, or NULL</span></span><br><span class="line"><span class="comment"> *   on error.</span></span><br><span class="line"><span class="comment"> *   On error case, rte_errno will be set appropriately:</span></span><br><span class="line"><span class="comment"> *    - E_RTE_NO_CONFIG - function could not get pointer to rte_config structure</span></span><br><span class="line"><span class="comment"> *    - ENOSPC - the maximum number of memzones has already been allocated</span></span><br><span class="line"><span class="comment"> *    - EEXIST - a memzone with the same name already exists</span></span><br><span class="line"><span class="comment"> *    - ENOMEM - no appropriate memory area found in which to create memzone</span></span><br><span class="line"><span class="comment"> *    - EINVAL - invalid parameters</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">const</span> <span class="keyword">struct</span> rte_memzone *<span class="title function_">rte_memzone_reserve_bounded</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name,</span></span><br><span class="line"><span class="params">			<span class="type">size_t</span> len, <span class="type">int</span> socket_id,</span></span><br><span class="line"><span class="params">			<span class="type">unsigned</span> flags, <span class="type">unsigned</span> align, <span class="type">unsigned</span> bound)</span>;</span><br></pre></td></tr></table></figure>



<h3 id="Legacy-Memory-Mode"><a href="#Legacy-Memory-Mode" class="headerlink" title="Legacy Memory Mode"></a>Legacy Memory Mode</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">int</span> <span class="title function_">eal_legacy_hugepage_init</span><span class="params">(<span class="type">void</span>)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¸ä½¿ç”¨å¤§é¡µçš„æƒ…å†µä¸‹ï¼š</p>
<ol>
<li>ä½¿èƒ½single-fileï¼Œåˆ©ç”¨<code>memfd_create()</code>åˆ›å»ºåŒ¿åå†…å­˜</li>
<li>ä¸è€ƒè™‘å¤šnumaä¸”åªä½¿ç”¨4kçš„page</li>
<li>å°†æ‰€éœ€è¦çš„å†…å­˜æ•°éƒ½é…ç½®åˆ°<code>segments[0]</code>ä¸Š</li>
<li>segmentçš„iovaåªæ”¯æŒé…ç½®va</li>
</ol>
</li>
<li><p>ä½¿ç”¨å¤§é¡µçš„æƒ…å†µä¸‹</p>
<ol>
<li><p>æ¯ä¸ªå¤§é¡µæ–‡ä»¶å¯¹åº”ä¸€ä¸ª<code>struct hugepage_file</code>ç”¨äºå¤šè¿›ç¨‹å…±äº«</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//primaryè®¾ç½®ï¼Œsecondaryè¯»å–</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hugepage_file</span> {</span></span><br><span class="line">	<span class="comment">//ç¬¬ä¸€æ¬¡å…ˆæ˜ å°„æ‰€æœ‰å¤§é¡µå†…å­˜ï¼Œç”¨äºå¯»æ‰¾iovaè¿ç»­çš„å¤§é¡µç»„</span></span><br><span class="line">	<span class="type">void</span> *orig_va;      <span class="comment">/**&lt; virtual addr of first mmap() */</span></span><br><span class="line">	<span class="comment">//ç¬¬äºŒæ¬¡å°†iovaè¿ç»­çš„å¤§é¡µå†…å­˜æ˜ å°„åˆ°vaè¿ç»­çš„åœ°å€ä¸Š</span></span><br><span class="line">	<span class="type">void</span> *final_va;     <span class="comment">/**&lt; virtual addr of 2nd mmap() */</span></span><br><span class="line">	<span class="comment">//iova</span></span><br><span class="line">	<span class="type">uint64_t</span> physaddr;  <span class="comment">/**&lt; physical addr */</span></span><br><span class="line">	<span class="type">size_t</span> size;        <span class="comment">/**&lt; the page size */</span></span><br><span class="line">	<span class="type">int</span> socket_id;      <span class="comment">/**&lt; NUMA socket ID */</span></span><br><span class="line">	<span class="type">int</span> file_id;        <span class="comment">/**&lt; the '%d' in HUGEFILE_FMT */</span></span><br><span class="line">	<span class="type">char</span> filepath[MAX_HUGEPAGE_PATH]; <span class="comment">/**&lt; path to backing file on filesystem */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>
</li>
<li><p>å…ˆç”³è¯·ç³»ç»Ÿä¸­æ‰€æœ‰çš„å¤§é¡µå†…å­˜ï¼ˆæ˜¯å¦é‡‡ç”¨numaæ„ŸçŸ¥å–å†³äºé…ç½®å‚æ•°ï¼‰</p>
</li>
<li><p>è¯»å–<code>/proc/self/numa_maps</code>æ–‡ä»¶ç¡®å®šå¤§é¡µæ‰€å¤„çš„socket_id</p>
</li>
<li><p>æ ¹æ®æ‰€ç”³è¯·åˆ°çš„å¤§é¡µæ•°æ›´æ–°<code>internal_conf-&gt;hugepage_info</code></p>
</li>
<li><p>æ ¹æ®é…ç½®è®¡ç®—å„numaæ‰€éœ€è¦çš„ä¸åŒå°ºå¯¸çš„å¤§é¡µæ•°ï¼ˆè‹¥æ²¡æœ‰é…ç½®<code>--socket-num</code>ï¼Œåˆ™å°½å¯èƒ½æŒ‰ç…§lcoreåœ¨å„nodeçš„æ¯”ä¾‹æ¥åˆ†é…ï¼‰</p>
</li>
<li><p>æ ¹æ®è¦æ±‚é‡Šæ”¾ä¸éœ€è¦çš„å¤§é¡µ</p>
</li>
<li><p>éå†<code>struct hugepage_file</code>ï¼Œæ‰¾å‡ºiovaè¿ç»­çš„å¤§é¡µç»„ï¼Œå¹¶å°†å…¶æ˜ å°„åˆ°segmentsä¸­ï¼ˆä¹Ÿå°±æ˜¯å°†iovaè¿ç»­çš„å¤§é¡µå†…å­˜æ˜ å°„åˆ°vaè¿ç»­çš„åœ°å€ä¸Šï¼‰</p>
</li>
<li><p>å„å¤§é¡µç»„æ‰€å¯¹åº”çš„segmentä¹‹é—´ä¼šç•™å‡ºä¸€ä¸ªç©ºé—²çš„segmentï¼Œä½¿å¾—iovaè¿ç»­ä¸vaè¿ç»­ä¸€ä¸€å¯¹åº”</p>
</li>
<li><p>ç”±äºåç»­ä¸å†è¿›è¡Œå¤§é¡µçš„åˆ†é…ä¸é‡Šæ”¾ï¼Œå› æ­¤é‡Šæ”¾æ²¡æœ‰ç”¨åˆ°çš„<code>segment list</code></p>
</li>
</ol>
</li>
</ul>
<h3 id="Dynamic-Memory-Mode"><a href="#Dynamic-Memory-Mode" class="headerlink" title="Dynamic Memory Mode"></a>Dynamic Memory Mode</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">eal_dynmem_hugepage_init</span><span class="params">(<span class="type">void</span>)</span></span><br></pre></td></tr></table></figure>



<h2 id="Tailq"><a href="#Tailq" class="headerlink" title="Tailq"></a>Tailq</h2><p>ä½äº<code>rte_eal_get_configuration()-&gt;mem_config</code>çš„<code>tailq_head[]</code>å­—æ®µï¼Œç”¨äºå¤šè¿›ç¨‹æ•°æ®å…±äº«ã€‚</p>
<h2 id="Service-Core"><a href="#Service-Core" class="headerlink" title="Service Core"></a>Service Core</h2><p>serviceï¼šæœåŠ¡ï¼Œå¯è§†ä¸ºéœ€è¦CPUè¿è¡Œçš„ä»»åŠ¡</p>
<p>service coreï¼šæœåŠ¡æ ¸ï¼Œè¿è¡ŒæœåŠ¡çš„çº¿ç¨‹</p>
<p>ä½¿å¾—ç”¨æˆ·æ‰€è®¾ç½®çš„ä»»åŠ¡å’Œæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹å¯ä»¥æ›´åŠ çµæ´»çš„é…ç½®ï¼ŒæœåŠ¡æ ¸é€šè¿‡è°ƒç”¨<code>service_runner_func()</code>å»è¿è¡Œæ³¨å†Œåˆ°è¯¥æ ¸ä¸Šçš„æœåŠ¡ï¼Œè€ŒæœåŠ¡æœ¬èº«ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œï¼Œå¯åŠ¨ç­‰æµç¨‹ï¼Œå°†å…¶æ”¾åˆ°æŒ‡å®šçš„æœåŠ¡æ ¸ä¸Šè¿è¡Œã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”¨äºç®¡ç†æœåŠ¡çš„æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_service_spec_impl</span> {</span></span><br><span class="line">	<span class="comment">/* public part of the struct */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_service_spec</span> <span class="title">spec</span>;</span>	<span class="comment">//ç”¨æˆ·æ³¨å†Œçš„æœåŠ¡</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* spin lock that when set indicates a service core is currently</span></span><br><span class="line"><span class="comment">	 * running this service callback. When not set, a core may take the</span></span><br><span class="line"><span class="comment">	 * lock and then run the service callback.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">rte_spinlock_t</span> execute_lock;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* API set/get-able variables */</span></span><br><span class="line">	RTE_ATOMIC(<span class="type">int8_t</span>) app_runstate;	<span class="comment">//è¡¨ç¤ºæœåŠ¡æ˜¯å¦è¦æ‰§è¡Œï¼Œåº”ç”¨ç¨‹åºè®¾ç½®</span></span><br><span class="line">	RTE_ATOMIC(<span class="type">int8_t</span>) comp_runstate;	<span class="comment">//è¡¨ç¤ºæœåŠ¡æ˜¯å¦å¯è¿è¡Œï¼ŒæœåŠ¡æœ¬èº«è®¾ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SERVICE_F_REGISTERED    (1 &lt;&lt; 0)	<span class="comment">//æœåŠ¡æ³¨å†Œ</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SERVICE_F_STATS_ENABLED (1 &lt;&lt; 1)	<span class="comment">//æœåŠ¡ç»Ÿè®¡åŠŸèƒ½</span></span></span><br><span class="line"><span class="comment">/* åˆ¤æ–­æœåŠ¡æ˜¯å¦åœ¨service coreä¸Šè¿è¡Œæ—¶ï¼Œç”¨åˆ°äº†è¯¥æ ‡å¿—ä½ã€‚</span></span><br><span class="line"><span class="comment"> * ä¸º1æ—¶è¡¨ç¤ºéœ€è¦æ£€æŸ¥è¯¥æœåŠ¡æ˜¯å¦æœ‰ç»‘å®šåˆ°service coreå»è¿è¡Œã€‚</span></span><br><span class="line"><span class="comment"> * ä¸º0æ—¶è¡¨ç¤ºä¸éœ€è¦æ£€æŸ¥ï¼Œè¿™ç§æƒ…å†µä¸‹å¯èƒ½æ˜¯åº”ç”¨ç¨‹åºæ‰‹åŠ¨è°ƒç”¨rte_service_run_iter_on_app_lcore()å‡½æ•°æ‰§è¡ŒæœåŠ¡ï¼Œ</span></span><br><span class="line"><span class="comment"> * å¹¶æ²¡æœ‰å°†è¯¥æœåŠ¡ç»‘å®šåˆ°service coreä¸Šã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SERVICE_F_START_CHECK   (1 &lt;&lt; 2)</span></span><br><span class="line">	<span class="type">uint8_t</span> internal_flags;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/* per service statistics */</span></span><br><span class="line">	<span class="comment">/* Indicates how many cores the service is mapped to run on.</span></span><br><span class="line"><span class="comment">	 * It does not indicate the number of cores the service is running</span></span><br><span class="line"><span class="comment">	 * on currently.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	RTE_ATOMIC(<span class="type">uint32_t</span>) num_mapped_cores;</span><br><span class="line">} __rte_cache_aligned;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”¨æˆ·æ‰€è®¾ç½®çš„æœåŠ¡</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_service_spec</span> {</span></span><br><span class="line">	<span class="comment">/** The name of the service. This should be used by the application to</span></span><br><span class="line"><span class="comment">	 * understand what purpose this service provides.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">char</span> name[RTE_SERVICE_NAME_MAX];</span><br><span class="line">	<span class="comment">/** The callback to invoke to run one iteration of the service. */</span></span><br><span class="line">	rte_service_func callback;</span><br><span class="line">	<span class="comment">/** The userdata pointer provided to the service callback. */</span></span><br><span class="line">	<span class="type">void</span> *callback_userdata;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** Flags to indicate the capabilities of this service. See defines in</span></span><br><span class="line"><span class="comment"> * the public header file for values of RTE_SERVICE_CAP_*</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_SERVICE_CAP_MT_SAFE (1 &lt;&lt; 0)</span></span><br><span class="line">	<span class="type">uint32_t</span> capabilities;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** NUMA socket ID that this service is affinitized to */</span></span><br><span class="line">	<span class="type">int</span> socket_id;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœåŠ¡æ³¨å†Œï¼Œé»˜è®¤æ³¨å†ŒåæœåŠ¡å¤„äºä¸å¯è¿è¡ŒçŠ¶æ€</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">rte_service_component_register</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_service_spec *spec,</span></span><br><span class="line"><span class="params">		<span class="type">uint32_t</span> *service_id)</span>;	<span class="comment">//æœåŠ¡idï¼Œç”¨æˆ·å¯ä½¿ç”¨idæ¥è¡¨ç¤ºè¯¥æœåŠ¡</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”±æœåŠ¡æœ¬èº«è®¾ç½®ï¼Œè¡¨ç¤ºè¯¥æœåŠ¡å¤„äºå¯è¿è¡ŒçŠ¶æ€</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">rte_service_component_runstate_set</span><span class="params">(<span class="type">uint32_t</span> id, <span class="type">uint32_t</span> runstate)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç”±åº”ç”¨ç¨‹åºè®¾ç½®ï¼Œè¡¨ç¤ºæ˜¯å¦è¿è¡Œè¯¥æœåŠ¡</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">rte_service_runstate_set</span><span class="params">(<span class="type">uint32_t</span> id, <span class="type">uint32_t</span> runstate)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸ºæœåŠ¡åˆ†é…service core</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">rte_service_map_lcore_set</span><span class="params">(<span class="type">uint32_t</span> service_id, <span class="type">uint32_t</span> lcore,</span></span><br><span class="line"><span class="params">		<span class="type">uint32_t</span> enable)</span>;</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç”¨äºç®¡ç†æœåŠ¡æ ¸çš„æ•°æ®ç»“æ„</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">core_state</span> {</span></span><br><span class="line">	<span class="comment">/* map of services IDs are run on this core */</span></span><br><span class="line">	<span class="type">uint64_t</span> service_mask;</span><br><span class="line">	RTE_ATOMIC(<span class="type">uint8_t</span>) runstate; <span class="comment">/* running or stopped */</span></span><br><span class="line">	RTE_ATOMIC(<span class="type">uint8_t</span>) thread_active; <span class="comment">/* indicates when thread is in service_run() */</span></span><br><span class="line">	<span class="type">uint8_t</span> is_service_core; <span class="comment">/* set if core is currently a service core */</span></span><br><span class="line">	<span class="type">uint8_t</span> service_active_on_lcore[RTE_SERVICE_NUM_MAX];</span><br><span class="line">	RTE_ATOMIC(<span class="type">uint64_t</span>) loops;</span><br><span class="line">	RTE_ATOMIC(<span class="type">uint64_t</span>) cycles;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">service_stats</span> <span class="title">service_stats</span>[<span class="title">RTE_SERVICE_NUM_MAX</span>];</span>	<span class="comment">//å„æœåŠ¡åœ¨è¯¥æ ¸ä¸Šçš„ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line">} __rte_cache_aligned;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœåŠ¡æ ¸çš„æ·»åŠ </span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">rte_service_lcore_add</span><span class="params">(<span class="type">uint32_t</span> lcore)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœåŠ¡æ ¸çš„è¿è¡Œ</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">rte_service_lcore_start</span><span class="params">(<span class="type">uint32_t</span> lcore_id)</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ€»ä½“æ¥è¯´APIä½¿ç”¨è¾ƒä¸ºç¹çï¼Œä¸æ˜¯å¾ˆå¥½ç”¨ã€‚</p>
</blockquote>
<h1 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h1><p>DPDKæ—¥å¿—æ”¯æŒsyslogçš„é…ç½®ï¼Œubuntuç³»ç»Ÿå¯é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹syslogæ—¥å¿—</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">journalctl -t dpdk-test</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ—¥å¿—åˆå§‹åŒ–å‡½æ•°ï¼Œæ·»åŠ å†…ç½®çš„æ—¥å¿—ç±»å‹</span></span><br><span class="line">RTE_INIT_PRIO(log_init, LOG)</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ—¥å¿—ç±»å‹æ³¨å†Œ</span></span><br><span class="line">RTE_LOG_REGISTER(type, name, level)</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ—¥å¿—æ‰“å°å‡½æ•°ï¼ŒlæŒ‡å®šæ—¥å¿—ç­‰çº§ï¼ŒtæŒ‡å®šæ—¥å¿—ç±»å‹ï¼Œåé¢ä¸ºæ—¥å¿—å†…å®¹</span></span><br><span class="line">RTE_LOG(l, t, ...)</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ—¥å¿—æ‰“å°å‡½æ•°ï¼Œä¸ä¸Šé¢ä¸åŒçš„æ˜¯ï¼Œå¦‚æœlçš„ç­‰çº§ä½äºRTE_LOG_DP_LEVELï¼Œåˆ™è¯¥å®ä¼šåœ¨ç¼–è¯‘æ—¶å±•å¼€ä¸ºç©º</span></span><br><span class="line">RTE_LOG_DP(l, t, ...)</span><br></pre></td></tr></table></figure>



<h1 id="Command-line"><a href="#Command-line" class="headerlink" title="Command-line"></a>Command-line</h1><h2 id="å‘½ä»¤å‚æ•°ç±»å‹"><a href="#å‘½ä»¤å‚æ•°ç±»å‹" class="headerlink" title="å‘½ä»¤å‚æ•°ç±»å‹"></a>å‘½ä»¤å‚æ•°ç±»å‹</h2><ul>
<li><p>å­—ç¬¦ä¸²</p>
<ul>
<li>cmdline_fixed_string_tï¼Œä¸€ä¸ªtoken</li>
<li>cmdline_multi_string_tï¼Œä»»æ„ä¸ªtokenï¼Œåªèƒ½ä½œä¸ºå‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°</li>
</ul>
</li>
<li><p>IPåœ°å€</p>
<ul>
<li>cmdline_ipaddr_tï¼Œipv4/ipv6</li>
</ul>
</li>
<li><p>MACåœ°å€</p>
<ul>
<li>struct rte_ether_addr</li>
</ul>
</li>
<li><p>æ•°å­—</p>
<ul>
<li><p>uint8_tã€uint16_tã€uint32_tã€uint64_tã€int8_tã€int16_tã€int32_tã€int64_t</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">cmdline_numtype</span> {</span></span><br><span class="line">	RTE_UINT8 = <span class="number">0</span>,</span><br><span class="line">	RTE_UINT16,</span><br><span class="line">	RTE_UINT32,</span><br><span class="line">	RTE_UINT64,</span><br><span class="line">	RTE_INT8,</span><br><span class="line">	RTE_INT16,</span><br><span class="line">	RTE_INT32,</span><br><span class="line">	RTE_INT64</span><br><span class="line">};</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="å‘½ä»¤æ³¨å†Œ"><a href="#å‘½ä»¤æ³¨å†Œ" class="headerlink" title="å‘½ä»¤æ³¨å†Œ"></a>å‘½ä»¤æ³¨å†Œ</h2><ol>
<li><p>ç¡®å®šè¦æ³¨å†Œå‘½ä»¤çš„æ ¼å¼ï¼Œä¾‹ï¼š<code>echo string_mac_ip_number/smin &lt;STRING&gt;str &lt;MAC&gt;mac &lt;IP&gt;ip &lt;INT64&gt;n</code></p>
</li>
<li><p>å®šä¹‰å‘½ä»¤ç»“æœç»“æ„ä½“ï¼Œè¯¥ç»“æ„ä½“ç”¨äºå­˜å‚¨è§£æåçš„å„å­—æ®µçš„å†…å®¹</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cmd_echo_string_mac_ip_number_result</span> {</span></span><br><span class="line">   <span class="type">cmdline_fixed_string_t</span> echo;</span><br><span class="line">   <span class="type">cmdline_fixed_string_t</span> string_mac_ip_number;</span><br><span class="line">   <span class="type">cmdline_fixed_string_t</span> str;</span><br><span class="line">   <span class="class"><span class="keyword">struct</span> <span class="title">rte_ether_addr</span>  <span class="title">mac</span>;</span></span><br><span class="line">   <span class="type">cmdline_ipaddr_t</span>       ip;</span><br><span class="line">   <span class="type">int64_t</span>                n;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
</li>
<li><p>æä¾›å‘½ä»¤å„å­—æ®µçš„åˆå§‹åŒ–</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">cmdline_parse_token_string_t</span> cmd_echo_string_mac_ip_number_echo_tok =</span><br><span class="line">   TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_echo_string_mac_ip_number_result, echo, <span class="string">"echo"</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">cmdline_parse_token_string_t</span> cmd_echo_string_mac_ip_number_string_mac_ip_number_tok =</span><br><span class="line">   TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_echo_string_mac_ip_number_result, string_mac_ip_number, <span class="string">"string_mac_ip_number#smin"</span>);	<span class="comment">//è‹¥è¯¥tokenå¯ä»¥åŒ¹é…å¤šä¸ªå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¹‹é—´å¯ç”¨#åˆ†å‰²</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">cmdline_parse_token_string_t</span> cmd_echo_string_mac_ip_number_str_tok =</span><br><span class="line">   TOKEN_STRING_INITIALIZER(<span class="keyword">struct</span> cmd_echo_string_mac_ip_number_result, str, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">cmdline_parse_token_etheraddr_t</span> cmd_echo_string_mac_ip_number_mac_tok =</span><br><span class="line">   TOKEN_ETHERADDR_INITIALIZER(<span class="keyword">struct</span> cmd_echo_string_mac_ip_number_result, mac);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">cmdline_parse_token_ipaddr_t</span> cmd_echo_string_mac_ip_number_ip_tok =</span><br><span class="line">   TOKEN_IPADDR_INITIALIZER(<span class="keyword">struct</span> cmd_echo_string_mac_ip_number_result, ip);</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">cmdline_parse_token_num_t</span> cmd_echo_string_mac_ip_number_n_tok =</span><br><span class="line">   TOKEN_NUM_INITIALIZER(<span class="keyword">struct</span> cmd_echo_string_mac_ip_number_result, n, RTE_INT64);</span><br></pre></td></tr></table></figure>
</li>
<li><p>å®šä¹‰å‘½ä»¤å›è°ƒå‡½æ•°</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span></span><br><span class="line"><span class="title function_">cmd_echo_string_mac_ip_number_parsed</span><span class="params">(<span class="type">void</span> *parsed_result, 	<span class="comment">//å‘½ä»¤ç»“æœç»“æ„ä½“</span></span></span><br><span class="line"><span class="params">                                     <span class="keyword">struct</span> cmdline *cl, 	<span class="comment">//å‘½ä»¤è¡Œå®ä¾‹ä½¿ç”¨ï¼Œå¯ä»¥æ— è§†è¯¥å‚æ•°</span></span></span><br><span class="line"><span class="params">                                     <span class="type">void</span> *data)</span>			<span class="comment">//ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>å®šä¹‰è¯¥å‘½ä»¤çš„è§£æå®ä¾‹ï¼Œç”¨äºæœ€ç»ˆçš„å‘½ä»¤æ³¨å†Œ</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> <span class="type">cmdline_parse_inst_t</span> cmd_echo_string_mac_ip_number = {</span><br><span class="line">    .f = cmd_echo_string_mac_ip_number_parsed,</span><br><span class="line">    .data = <span class="literal">NULL</span>,	<span class="comment">//ç”¨æˆ·è‡ªå®šä¹‰æ•°æ®ï¼Œå›è°ƒå‡½æ•°ä½¿ç”¨</span></span><br><span class="line">    .help_str = <span class="string">"Echo string and mac and ip and number"</span>,</span><br><span class="line">    .tokens = {</span><br><span class="line">        (<span class="type">void</span> *)&amp;cmd_echo_string_mac_ip_number_echo_tok,</span><br><span class="line">        (<span class="type">void</span> *)&amp;cmd_echo_string_mac_ip_number_string_mac_ip_number_tok,</span><br><span class="line">        (<span class="type">void</span> *)&amp;cmd_echo_string_mac_ip_number_str_tok,</span><br><span class="line">        (<span class="type">void</span> *)&amp;cmd_echo_string_mac_ip_number_mac_tok,</span><br><span class="line">        (<span class="type">void</span> *)&amp;cmd_echo_string_mac_ip_number_ip_tok,</span><br><span class="line">        (<span class="type">void</span> *)&amp;cmd_echo_string_mac_ip_number_n_tok,</span><br><span class="line">        <span class="literal">NULL</span></span><br><span class="line">    }</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
</li>
<li><p>å°†è¯¥å‘½ä»¤æ·»åŠ åˆ°å‘½ä»¤è§£æä¸Šä¸‹æ–‡ä¸­ï¼Œè¯¥ä¸Šä¸‹æ–‡å­˜å‚¨ç€éœ€è¦æ³¨å†Œçš„æ‰€æœ‰å‘½ä»¤</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">static cmdline_parse_ctx_t ctx[] = {</span><br><span class="line">    &amp;cmd_echo_string_mac_ip_number,</span><br><span class="line">    ...</span><br><span class="line">    NULL</span><br><span class="line">};</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="å‘½ä»¤è¡Œå®ä¾‹çš„åˆ›å»ºä¸è¿è¡Œ"><a href="#å‘½ä»¤è¡Œå®ä¾‹çš„åˆ›å»ºä¸è¿è¡Œ" class="headerlink" title="å‘½ä»¤è¡Œå®ä¾‹çš„åˆ›å»ºä¸è¿è¡Œ"></a>å‘½ä»¤è¡Œå®ä¾‹çš„åˆ›å»ºä¸è¿è¡Œ</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">cmdline</span> *<span class="title">cl</span>;</span></span><br><span class="line"><span class="type">int</span> fd = open(startup_file, O_RDONLY);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (fd &gt;= <span class="number">0</span>) {</span><br><span class="line">    cl = cmdline_new(ctx, <span class="string">""</span>, fd, STDOUT_FILENO);</span><br><span class="line">    <span class="keyword">if</span> (cl == <span class="literal">NULL</span>) {</span><br><span class="line">        <span class="comment">/* error handling */</span></span><br><span class="line">    }</span><br><span class="line">    cmdline_interact(cl);</span><br><span class="line">    cmdline_quit(cl);</span><br><span class="line">    close(fd);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">cl = cmdline_stdin_new(ctx, <span class="string">"Proxy&gt;&gt; "</span>);</span><br><span class="line"><span class="keyword">if</span> (cl == <span class="literal">NULL</span>) {</span><br><span class="line">    <span class="comment">/* error handling */</span></span><br><span class="line">}</span><br><span class="line">cmdline_interact(cl);</span><br><span class="line">cmdline_stdin_exit(cl);</span><br></pre></td></tr></table></figure>



<h2 id="Generator-Script"><a href="#Generator-Script" class="headerlink" title="Generator Script"></a>Generator Script</h2><p>æ­¤å¤–è¿˜å¯ä»¥é€šè¿‡æ‰§è¡Œ<code>dpdk-cmdline-gen.py</code>è„šæœ¬æ¥ç”Ÿæˆå‘½ä»¤æ³¨å†Œçš„ä»£ç ï¼Œè¯¥è„šæœ¬ä»¥å‘½ä»¤åˆ—è¡¨æ–‡ä»¶ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¾“å‡ºç›¸åº”ä»£ç ï¼ˆ<code>--stubs</code>è¿˜å¯ä»¥ç”Ÿæˆå›è°ƒå‡½æ•°çš„æ¨¡æ¿ï¼‰ã€‚å‘½ä»¤åˆ—è¡¨æ–‡ä»¶çš„å†…å®¹æ ¼å¼è¦æ±‚å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ¯è¡Œå¯¹åº”ä¸€æ¡å‘½ä»¤</li>
<li>è¡Œé¦–ä¸º<code>#</code>çš„è¡Œä¸ºæ³¨é‡Šè¡Œ</li>
<li>å‘½ä»¤åå¯åŠ <code>#</code>ï¼Œæ³¨é‡Šç¬¦åé¢çš„å†…å®¹ä¸ºè¯¥å‘½ä»¤çš„å¸®åŠ©å­—æ®µ</li>
<li>ä»…æ”¯æŒå‚æ•°ä¸ºï¼š<ul>
<li>å•tokençš„å­—ç¬¦ä¸²</li>
<li>IPåœ°å€</li>
<li>æ•°å­—</li>
</ul>
</li>
</ul>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># example list file</span><br><span class="line">list                     # show all entries</span><br><span class="line">add &lt;UINT16&gt;x &lt;UINT16&gt;y  # add x and y</span><br><span class="line">echo &lt;STRING&gt;message     # print message to screen</span><br><span class="line">add socket &lt;STRING&gt;path  # add unix socket with the given path</span><br><span class="line">set mode &lt;(rx,tx)&gt;rxtx   # set Rx-only or Tx-only mode</span><br><span class="line">quit                     # close the application</span><br></pre></td></tr></table></figure>



<h1 id="Ring-Queue"><a href="#Ring-Queue" class="headerlink" title="Ring(Queue)"></a>Ring(Queue)</h1><p>å¾ªç¯é˜Ÿåˆ—ï¼Œæ”¯æŒå¤šç”Ÿäº§è€…å…¥é˜Ÿå’Œå¤šæ¶ˆè´¹è€…å‡ºé˜Ÿï¼Œæ— é”åŒ–å®ç°ã€‚</p>
<p>å•ç”Ÿäº§è€…å…¥é˜Ÿï¼š</p>
<ol>
<li><p>å¤åˆ¶<code>ring-&gt;prod_head</code>å’Œ<code>ring-&gt;cons_tail</code> åˆ°æœ¬åœ°å˜é‡ä¸­ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è¶³å¤Ÿç©ºé—´å¹¶ä¸”å°†æœ¬åœ°å˜é‡<code>prod_next</code>æŒ‡å‘å¾…æ›´æ–°çš„ä½ç½®</p>
<p><a href="/images/ring-enqueue1.svg" title="enqueue1" class="gallery-item" style="box-shadow: none;"> <img src="/images/ring-enqueue1.svg" alt="enqueue1"></a></p>
</li>
<li><p>å°†<code>ring-&gt;prod_head</code>æ›´æ–°ä¸ºæœ¬åœ°å˜é‡<code>prod_next</code>æ‰€æŒ‡å‘çš„ä½ç½®ï¼Œå¹¶å°†å¾…å…¥é˜Ÿçš„å…ƒç´ obj4æ‹·è´åˆ°ringä¸­</p>
<p> <a href="/images/ring-enqueue2.svg" title="enqueue2" class="gallery-item" style="box-shadow: none;"> <img src="/images/ring-enqueue2.svg" alt="enqueue2"></a></p>
</li>
<li><p>å°†<code>ring-&gt;prod_tail</code>æ›´æ–°ä¸º<code>ring-&gt;prod_head</code>æ‰€æŒ‡å‘çš„ä½ç½®</p>
<p> <a href="/images/ring-enqueue3.svg" title="enqueue3" class="gallery-item" style="box-shadow: none;"> <img src="/images/ring-enqueue3.svg" alt="enqueue3"></a></p>
</li>
</ol>
<p>å¤šç”Ÿäº§è€…å…¥é˜Ÿï¼š</p>
<ol>
<li><p>æ‰€æœ‰coreï¼Œéƒ½å¤åˆ¶<code>ring-&gt;prod_head</code>å’Œ<code>ring-&gt;cons_tail</code> åˆ°æœ¬åœ°å˜é‡ä¸­ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è¶³å¤Ÿç©ºé—´å¹¶ä¸”å°†æœ¬åœ°å˜é‡<code>prod_next</code>æŒ‡å‘å¾…æ›´æ–°çš„ä½ç½®</p>
<p> <a href="/images/ring-mp-enqueue1.svg" title="mp_enqueue1" class="gallery-item" style="box-shadow: none;"> <img src="/images/ring-mp-enqueue1.svg" alt="mp_enqueue1"></a></p>
</li>
<li><p>æ‰€æœ‰coreéƒ½ä½¿ç”¨CASæŒ‡ä»¤æ›´æ–°<code>ring-&gt;prod_head</code>ä¸ºæœ¬åœ°å˜é‡<code>prod_next</code>æ‰€æŒ‡å‘çš„ä½ç½®ï¼Œè¿™å¯èƒ½ä¼šäº§ç”Ÿä¸¤ç§ç»“æœï¼š</p>
<ol>
<li>CASå¤±è´¥ï¼Œè¿”å›åˆ°ç¬¬ä¸€æ­¥</li>
<li>CASæˆåŠŸï¼Œç»§ç»­ä¸‹ä¸€æ­¥</li>
</ol>
<p> è¿™é‡Œå‡è®¾core1æˆåŠŸï¼Œcore2å¤±è´¥</p>
<p> <a href="/images/ring-mp-enqueue2.svg" title="mp_enqueue2" class="gallery-item" style="box-shadow: none;"> <img src="/images/ring-mp-enqueue2.svg" alt="mp_enqueue2"></a></p>
</li>
<li><p>core2åœ¨ç¬¬äºŒæ¬¡æ‰§è¡ŒCASæ—¶æˆåŠŸï¼Œç„¶åcore1å…¥é˜Ÿä¸€ä¸ªå…ƒç´ obj4ï¼Œcore2å…¥é˜Ÿä¸€ä¸ªå…ƒç´ obj5</p>
<p> <a href="/images/ring-mp-enqueue3.svg" title="mp_enqueue3" class="gallery-item" style="box-shadow: none;"> <img src="/images/ring-mp-enqueue3.svg" alt="mp_enqueue3"></a></p>
</li>
<li><p>ç°åœ¨æ‰€æœ‰coreéƒ½æƒ³è¦æ›´æ–°<code>ring-&gt;prod_tail</code>ä¸ºæœ¬åœ°å˜é‡<code>prod_next</code>æ‰€æŒ‡å‘çš„ä½ç½®ï¼Œä½†åªæœ‰<code>ring-&gt;prod_tail</code>å’Œæœ¬åœ°å˜é‡<code>prod_head </code>ç›¸ç­‰çš„coreæ‰è¢«å…è®¸æ›´æ–°ã€‚å› æ­¤è¿™ä¸ªæ“ä½œåœ¨core1ä¸Šå®Œæˆ</p>
<p> <a href="/images/ring-mp-enqueue4.svg" title="mp_enqueue4" class="gallery-item" style="box-shadow: none;"> <img src="/images/ring-mp-enqueue4.svg" alt="mp_enqueue4"></a></p>
</li>
<li><p>ä¸€æ—¦core1ä¸Šå®Œæˆå¯¹<code>ring-&gt;prod_tail</code>çš„æ›´æ–°ï¼Œcore2ä¹Ÿæ»¡è¶³æ›´æ–°æ¡ä»¶ï¼Œå› æ­¤è¿™ä¸ªæ“ä½œä¹Ÿä¼šåœ¨core2ä¸Šå®Œæˆ</p>
<p> <a href="/images/ring-mp-enqueue5.svg" title="mp_enqueue5" class="gallery-item" style="box-shadow: none;"> <img src="/images/ring-mp-enqueue5.svg" alt="mp_enqueue5"></a></p>
</li>
</ol>
<p>åœ¨å®é™…å®ç°ä¸­ï¼Œ<code>prod_head</code>ï¼Œ<code>prod_tail</code>ï¼Œ <code>cons_head</code>å’Œ<code>cons_tail</code>ä½¿ç”¨32ä½æ— ç¬¦å·æ•´æ•°è¡¨ç¤ºï¼Œå¹¶ä¸”é€šè¿‡ä¸<code>ring-&gt;mask</code>è¿›è¡Œä½ä¸æ“ä½œæ¥è·å–å®ƒä»¬åœ¨ringä¸­çš„ä½ç½®ã€‚ä¸‹é¢ä¸¤ä¸ªä¾‹å­é‡‡ç”¨16ä½è€Œé32ä½æ¥è¯´æ˜ï¼š</p>
<p><a href="/images/ring-modulo1.svg" title="modulo1" class="gallery-item" style="box-shadow: none;"> <img src="/images/ring-modulo1.svg" alt="modulo1"></a></p>
<p><a href="/images/ring-modulo2.svg" title="modulo2" class="gallery-item" style="box-shadow: none;"> <img src="/images/ring-modulo2.svg" alt="modulo2"></a></p>
<blockquote>
<p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä¾‹å­ä¸­ä½¿ç”¨äº†æ¨¡65535çš„è¿ç®—ï¼Œå®é™…æ‰§è¡Œä¸­è¿™æ˜¯å¤šä½™çš„ï¼Œå› ä¸ºç»“æœæº¢å‡ºæ—¶ä¼šè‡ªåŠ¨å–æ¨¡ã€‚</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_ring</span> {</span></span><br><span class="line">	...</span><br><span class="line">    <span class="comment">//ringçš„å®é™…å¤§å°ï¼Œä¸º2çš„æ•´æ•°æ¬¡å¹‚</span></span><br><span class="line">	<span class="type">uint32_t</span> size;           <span class="comment">/**&lt; Size of ring. */</span></span><br><span class="line">    <span class="comment">//é€šè¿‡å°†headä½ä¸maskè·å¾—ringä¸­çš„å®é™…ç´¢å¼•</span></span><br><span class="line">	<span class="type">uint32_t</span> mask;           <span class="comment">/**&lt; Mask (size-1) of ring. */</span></span><br><span class="line">    <span class="comment">//ç”¨æˆ·è®¾ç½®çš„ringçš„å¤§å°ï¼Œå°äºsize</span></span><br><span class="line">	<span class="type">uint32_t</span> capacity;       <span class="comment">/**&lt; Usable size of ring */</span></span><br><span class="line">	...</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line">*entries = (prod_tail - *old_head);	<span class="comment">//å‡ºé˜Ÿæ—¶è®¡ç®—</span></span><br><span class="line"><span class="comment">//å› ä¸ºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„è·ç¦»æ€»æ˜¯ä¿æŒåœ¨0~(capacity-1)ä¹‹é—´ï¼Œæ‰€ä»¥è¿™é‡Œçš„å‡æ³•ä¸ä¼šå¯¼è‡´æº¢å‡º</span></span><br><span class="line">*free_entries = (capacity + cons_tail - *old_head);	<span class="comment">//å…¥é˜Ÿæ—¶è®¡ç®—</span></span><br></pre></td></tr></table></figure>



<h2 id="ç”Ÿäº§è€…-æ¶ˆè´¹è€…åŒæ­¥æ¨¡å¼"><a href="#ç”Ÿäº§è€…-æ¶ˆè´¹è€…åŒæ­¥æ¨¡å¼" class="headerlink" title="ç”Ÿäº§è€…/æ¶ˆè´¹è€…åŒæ­¥æ¨¡å¼"></a>ç”Ÿäº§è€…/æ¶ˆè´¹è€…åŒæ­¥æ¨¡å¼</h2><p>ringæ”¯æŒä¸åŒçš„ç”Ÿäº§è€…æ¶ˆè´¹è€…åŒæ­¥æ¨¡å¼ï¼Œä»¥é€‚åº”ä¸åŒçš„ä½¿ç”¨ç¯å¢ƒï¼š</p>
<ul>
<li><p>MP/MC(é»˜è®¤æ¨¡å¼)ï¼šå¤šç”Ÿäº§è€…/å¤šæ¶ˆè´¹è€…æ¨¡å¼ï¼Œè¿™åœ¨æ¯lcoreå¯¹åº”ä¸€ä¸ªcpuçš„coreæ—¶æ˜¯æœ€åˆé€‚å’Œæœ€å¿«é€Ÿçš„åŒæ­¥æ¨¡å¼ã€‚</p>
</li>
<li><p>SP/SCï¼šå•ç”Ÿäº§è€…/å•æ¶ˆè´¹è€…æ¨¡å¼ã€‚</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_ring_headtail</span> {</span></span><br><span class="line">    <span class="comment">// MP/MCæ¨¡å¼ä¸‹headæ›´æ–°éœ€è¦CASï¼Œå¤±è´¥éœ€è¦é‡æ–°è®¡ç®—headå€¼</span></span><br><span class="line">    <span class="comment">// SP/SCæ¨¡å¼ä¸‹headç›´æ¥æ›´æ–°</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="title function_">RTE_ATOMIC</span><span class="params">(<span class="type">uint32_t</span>)</span> head;      <span class="comment">/**&lt; prod/consumer head. */</span></span><br><span class="line">    <span class="comment">// MP/MCæ¨¡å¼ä¸‹éœ€è¦ç­‰åˆ°tailä¸æœ¬åœ°headç›¸ç­‰æ—¶æ‰å¯æ›´æ–°</span></span><br><span class="line">    <span class="comment">// SP/SCæ¨¡å¼ä¸‹tailç›´æ¥æ›´æ–°</span></span><br><span class="line">    <span class="keyword">volatile</span> <span class="title function_">RTE_ATOMIC</span><span class="params">(<span class="type">uint32_t</span>)</span> tail;      <span class="comment">/**&lt; prod/consumer tail. */</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">        <span class="comment">/** sync type of prod/cons */</span></span><br><span class="line">        <span class="class"><span class="keyword">enum</span> <span class="title">rte_ring_sync_type</span> <span class="title">sync_type</span>;</span></span><br><span class="line">        <span class="comment">/** deprecated -  True if single prod/cons */</span></span><br><span class="line">        <span class="type">uint32_t</span> single;</span><br><span class="line">    };</span><br><span class="line">};</span><br></pre></td></tr></table></figure>
</li>
<li><p>MP_RTS/MC_RTS(Relaxed Tail Sync)ï¼šä¸MP/MCä¸åŒçš„æ˜¯åœ¨å¤šä¸ªç”Ÿäº§è€…/æ¶ˆè´¹è€…åŒæ—¶æ“ä½œringæ—¶ï¼Œä»…æœ€åä¸€ä¸ªç”Ÿäº§è€…/æ¶ˆè´¹è€…æ›´æ–°<code>tail</code>ï¼Œå…¶ä»–ç”Ÿäº§è€…/æ¶ˆè´¹è€…ä¸ä¼šç­‰å¾…æ›´æ–°<code>tail</code>ã€‚è¿™é¿å…äº†åœ¨å¤šç”Ÿäº§è€…/å¤šæ¶ˆè´¹è€…å¯¹ringæ“ä½œè¿‡äºé¢‘ç¹çš„æƒ…å†µä¸‹å¯¼è‡´çš„Lock-Waiter-Preemption (LWP)é—®é¢˜ã€‚</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">union</span> __<span class="title">rte_ring_rts_poscnt</span> {</span></span><br><span class="line">	<span class="comment">/** raw 8B value to read/write *cnt* and *pos* as one atomic op */</span></span><br><span class="line">	RTE_ATOMIC(<span class="type">uint64_t</span>) raw __rte_aligned(<span class="number">8</span>);</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">        <span class="comment">//æ¯æ›´æ–°ä¸€æ¬¡cntåŠ ä¸€</span></span><br><span class="line">		<span class="type">uint32_t</span> cnt; <span class="comment">/**&lt; head/tail reference counter */</span></span><br><span class="line">		<span class="type">uint32_t</span> pos; <span class="comment">/**&lt; head/tail position */</span></span><br><span class="line">	} val;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_ring_rts_headtail</span> {</span></span><br><span class="line">    <span class="comment">// éæœ€åä¸€ä¸ªçº¿ç¨‹æ›´æ–°cntï¼Œæœ€åä¸€ä¸ªçº¿ç¨‹åŒæ—¶æ›´æ–°cntå’Œpos</span></span><br><span class="line">	<span class="keyword">volatile</span> <span class="class"><span class="keyword">union</span> __<span class="title">rte_ring_rts_poscnt</span> <span class="title">tail</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">rte_ring_sync_type</span> <span class="title">sync_type</span>;</span>  <span class="comment">/**&lt; sync type of prod/cons */</span></span><br><span class="line">    <span class="comment">// é¿å…é¢‘ç¹çš„å…¥é˜Ÿ/å‡ºé˜Ÿæ‰€å¯¼è‡´çš„tailè¿Ÿè¿Ÿä¸æ›´æ–°</span></span><br><span class="line">	<span class="type">uint32_t</span> htd_max;   <span class="comment">/**&lt; max allowed distance between head/tail */</span></span><br><span class="line">    <span class="comment">// æ›´æ–°posçš„åŒæ—¶æ›´æ–°cnt</span></span><br><span class="line">	<span class="keyword">volatile</span> <span class="class"><span class="keyword">union</span> __<span class="title">rte_ring_rts_poscnt</span> <span class="title">head</span>;</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>
</li>
<li><p>MP_HTS/MC_HTS(Head/Tail Sync)ï¼šåœ¨å¤šç”Ÿäº§è€…/å¤šæ¶ˆè´¹è€…æƒ…å†µä¸‹ï¼Œä¿è¯äº†å…¥é˜Ÿ/å‡ºé˜Ÿæ“ä½œçš„åºåˆ—åŒ–ï¼Œå³æ¯æ¬¡ä»…å…è®¸ä¸€ä¸ªç”Ÿäº§è€…/æ¶ˆè´¹è€…è¿›è¡Œæ“ä½œã€‚</p>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">union</span> __<span class="title">rte_ring_hts_pos</span> {</span></span><br><span class="line">	<span class="comment">/** raw 8B value to read/write *head* and *tail* as one atomic op */</span></span><br><span class="line">	RTE_ATOMIC(<span class="type">uint64_t</span>) raw __rte_aligned(<span class="number">8</span>);</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">        <span class="comment">// åªæœ‰åœ¨headç­‰äºtailæ—¶æ‰èƒ½æ›´æ–°head</span></span><br><span class="line">		RTE_ATOMIC(<span class="type">uint32_t</span>) head; <span class="comment">/**&lt; head position */</span></span><br><span class="line">		RTE_ATOMIC(<span class="type">uint32_t</span>) tail; <span class="comment">/**&lt; tail position */</span></span><br><span class="line">	} pos;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_ring_hts_headtail</span> {</span></span><br><span class="line">	<span class="keyword">volatile</span> <span class="class"><span class="keyword">union</span> __<span class="title">rte_ring_hts_pos</span> <span class="title">ht</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">rte_ring_sync_type</span> <span class="title">sync_type</span>;</span>  <span class="comment">/**&lt; sync type of prod/cons */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Ringçš„åˆ›å»º"><a href="#Ringçš„åˆ›å»º" class="headerlink" title="Ringçš„åˆ›å»º"></a>Ringçš„åˆ›å»º</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> RING_F_SP_ENQ 0x0001 <span class="comment">/**&lt; The default enqueue is "single-producer". */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RING_F_SC_DEQ 0x0002 <span class="comment">/**&lt; The default dequeue is "single-consumer". */</span></span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Ring is to hold exactly requested number of entries.</span></span><br><span class="line"><span class="comment"> * Without this flag set, the ring size requested must be a power of 2, and the</span></span><br><span class="line"><span class="comment"> * usable space will be that size - 1. With the flag, the requested size will</span></span><br><span class="line"><span class="comment"> * be rounded up to the next power of two, but the usable space will be exactly</span></span><br><span class="line"><span class="comment"> * that requested. Worst case, if a power-of-2 size is requested, half the</span></span><br><span class="line"><span class="comment"> * ring space will be wasted.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RING_F_EXACT_SZ 0x0004</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RING_F_MP_RTS_ENQ 0x0008 <span class="comment">/**&lt; The default enqueue is "MP RTS". */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RING_F_MC_RTS_DEQ 0x0010 <span class="comment">/**&lt; The default dequeue is "MC RTS". */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RING_F_MP_HTS_ENQ 0x0020 <span class="comment">/**&lt; The default enqueue is "MP HTS". */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RING_F_MC_HTS_DEQ 0x0040 <span class="comment">/**&lt; The default dequeue is "MC HTS". */</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">//åœ¨flagæ²¡æœ‰é…ç½®RING_F_EXACT_SZçš„æƒ…å†µä¸‹ï¼Œcountåªèƒ½é€‰æ‹©2çš„æ•´æ•°æ¬¡å¹‚ï¼Œä¸”å¯ç”¨ringçš„å®¹é‡ä¸ºcount-1ï¼ˆç©ºå‡ºæ¥çš„é‚£ä¸ªå…ƒç´ ç”¨äºåˆ¤æ–­é˜Ÿæ»¡å’Œé˜Ÿç©ºï¼‰</span></span><br><span class="line"><span class="keyword">struct</span> rte_ring *<span class="title function_">rte_ring_create_elem</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">unsigned</span> <span class="type">int</span> esize,</span></span><br><span class="line"><span class="params">			<span class="type">unsigned</span> <span class="type">int</span> count, <span class="type">int</span> socket_id, <span class="type">unsigned</span> <span class="type">int</span> flags)</span>;</span><br></pre></td></tr></table></figure>



<h2 id="Ringçš„å…¥é˜Ÿ"><a href="#Ringçš„å…¥é˜Ÿ" class="headerlink" title="Ringçš„å…¥é˜Ÿ"></a>Ringçš„å…¥é˜Ÿ</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰¹é‡å…¥é˜Ÿï¼Œå…¥é˜Ÿæ•°é‡ = n</span></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">unsigned</span> <span class="type">int</span></span><br><span class="line"><span class="title function_">rte_ring_enqueue_bulk_elem</span><span class="params">(<span class="keyword">struct</span> rte_ring *r, <span class="type">const</span> <span class="type">void</span> *obj_table,</span></span><br><span class="line"><span class="params">		<span class="type">unsigned</span> <span class="type">int</span> esize, <span class="type">unsigned</span> <span class="type">int</span> n, <span class="type">unsigned</span> <span class="type">int</span> *free_space)</span></span><br><span class="line"><span class="comment">//çªå‘å…¥é˜Ÿï¼Œå…¥é˜Ÿæ•°é‡ &lt;= n</span></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">unsigned</span> <span class="type">int</span></span><br><span class="line"><span class="title function_">rte_ring_mp_rts_enqueue_burst_elem</span><span class="params">(<span class="keyword">struct</span> rte_ring *r, <span class="type">const</span> <span class="type">void</span> *obj_table,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">int</span> esize, <span class="type">unsigned</span> <span class="type">int</span> n, <span class="type">unsigned</span> <span class="type">int</span> *free_space)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ‰¹é‡é¢„å…¥é˜Ÿï¼Œå…ˆé¢„ä¿ç•™nä¸ªé˜Ÿåˆ—å…ƒç´ ï¼Œè€Œåæ ¹æ®ç”¨æˆ·è¡Œä¸ºæ¥å†³å®šå®é™…å…¥é˜Ÿçš„ä¸ªæ•°ï¼Œè¯¥åŠŸèƒ½ä»…æ”¯æŒSP/SCï¼ŒMP_HTS/MC_HTSæ¨¡å¼ä¸‹ä½¿ç”¨</span></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">unsigned</span> <span class="type">int</span></span><br><span class="line"><span class="title function_">rte_ring_enqueue_bulk_elem_start</span><span class="params">(<span class="keyword">struct</span> rte_ring *r, <span class="type">unsigned</span> <span class="type">int</span> n,</span></span><br><span class="line"><span class="params">		<span class="type">unsigned</span> <span class="type">int</span> *free_space)</span></span><br><span class="line"><span class="comment">//æ‰¹é‡å…¥é˜Ÿå®Œæˆï¼Œå®é™…å…¥é˜Ÿä¸ªæ•°å¯èƒ½å°äºé¢„ä¿ç•™ä¸ªæ•°</span></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">void</span></span><br><span class="line"><span class="title function_">rte_ring_enqueue_elem_finish</span><span class="params">(<span class="keyword">struct</span> rte_ring *r, <span class="type">const</span> <span class="type">void</span> *obj_table,</span></span><br><span class="line"><span class="params">		<span class="type">unsigned</span> <span class="type">int</span> esize, <span class="type">unsigned</span> <span class="type">int</span> n)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> rte_ring_zc_data {</span><br><span class="line">	<span class="comment">/* Pointer to the first space in the ring */</span></span><br><span class="line">	<span class="type">void</span> *ptr1;</span><br><span class="line">	<span class="comment">/* Pointer to the second space in the ring if there is wrap-around.</span></span><br><span class="line"><span class="comment">	 * It contains valid value only if wrap-around happens.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">void</span> *ptr2;</span><br><span class="line">	<span class="comment">/* Number of elements in the first pointer. If this is equal to</span></span><br><span class="line"><span class="comment">	 * the number of elements requested, then ptr2 is NULL.</span></span><br><span class="line"><span class="comment">	 * Otherwise, subtracting n1 from number of elements requested</span></span><br><span class="line"><span class="comment">	 * will give the number of elements available at ptr2.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> n1;</span><br><span class="line">} __rte_cache_aligned;</span><br><span class="line"><span class="comment">//é›¶æ‹·è´çš„æ‰¹é‡é¢„å…¥é˜Ÿï¼Œè¯¥åŠŸèƒ½ä»…æ”¯æŒSP/SCï¼ŒMP_HTS/MC_HTSæ¨¡å¼ä¸‹ä½¿ç”¨</span></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">unsigned</span> <span class="type">int</span></span><br><span class="line"><span class="title function_">rte_ring_enqueue_zc_bulk_elem_start</span><span class="params">(<span class="keyword">struct</span> rte_ring *r, <span class="type">unsigned</span> <span class="type">int</span> esize,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">int</span> n, <span class="keyword">struct</span> rte_ring_zc_data *zcd, <span class="type">unsigned</span> <span class="type">int</span> *free_space)</span></span><br></pre></td></tr></table></figure>



<h1 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h1><p>åè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ï¼Œæä¾›äº†ä¸¤ç§å®ç°æ–¹å¼</p>
<ul>
<li>standardï¼šåˆ©ç”¨æ•°ç»„å­˜å‚¨stackå…ƒç´ ï¼Œspiné”æ§åˆ¶å¹¶å‘</li>
<li>lock-freeï¼šåˆ©ç”¨å•å‘é“¾è¡¨å­˜å‚¨stackå…ƒç´ (è¡¨å¤´å³ä¸ºæ ˆé¡¶)ï¼Œä¸”å†…éƒ¨åŒæ—¶ä½¿ç”¨ä¸¤ä¸ªæ ˆï¼Œä¸€ä¸ªæ ˆä¸ºusedæ ˆï¼›å¦ä¸€ä¸ªæ ˆä¸ºfreeæ ˆã€‚(ä½¿ç”¨ä¸¤ä¸ªæ ˆè§£å†³äº†pushå’Œpopä¹‹é—´çš„æ— é”åŒ–åŒæ­¥)</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//stackçš„åˆ›å»º</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_STACK_F_LF 0x0001	<span class="comment">//æŒ‡æ˜æ ˆä½¿ç”¨å“ªç§å®ç°æ–¹å¼</span></span></span><br><span class="line"><span class="keyword">struct</span> rte_stack *</span><br><span class="line"><span class="title function_">rte_stack_create</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">unsigned</span> <span class="type">int</span> count, <span class="type">int</span> socket_id,</span></span><br><span class="line"><span class="params">		 <span class="type">uint32_t</span> flags)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">unsigned</span> <span class="type">int</span></span><br><span class="line"><span class="title function_">rte_stack_push</span><span class="params">(<span class="keyword">struct</span> rte_stack *s, <span class="type">void</span> * <span class="type">const</span> *obj_table, <span class="type">unsigned</span> <span class="type">int</span> n)</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">unsigned</span> <span class="type">int</span></span><br><span class="line"><span class="title function_">rte_stack_pop</span><span class="params">(<span class="keyword">struct</span> rte_stack *s, <span class="type">void</span> **obj_table, <span class="type">unsigned</span> <span class="type">int</span> n)</span></span><br></pre></td></tr></table></figure>



<h3 id="æ— é”åŒ–æ–¹å¼ä¸‹ABAé—®é¢˜"><a href="#æ— é”åŒ–æ–¹å¼ä¸‹ABAé—®é¢˜" class="headerlink" title="æ— é”åŒ–æ–¹å¼ä¸‹ABAé—®é¢˜"></a>æ— é”åŒ–æ–¹å¼ä¸‹ABAé—®é¢˜</h3><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥äº†è§£ä¸‹ABAé—®é¢˜çš„äº§ç”Ÿï¼Œè¿™é‡Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæ¯æ¬¡ä»…push/popä¸€ä¸ªå…ƒç´ ï¼Œä¸”å¿½ç•¥å¯¹freeæ ˆçš„æ“ä½œï¼š</p>
<p>1ï¼šAçº¿ç¨‹æ‰§è¡Œpopæ“ä½œï¼Œé€šè¿‡æ ˆé¡¶æŒ‡é’ˆè¯»å–åˆ°usedæ ˆé¡¶å…ƒç´ çš„åœ°å€<code>X</code>ã€æ ˆé¡¶å…ƒç´ çš„å†…å®¹<code>X-&gt;data</code>å’Œã€æ–°çš„æ ˆé¡¶å…ƒç´ çš„åœ°å€<code>X-&gt;next</code>ï¼Œå¹¶å°†å…¶è®°å½•ä¸‹æ¥</p>
<p>2ï¼šå…¶ä»–çº¿ç¨‹æ‰§è¡Œäº†ä¸€äº›popå’Œpushæ“ä½œï¼Œä¸”æ“ä½œåusedæ ˆé¡¶æŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ çš„åœ°å€æ°å¥½æ˜¯<code>X</code></p>
<p>3ï¼šAçº¿ç¨‹ä½¿ç”¨CASï¼ŒæˆåŠŸçš„å°†<code>X-&gt;next</code>è®¾ç½®ä¸ºusedæ ˆé¡¶æŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ çš„åœ°å€,å¹¶å°†<code>X-&gt;data</code>è¿”å›ç»™ç”¨æˆ·</p>
<p>ç¬¬ä¸‰æ­¥ä¸­çº¿ç¨‹Aæ‰€è·å–åˆ°çš„<code>X</code>å’Œ<code>X-&gt;next</code>å·²ç»ä¸æ˜¯æœ€æ–°çš„äº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹å°†<code>X-&gt;data</code>ä½œä¸ºå‡ºæ ˆå…ƒç´ ï¼Œå°†<code>X-&gt;next</code>ä½œä¸ºusedæ ˆé¡¶å…ƒç´ çš„åœ°å€ï¼Œå°±æ˜¯é”™è¯¯çš„è¡Œä¸ºäº†ã€‚</p>
<h3 id="ABAé—®é¢˜è§£å†³æ–¹æ¡ˆ"><a href="#ABAé—®é¢˜è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ABAé—®é¢˜è§£å†³æ–¹æ¡ˆ"></a>ABAé—®é¢˜è§£å†³æ–¹æ¡ˆ</h3><p>å¼•å…¥ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å¯¹æ ˆé¡¶è¿›è¡Œpushå’Œpopæ“ä½œæ—¶ï¼Œç‰ˆæœ¬å·åŠ ä¸€ã€‚åŒæ—¶ä½¿ç”¨CASè¿›è¡Œæ¯”è¾ƒæ—¶ä¸ä»…æ¯”è¾ƒæ ˆé¡¶å…ƒç´ çš„åœ°å€ï¼Œè¿˜åŒæ—¶æ¯”è¾ƒç‰ˆæœ¬å·ã€‚è¿™æ ·åšå°±é¿å…äº†ABAé—®é¢˜ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ˆå…ƒç´ </span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_stack_lf_elem</span> {</span></span><br><span class="line">	<span class="type">void</span> *data;			<span class="comment">/**&lt; Data pointer */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_stack_lf_elem</span> *<span class="title">next</span>;</span>	<span class="comment">/**&lt; Next pointer */</span></span><br><span class="line">};</span><br><span class="line"><span class="comment">//æ ˆé¡¶æŒ‡é’ˆï¼Œé‡‡ç”¨128ä½çš„CASè¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_stack_lf_head</span> {</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_stack_lf_elem</span> *<span class="title">top</span>;</span> <span class="comment">/**&lt; Stack top */</span></span><br><span class="line">	<span class="type">uint64_t</span> cnt; <span class="comment">/**&lt; Modification counter for avoiding ABA problem */</span></span><br><span class="line">};</span><br><span class="line"><span class="comment">//usedæ ˆå’Œfreeæ ˆ</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_stack_lf_list</span> {</span></span><br><span class="line">	<span class="comment">/** List head */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_stack_lf_head</span> <span class="title">head</span> __<span class="title">rte_aligned</span>(16);</span></span><br><span class="line">	<span class="comment">/** List len */</span></span><br><span class="line">	RTE_ATOMIC(<span class="type">uint64_t</span>) len;</span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Structure containing two lock-free LIFO lists: the stack itself and a list</span></span><br><span class="line"><span class="comment"> * of free linked-list elements.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_stack_lf</span> {</span></span><br><span class="line">	<span class="comment">/** LIFO list of elements */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_stack_lf_list</span> <span class="title">used</span> __<span class="title">rte_cache_aligned</span>;</span></span><br><span class="line">	<span class="comment">/** LIFO list of free elements */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_stack_lf_list</span> <span class="title">free</span> __<span class="title">rte_cache_aligned</span>;</span></span><br><span class="line">	<span class="comment">/** LIFO elements */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_stack_lf_elem</span> <span class="title">elems</span>[] __<span class="title">rte_cache_aligned</span>;</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>



<h1 id="RCU-Read-Copy-Update"><a href="#RCU-Read-Copy-Update" class="headerlink" title="RCU(Read, Copy, Update)"></a>RCU(Read, Copy, Update)</h1><p>æ— é”åŒ–çš„è¯»å†™é”ï¼Œåˆ©ç”¨QSBR(Quiescent State Based Reclamation)ç®—æ³•æ£€æµ‹grace periodã€‚</p>
<blockquote>
<p>é™æ­¢æœŸï¼ˆQuiescent Stateï¼‰ï¼šçº¿ç¨‹ä¸å­˜åœ¨å¯¹ä¸´ç•Œèµ„æºçš„ä»»ä½•å¼•ç”¨çš„æ—¶é—´æ®µ</p>
</blockquote>
<blockquote>
<p>å®½é™æœŸï¼ˆgrace periodï¼‰ï¼šä»èµ„æºåœ¨å…±äº«æ•°æ®ç»“æ„ä¸Šåˆ é™¤åˆ°è¯¥èµ„æºé‡Šæ”¾çš„æ—¶é—´æ®µ</p>
</blockquote>
<p>dpdkçš„rcuä½¿ç”¨QSå˜é‡ï¼ˆrcuå®ä¾‹ï¼‰æ¥ä¿æŠ¤æŸä¸ªç‰¹å®šå…±äº«æ•°æ®ç»“æ„çš„ä¸´ç•Œèµ„æºï¼ˆä¾‹å¦‚hashã€lpmï¼‰ã€‚</p>
<p>QSå˜é‡ä½¿ç”¨<code>token</code>æ¥è®°å½•å½“å‰å…±äº«æ•°æ®ç»“æ„çš„ç‰ˆæœ¬å·ï¼ˆæ¯ä¸ªè¯»è€…çº¿ç¨‹ä¹Ÿæœ‰å±äºè¯¥çº¿ç¨‹çš„tokenï¼Œè®°å½•è¯¥çº¿ç¨‹çš„é™æ­¢æœŸæ‰€ä½¿ç”¨çš„ç‰ˆæœ¬å·ï¼‰ï¼Œå†™è€…æ¯å¯¹å…¶èµ„æºæ¯åˆ é™¤ä¸€æ¬¡ï¼Œç‰ˆæœ¬å·éƒ½ä¼šåŠ ä¸€ï¼ŒåŠ ä¸€åçš„ç‰ˆæœ¬å·ä¹Ÿå°±å¯¹åº”äº†è¯¥èµ„æºçš„å®½é™æœŸã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå†™è€…å¯¹å…¶èµ„æºæ·»åŠ å¹¶ä¸ä¼šä¿®æ”¹ç‰ˆæœ¬å·ï¼Œå› ä¸ºæ·»åŠ çš„èµ„æºä¸éœ€è¦é‡Šæ”¾ï¼Œä¹Ÿå°±ä¸éœ€è¦è¿½è¸ªå…¶ç‰ˆæœ¬ã€‚</p>
<p>å½“è¯»çº¿ç¨‹å¤„äºé™æ­¢æœŸæ—¶ï¼Œæ›´æ–°è¯¥çº¿ç¨‹çš„ç‰ˆæœ¬å·ä¸ºå½“å‰QSå˜é‡çš„tokenã€‚</p>
<p>å½“å†™è€…è¦é‡Šæ”¾ç‰¹å®šç‰ˆæœ¬å·æ‰€åˆ é™¤çš„èµ„æºæ—¶ï¼Œéœ€è¦ç­‰å¾…ä¸€ä¸ªå®½é™æœŸçš„æ—¶é—´ï¼Œå³å†™è€…è¦ç­‰åˆ°æ‰€æœ‰çš„è¯»çº¿ç¨‹çš„ç‰ˆæœ¬å·éƒ½å¤§äºç­‰äºè¯¥ç‰ˆæœ¬å·ã€‚å®½é™æœŸè¿‡åï¼Œå³å¯é‡Šæ”¾è¯¥èµ„æºã€‚</p>
<p><a href="/images/rcu_general_info.svg" class="gallery-item" style="box-shadow: none;"> <img src="/images/rcu_general_info.svg"></a></p>
<h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//QSå˜é‡åˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">//è·å–QSå˜é‡å¤§å°</span></span><br><span class="line"><span class="type">size_t</span> <span class="title function_">rte_rcu_qsbr_get_memsize</span><span class="params">(<span class="type">uint32_t</span> max_threads)</span>;</span><br><span class="line"><span class="comment">//QSå˜é‡åˆå§‹åŒ–ï¼Œå…¥å‚çš„QSå˜é‡ä¸€å®šè¦æå‰mallocå‡ºæ¥</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_rcu_qsbr_init</span><span class="params">(<span class="keyword">struct</span> rte_rcu_qsbr *v, <span class="type">uint32_t</span> max_threads)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¯»è€…çº¿ç¨‹æ³¨å†Œ</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_rcu_qsbr_thread_register</span><span class="params">(<span class="keyword">struct</span> rte_rcu_qsbr *v, <span class="type">unsigned</span> <span class="type">int</span> thread_id)</span>;</span><br></pre></td></tr></table></figure>



<h2 id="è¯»è€…"><a href="#è¯»è€…" class="headerlink" title="è¯»è€…"></a>è¯»è€…</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¯»è€…çº¿ç¨‹å¼€å¯å¯¹è¯¥çº¿ç¨‹QSï¼ˆQuiescent Stateï¼‰çš„æŠ¥å‘Šï¼Œè¡¨æ˜è¯»è€…çº¿ç¨‹è¦å¼€å§‹è®¿é—®å…±äº«æ•°æ®ç»“æ„çš„ä¸´ç•Œèµ„æº</span></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">void</span></span><br><span class="line"><span class="title function_">rte_rcu_qsbr_thread_online</span><span class="params">(<span class="keyword">struct</span> rte_rcu_qsbr *v, <span class="type">unsigned</span> <span class="type">int</span> thread_id)</span></span><br><span class="line"><span class="comment">//è¯»è€…çº¿ç¨‹å…³é—­å¯¹è¯¥çº¿ç¨‹QSçš„æŠ¥å‘Šï¼Œä½¿å¾—å†™è€…åœ¨æ£€æŸ¥å®½é™æœŸæ—¶è·³è¿‡è¯¥çº¿ç¨‹ï¼ŒåŒæ—¶è¡¨æ˜è¯»è€…çº¿ç¨‹åœ¨æ­¤åä¸€æ®µæ—¶é—´å†…ä¸éœ€è¦è®¿é—®å…±äº«æ•°æ®ç»“æ„çš„ä¸´ç•Œèµ„æº</span></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">void</span></span><br><span class="line"><span class="title function_">rte_rcu_qsbr_thread_offline</span><span class="params">(<span class="keyword">struct</span> rte_rcu_qsbr *v, <span class="type">unsigned</span> <span class="type">int</span> thread_id)</span></span><br><span class="line"><span class="comment">//è¯»è€…çº¿ç¨‹æ›´æ–°è¯¥çº¿ç¨‹çš„QSï¼Œè¡¨æ˜æ­¤æ—¶è¯»è€…å®Œæˆäº†å¯¹å…±äº«æ•°æ®ç»“æ„çš„ä¸´ç•Œèµ„æºçš„è¯»å–ï¼Œä¸”ä¸å­˜åœ¨å¯¹ä¸´ç•Œèµ„æºçš„ä»»ä½•å¼•ç”¨</span></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">void</span></span><br><span class="line"><span class="title function_">rte_rcu_qsbr_quiescent</span><span class="params">(<span class="keyword">struct</span> rte_rcu_qsbr *v, <span class="type">unsigned</span> <span class="type">int</span> thread_id)</span></span><br></pre></td></tr></table></figure>



<h2 id="å†™è€…"><a href="#å†™è€…" class="headerlink" title="å†™è€…"></a>å†™è€…</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼€å§‹å®½é™æœŸ</span></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">uint64_t</span></span><br><span class="line"><span class="title function_">rte_rcu_qsbr_start</span><span class="params">(<span class="keyword">struct</span> rte_rcu_qsbr *v)</span></span><br><span class="line"><span class="comment">//æ£€æŸ¥ç‰¹å®šç‰ˆæœ¬çš„å®½é™æœŸæ˜¯å¦ç»“æŸ</span></span><br><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">int</span></span><br><span class="line"><span class="title function_">rte_rcu_qsbr_check</span><span class="params">(<span class="keyword">struct</span> rte_rcu_qsbr *v, <span class="type">uint64_t</span> t, <span class="type">bool</span> wait)</span></span><br></pre></td></tr></table></figure>



<h2 id="èµ„æºçš„é‡Šæ”¾"><a href="#èµ„æºçš„é‡Šæ”¾" class="headerlink" title="èµ„æºçš„é‡Šæ”¾"></a>èµ„æºçš„é‡Šæ”¾</h2><p>ä¸Šè¿°å¯¹äºå†™è€…æ‰€æä¾›çš„APIä½¿å¾—å†™è€…å¯ä»¥å¾ˆçµæ´»åœ°å®ç°å¯¹äºèµ„æºçš„åˆ é™¤å’Œé‡Šæ”¾ã€‚ä¸ºäº†æ›´è¿›ä¸€æ­¥æ–¹ä¾¿å†™è€…å¯¹äºrcuçš„ä½¿ç”¨ï¼Œdpdkå°†ä¸Šé¢çš„ä¸¤ä¸ªAPIåšè¿›ä¸€æ­¥çš„å°è£…ï¼Œå¹¶æ ¹æ®å¯¹åˆ é™¤èµ„æºçš„é‡Šæ”¾æ—¶æœºï¼Œæä¾›äº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•</p>
<ol>
<li><p>åŒæ­¥é‡Šæ”¾ï¼šåˆ é™¤èµ„æºåï¼Œå†™è€…ä»¥é˜»å¡æ–¹å¼ç­‰å¾…å®½é™æœŸç»“æŸï¼Œç»“æŸåç«‹å³é‡Šæ”¾èµ„æº</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å¼€å§‹ä¸€ä¸ªæ–°çš„å®½é™æœŸå¹¶é˜»å¡åˆ°å®½é™æœŸç»“æŸåè¿”å›ï¼Œè¿”å›åå¯ä»¥å®‰å…¨çš„é‡Šæ”¾æ‰€åˆ é™¤çš„èµ„æºã€‚</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rte_rcu_qsbr_synchronize</span><span class="params">(<span class="keyword">struct</span> rte_rcu_qsbr *v, <span class="type">unsigned</span> <span class="type">int</span> thread_id)</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¼‚æ­¥é‡Šæ”¾ï¼šé€šè¿‡åˆ›å»ºFIFOçš„å»¶æ—¶é˜Ÿåˆ—ï¼Œåˆ é™¤èµ„æºåï¼Œå°†å¾…é‡Šæ”¾çš„èµ„æºå’Œè¯¥èµ„æºå¯¹åº”çš„å®½é™æœŸç‰ˆæœ¬å·å…¥é˜Ÿï¼Œè€Œåç›´æ¥è¿”å›ã€‚æ­¤åå¯é€‰æ‹©é€‚å½“çš„æ—¶æœºä»¥éé˜»å¡çš„æ–¹å¼éå†å»¶æ—¶é˜Ÿåˆ—ï¼Œå–å‡ºå¹¶é‡Šæ”¾å®½é™æœŸç»“æŸçš„èµ„æºã€‚</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºå»¶æ—¶é˜Ÿåˆ—æ—¶ä½¿ç”¨çš„å‚æ•°</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_rcu_qsbr_dq_parameters</span> {</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *name;</span><br><span class="line">	<span class="comment">/**&lt; Name of the queue. */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**&lt; Enqueue and reclaim operations are multi-thread safe by default.</span></span><br><span class="line"><span class="comment"> *   The call back functions registered to free the resources are</span></span><br><span class="line"><span class="comment"> *   assumed to be multi-thread safe.</span></span><br><span class="line"><span class="comment"> *   Set this flag if multi-thread safety is not required.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_RCU_QSBR_DQ_MT_UNSAFE 1</span></span><br><span class="line">	<span class="type">uint32_t</span> flags;</span><br><span class="line">	<span class="comment">/**&lt; Flags to control API behaviors */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">uint32_t</span> size;</span><br><span class="line">	<span class="comment">/**&lt; Number of entries in queue. Typically, this will be</span></span><br><span class="line"><span class="comment">	 *   the same as the maximum number of entries supported in the</span></span><br><span class="line"><span class="comment">	 *   lock free data structure.</span></span><br><span class="line"><span class="comment">	 *   Data structures with unbounded number of entries is not</span></span><br><span class="line"><span class="comment">	 *   supported currently.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> esize;</span><br><span class="line">	<span class="comment">/**&lt; Size (in bytes) of each element in the defer queue.</span></span><br><span class="line"><span class="comment">	 *   This has to be multiple of 4B.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> trigger_reclaim_limit;</span><br><span class="line">	<span class="comment">/**&lt; Trigger automatic reclamation after the defer queue</span></span><br><span class="line"><span class="comment">	 *   has at least these many resources waiting. This auto</span></span><br><span class="line"><span class="comment">	 *   reclamation is triggered in rte_rcu_qsbr_dq_enqueue API</span></span><br><span class="line"><span class="comment">	 *   call.</span></span><br><span class="line"><span class="comment">	 *   If this is greater than 'size', auto reclamation is</span></span><br><span class="line"><span class="comment">	 *   not triggered.</span></span><br><span class="line"><span class="comment">	 *   If this is set to 0, auto reclamation is triggered</span></span><br><span class="line"><span class="comment">	 *   in every call to rte_rcu_qsbr_dq_enqueue API.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> max_reclaim_size;</span><br><span class="line">	<span class="comment">/**&lt; When automatic reclamation is enabled, reclaim at the max</span></span><br><span class="line"><span class="comment">	 *   these many resources. This should contain a valid value, if</span></span><br><span class="line"><span class="comment">	 *   auto reclamation is on. Setting this to 'size' or greater will</span></span><br><span class="line"><span class="comment">	 *   reclaim all possible resources currently on the defer queue.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">rte_rcu_qsbr_free_resource_t</span> free_fn;</span><br><span class="line">	<span class="comment">/**&lt; Function to call to free the resource. */</span></span><br><span class="line">	<span class="type">void</span> *p;</span><br><span class="line">	<span class="comment">/**&lt; Pointer passed to the free function. Typically, this is the</span></span><br><span class="line"><span class="comment">	 *   pointer to the data structure to which the resource to free</span></span><br><span class="line"><span class="comment">	 *   belongs. This can be NULL.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_rcu_qsbr</span> *<span class="title">v</span>;</span></span><br><span class="line">	<span class="comment">/**&lt; RCU QSBR variable to use for this defer queue */</span></span><br><span class="line">};</span><br><span class="line"><span class="comment">//å»¶æ—¶é˜Ÿåˆ—åˆ›å»ºï¼Œå†™è€…ä»¥å¼‚æ­¥æ–¹å¼è¿›è¡Œèµ„æºé‡Šæ”¾</span></span><br><span class="line"><span class="keyword">struct</span> rte_rcu_qsbr_dq *</span><br><span class="line"><span class="title function_">rte_rcu_qsbr_dq_create</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_rcu_qsbr_dq_parameters *params)</span>;</span><br><span class="line"><span class="comment">//å°†å¾…é‡Šæ”¾çš„èµ„æºå…¥é˜Ÿ</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_rcu_qsbr_dq_enqueue</span><span class="params">(<span class="keyword">struct</span> rte_rcu_qsbr_dq *dq, <span class="type">void</span> *e)</span>;</span><br><span class="line"><span class="comment">//é‡Šæ”¾å»¶æ—¶é˜Ÿåˆ—ä¸­èƒ½å¤Ÿé‡Šæ”¾çš„èµ„æº</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_rcu_qsbr_dq_reclaim</span><span class="params">(<span class="keyword">struct</span> rte_rcu_qsbr_dq *dq, <span class="type">unsigned</span> <span class="type">int</span> n,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">int</span> *freed, <span class="type">unsigned</span> <span class="type">int</span> *pending, <span class="type">unsigned</span> <span class="type">int</span> *available)</span>;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>å…·ä½“ä½¿ç”¨å¯å‚è€ƒdpdkçš„hashæ¨¡å—ï¼š<code>rte_hash_rcu_qsbr_add()</code></p>
<h1 id="Mempool"><a href="#Mempool" class="headerlink" title="Mempool"></a>Mempool</h1><ul>
<li><p>å¯ä½¿ç”¨å¤šç§ç®¡ç†æ–¹å¼æ¥ç®¡ç†å†…å­˜æ± ï¼Œé»˜è®¤æ˜¯åŸºäºringç®¡ç†</p>
</li>
<li><p>æ ¹æ®ç¡¬ä»¶çš„å†…å­˜é…ç½®ï¼Œä¼˜åŒ–å†…å­˜æ± blockçš„å†…å­˜å¸ƒå±€ã€‚è¿™åœ¨å¤šæ¬¡è®¿é—®å†…å­˜æ± è¿ç»­çš„å¯¹è±¡ï¼Œä¸”æ¯æ¬¡ä»…è®¿é—®blockçš„å¤´64å­—èŠ‚(ä¸€ä¸ªcache lineå¤§å°)çš„æƒ…å†µä¸‹å¯æœ€å¤§åŒ–å†…å­˜å¸¦å®½</p>
<blockquote>
<p>ä¾‹å¦‚ä½¿ç”¨mempoolç®¡ç†packetï¼Œmempoolä¼šä¿è¯æ¯ä¸ªpacketçš„é¦–åœ°å€éƒ½å¤„äºä¸åŒçš„channelå’Œrankä¸­ï¼Œæ­¤æ—¶mempoolä¼šå°†packetçš„å¤§å°æ‰©å±•åˆ°ä¸channel*rankäº’ä¸ºè´¨æ•°ï¼ˆå³æœ€å¤§å…¬çº¦æ•°ä¸º1ï¼Œæœ€å°å…¬å€æ•°ä¸ºä¸¤æ•°ç›¸ä¹˜ï¼Œè¿™æ„å‘³ç€è¿ç»­çš„channel*rankä¸ªpacketï¼Œæ¯ä¸ªpacketçš„é¦–åœ°å€éƒ½å¤„äºä¸åŒçš„channelå’Œrankä¸­ï¼‰</p>
<p><a href="/images/memory-management.svg" title="management" class="gallery-item" style="box-shadow: none;"> <img src="/images/memory-management.svg" alt="management"></a></p>
</blockquote>
</li>
<li><p>ä½¿ç”¨å±€éƒ¨ç¼“å­˜ï¼Œé€šè¿‡é™ä½äº§ç”Ÿå¹¶å‘çš„é¢‘ç‡æ¥æé«˜å†…å­˜æ± çš„å­˜å–æ€§èƒ½</p>
</li>
</ul>
<p>å†…å­˜æ± ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<ol>
<li><code>struct rte_mempool</code>ç”¨äºå­˜å‚¨è¯¥å†…å­˜æ± çš„ç›¸å…³ä¿¡æ¯ï¼Œè¯¥ç»“æ„ä½“åŒ…å«äº†ç§æœ‰æ•°æ®å’Œå±€éƒ¨ç¼“å­˜(LIFO)çš„å†…å­˜</li>
<li>ç”¨äºç®¡ç†å†…å­˜æ± çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚å‰é¢ä»‹ç»è¿‡çš„<code>ring</code>å’Œ<code>stack</code></li>
<li>å†…å­˜æ± ä¸­çš„å¯¹è±¡ï¼Œå­˜æ”¾åœ¨<strong>2</strong>ä¸­è¿›è¡Œç®¡ç†ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¤´(<code>struct rte_mempool_objhdr</code>)ï¼Œç”¨é“¾è¡¨è¿æ¥èµ·æ¥å¹¶å­˜æ”¾åœ¨<strong>1</strong>ä¸­</li>
</ol>
<p><a href="/images/mempool.svg" title="mempool" class="gallery-item" style="box-shadow: none;"> <img src="/images/mempool.svg" alt="mempool"></a></p>
<blockquote>
<p>å†…å­˜æ± å¯¹äºæ¯ä¸ªæ ¸éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå±€éƒ¨ç¼“å­˜ï¼Œä¸€èˆ¬æ¥è¯´æ¯æ ¸å¯¹åº”ä¸€ä¸ªå¤„ç†çº¿ç¨‹ï¼Œå¦‚æœæœ‰å¤šä¸ªå¤„ç†çº¿ç¨‹éƒ½åœ¨ä¸€ä¸ªæ ¸ä¸Šï¼Œå¯¹å±€éƒ¨ç¼“å­˜çš„æ“ä½œéœ€è¦ä¸Šé”ã€‚</p>
</blockquote>
<h2 id="Mempoolåˆ›å»º"><a href="#Mempoolåˆ›å»º" class="headerlink" title="Mempoolåˆ›å»º"></a>Mempoolåˆ›å»º</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Spreading among memory channels not required. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_MEMPOOL_F_NO_SPREAD		0x0001</span></span><br><span class="line"><span class="comment">/** Do not align objects on cache lines. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_MEMPOOL_F_NO_CACHE_ALIGN	0x0002</span></span><br><span class="line"><span class="comment">/** Default put is "single-producer". */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_MEMPOOL_F_SP_PUT		0x0004</span></span><br><span class="line"><span class="comment">/** Default get is "single-consumer". */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_MEMPOOL_F_SC_GET		0x0008</span></span><br><span class="line"><span class="comment">/** Don't need IOVA contiguous objects. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_MEMPOOL_F_NO_IOVA_CONTIG	0x0020</span></span><br><span class="line"><span class="keyword">struct</span> rte_mempool *</span><br><span class="line"><span class="title function_">rte_mempool_create</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">unsigned</span> n, <span class="type">unsigned</span> elt_size,</span></span><br><span class="line"><span class="params">		   <span class="type">unsigned</span> cache_size, 		<span class="comment">//å±€éƒ¨ç¼“å­˜çš„å®¹é‡</span></span></span><br><span class="line"><span class="params">		   <span class="type">unsigned</span> private_data_size,	<span class="comment">//è¿½åŠ åˆ°struct rte_mempoolåçš„ç§æœ‰æ•°æ®å¤§å°</span></span></span><br><span class="line"><span class="params">		   <span class="type">rte_mempool_ctor_t</span> *mp_init, <span class="type">void</span> *mp_init_arg,	<span class="comment">//åˆå§‹åŒ–ç§æœ‰æ•°æ®</span></span></span><br><span class="line"><span class="params">		   <span class="type">rte_mempool_obj_cb_t</span> *obj_init, <span class="type">void</span> *obj_init_arg,	<span class="comment">//åˆå§‹åŒ–å†…å­˜æ± çš„æ‰€æœ‰å¯¹è±¡</span></span></span><br><span class="line"><span class="params">		   <span class="type">int</span> socket_id, <span class="type">unsigned</span> flags)</span>;</span><br></pre></td></tr></table></figure>

<p>åˆ›å»ºå‡½æ•°ä¼šè°ƒç”¨<code>rte_mempool_populate_default()</code>ï¼Œè¯¥å‡½æ•°è®¡ç®—å†…å­˜æ± å¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°ï¼Œè€Œåå»ç”³è¯·å†…å­˜å¹¶å°†ç”³è¯·åˆ°çš„å†…å­˜åˆ†å‰²æˆä¸€ä¸ªä¸ªå¯¹è±¡åŠ å…¥åˆ°å†…å­˜æ± ä¸­ã€‚</p>
<p>è®¡ç®—å†…å­˜æ± å¯¹è±¡æ‰€éœ€å†…å­˜å¤§å°æ—¶ï¼š</p>
<ol>
<li>å¯¹äºæ²¡æœ‰è®¾ç½®<code>RTE_MEMPOOL_F_NO_IOVA_CONTIG</code>æ ‡å¿—çš„å†…å­˜æ± æ¥è¯´ï¼Œå…¶å¯¹è±¡çš„ç‰©ç†åœ°å€å¿…é¡»æ˜¯è¿ç»­çš„ï¼Œä¸”ä¸èƒ½è·¨é¡µé¢ï¼›è®¡ç®—æ—¶æ‰€ä½¿ç”¨çš„é¡µé¢å¤§å°ä¸ºdpdkæ‰€ç”¨çš„æœ€å°é¡µé¢çš„å¤§å°ï¼Œè¿™æ ·åšè™½ç„¶ä¼šä½¿å¾—è®¡ç®—ç»“æœåå¤§ï¼Œä½†å´ç®€åŒ–äº†å®ç°çš„å¤æ‚åº¦ã€‚è‹¥å®é™…åˆ†é…æ—¶é‡‡ç”¨çš„æ˜¯è¾ƒå¤§çš„é¡µé¢ï¼Œä¹Ÿä¸ä¼šå¯¼è‡´ä»»ä½•é—®é¢˜ï¼Œå› ä¸ºå¤§é¡µé¢å¯è§†ä¸ºå¤šä¸ªç‰©ç†åœ°å€è¿ç»­çš„å°é¡µé¢çš„é›†åˆã€‚</li>
<li>å¯¹äºè®¾ç½®äº†<code>RTE_MEMPOOL_F_NO_IOVA_CONTIG</code>æ ‡å¿—çš„å†…å­˜æ± æ¥è¯´æ²¡æœ‰ä¸Šè¿°çº¦æŸã€‚</li>
</ol>
<p>ç”³è¯·å†…å­˜æ—¶ï¼š</p>
<ol>
<li>å°½é‡ä¸€æ¬¡ç”³è¯·å‡ºå¯¹è±¡æ‰€éœ€å†…å­˜(memzoneï¼Œä¸éœ€è¦iovaè¿ç»­ï¼Œæ— è®ºæ˜¯å¦é…ç½®äº†<code>RTE_MEMPOOL_F_NO_IOVA_CONTIG</code>)</li>
<li>å¦‚æœç”³è¯·å¤±è´¥åˆ™å°†ç”³è¯·å¤§å°å‡åŠè¿›è¡Œç”³è¯·ï¼Œç›´åˆ°ç”³è¯·æˆåŠŸ</li>
</ol>
<p>å°†ç”³è¯·åˆ°çš„å†…å­˜åˆ†å‰²æˆå¯¹è±¡ï¼š</p>
<ol>
<li>è‹¥è®¾ç½®äº†<code>RTE_MEMPOOL_F_NO_IOVA_CONTIG</code>åˆ™è°ƒç”¨<code>rte_mempool_populate_iova()</code>å°†memzoneåˆ†å‰²æˆå¯¹è±¡</li>
<li>è‹¥æ²¡è®¾ç½®<code>RTE_MEMPOOL_F_NO_IOVA_CONTIG</code>åˆ™è°ƒç”¨<code>rte_mempool_populate_virt()</code>å°†memzoneåˆ’ä¸ºä¸€ä¸ªä¸ªiovaè¿ç»­çš„å†…å­˜åŒºåŸŸï¼Œå†è°ƒç”¨<code>rte_mempool_populate_iova()</code>å°†è¿™äº›iovaè¿ç»­çš„å†…å­˜åŒºåŸŸåˆ†å‰²æˆå¯¹è±¡</li>
</ol>
<h2 id="Mempoolå¯¹è±¡çš„ç”³è¯·"><a href="#Mempoolå¯¹è±¡çš„ç”³è¯·" class="headerlink" title="Mempoolå¯¹è±¡çš„ç”³è¯·"></a>Mempoolå¯¹è±¡çš„ç”³è¯·</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">static</span> __rte_always_inline <span class="type">void</span></span><br><span class="line"><span class="title function_">rte_mempool_put_bulk</span><span class="params">(<span class="keyword">struct</span> rte_mempool *mp, <span class="type">void</span> * <span class="type">const</span> *obj_table,</span></span><br><span class="line"><span class="params">		     <span class="type">unsigned</span> <span class="type">int</span> n)</span></span><br></pre></td></tr></table></figure>



<h1 id="Mbuf"><a href="#Mbuf" class="headerlink" title="Mbuf"></a>Mbuf</h1><p>dpdkç”¨äºæ¶ˆæ¯å­˜å‚¨(message buffers)çš„æ•°æ®ç»“æ„ï¼Œä½¿ç”¨mempoolç®¡ç†ã€‚å¸¸ç”¨äºæºå¸¦ç½‘ç»œæŠ¥æ–‡ã€‚</p>
<p><a href="/images/mbuf1.svg" title="mbuf1" class="gallery-item" style="box-shadow: none;"> <img src="/images/mbuf1.svg" alt="mbuf1"></a></p>
<p><a href="/images/mbuf2.svg" title="mbuf2" class="gallery-item" style="box-shadow: none;"> <img src="/images/mbuf2.svg" alt="mbuf2"></a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_mbuf</span> {</span></span><br><span class="line">	RTE_MARKER cacheline0;</span><br><span class="line"></span><br><span class="line">	<span class="type">void</span> *buf_addr;           <span class="comment">/**&lt; Virtual address of segment buffer. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> RTE_IOVA_IN_MBUF</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Physical address of segment buffer.</span></span><br><span class="line"><span class="comment">	 * This field is undefined if the build is configured to use only</span></span><br><span class="line"><span class="comment">	 * virtual address as IOVA (i.e. RTE_IOVA_IN_MBUF is 0).</span></span><br><span class="line"><span class="comment">	 * Force alignment to 8-bytes, so as to ensure we have the exact</span></span><br><span class="line"><span class="comment">	 * same mbuf cacheline0 layout for 32-bit and 64-bit. This makes</span></span><br><span class="line"><span class="comment">	 * working on vector drivers easier.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">rte_iova_t</span> buf_iova __rte_aligned(<span class="keyword">sizeof</span>(<span class="type">rte_iova_t</span>));</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Next segment of scattered packet.</span></span><br><span class="line"><span class="comment">	 * This field is valid when physical address field is undefined.</span></span><br><span class="line"><span class="comment">	 * Otherwise next pointer in the second cache line will be used.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_mbuf</span> *<span class="title">next</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* next 8 bytes are initialised on RX descriptor rearm */</span></span><br><span class="line">	RTE_MARKER64 rearm_data;</span><br><span class="line">	<span class="type">uint16_t</span> data_off;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Reference counter. Its size should at least equal to the size</span></span><br><span class="line"><span class="comment">	 * of port field (16 bits), to support zero-copy broadcast.</span></span><br><span class="line"><span class="comment">	 * It should only be accessed using the following functions:</span></span><br><span class="line"><span class="comment">	 * rte_mbuf_refcnt_update(), rte_mbuf_refcnt_read(), and</span></span><br><span class="line"><span class="comment">	 * rte_mbuf_refcnt_set(). The functionality of these functions (atomic,</span></span><br><span class="line"><span class="comment">	 * or non-atomic) is controlled by the RTE_MBUF_REFCNT_ATOMIC flag.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	RTE_ATOMIC(<span class="type">uint16_t</span>) refcnt;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Number of segments. Only valid for the first segment of an mbuf</span></span><br><span class="line"><span class="comment">	 * chain.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint16_t</span> nb_segs;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Input port (16 bits to support more than 256 virtual ports).</span></span><br><span class="line"><span class="comment">	 * The event eth Tx adapter uses this field to specify the output port.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint16_t</span> port;</span><br><span class="line"></span><br><span class="line">	<span class="type">uint64_t</span> ol_flags;        <span class="comment">/**&lt; Offload features. */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* remaining bytes are set on RX when pulling packet from descriptor */</span></span><br><span class="line">	RTE_MARKER rx_descriptor_fields1;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * The packet type, which is the combination of outer/inner L2, L3, L4</span></span><br><span class="line"><span class="comment">	 * and tunnel types. The packet_type is about data really present in the</span></span><br><span class="line"><span class="comment">	 * mbuf. Example: if vlan stripping is enabled, a received vlan packet</span></span><br><span class="line"><span class="comment">	 * would have RTE_PTYPE_L2_ETHER and not RTE_PTYPE_L2_VLAN because the</span></span><br><span class="line"><span class="comment">	 * vlan is stripped from the data.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">		<span class="type">uint32_t</span> packet_type; <span class="comment">/**&lt; L2/L3/L4 and tunnel information. */</span></span><br><span class="line">		__extension__</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">			<span class="type">uint8_t</span> l2_type:<span class="number">4</span>;   <span class="comment">/**&lt; (Outer) L2 type. */</span></span><br><span class="line">			<span class="type">uint8_t</span> l3_type:<span class="number">4</span>;   <span class="comment">/**&lt; (Outer) L3 type. */</span></span><br><span class="line">			<span class="type">uint8_t</span> l4_type:<span class="number">4</span>;   <span class="comment">/**&lt; (Outer) L4 type. */</span></span><br><span class="line">			<span class="type">uint8_t</span> tun_type:<span class="number">4</span>;  <span class="comment">/**&lt; Tunnel type. */</span></span><br><span class="line">			<span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">				<span class="type">uint8_t</span> inner_esp_next_proto;</span><br><span class="line">				<span class="comment">/**&lt; ESP next protocol type, valid if</span></span><br><span class="line"><span class="comment">				 * RTE_PTYPE_TUNNEL_ESP tunnel type is set</span></span><br><span class="line"><span class="comment">				 * on both Tx and Rx.</span></span><br><span class="line"><span class="comment">				 */</span></span><br><span class="line">				__extension__</span><br><span class="line">				<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">					<span class="type">uint8_t</span> inner_l2_type:<span class="number">4</span>;</span><br><span class="line">					<span class="comment">/**&lt; Inner L2 type. */</span></span><br><span class="line">					<span class="type">uint8_t</span> inner_l3_type:<span class="number">4</span>;</span><br><span class="line">					<span class="comment">/**&lt; Inner L3 type. */</span></span><br><span class="line">				};</span><br><span class="line">			};</span><br><span class="line">			<span class="type">uint8_t</span> inner_l4_type:<span class="number">4</span>; <span class="comment">/**&lt; Inner L4 type. */</span></span><br><span class="line">		};</span><br><span class="line">	};</span><br><span class="line"></span><br><span class="line">	<span class="type">uint32_t</span> pkt_len;         <span class="comment">/**&lt; Total pkt len: sum of all segments. */</span></span><br><span class="line">	<span class="type">uint16_t</span> data_len;        <span class="comment">/**&lt; Amount of data in segment buffer. */</span></span><br><span class="line">	<span class="comment">/** VLAN TCI (CPU order), valid if RTE_MBUF_F_RX_VLAN is set. */</span></span><br><span class="line">	<span class="type">uint16_t</span> vlan_tci;</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">		<span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">			<span class="type">uint32_t</span> rss;     <span class="comment">/**&lt; RSS hash result if RSS enabled */</span></span><br><span class="line">			<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">				<span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">					<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">						<span class="type">uint16_t</span> hash;</span><br><span class="line">						<span class="type">uint16_t</span> id;</span><br><span class="line">					};</span><br><span class="line">					<span class="type">uint32_t</span> lo;</span><br><span class="line">					<span class="comment">/**&lt; Second 4 flexible bytes */</span></span><br><span class="line">				};</span><br><span class="line">				<span class="type">uint32_t</span> hi;</span><br><span class="line">				<span class="comment">/**&lt; First 4 flexible bytes or FD ID, dependent</span></span><br><span class="line"><span class="comment">				 * on RTE_MBUF_F_RX_FDIR_* flag in ol_flags.</span></span><br><span class="line"><span class="comment">				 */</span></span><br><span class="line">			} fdir;	<span class="comment">/**&lt; Filter identifier if FDIR enabled */</span></span><br><span class="line">			<span class="class"><span class="keyword">struct</span> <span class="title">rte_mbuf_sched</span> <span class="title">sched</span>;</span></span><br><span class="line">			<span class="comment">/**&lt; Hierarchical scheduler : 8 bytes */</span></span><br><span class="line">			<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">				<span class="type">uint32_t</span> reserved1;</span><br><span class="line">				<span class="type">uint16_t</span> reserved2;</span><br><span class="line">				<span class="type">uint16_t</span> txq;</span><br><span class="line">				<span class="comment">/**&lt; The event eth Tx adapter uses this field</span></span><br><span class="line"><span class="comment">				 * to store Tx queue id.</span></span><br><span class="line"><span class="comment">				 * @see rte_event_eth_tx_adapter_txq_set()</span></span><br><span class="line"><span class="comment">				 */</span></span><br><span class="line">			} txadapter; <span class="comment">/**&lt; Eventdev ethdev Tx adapter */</span></span><br><span class="line">			<span class="type">uint32_t</span> usr;</span><br><span class="line">			<span class="comment">/**&lt; User defined tags. See rte_distributor_process() */</span></span><br><span class="line">		} hash;                   <span class="comment">/**&lt; hash information */</span></span><br><span class="line">	};</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Outer VLAN TCI (CPU order), valid if RTE_MBUF_F_RX_QINQ is set. */</span></span><br><span class="line">	<span class="type">uint16_t</span> vlan_tci_outer;</span><br><span class="line"></span><br><span class="line">	<span class="type">uint16_t</span> buf_len;         <span class="comment">/**&lt; Length of segment buffer. */</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_mempool</span> *<span class="title">pool</span>;</span> <span class="comment">/**&lt; Pool from which mbuf was allocated. */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* second cache line - fields only used in slow path or on TX */</span></span><br><span class="line">	RTE_MARKER cacheline1 __rte_cache_min_aligned;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> RTE_IOVA_IN_MBUF</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Next segment of scattered packet. Must be NULL in the last</span></span><br><span class="line"><span class="comment">	 * segment or in case of non-segmented packet.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_mbuf</span> *<span class="title">next</span>;</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Reserved for dynamic fields</span></span><br><span class="line"><span class="comment">	 * when the next pointer is in first cache line (i.e. RTE_IOVA_IN_MBUF is 0).</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint64_t</span> dynfield2;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* fields to support TX offloads */</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">		<span class="type">uint64_t</span> tx_offload;       <span class="comment">/**&lt; combined for easy fetch */</span></span><br><span class="line">		__extension__</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">			<span class="type">uint64_t</span> l2_len:RTE_MBUF_L2_LEN_BITS;</span><br><span class="line">			<span class="comment">/**&lt; L2 (MAC) Header Length for non-tunneling pkt.</span></span><br><span class="line"><span class="comment">			 * Outer_L4_len + ... + Inner_L2_len for tunneling pkt.</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			<span class="type">uint64_t</span> l3_len:RTE_MBUF_L3_LEN_BITS;</span><br><span class="line">			<span class="comment">/**&lt; L3 (IP) Header Length. */</span></span><br><span class="line">			<span class="type">uint64_t</span> l4_len:RTE_MBUF_L4_LEN_BITS;</span><br><span class="line">			<span class="comment">/**&lt; L4 (TCP/UDP) Header Length. */</span></span><br><span class="line">			<span class="type">uint64_t</span> tso_segsz:RTE_MBUF_TSO_SEGSZ_BITS;</span><br><span class="line">			<span class="comment">/**&lt; TCP TSO segment size */</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">/*</span></span><br><span class="line"><span class="comment">			 * Fields for Tx offloading of tunnels.</span></span><br><span class="line"><span class="comment">			 * These are undefined for packets which don't request</span></span><br><span class="line"><span class="comment">			 * any tunnel offloads (outer IP or UDP checksum,</span></span><br><span class="line"><span class="comment">			 * tunnel TSO).</span></span><br><span class="line"><span class="comment">			 *</span></span><br><span class="line"><span class="comment">			 * PMDs should not use these fields unconditionally</span></span><br><span class="line"><span class="comment">			 * when calculating offsets.</span></span><br><span class="line"><span class="comment">			 *</span></span><br><span class="line"><span class="comment">			 * Applications are expected to set appropriate tunnel</span></span><br><span class="line"><span class="comment">			 * offload flags when they fill in these fields.</span></span><br><span class="line"><span class="comment">			 */</span></span><br><span class="line">			<span class="type">uint64_t</span> outer_l3_len:RTE_MBUF_OUTL3_LEN_BITS;</span><br><span class="line">			<span class="comment">/**&lt; Outer L3 (IP) Hdr Length. */</span></span><br><span class="line">			<span class="type">uint64_t</span> outer_l2_len:RTE_MBUF_OUTL2_LEN_BITS;</span><br><span class="line">			<span class="comment">/**&lt; Outer L2 (MAC) Hdr Length. */</span></span><br><span class="line"></span><br><span class="line">			<span class="comment">/* uint64_t unused:RTE_MBUF_TXOFLD_UNUSED_BITS; */</span></span><br><span class="line">		};</span><br><span class="line">	};</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Shared data for external buffer attached to mbuf. See</span></span><br><span class="line"><span class="comment">	 * rte_pktmbuf_attach_extbuf().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_mbuf_ext_shared_info</span> *<span class="title">shinfo</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Size of the application private data. In case of an indirect</span></span><br><span class="line"><span class="comment">	 * mbuf, it stores the direct mbuf private data size.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint16_t</span> priv_size;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/** Timesync flags for use with IEEE1588. */</span></span><br><span class="line">	<span class="type">uint16_t</span> timesync;</span><br><span class="line"></span><br><span class="line">	<span class="type">uint32_t</span> dynfield1[<span class="number">9</span>]; <span class="comment">/**&lt; Reserved for dynamic fields. */</span></span><br><span class="line">} __rte_cache_aligned;</span><br></pre></td></tr></table></figure>



<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> rte_mempool *</span><br><span class="line"><span class="title function_">rte_pktmbuf_pool_create</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">unsigned</span> n,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> cache_size, <span class="type">uint16_t</span> priv_size, <span class="type">uint16_t</span> data_room_size,</span></span><br><span class="line"><span class="params">	<span class="type">int</span> socket_id)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">int</span> <span class="title function_">rte_pktmbuf_alloc_bulk</span><span class="params">(<span class="keyword">struct</span> rte_mempool *pool,</span></span><br><span class="line"><span class="params">	 <span class="keyword">struct</span> rte_mbuf **mbufs, <span class="type">unsigned</span> count)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> rte_mbuf *</span><br><span class="line"><span class="title function_">rte_pktmbuf_clone</span><span class="params">(<span class="keyword">struct</span> rte_mbuf *md, <span class="keyword">struct</span> rte_mempool *mp)</span>;</span><br></pre></td></tr></table></figure>



<h2 id="Dynamic-field"><a href="#Dynamic-field" class="headerlink" title="Dynamic field"></a>Dynamic field</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_mbuf_dynfield</span> {</span></span><br><span class="line">	<span class="type">char</span> name[RTE_MBUF_DYN_NAMESIZE]; <span class="comment">/**&lt; Name of the field. */</span></span><br><span class="line">	<span class="type">size_t</span> size;        <span class="comment">/**&lt; The number of bytes to reserve. */</span></span><br><span class="line">	<span class="type">size_t</span> align;       <span class="comment">/**&lt; The alignment constraint (power of 2). */</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> flags; <span class="comment">/**&lt; Reserved for future use, must be 0. */</span></span><br><span class="line">};</span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_mbuf_dynfield_register</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_mbuf_dynfield *params)</span>;</span><br></pre></td></tr></table></figure>



<h2 id="Dynamic-flag"><a href="#Dynamic-flag" class="headerlink" title="Dynamic flag"></a>Dynamic flag</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_mbuf_dynflag</span> {</span></span><br><span class="line">	<span class="type">char</span> name[RTE_MBUF_DYN_NAMESIZE]; <span class="comment">/**&lt; Name of the dynamic flag. */</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> flags; <span class="comment">/**&lt; Reserved for future use, must be 0. */</span></span><br><span class="line">};</span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_mbuf_dynflag_register</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_mbuf_dynflag *params)</span>;</span><br></pre></td></tr></table></figure>



<h1 id="Timer"><a href="#Timer" class="headerlink" title="Timer"></a>Timer</h1><ul>
<li><p>åŸºäºskiplistå®ç°ï¼Œskiplistæ˜¯ä¸€ä¸ªå…·æœ‰å¤šå±‚ç´¢å¼•çš„æœ‰åºé“¾è¡¨ï¼Œå…¶æœç´¢/æ’å…¥/åˆ é™¤çš„æ—¶é—´å¤æ‚åº¦å‡ä¸ºO(logn)</p>
</li>
<li><p>ä½¿ç”¨HPET(High Precision Event Timer)æˆ–è€…TSC(Time Stamp Counter)ä½œä¸ºä½å¼€é”€çš„æ—¶é—´åŸºå‡†</p>
</li>
</ul>
<h2 id="SkipliståŸç†"><a href="#SkipliståŸç†" class="headerlink" title="SkipliståŸç†"></a>SkipliståŸç†</h2><p>è·³è·ƒè¡¨æ˜¯æŒ‰å±‚å»ºé€ çš„ã€‚åº•å±‚æ˜¯ä¸€ä¸ªæ™®é€šçš„æœ‰åºé“¾è¡¨ã€‚æ¯ä¸ªæ›´é«˜å±‚éƒ½å……å½“ä¸‹é¢åˆ—è¡¨çš„â€œå¿«é€Ÿé€šé“â€ï¼Œåœ¨ç¬¬ i å±‚ä¸­çš„å…ƒç´ æŒ‰æŸä¸ªå›ºå®šçš„æ¦‚ç‡p(é€šå¸¸ä¸º 1/2 æˆ– 1/4 )å‡ºç°åœ¨ç¬¬ i + 1 å±‚ä¸­ã€‚</p>
<p><a href="/images/Skip_list.svg" title="skiplist" class="gallery-item" style="box-shadow: none;"> <img src="/images/Skip_list.svg" alt="skiplist"></a></p>
<p>è·³è·ƒè¡¨çš„æ’å…¥(ä»¥p=1/2ä¸ºä¾‹):</p>
<p><a href="/images/Skip_list_add_element-en.gif" title="skiplist_add" class="gallery-item" style="box-shadow: none;"> <img src="/images/Skip_list_add_element-en.gif" alt="skiplist_add"></a></p>
<p>dpdké‡‡ç”¨10å±‚(0~9)çš„è·³è·ƒè¡¨ï¼Œä¸”æ’å…¥åˆ° 0 å±‚çš„å…ƒç´ ä»¥ 1/4 çš„æ¦‚ç‡å‡ºç°åœ¨ 1 å±‚ä¸­ï¼Œå³æ’å…¥çš„å…ƒç´ æœ‰ (1/4)^i çš„æ¦‚ç‡å‡ºç°åœ¨ i å±‚ã€‚dpdkå¯¹äºæ’å…¥å±‚æ•°çš„ç¡®å®šæ²¡æœ‰æŒ‰ç…§ä¸€èˆ¬è·³è·ƒè¡¨å¯¹äºçš„æ’å…¥å®ç°ï¼Œå³å¯¹æ’å…¥çš„å±‚æ•°æŒ‰æ¦‚ç‡ä¸€å±‚ä¸€å±‚çš„ç´¯åŠ ï¼Œè€Œæ˜¯ç›´æ¥ç¡®å®šæ’å…¥å…ƒç´ çš„æœ€é«˜å±‚æ•° ã€‚å¯¹äºå¦‚ä½•ä¸€æ¬¡å°±èƒ½ç¡®å®šæ’å…¥å…ƒç´ çš„æœ€é«˜å±‚æ•°ï¼Œdpdkçš„å®ç°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* probability value is 1/4, i.e. all at level 0, 1 in 4 is at level 1,</span></span><br><span class="line"><span class="comment"> * 1 in 16 at level 2, 1 in 64 at level 3, etc. Calculated using lowest</span></span><br><span class="line"><span class="comment"> * bit position of a (pseudo)random number.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//å–éšæœºæ•°çš„1~31ä½ï¼Œè¿™äº›ä½æ¯ä½å‡ºç°0/1çš„æ¦‚ç‡éƒ½æ˜¯1/2</span></span><br><span class="line"><span class="type">uint32_t</span> rand = rte_rand() &amp; (UINT32_MAX - <span class="number">1</span>);</span><br><span class="line"><span class="comment">/* ç”±äºrte_bsf32()å‡½æ•°å…¥å‚ä¸èƒ½ä¸º0ï¼Œå½“randä¸º0æ—¶ï¼Œéšæœºå˜é‡levelè®¾ä¸ºæœ€é«˜å±‚</span></span><br><span class="line"><span class="comment"> * X = rte_bsf32(rand) Xè¡¨ç¤ºå€¼ä¸º1çš„æœ€ä½äºŒè¿›åˆ¶ä½æ•°ï¼Œä¹Ÿæ„å‘³ç€ä»æœ€ä½ä½å¼€å§‹è¿ç»­0çš„ä¸ªæ•°(Xâˆˆ[1,31])</span></span><br><span class="line"><span class="comment"> * è¿™é‡Œå¯å°†Xè§†ä¸ºæœä»å‚æ•°ä¸º1/2çš„å‡ ä½•åˆ†å¸ƒï¼Œå³X~Geo(1/2)ï¼ŒX=1,2,3,...</span></span><br><span class="line"><span class="comment"> * ä»¤éšæœºå˜é‡level = âŒŠ(X-1)/2âŒ‹ï¼Œè¯¥éšæœºå˜é‡å°±æ˜¯æ’å…¥å…ƒç´ æ—¶æ‰€ç¡®å®šçš„æœ€é«˜å±‚æ•°ï¼Œè¯¥æœ€é«˜å±‚æ•°æ»¡è¶³</span></span><br><span class="line"><span class="comment"> * P{level &gt; r} = P{X &gt; 2r+2} = (1/2)^(2r+2) = (1/4)^(r+1)ï¼Œå³æ’å…¥çš„å…ƒç´ å‡ºç°åœ¨(r+1)å±‚çš„æ¦‚ç‡ä¸º(1/4)^(r+1)</span></span><br><span class="line"><span class="comment"> * åŒç†ï¼Œè‹¥è®¾ç½®æ¦‚ç‡ä¸º1/8ï¼Œä»¤level = âŒŠ(X-1)/4âŒ‹ å³å¯</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">uint32_t</span> level = rand == <span class="number">0</span> ? MAX_SKIPLIST_DEPTH : (rte_bsf32(rand)<span class="number">-1</span>) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* limit the levels used to one above our current level, so we don't,</span></span><br><span class="line"><span class="comment"> * for instance, have a level 0 and a level 7 without anything between</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">if</span> (level &gt; curr_depth)</span><br><span class="line">	level = curr_depth;</span><br><span class="line"><span class="keyword">if</span> (level &gt;= MAX_SKIPLIST_DEPTH)</span><br><span class="line">	level = MAX_SKIPLIST_DEPTH<span class="number">-1</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ä¸Šé¢ä»£ç çš„æ³¨é‡Šè¿˜æ˜¯æœ‰äº›é—®é¢˜ï¼Œä»¥åå†ç ”ç©¶</p>
</blockquote>
<p>åœ¨ç»“æ„è¡¨ç¤ºä¸Šï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„æœ‰åºé“¾è¡¨ï¼Œè·³è·ƒè¡¨çš„nextæˆå‘˜ä¸å†æ˜¯æŒ‡é’ˆï¼Œè€Œæ˜¯æŒ‡é’ˆæ•°ç»„ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_timer</span></span></span><br><span class="line"><span class="class">{</span></span><br><span class="line">	<span class="type">uint64_t</span> expire;       <span class="comment">/**&lt; Time when timer expire. */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_timer</span> *<span class="title">sl_next</span>[<span class="title">MAX_SKIPLIST_DEPTH</span>];</span>	<span class="comment">//è·³è·ƒè¡¨çš„nextæ•°ç»„</span></span><br><span class="line">	<span class="keyword">volatile</span> <span class="class"><span class="keyword">union</span> <span class="title">rte_timer_status</span> <span class="title">status</span>;</span> <span class="comment">/**&lt; Status of timer. */</span></span><br><span class="line">	<span class="type">uint64_t</span> period;       <span class="comment">/**&lt; Period of timer (0 if not periodic). */</span></span><br><span class="line">	<span class="type">rte_timer_cb_t</span> f;      <span class="comment">/**&lt; Callback function. */</span></span><br><span class="line">	<span class="type">void</span> *arg;             <span class="comment">/**&lt; Argument to callback function. */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>



<h2 id="Timerçš„ä½¿ç”¨"><a href="#Timerçš„ä½¿ç”¨" class="headerlink" title="Timerçš„ä½¿ç”¨"></a>Timerçš„ä½¿ç”¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å®šæ—¶å™¨æ¨¡å—åˆå§‹åŒ–</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_timer_subsystem_init</span><span class="params">(<span class="type">void</span>)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//åˆå§‹åŒ–ä¸€ä¸ªå®šæ—¶å™¨</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rte_timer_init</span><span class="params">(<span class="keyword">struct</span> rte_timer *tim)</span>;</span><br><span class="line"><span class="comment">//é…ç½®ä¸€ä¸ªå®šæ—¶å™¨å¹¶å¼€å¯</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_timer_reset</span><span class="params">(<span class="keyword">struct</span> rte_timer *tim, <span class="type">uint64_t</span> ticks,</span></span><br><span class="line"><span class="params">		    <span class="keyword">enum</span> rte_timer_type type, <span class="type">unsigned</span> tim_lcore,</span></span><br><span class="line"><span class="params">		    <span class="type">rte_timer_cb_t</span> fct, <span class="type">void</span> *arg)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å®šæ—¶å™¨å¤„ç†ï¼Œæ‰€æœ‰åˆ°æ—¶çš„å®šæ—¶å™¨ä¼šåœ¨è¯¥å‡½æ•°ä¸­å¤„ç†ï¼Œéœ€è¦ç”¨æˆ·å¾ªç¯è°ƒç”¨ï¼Œè°ƒç”¨çš„æ—¶é—´é—´éš”ä¼šå½±å“å®šæ—¶å™¨çš„ç²¾åº¦ã€‚</span></span><br><span class="line"><span class="comment">//éœ€è¦æ³¨æ„çš„æ˜¯è¯¥å‡½æ•°åªä¼šå¤„ç†æŒ‚è½½åœ¨è¯¥lcoreä¸Šçš„å®šæ—¶å™¨ã€‚</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_timer_manage</span><span class="params">(<span class="type">void</span>)</span>;</span><br></pre></td></tr></table></figure>



<h1 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h1><p>åŸºäºCuckooç®—æ³•å®ç°ï¼Œåœ¨è¾ƒé«˜çš„ç©ºé—´åˆ©ç”¨ç‡çš„æƒ…å†µä¸‹ï¼Œèƒ½æœ‰ä¸é”™çš„æŸ¥è¯¢æ€§èƒ½ã€‚dpdkçš„hashè¡¨è¢«åˆ†ä¸ºä¸¤ä¸ªè¡¨ï¼š</p>
<ol>
<li>ç´¢å¼•æŸ¥è¯¢è¡¨ï¼ˆhash bucketï¼‰ï¼šé‡Œé¢å­˜å‚¨ç€keyçš„ç­¾åï¼ˆç”¨äºhashæŸ¥æ‰¾æ—¶çš„å¿«é€Ÿæ¯”è¾ƒå’Œå¦ä¸€ä¸ªhash bucketçš„ç¡®å®šï¼‰å’Œkey-valueè¡¨çš„ç´¢å¼•</li>
<li>key-valueè¡¨ï¼šå­˜æ”¾ç€keyå’Œvalueï¼ˆvalueçš„å¤§å°æœ€å¤§ä¸ºä¸€ä¸ªæŒ‡é’ˆçš„é•¿åº¦ï¼‰</li>
</ol>
<h2 id="Cuckooç®—æ³•"><a href="#Cuckooç®—æ³•" class="headerlink" title="Cuckooç®—æ³•"></a>Cuckooç®—æ³•</h2><p>åˆ©ç”¨ä¸¤ä¸ªhashå‡½æ•°æ¥è§£å†³hashå†²çªï¼Œå¯¹äºä»»æ„çš„keyï¼Œå¯æ±‚å‡º2ä¸ªhashå€¼ï¼Œå°†è¿™ä¸¤ä¸ªhashå€¼æ˜ å°„åˆ°ç´¢å¼•æŸ¥è¯¢è¡¨çš„ä¸¤ä¸ªä¸åŒçš„ä½ç½®ä¸Šã€‚æ¢å¥è¯è¯´ï¼ŒCuckooç®—æ³•ä¸­æ¯ä¸ªkeyéƒ½ä¼šå¯¹åº”ä¸¤ä¸ªhash bucketï¼Œåˆ†åˆ«ä¸ºprimary bucketå’Œsecondary bucketã€‚</p>
<ul>
<li><p>æŸ¥æ‰¾key_aï¼šæ ¹æ®ç»™å®šçš„key_aï¼Œæ±‚å‡ºä¸¤ä¸ªhash bucketçš„ä½ç½®ï¼Œè¿›è¡ŒåŒ¹é…ï¼ˆå…·ä½“å®ç°æ—¶åˆ†ä¸ºä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥åŒ¹é…ç´¢å¼•æŸ¥è¯¢è¡¨ä¸­çš„keyçš„ç­¾åï¼Œç¬¬äºŒæ­¥åŒ¹é…key-valueè¡¨ä¸­çš„keyï¼‰ï¼Œè‹¥åŒ¹é…å¤±è´¥ï¼Œåˆ™æŸ¥æ‰¾å¤±è´¥</p>
</li>
<li><p>æ’å…¥key_aï¼š</p>
<ol>
<li>å…ˆè¿›è¡ŒæŸ¥æ‰¾ï¼Œè‹¥å·²å­˜åœ¨å¯¹åº”key_aï¼Œåˆ™æ›´æ–°valueå¹¶è¿”å›æˆåŠŸ</li>
<li>æŸ¥çœ‹primary bucketæ˜¯å¦è¢«å ç”¨ï¼Œè‹¥æ²¡å ç”¨ï¼Œåˆ™ç›´æ¥æ’å…¥å¹¶è¿”å›æˆåŠŸ</li>
<li>å°†å½“å‰primary bucketæ‰€å­˜å‚¨çš„key_bè¸¢å‡ºï¼Œå¹¶æ’å…¥key_a</li>
<li>è¢«è¸¢å‡ºçš„key_bå­˜æ”¾åˆ°è¯¥keyæ‰€å¯¹åº”çš„å¦ä¸€ä¸ªhashæ¡¶ä¸Šï¼Œè‹¥å¦ä¸€ä¸ªhashæ¡¶è¢«å ç”¨ï¼Œåˆ™å°†è¯¥hashæ¡¶ä¸Šçš„key_cè¸¢å‡ºï¼Œå¹¶æ’å…¥key_b</li>
<li>é‡å¤æ“ä½œ4ï¼Œç›´åˆ°æ²¡æœ‰æ–°çš„keyè¢«è¸¢å‡ºæ—¶è¿”å›æˆåŠŸï¼Œæˆ–è€…è¶…å‡ºæœ€å¤§å¾ªç¯é™åˆ¶</li>
<li>æ‰§è¡Œæ“ä½œ2-5ï¼Œåªä¸è¿‡è¿™æ¬¡æ˜¯å¯¹secondary bucketè¿›è¡Œæ“ä½œï¼Œè‹¥è¶…å‡ºæœ€å¤§å¾ªç¯é™åˆ¶ï¼Œåˆ™è¿”å›å¤±è´¥</li>
</ol>
<blockquote>
<p>ä¸€è¿ä¸²è¢«è¸¢å‡ºçš„keyæ‰€å½¢æˆçš„è·¯å¾„ç§°ä½œCuckoo Kickè·¯å¾„</p>
</blockquote>
</li>
</ul>
<p>ä¸ºäº†æé«˜hashçš„æ’å…¥æ€§èƒ½ï¼Œdpdkåšäº†ä¸‹é¢å‡ å¤„ä¼˜åŒ–ï¼š</p>
<ol>
<li>ä½¿ç”¨8è·¯ç»„ç›¸è”ï¼Œè¿™æ„å‘³ç€æ¯ä¸ªhash bucketä¸å†åªå­˜å‚¨ä¸€ä¸ªkeyï¼Œè€Œæ˜¯å¯ä»¥å­˜å‚¨æœ€å¤š8ä¸ªkeyï¼Œå¤§å¤§å‡å°äº†æ’å…¥æ—¶æ—§keyè¢«è¸¢å‡ºçš„æ¦‚ç‡ã€‚é€‰ç”¨8è·¯ç»„ç›¸è”ä¸»è¦æ˜¯å› ä¸ºè¿™å¯ä»¥ä½¿å¾—hash bucketçš„å¤§å°æ­£å¥½ä¸ºä¸€ä¸ªcache lineï¼Œå‡å°‘ç»„ç›¸è”å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ã€‚</li>
<li>æ’å…¥æ—¶å¦‚æœéœ€è¦è¸¢å‡ºæ—§keyï¼Œåˆ™å…ˆé‡‡ç”¨BFSæ¥å¯»æ‰¾æœ€çŸ­Cuckoo Kickè·¯å¾„ï¼ˆå¼•å…¥ç»„ç›¸è”åCuckoo Kickè·¯å¾„ä¸å†æ˜¯ä¸€æ¡ï¼Œè€Œæ˜¯å¤šæ¡ï¼‰ï¼Œæ‰¾åˆ°åå†ä»å°¾åˆ°å¤´ç§»åŠ¨keyï¼Œæœ€åæ’å…¥å¾…æ’å…¥çš„keyåˆ°primary/secondary bucketä¸­ã€‚</li>
</ol>
<h2 id="Hashè¡¨çš„åˆå§‹åŒ–"><a href="#Hashè¡¨çš„åˆå§‹åŒ–" class="headerlink" title="Hashè¡¨çš„åˆå§‹åŒ–"></a>Hashè¡¨çš„åˆå§‹åŒ–</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Enable Hardware transactional memory support. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_HASH_EXTRA_FLAGS_TRANS_MEM_SUPPORT	0x01</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Default behavior of insertion, single writer/multi writer */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_HASH_EXTRA_FLAGS_MULTI_WRITER_ADD 0x02</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Flag to support reader writer concurrency */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_HASH_EXTRA_FLAGS_RW_CONCURRENCY 0x04</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Flag to indicate the extendable bucket table feature should be used */</span></span><br><span class="line"><span class="comment">//ä¸ºåº”å¯¹æå°æ¦‚ç‡ä¸‹æ‰€é‡åˆ°çš„å› Cuckoo Kickè·¯å¾„è¿‡é•¿æ‰€å¯¼è‡´çš„æ’å…¥å¤±è´¥é—®é¢˜ã€‚å¯æ‰©å±•çš„ä»…ä¸ºç´¢å¼•æŸ¥è¯¢è¡¨ï¼Œè€Œékey-valueè¡¨ã€‚</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_HASH_EXTRA_FLAGS_EXT_TABLE 0x08</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Flag to disable freeing of key index on hash delete.</span></span><br><span class="line"><span class="comment"> * Refer to rte_hash_del_xxx APIs for more details.</span></span><br><span class="line"><span class="comment"> * This is enabled by default when RTE_HASH_EXTRA_FLAGS_RW_CONCURRENCY_LF</span></span><br><span class="line"><span class="comment"> * is enabled. However, if internal RCU is enabled, freeing of internal</span></span><br><span class="line"><span class="comment"> * memory/index is done on delete</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_HASH_EXTRA_FLAGS_NO_FREE_ON_DEL 0x10</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** Flag to support lock free reader writer concurrency. Both single writer</span></span><br><span class="line"><span class="comment"> * and multi writer use cases are supported.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_HASH_EXTRA_FLAGS_RW_CONCURRENCY_LF 0x20</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_hash_parameters</span> {</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *name;		<span class="comment">/**&lt; Name of the hash. */</span></span><br><span class="line">	<span class="type">uint32_t</span> entries;		<span class="comment">/**&lt; Total hash table entries. */</span></span><br><span class="line">	<span class="type">uint32_t</span> reserved;		<span class="comment">/**&lt; Unused field. Should be set to 0 */</span></span><br><span class="line">	<span class="type">uint32_t</span> key_len;		<span class="comment">/**&lt; Length of hash key. */</span></span><br><span class="line">	rte_hash_function hash_func;	<span class="comment">/**&lt; Primary Hash function used to calculate hash. */</span></span><br><span class="line">	<span class="type">uint32_t</span> hash_func_init_val;	<span class="comment">/**&lt; Init value used by hash_func. */</span></span><br><span class="line">	<span class="type">int</span> socket_id;			<span class="comment">/**&lt; NUMA Socket ID for memory. */</span></span><br><span class="line">	<span class="type">uint8_t</span> extra_flag;		<span class="comment">/**&lt; Indicate if additional parameters are present. */</span></span><br><span class="line">};</span><br><span class="line"><span class="comment">//hashè¡¨çš„åˆ›å»º</span></span><br><span class="line"><span class="keyword">struct</span> rte_hash *</span><br><span class="line"><span class="title function_">rte_hash_create</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_hash_parameters *params)</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_hash_rcu_config</span> {</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_rcu_qsbr</span> *<span class="title">v</span>;</span>		<span class="comment">/**&lt; RCU QSBR variable. */</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">rte_hash_qsbr_mode</span> <span class="title">mode</span>;</span></span><br><span class="line">	<span class="comment">/**&lt; Mode of RCU QSBR. RTE_HASH_QSBR_MODE_xxx</span></span><br><span class="line"><span class="comment">	 * '0' for default: create defer queue for reclaim.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> dq_size;</span><br><span class="line">	<span class="comment">/**&lt; RCU defer queue size.</span></span><br><span class="line"><span class="comment">	 * default: total hash table entries.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> trigger_reclaim_limit;	<span class="comment">/**&lt; Threshold to trigger auto reclaim. */</span></span><br><span class="line">	<span class="type">uint32_t</span> max_reclaim_size;</span><br><span class="line">	<span class="comment">/**&lt; Max entries to reclaim in one go.</span></span><br><span class="line"><span class="comment">	 * default: RTE_HASH_RCU_DQ_RECLAIM_MAX.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">void</span> *key_data_ptr;</span><br><span class="line">	<span class="comment">/**&lt; Pointer passed to the free function. Typically, this is the</span></span><br><span class="line"><span class="comment">	 * pointer to the data structure to which the resource to free</span></span><br><span class="line"><span class="comment">	 * (key-data) belongs. This can be NULL.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	rte_hash_free_key_data free_key_data_func;</span><br><span class="line">	<span class="comment">/**&lt; Function to call to free the resource (key-data). */</span></span><br><span class="line">};</span><br><span class="line"><span class="comment">//è‹¥åœ¨åˆ›å»ºæ—¶é…ç½®äº†RTE_HASH_EXTRA_FLAGS_RW_CONCURRENCY_LFï¼Œåˆ™éœ€è¦é…ç½®rcu</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_hash_rcu_qsbr_add</span><span class="params">(<span class="keyword">struct</span> rte_hash *h, <span class="keyword">struct</span> rte_hash_rcu_config *cfg)</span>;</span><br></pre></td></tr></table></figure>



<h2 id="Hashè¡¨çš„ä½¿ç”¨"><a href="#Hashè¡¨çš„ä½¿ç”¨" class="headerlink" title="Hashè¡¨çš„ä½¿ç”¨"></a>Hashè¡¨çš„ä½¿ç”¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ’å…¥key-value</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_hash_add_key_data</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_hash *h, <span class="type">const</span> <span class="type">void</span> *key, <span class="type">void</span> *data)</span>;</span><br><span class="line"><span class="comment">//æŸ¥è¯¢keyæ‰€å¯¹åº”çš„value</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_hash_lookup_data</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_hash *h, <span class="type">const</span> <span class="type">void</span> *key, <span class="type">void</span> **data)</span>;</span><br><span class="line"><span class="comment">//åˆ é™¤key</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">rte_hash_del_key</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_hash *h, <span class="type">const</span> <span class="type">void</span> *key)</span>;</span><br></pre></td></tr></table></figure>



<h2 id="Toeplitz-Hash"><a href="#Toeplitz-Hash" class="headerlink" title="Toeplitz Hash"></a>Toeplitz Hash</h2><p>ç½‘å¡rssåŠŸèƒ½æ‰€ä½¿ç”¨çš„hashå‡½æ•°ï¼Œé»˜è®¤ä¸ºéå¯¹ç§°hashï¼Œè‹¥é…ç½®ç‰¹å®šçš„rss_keyï¼Œå¯å˜ä¸ºå¯¹ç§°hashã€‚</p>
<p>dpdkæä¾›äº†Toeplitz Hashçš„è½¯ä»¶å®ç°ï¼Œè¿™åœ¨æŸäº›åœºæ™¯å¾ˆæœ‰ç”¨ï¼Œå¦‚ï¼š</p>
<ul>
<li>æµAé€šè¿‡rssåˆ†é…åˆ°ç½‘å¡é˜Ÿåˆ—aä¸Šï¼Œè®¾å¤‡åœ¨å¯¹æµAåšå¤„ç†æ—¶æ”¹å˜äº†è¯¥æ¡æµçš„tupleï¼Œå¯¹è¯¥æ¡æµåšäº†SNATï¼Œæ­¤æ—¶éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæºç«¯å£ï¼Œä½¿è¯¥æ¡æµåœ¨ä¿®æ”¹tupleåä»ç„¶èƒ½å¤Ÿä½¿å¾—ç½‘å¡å¯¹å…¶åšrssåˆ†é…åˆ°ç½‘å¡é˜Ÿåˆ—aä¸Šã€‚ä¿è¯è¯¥æ¡æµå§‹ç»ˆåœ¨åŒä¸€ä¸ªçº¿ç¨‹å¤„ç†ã€‚</li>
</ul>
<h2 id="Toeplitz-Hashä½¿ç”¨"><a href="#Toeplitz-Hashä½¿ç”¨" class="headerlink" title="Toeplitz Hashä½¿ç”¨"></a>Toeplitz Hashä½¿ç”¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> rte_thash_ctx *</span><br><span class="line"><span class="title function_">rte_thash_init_ctx</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">uint32_t</span> key_len, <span class="type">uint32_t</span> reta_sz,</span></span><br><span class="line"><span class="params">	<span class="type">uint8_t</span> *key, <span class="type">uint32_t</span> flags)</span>;</span><br></pre></td></tr></table></figure>





<h1 id="LPM-Longest-Prefix-Match"><a href="#LPM-Longest-Prefix-Match" class="headerlink" title="LPM(Longest Prefix Match)"></a>LPM(Longest Prefix Match)</h1><p>ä½¿ç”¨DIR-24-8ç®—æ³•çš„å˜ä½“å®ç°ï¼Œä»¥ç©ºé—´æ¢æ—¶é—´ã€‚ä½¿å¾—lpmçš„æŸ¥æ‰¾æœ€å¤šèŠ±è´¹ä¸¤æ¬¡è®¿å­˜æ“ä½œ(å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä»…è®¿å­˜ä¸€æ¬¡)</p>
<h2 id="DIR-24-8ç®—æ³•åŸç†"><a href="#DIR-24-8ç®—æ³•åŸç†" class="headerlink" title="DIR-24-8ç®—æ³•åŸç†"></a>DIR-24-8ç®—æ³•åŸç†</h2><h3 id="æœ´ç´ ç®—æ³•"><a href="#æœ´ç´ ç®—æ³•" class="headerlink" title="æœ´ç´ ç®—æ³•"></a>æœ´ç´ ç®—æ³•</h3><p>å»ºç«‹ä¸€ä¸ªè§„åˆ™è¡¨å’Œä¸€ä¸ªå·¨å¤§çš„lpmè¡¨ã€‚å…¶ä¸­lpmè¡¨ä¸­çš„æ¯ä¸ªè¡¨é¡¹çš„ç´¢å¼•ä¸ºipåœ°å€(32ä½æ— ç¬¦å·æ•´æ•°)ï¼Œè¡¨é¡¹å†…å®¹ä¸ºï¼š</p>
<ul>
<li>validï¼šæœ‰æ•ˆä½</li>
<li>depthï¼šå‰ç¼€é•¿åº¦</li>
<li>next hopï¼šä¸‹ä¸€è·³åœ°å€(ç½‘å¡ç«¯å£å·)</li>
</ul>
<p>æ·»åŠ è§„åˆ™æ—¶ï¼š</p>
<ul>
<li>å°†è§„åˆ™æ·»åŠ åˆ°è§„åˆ™è¡¨ä¸­</li>
<li>æ ¹æ®æ‰€æä¾›çš„CIDRï¼Œè®¡ç®—è¯¥è§„åˆ™çš„ipåœ°å€èŒƒå›´ï¼Œåœ¨è¯¥èŒƒå›´å†…æ ¹æ®è¡¨é¡¹çš„validå’Œdepthå€¼ï¼Œå†³å®šæ˜¯å¦æ›´æ–°lpmè¡¨é¡¹</li>
</ul>
<p>åˆ é™¤è§„åˆ™æ—¶ï¼š</p>
<ul>
<li>å°†è§„åˆ™ä»è§„åˆ™è¡¨ä¸­åˆ é™¤</li>
<li>æ ¹æ®æ‰€æä¾›çš„CIDRï¼Œè®¡ç®—è¯¥è§„åˆ™çš„ipåœ°å€èŒƒå›´ï¼ŒåŒæ—¶åœ¨è§„åˆ™è¡¨ä¸­å¯»æ‰¾æ˜¯å¦æœ‰åŒ…å«è¯¥è§„åˆ™çš„æœ€å°æ¯è§„åˆ™ã€‚è‹¥å­˜åœ¨ï¼Œåˆ™ç”¨æ¯è§„åˆ™æ›´æ–°lpmè¡¨é¡¹ï¼Œå¦åˆ™å°†å¯¹åº”çš„lpmè¡¨é¡¹ç½®ä¸ºæ— æ•ˆ</li>
</ul>
<p>è§„åˆ™åŒ¹é…æ—¶ï¼šç›´æ¥è®¿é—®ipæ‰€å¯¹åº”çš„lpmè¡¨é¡¹ï¼Œå¹¶æ ¹æ®æœ‰æ•ˆä½æ¥å†³å®šè¿”å›çš„ç»“æœã€‚</p>
<h3 id="DIR-24-8ç®—æ³•"><a href="#DIR-24-8ç®—æ³•" class="headerlink" title="DIR-24-8ç®—æ³•"></a>DIR-24-8ç®—æ³•</h3><p>ç”±äºæœ´ç´ ç®—æ³•æ‰€å ç”¨çš„å†…å­˜è¿‡äºåºå¤§ï¼Œä¸ºå¹³è¡¡å†…å­˜å ç”¨å’ŒæŸ¥æ‰¾æ€§èƒ½ï¼Œå°†lpmè¡¨é¡¹åˆ†ä¸ºä¸¤çº§ï¼š</p>
<ul>
<li>åŒ…å«2^24ä¸ªè¡¨é¡¹çš„tbl24ï¼ˆç´¢å¼•ä¸ºipåœ°å€çš„é«˜24ä½ï¼‰</li>
<li>åŒ…å«2^8ä¸ªè¡¨é¡¹çš„tbl8ï¼ˆç´¢å¼•ä¸ºipåœ°å€çš„ä½8ä½ï¼‰</li>
</ul>
<p>ç±»ä¼¼äºç”¨äºè™šæ‹Ÿå†…å­˜çš„å¤šçº§é¡µè¡¨æœºåˆ¶ï¼Œå°†lpmè¡¨åˆ†ä¸ºä¸¤çº§åè¡¨é¡¹æœ¬èº«æ‰€å ç”¨çš„å†…å­˜å¤§å¹…åº¦å‡å°ã€‚å› ä¸ºç»å¤§å¤šæ•°çš„è·¯ç”±è§„åˆ™ä¸ä¼šå»é…ç½®å¤§äº24çš„å‰ç¼€é•¿åº¦ï¼Œæ‰€ä»¥è¯¥ä¼˜åŒ–ä¸ä¼šä½¿å¾—è§„åˆ™åŒ¹é…çš„æ€§èƒ½æœ‰å¾ˆå¤§çš„ä¸‹é™ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_lpm_tbl_entry</span> {</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Stores Next hop ((tbl8) or (tbl24 when valid_group is not set)) or</span></span><br><span class="line"><span class="comment">	 * a group index pointing to a tbl8 structure (tbl24 only, when</span></span><br><span class="line"><span class="comment">	 * valid_group is set)</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> next_hop    :<span class="number">24</span>;</span><br><span class="line">	<span class="comment">/* Using single uint8_t to store 3 values. */</span></span><br><span class="line">	<span class="type">uint32_t</span> valid       :<span class="number">1</span>;   <span class="comment">/**&lt; Validation flag. */</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * For tbl24:</span></span><br><span class="line"><span class="comment">	 *  - valid_group == 0: entry stores a next hop</span></span><br><span class="line"><span class="comment">	 *  - valid_group == 1: entry stores a group_index pointing to a tbl8</span></span><br><span class="line"><span class="comment">	 * For tbl8:</span></span><br><span class="line"><span class="comment">	 *  - valid_group indicates whether the current tbl8 is in use or not</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> valid_group :<span class="number">1</span>;</span><br><span class="line">	<span class="type">uint32_t</span> depth       :<span class="number">6</span>; <span class="comment">/**&lt; Rule depth. */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>



<h2 id="LPMä½¿ç”¨"><a href="#LPMä½¿ç”¨" class="headerlink" title="LPMä½¿ç”¨"></a>LPMä½¿ç”¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_lpm_config</span> {</span></span><br><span class="line">	<span class="type">uint32_t</span> max_rules;      <span class="comment">/**&lt; Max number of rules. */</span></span><br><span class="line">	<span class="type">uint32_t</span> number_tbl8s;   <span class="comment">/**&lt; Number of tbl8s to allocate. */</span></span><br><span class="line">	<span class="type">int</span> flags;               <span class="comment">/**&lt; This field is currently unused. */</span></span><br><span class="line">};</span><br><span class="line"><span class="comment">//lpmè¡¨åˆ›å»º</span></span><br><span class="line"><span class="keyword">struct</span> rte_lpm *</span><br><span class="line"><span class="title function_">rte_lpm_create</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">int</span> socket_id,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="keyword">struct</span> rte_lpm_config *config)</span>;</span><br><span class="line"><span class="comment">//lpmè¡¨æ— é”åŒ–æ”¯æŒ</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_lpm_rcu_qsbr_add</span><span class="params">(<span class="keyword">struct</span> rte_lpm *lpm, <span class="keyword">struct</span> rte_lpm_rcu_config *cfg)</span>;</span><br><span class="line"><span class="comment">//è§„åˆ™æ·»åŠ </span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_lpm_add</span><span class="params">(<span class="keyword">struct</span> rte_lpm *lpm, <span class="type">uint32_t</span> ip, <span class="type">uint8_t</span> depth, <span class="type">uint32_t</span> next_hop)</span>;</span><br><span class="line"><span class="comment">//è§„åˆ™åˆ é™¤</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_lpm_delete</span><span class="params">(<span class="keyword">struct</span> rte_lpm *lpm, <span class="type">uint32_t</span> ip, <span class="type">uint8_t</span> depth)</span>;</span><br><span class="line"><span class="comment">//è§„åˆ™åŒ¹é…</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">int</span></span><br><span class="line"><span class="title function_">rte_lpm_lookup</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_lpm *lpm, <span class="type">uint32_t</span> ip, <span class="type">uint32_t</span> *next_hop)</span></span><br></pre></td></tr></table></figure>



<h1 id="LPM6"><a href="#LPM6" class="headerlink" title="LPM6"></a>LPM6</h1><p>ä¸lpmçš„å®ç°ç±»ä¼¼ï¼Œå°†lpmè¡¨é¡¹åˆ†ä¸º14çº§ï¼Œç¬¬1çº§ä¸ºtbl24ï¼Œåé¢çš„13çº§ä¸ºtbl8ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_lpm6_tbl_entry</span> {</span></span><br><span class="line">	<span class="type">uint32_t</span> next_hop:	<span class="number">21</span>;  <span class="comment">/**&lt; Next hop / next table to be checked. */</span></span><br><span class="line">	<span class="type">uint32_t</span> depth	:<span class="number">8</span>;      <span class="comment">/**&lt; Rule depth. */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/* Flags. */</span></span><br><span class="line">	<span class="type">uint32_t</span> valid     :<span class="number">1</span>;   <span class="comment">/**&lt; Validation flag. */</span></span><br><span class="line">    <span class="comment">//è™½ç„¶ä¼šè¢«è®¾ç½®ï¼Œä½†å®é™…ä¸Šè¿™ä¸€æ ‡å¿—ä½æ²¡æœ‰è¢«ç”¨åˆ°</span></span><br><span class="line">	<span class="type">uint32_t</span> valid_group :<span class="number">1</span>; <span class="comment">/**&lt; Group validation flag. */</span></span><br><span class="line">	<span class="type">uint32_t</span> ext_entry :<span class="number">1</span>;   <span class="comment">/**&lt; External entry. */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>



<h1 id="RIB-Routing-Information-Base"><a href="#RIB-Routing-Information-Base" class="headerlink" title="RIB(Routing Information Base)"></a>RIB(Routing Information Base)</h1><p>è·¯ç”±ä¿¡æ¯è¡¨ï¼Œæä¾›è·¯ç”±ä¿¡æ¯çš„å­˜å‚¨ã€‚</p>
<p>é‡‡ç”¨äºŒå‰æ ‘ç»“æ„æ¥ç®¡ç†è·¯ç”±è¡¨é¡¹ï¼Œæ¯ä¸ªè·¯ç”±è¡¨é¡¹éƒ½å­˜å‚¨åœ¨å”¯ä¸€çš„ä¸€ä¸ªäºŒå‰æ ‘èŠ‚ç‚¹ä¸­ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_rib_node</span> {</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_rib_node</span>	*<span class="title">left</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_rib_node</span>	*<span class="title">right</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_rib_node</span>	*<span class="title">parent</span>;</span></span><br><span class="line">	<span class="type">uint32_t</span>	ip;</span><br><span class="line">	<span class="type">uint8_t</span>		depth;</span><br><span class="line">	<span class="type">uint8_t</span>		flag;	<span class="comment">//è®°å½•è¯¥èŠ‚ç‚¹æ˜¯ä¸­é—´èŠ‚ç‚¹è¿˜æ˜¯è·¯ç”±èŠ‚ç‚¹</span></span><br><span class="line">	<span class="type">uint64_t</span>	nh;		<span class="comment">//ä¸‹ä¸€è·³</span></span><br><span class="line">	__extension__ <span class="type">uint64_t</span> ext[];	<span class="comment">//ç”¨æˆ·è®¾ç½®çš„é¢å¤–æ•°æ®</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>ç”±è·¯ç”±è¡¨é¡¹æ‰€æ„å»ºçš„äºŒå‰æ ‘çš„è§„åˆ™å¦‚ä¸‹ï¼š</p>
<ul>
<li>æ¯ä¸ªèŠ‚ç‚¹éƒ½ä»£è¡¨ä¸€ä¸ªCIDRåœ°å€å—(è¡¨ç¤ºipåœ°å€èŒƒå›´)</li>
<li>æ¯ä¸ªèŠ‚ç‚¹æ‰€ä»£è¡¨çš„ipåœ°å€èŒƒå›´éƒ½åŒ…å«åœ¨çˆ¶èŠ‚ç‚¹çš„ipåœ°å€èŒƒå›´ä¸­ï¼Œæ ¹èŠ‚ç‚¹é™¤å¤–</li>
<li>å°†æ¯ä¸ªèŠ‚ç‚¹æ‰€ä»£è¡¨çš„ipåœ°å€èŒƒå›´å¯¹åŠåˆ†ï¼Œå·¦å­©å­èŠ‚ç‚¹ä½äºè¾ƒä½çš„ipåœ°å€èŒƒå›´ï¼Œå³å­©å­èŠ‚ç‚¹ä½äºè¾ƒé«˜çš„ipåœ°å€èŒƒå›´</li>
</ul>
<p>å…¶ä¸­äºŒå‰æ ‘çš„èŠ‚ç‚¹è¢«åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ol>
<li>è·¯ç”±èŠ‚ç‚¹ï¼šå­˜æ”¾ç€è·¯ç”±è¡¨é¡¹çš„èŠ‚ç‚¹</li>
<li>ä¸­é—´èŠ‚ç‚¹ï¼šä¸ºäº†ç»´æŒäºŒå‰æ ‘ç»“æ„æ‰€ä½¿ç”¨çš„èŠ‚ç‚¹ï¼Œæœ¬èº«ä¸å±äºä»»ä½•è·¯ç”±è¡¨é¡¹</li>
</ol>
<p><a href="/images/rib_internals.svg" title="rib binary tree" class="gallery-item" style="box-shadow: none;"> <img src="/images/rib_internals.svg" alt="rib binary tree"></a></p>
<h2 id="RIBä½¿ç”¨"><a href="#RIBä½¿ç”¨" class="headerlink" title="RIBä½¿ç”¨"></a>RIBä½¿ç”¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_rib_conf</span> {</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Size of extension block inside rte_rib_node.</span></span><br><span class="line"><span class="comment">	 * This space could be used to store additional user</span></span><br><span class="line"><span class="comment">	 * defined data.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">size_t</span>	ext_sz;</span><br><span class="line">	<span class="comment">/* size of rte_rib_node's pool */</span></span><br><span class="line">	<span class="type">int</span>	max_nodes;</span><br><span class="line">};</span><br><span class="line"><span class="comment">//ribè¡¨åˆ›å»º</span></span><br><span class="line"><span class="keyword">struct</span> rte_rib *</span><br><span class="line"><span class="title function_">rte_rib_create</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">int</span> socket_id, <span class="type">const</span> <span class="keyword">struct</span> rte_rib_conf *conf)</span></span><br><span class="line"><span class="comment">//æ’å…¥CIDRåˆ°ribè¡¨ä¸­å¹¶è¿”å›å¯¹åº”çš„è·¯ç”±è¡¨é¡¹</span></span><br><span class="line"><span class="keyword">struct</span> rte_rib_node *</span><br><span class="line"><span class="title function_">rte_rib_insert</span><span class="params">(<span class="keyword">struct</span> rte_rib *rib, <span class="type">uint32_t</span> ip, <span class="type">uint8_t</span> depth)</span>;</span><br><span class="line"><span class="comment">//æŸ¥æ‰¾è¯¥ipåœ°å€æ‰€åŒ¹é…çš„æœ€ä½³è·¯ç”±è¡¨é¡¹</span></span><br><span class="line"><span class="keyword">struct</span> rte_rib_node *</span><br><span class="line"><span class="title function_">rte_rib_lookup</span><span class="params">(<span class="keyword">struct</span> rte_rib *rib, <span class="type">uint32_t</span> ip)</span>;</span><br><span class="line"><span class="comment">//æŸ¥æ‰¾è¯¥CIDRæ‰€å¯¹åº”çš„è·¯ç”±è¡¨é¡¹</span></span><br><span class="line"><span class="keyword">struct</span> rte_rib_node *</span><br><span class="line"><span class="title function_">rte_rib_lookup_exact</span><span class="params">(<span class="keyword">struct</span> rte_rib *rib, <span class="type">uint32_t</span> ip, <span class="type">uint8_t</span> depth)</span>;</span><br></pre></td></tr></table></figure>



<h1 id="FIB-Forwarding-Information-Base"><a href="#FIB-Forwarding-Information-Base" class="headerlink" title="FIB(Forwarding Information Base)"></a>FIB(Forwarding Information Base)</h1><p>è½¬å‘è¡¨ï¼Œå†…éƒ¨ä½¿ç”¨ribè¡¨å­˜å‚¨è·¯ç”±è¡¨é¡¹å¹¶å¸®åŠ©ç”Ÿæˆè½¬å‘è¡¨ã€‚ç›®å‰è½¬å‘è¡¨æ‰€ä½¿ç”¨çš„ç®—æ³•æœ‰ä¸¤ä¸ªï¼š</p>
<ol>
<li>Dummyï¼šå°†ribè¡¨ä½œä¸ºfibè¡¨ä½¿ç”¨ï¼Œç”±äºribè¡¨åšè·¯ç”±æŸ¥æ‰¾å¾ˆæ…¢ï¼Œæ‰€ä»¥è¯¥ç®—æ³•ç”¨äºæµ‹è¯•å’Œç¨‹åºè°ƒè¯•æ—¶ä½¿ç”¨</li>
<li>DIR-24-8ï¼šä¸ä¸Šé¢æ‰€è®²åˆ°çš„lpmè¡¨æ‰€ä½¿ç”¨çš„ç®—æ³•ç±»ä¼¼ï¼Œæä¾›é«˜æ€§èƒ½çš„è·¯ç”±æŸ¥æ‰¾</li>
</ol>
<h2 id="DIR-24-8"><a href="#DIR-24-8" class="headerlink" title="DIR-24-8"></a>DIR-24-8</h2><p>ä¸lpmçš„ç®—æ³•ä¸åŒçš„æ˜¯ï¼Œtbl24å’Œtbl8ç»“æ„æ›´ä¸ºç´§å‡‘ï¼Œä¸”next hopçš„å¤§å°å¯é…ç½®ã€‚è‹¥next hopé…ç½®ä¸º1å­—èŠ‚ï¼Œåˆ™tbl24å’Œtbl8è¡¨é¡¹æ„æˆå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">tbl24</span>/<span class="title">tbl8</span> {</span></span><br><span class="line">    <span class="type">uint8_t</span> extend:<span class="number">1</span>;	<span class="comment">//0ä½</span></span><br><span class="line">    <span class="type">uint8_t</span> next_hop:<span class="number">7</span>;	<span class="comment">//1~7ä½</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>ç”±äºä½¿ç”¨äº†ä¸€ä½ç”¨äºåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ‰©å±•è¡¨ï¼Œå®é™…çš„next hopå–å€¼èŒƒå›´å‡å°ä¸€åŠã€‚ä¸‹é¢ä¸ºDIR-24-8ç®—æ³•æ‰€ä½¿ç”¨çš„æ•°æ®ç»“æ„</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">dir24_8_tbl</span> {</span></span><br><span class="line">	<span class="type">uint32_t</span>	number_tbl8s;	<span class="comment">/**&lt; Total number of tbl8s */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//è‹¥æ–°å¢çš„è·¯ç”±è§„åˆ™éœ€è¦æ·»åŠ tbl8æ—¶ï¼Œè¯¥æˆå‘˜åŠ ä¸€ã€‚è‹¥è¯¥å€¼ç­‰äºnumber_tb8sï¼Œåˆ™æ— æ³•æ·»åŠ è¯¥æ¡è·¯ç”±ã€‚</span></span><br><span class="line">	<span class="type">uint32_t</span>	rsvd_tbl8s;	<span class="comment">/**&lt; Number of reserved tbl8s */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//è¯¥æˆå‘˜çš„å€¼å¯èƒ½å°äºrsvd_tlb8sçš„å€¼ã€‚ä¾‹å¦‚æŸä¸ªtbl8ä¸­æ‰€æœ‰çš„next hopçš„å€¼éƒ½ç›¸ç­‰çš„æƒ…å†µä¸‹ï¼Œä¼šåˆ é™¤è¯¥tbl8ï¼Œä½¿å¾—cur_tbl8så€¼å˜å°ã€‚åœ¨åˆ é™¤æŸä¸ªè·¯ç”±è¡¨é¡¹æ—¶å¯èƒ½ä¼šå°†åˆ é™¤çš„tbl8æ·»åŠ å›æ¥ã€‚</span></span><br><span class="line">	<span class="type">uint32_t</span>	cur_tbl8s;	<span class="comment">/**&lt; Current number of tbl8s */</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">rte_fib_dir24_8_nh_sz</span>	<span class="title">nh_sz</span>;</span>	<span class="comment">/**&lt; Size of nexthop entry */</span></span><br><span class="line">	<span class="type">uint64_t</span>	def_nh;		<span class="comment">/**&lt; Default next hop */</span></span><br><span class="line">	<span class="type">uint64_t</span>	*tbl8;		<span class="comment">/**&lt; tbl8 table. */</span></span><br><span class="line">	<span class="type">uint64_t</span>	*tbl8_idxes;	<span class="comment">/**&lt; bitmap containing free tbl8 idxes*/</span></span><br><span class="line">	<span class="comment">/* tbl24 table. */</span></span><br><span class="line">	__extension__ <span class="type">uint64_t</span>	tbl24[<span class="number">0</span>] __rte_cache_aligned;</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>è·¯ç”±æŸ¥æ‰¾æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><a href="/images/dir_24_8_alg.svg" title="DIR-24-8 lookup" class="gallery-item" style="box-shadow: none;"> <img src="/images/dir_24_8_alg.svg" alt="DIR-24-8 lookup"></a></p>
<h2 id="FIBä½¿ç”¨"><a href="#FIBä½¿ç”¨" class="headerlink" title="FIBä½¿ç”¨"></a>FIBä½¿ç”¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_fib_conf</span> {</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">rte_fib_type</span> <span class="title">type</span>;</span> <span class="comment">/**&lt; Type of FIB struct */</span></span><br><span class="line">	<span class="comment">/** Default value returned on lookup if there is no route */</span></span><br><span class="line">	<span class="type">uint64_t</span> default_nh;</span><br><span class="line">	<span class="type">int</span>	max_routes;</span><br><span class="line">	<span class="comment">/** Size of the node extension in the internal RIB struct */</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> rib_ext_sz;</span><br><span class="line">	<span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">			<span class="class"><span class="keyword">enum</span> <span class="title">rte_fib_dir24_8_nh_sz</span> <span class="title">nh_sz</span>;</span></span><br><span class="line">			<span class="type">uint32_t</span>	num_tbl8;</span><br><span class="line">		} dir24_8;</span><br><span class="line">	};</span><br><span class="line">};</span><br><span class="line"><span class="keyword">struct</span> rte_fib *</span><br><span class="line"><span class="title function_">rte_fib_create</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">int</span> socket_id, <span class="keyword">struct</span> rte_fib_conf *conf)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_fib_add</span><span class="params">(<span class="keyword">struct</span> rte_fib *fib, <span class="type">uint32_t</span> ip, <span class="type">uint8_t</span> depth, <span class="type">uint64_t</span> next_hop)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_fib_delete</span><span class="params">(<span class="keyword">struct</span> rte_fib *fib, <span class="type">uint32_t</span> ip, <span class="type">uint8_t</span> depth)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_fib_lookup_bulk</span><span class="params">(<span class="keyword">struct</span> rte_fib *fib, <span class="type">uint32_t</span> *ips,</span></span><br><span class="line"><span class="params">		<span class="type">uint64_t</span> *next_hops, <span class="type">int</span> n)</span>;</span><br></pre></td></tr></table></figure>



<h1 id="ACL-Access-Control-Lists"><a href="#ACL-Access-Control-Lists" class="headerlink" title="ACL(Access Control Lists)"></a>ACL(Access Control Lists)</h1><p>è®¿é—®æ§åˆ¶åº“ï¼Œé€šè¿‡åŠ è½½å…·æœ‰å¤šä¸ªç±»åˆ«çš„ä¸€ç»„ACè§„åˆ™ï¼Œå¯¹è¾“å…¥æŠ¥æ–‡è¿›è¡ŒNå…ƒç»„æœç´¢ï¼Œä¸ºè¾“å…¥æŠ¥æ–‡æ‰¾åˆ°æ¯ä¸ªç±»åˆ«çš„æœ€ä½³åŒ¹é…ã€‚</p>
<h2 id="ACè§„åˆ™å®šä¹‰"><a href="#ACè§„åˆ™å®šä¹‰" class="headerlink" title="ACè§„åˆ™å®šä¹‰"></a>ACè§„åˆ™å®šä¹‰</h2><p>è§„åˆ™åŸŸå¯ä»¥çœ‹ä½œæ˜¯è§„åˆ™çš„æ¨¡æ¿ï¼Œå®šä¹‰äº†ACè§„åˆ™ä¸­å„ä¸ªå­—æ®µ(field)çš„åŒ¹é…è¡Œä¸ºã€‚ä¸€ä¸ªACè§„åˆ™é›†å¯¹åº”ä¸€ç»„è§„åˆ™åŸŸï¼Œåœ¨è¯¥è§„åˆ™é›†ä¸­æ‰€æœ‰æ·»åŠ çš„è§„åˆ™éƒ½æ˜¯ä»¥è¯¥è§„åˆ™åŸŸä¸ºæ¨¡æ¿çš„ã€‚åœ¨å®é™…ä½¿ç”¨æ—¶ï¼Œaclåº“ä¼šä¸ºæ¯ä¸ªè§„åˆ™é›†æ„å»ºä¸€ä¸ªACä¸Šä¸‹æ–‡ç”¨äºè§„åˆ™åŒ¹é…ã€‚ä¸‹é¢æ˜¯è§„åˆ™åŸŸçš„å®šä¹‰ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_field_def</span> {</span></span><br><span class="line">    <span class="type">uint8_t</span> type;         <span class="comment">/*&lt; type - ACL_FIELD_TYPE. */</span></span><br><span class="line">    <span class="type">uint8_t</span> size;         <span class="comment">/*&lt; size of field 1,2,4, or 8. */</span></span><br><span class="line">    <span class="type">uint8_t</span> field_index;  <span class="comment">/*&lt; index of field inside the rule. */</span></span><br><span class="line">    <span class="type">uint8_t</span> input_index;  <span class="comment">/*&lt; 0-N input index. */</span></span><br><span class="line">    <span class="type">uint32_t</span> offset;      <span class="comment">/*&lt; offset to start of field. */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<ul>
<li><p>typeå­—æ®µï¼š</p>
<ol>
<li><p>RTE_ACL_FIELD_TYPE_MASKï¼šè§„åˆ™æä¾›å‰ç¼€å’Œå‰ç¼€æ©ç é•¿åº¦ï¼ŒåŒ¹é…æ—¶å°†è¾“å…¥æ•°æ®å’Œå‰ç¼€é•¿åº¦æ‰€å¯¹åº”çš„æ©ç ç›¸ä¸ï¼Œå°†å…¶ç»“æœä¸å‰ç¼€æ¯”è¾ƒã€‚å¸¸ç”¨äºå¯¹IPåœ°å€çš„å‰ç¼€åŒ¹é…ã€‚</p>
</li>
<li><p>RTE_ACL_FIELD_TYPE_RANGEï¼šæ ¹æ®è§„åˆ™æ‰€æä¾›çš„èŒƒå›´çš„ä¸Šä¸‹é™ï¼Œåˆ¤æ–­è¾“å…¥æ•°æ®æ˜¯å¦åœ¨ç»™å®šèŒƒå›´å†…ã€‚å¸¸ç”¨äºå¯¹ç«¯å£çš„èŒƒå›´åŒ¹é…ã€‚</p>
</li>
<li><p>RTE_ACL_FIELD_TYPE_BITMASKï¼šè§„åˆ™æ‰€æä¾›äºŒè¿›åˆ¶ä¸²å’Œæ¯”ç‰¹æ©ç ï¼ŒåŒ¹é…æ—¶å°†è¾“å…¥æ•°æ®å’Œæ¯”ç‰¹æ©ç ç›¸ä¸ï¼Œå°†å…¶ç»“æœä¸äºŒè¿›åˆ¶ä¸²æ¯”è¾ƒã€‚å¸¸ç”¨äºå¯¹åè®®å·çš„åŒ¹é…ã€‚</p>
</li>
</ol>
</li>
<li><p>sizeå­—æ®µï¼šå®šä¹‰è¯¥è§„åˆ™åŸŸæ‰€éœ€çš„è¾“å…¥æ•°æ®çš„å­—èŠ‚é•¿åº¦ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè¯¥è§„åˆ™åŸŸè®¾ç½®ä¸º1æˆ–2å­—èŠ‚é•¿åº¦ï¼Œåˆ™éœ€è¦å…¶ä»–è§„åˆ™åŸŸä¸è¯¥è§„åˆ™åŸŸç»„æˆä¸€ä¸ªå®Œæ•´çš„è¾“å…¥ç»„ã€‚åŒæ—¶ï¼Œä¸ºäº†è§„åˆ™æ„å»ºè¿‡ç¨‹ä¸­çš„è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œ8å­—èŠ‚é•¿åº¦æœ€å¥½åˆ†ä¸ºä¸¤ä¸ª4å­—èŠ‚é•¿åº¦ã€‚</p>
</li>
<li><p>field_indexå­—æ®µï¼šè¡¨æ˜è¯¥è§„åˆ™åŸŸåœ¨è§„åˆ™ä¸­çš„ä½ç½®ï¼Œä»0å¼€å§‹ã€‚</p>
</li>
<li><p>input_indexå­—æ®µï¼šé™¤äº†ç¬¬ä¸€ä¸ªè§„åˆ™åŸŸï¼Œå…¶ä»–è§„åˆ™åŸŸæ‰€éœ€çš„æ‰€æœ‰çš„è¾“å…¥æ•°æ®å¿…é¡»ä»¥è¿ç»­çš„4ä¸ªå­—èŠ‚ä¸ºä¸€ç»„ï¼ˆè¢«ç§°ä¸ºè¾“å…¥ç»„ï¼‰ã€‚è¯¥å­—æ®µæŒ‡æ˜äº†è¯¥è§„åˆ™åŸŸçš„è¾“å…¥æ•°æ®å±äºå“ªä¸ªè¾“å…¥ç»„ã€‚åŒ¹é…æ—¶ä¼šæ¯æ¬¡è¯»å–ä¸€ä¸ªè¾“å…¥ç»„ã€‚</p>
</li>
<li><p>offsetå­—æ®µï¼šå®šä¹‰äº†è¯¥è§„åˆ™åŸŸæ‰€éœ€çš„è¾“å…¥æ•°æ®åœ¨è¾“å…¥ç¼“å†²åŒºä¸­çš„åç§»ã€‚</p>
</li>
</ul>
<p>å¯¹äºè§„åˆ™åŸŸçš„å®šä¹‰éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªè§„åˆ™åŸŸçš„sizeå­—æ®µé•¿åº¦å¿…é¡»ä¸º1ï¼Œä¸”å±äºå•ç‹¬çš„ä¸€ä¸ªè¾“å…¥ç»„ã€‚</li>
<li>å…¶ä½™çš„è§„åˆ™åŸŸæ‰€éœ€çš„è¾“å…¥æ•°æ®å¿…é¡»ä»¥è¿ç»­çš„4ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªè¾“å…¥ç»„ï¼ˆå¦‚æœå°‘äºè¿ç»­çš„4ä¸ªå­—èŠ‚åˆ™éœ€è¦è¡¥å……è‡³4ä¸ªï¼Œå³ä½¿æ²¡æœ‰ç”¨åˆ°ï¼‰ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ª4-tupleè§„åˆ™é›†ï¼ŒåŒ¹é…æ—¶è¾“å…¥ç¼“å†²åŒºä¸­æ•°æ®çš„æ ¼å¼å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">acl_key</span> {</span></span><br><span class="line">    <span class="type">uint8_t</span> ip_proto;</span><br><span class="line">    <span class="type">uint16_t</span> port_src;</span><br><span class="line">    <span class="type">uint16_t</span> port_dst;</span><br><span class="line">    <span class="type">uint32_t</span> ip_src;</span><br><span class="line">    <span class="type">uint32_t</span> ip_dst;</span><br><span class="line">    <span class="type">uint8_t</span> tos;      <span class="comment">/*&lt; This is partially using a 32-bit input element */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>è¯¥è§„åˆ™é›†çš„è§„åˆ™åŸŸå®šä¹‰å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_field_def</span> <span class="title">ipv4_defs</span>[6] =</span> {</span><br><span class="line">    <span class="comment">/* first input field - always one byte long. */</span></span><br><span class="line">    {</span><br><span class="line">        .type = RTE_ACL_FIELD_TYPE_BITMASK,</span><br><span class="line">        .size = <span class="keyword">sizeof</span> (<span class="type">uint8_t</span>),</span><br><span class="line">        .field_index = <span class="number">0</span>,</span><br><span class="line">        .input_index = <span class="number">0</span>,</span><br><span class="line">        .offset = offsetof (<span class="keyword">struct</span> acl_key, ip_proto),</span><br><span class="line">    },</span><br><span class="line">    </span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Next 2 fields (src &amp; dst ports) form 4 consecutive bytes.</span></span><br><span class="line"><span class="comment">     * They share the same input index.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    {</span><br><span class="line">        .type = RTE_ACL_FIELD_TYPE_RANGE,</span><br><span class="line">        .size = <span class="keyword">sizeof</span> (<span class="type">uint16_t</span>),</span><br><span class="line">        .field_index = <span class="number">1</span>,</span><br><span class="line">        .input_index = <span class="number">1</span>,</span><br><span class="line">        .offset = offsetof (<span class="keyword">struct</span> acl_key, port_src),</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    {</span><br><span class="line">        .type = RTE_ACL_FIELD_TYPE_RANGE,</span><br><span class="line">        .size = <span class="keyword">sizeof</span> (<span class="type">uint16_t</span>),</span><br><span class="line">        .field_index = <span class="number">2</span>,</span><br><span class="line">        .input_index = <span class="number">1</span>,</span><br><span class="line">        .offset = offsetof (<span class="keyword">struct</span> acl_key, port_dst),</span><br><span class="line">    },</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* next input field (IPv4 source address) - 4 consecutive bytes. */</span></span><br><span class="line">    {</span><br><span class="line">        .type = RTE_ACL_FIELD_TYPE_MASK,</span><br><span class="line">        .size = <span class="keyword">sizeof</span> (<span class="type">uint32_t</span>),</span><br><span class="line">        .field_index = <span class="number">3</span>,</span><br><span class="line">        .input_index = <span class="number">2</span>,</span><br><span class="line">       .offset = offsetof (<span class="keyword">struct</span> acl_key, ip_src),</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* next input field (IPv4 destination address) - 4 consecutive bytes. */</span></span><br><span class="line">    {</span><br><span class="line">        .type = RTE_ACL_FIELD_TYPE_MASK,</span><br><span class="line">        .size = <span class="keyword">sizeof</span> (<span class="type">uint32_t</span>),</span><br><span class="line">        .field_index = <span class="number">4</span>,</span><br><span class="line">        .input_index = <span class="number">3</span>,</span><br><span class="line">       .offset = offsetof (<span class="keyword">struct</span> acl_key, ip_dst),</span><br><span class="line">    },</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * Next element of search key (Type of Service) is indeed 1 byte long.</span></span><br><span class="line"><span class="comment">     * Anyway we need to allocate all the 4 consecutive bytes for it.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    {</span><br><span class="line">        .type = RTE_ACL_FIELD_TYPE_BITMASK,</span><br><span class="line">        .size = <span class="keyword">sizeof</span> (<span class="type">uint32_t</span>), <span class="comment">/* All the 4 consecutive bytes are allocated */</span></span><br><span class="line">        .field_index = <span class="number">5</span>,</span><br><span class="line">        .input_index = <span class="number">4</span>,</span><br><span class="line">        .offset = offsetof (<span class="keyword">struct</span> acl_key, tos),</span><br><span class="line">    },</span><br><span class="line">};</span><br></pre></td></tr></table></figure>

<p>æ ¹æ®ä¸Šè¿°è§„åˆ™åŸŸçš„å®šä¹‰ï¼Œå¯¹è§„åˆ™çš„ç¼–å†™å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">source addr/mask  destination addr/mask  source ports dest ports  tos/mask protocol/mask</span><br><span class="line">192.168.1.0/24    192.168.2.31/32        0:65535      1234:1234   1/0xff   6/0xff</span><br></pre></td></tr></table></figure>



<p>ä¸Šé¢çš„è§„åˆ™æ˜¯ä»¥é…ç½®æ–‡ä»¶æ–¹å¼å±•ç¤ºï¼Œå®é™…ä»£ç ä¸­è§„åˆ™å¯¹åº”å¦‚ä¸‹æ•°æ®ç»“æ„ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Miscellaneous data for ACL rule.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_rule_data</span> {</span></span><br><span class="line">    <span class="comment">//è¯¥è§„åˆ™æ‰€å±ç±»åˆ«çš„æ©ç </span></span><br><span class="line">	<span class="type">uint32_t</span> category_mask; <span class="comment">/**&lt; Mask of categories for that rule. */</span></span><br><span class="line">    <span class="comment">//è‹¥å­˜åœ¨å¤šæ¡priorityç›¸ç­‰çš„è§„åˆ™ä¸”åŒ¹é…æ—¶åŒæ—¶å‘½ä¸­ï¼Œå› ä¸ºä¼˜å…ˆçº§ç›¸åŒï¼Œæ‰€ä»¥è¿”å›çš„ç»“æœæ˜¯ä¸ç¡®å®šçš„ã€‚</span></span><br><span class="line">    <span class="comment">//å¯¹äºæ¯æ¡è§„åˆ™ï¼Œå…¶priorityåº”è¯¥æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚</span></span><br><span class="line">    <span class="comment">//å…¶å–å€¼èŒƒå›´ä¸º[1, (2^29)-1]</span></span><br><span class="line">	<span class="type">int32_t</span>  priority;      <span class="comment">/**&lt; Priority for that rule. */</span></span><br><span class="line">	<span class="type">uint32_t</span> userdata;      <span class="comment">/**&lt; Associated with the rule user data. */</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Defines the value of a field for a rule.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_field</span> {</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> <span class="title">rte_acl_field_types</span> <span class="title">value</span>;</span></span><br><span class="line">	<span class="comment">/**&lt; a 1,2,4, or 8 byte value of the field. */</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> <span class="title">rte_acl_field_types</span> <span class="title">mask_range</span>;</span></span><br><span class="line">	<span class="comment">/**&lt;</span></span><br><span class="line"><span class="comment">	 * depending on field type:</span></span><br><span class="line"><span class="comment">	 * mask -&gt; 1.2.3.4/32 value=0x1020304, mask_range=32,</span></span><br><span class="line"><span class="comment">	 * range -&gt; 0 : 65535 value=0, mask_range=65535,</span></span><br><span class="line"><span class="comment">	 * bitmask -&gt; 0x06/0xff value=6, mask_range=0xff.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Defines single ACL rule.</span></span><br><span class="line"><span class="comment"> * data - miscellaneous data for the rule.</span></span><br><span class="line"><span class="comment"> * field[] - value and mask or range for each field.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>	RTE_ACL_RULE_DEF(name, fld_num)	struct name {\</span></span><br><span class="line"><span class="meta">	struct rte_acl_rule_data data;               \</span></span><br><span class="line"><span class="meta">	struct rte_acl_field field[fld_num];         \</span></span><br><span class="line"><span class="meta">}</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//General rule representation</span></span><br><span class="line">RTE_ACL_RULE_DEF(rte_acl_rule,);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ACL rule size</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span>	RTE_ACL_RULE_SZ(fld_num)	\</span></span><br><span class="line"><span class="meta">	(sizeof(struct rte_acl_rule) + sizeof(struct rte_acl_field) * (fld_num))</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯è§„åˆ™ä¸­æ‰€ä½¿ç”¨çš„æ•°æ®å‡ä¸ºä¸»æœºå­—èŠ‚åº(LSB)ã€‚åœ¨è§„åˆ™åŒ¹é…æ—¶ï¼Œè¾“å…¥ç¼“å†²åŒºä¸­çš„æ•°æ®ä¸ºç½‘ç»œå­—èŠ‚åº(MSB)ã€‚</p>
</blockquote>
<h2 id="ACLä½¿ç”¨"><a href="#ACLä½¿ç”¨" class="headerlink" title="ACLä½¿ç”¨"></a>ACLä½¿ç”¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_param</span> {</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *name;         <span class="comment">/**&lt; Name of the ACL context. */</span></span><br><span class="line">	<span class="type">int</span>         socket_id;    <span class="comment">/**&lt; Socket ID to allocate memory for. */</span></span><br><span class="line">    <span class="comment">//è¯¥è§„åˆ™é›†ä¸­è§„åˆ™çš„å¤§å°ï¼Œå¯è®¾ç½®ä¸º RTE_ACL_RULE_SZ(fld_num)</span></span><br><span class="line">	<span class="type">uint32_t</span>    rule_size;    <span class="comment">/**&lt; Size of each rule. */</span></span><br><span class="line">	<span class="type">uint32_t</span>    max_rule_num; <span class="comment">/**&lt; Maximum number of rules. */</span></span><br><span class="line">};</span><br><span class="line"><span class="comment">//åˆ›å»ºè§„åˆ™é›†çš„ACä¸Šä¸‹æ–‡</span></span><br><span class="line"><span class="keyword">struct</span> rte_acl_ctx * <span class="title function_">rte_acl_create</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_acl_param *param)</span>;</span><br><span class="line"><span class="comment">//æ·»åŠ è§„åˆ™åˆ°è§„åˆ™é›†ä¸­</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_acl_add_rules</span><span class="params">(<span class="keyword">struct</span> rte_acl_ctx *ctx, <span class="type">const</span> <span class="keyword">struct</span> rte_acl_rule *rules,</span></span><br><span class="line"><span class="params">	<span class="type">uint32_t</span> num)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ACL build configuration.</span></span><br><span class="line"><span class="comment"> * Defines the fields of an ACL trie and number of categories to build with.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">struct</span> rte_acl_config {</span><br><span class="line">    <span class="comment">//ç±»åˆ«æ•°ï¼Œæœ€å¤š16ä¸ªï¼Œæœ€å°‘1ä¸ª</span></span><br><span class="line">	<span class="type">uint32_t</span> num_categories; <span class="comment">/**&lt; Number of categories to build with. */</span></span><br><span class="line">    <span class="comment">//è§„åˆ™åŸŸä¸ªæ•°ï¼Œä¸å¾—å¤šäº64ä¸ª</span></span><br><span class="line">	<span class="type">uint32_t</span> num_fields;     <span class="comment">/**&lt; Number of field definitions. */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_field_def</span> <span class="title">defs</span>[<span class="title">RTE_ACL_MAX_FIELDS</span>];</span></span><br><span class="line">	<span class="comment">/**&lt; array of field definitions. */</span></span><br><span class="line">    <span class="comment">//è‹¥ä¸º0åˆ™è¡¨ç¤ºæ²¡æœ‰å†…å­˜é™åˆ¶ï¼Œæ„å»ºæ—¶ä¼šä»¥æœ€å°å†…å­˜ä»£ä»·æ„å»ºtrieï¼Œè¿™å¯èƒ½ä¼šå¢åŠ æ„å»ºè€—æ—¶ã€‚</span></span><br><span class="line">    <span class="comment">//è‹¥ä¸ä¸º0åˆ™åœ¨å†…å­˜é™åˆ¶èŒƒå›´å†…ä»¥æœ€å°‘trieæ•°æ„å»ºã€‚</span></span><br><span class="line">	<span class="type">size_t</span> max_size;</span><br><span class="line">	<span class="comment">/**&lt; max memory limit for internal run-time structures. */</span></span><br><span class="line">};</span><br><span class="line"><span class="comment">//æ„å»ºè§„åˆ™é›†</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_acl_build</span><span class="params">(<span class="keyword">struct</span> rte_acl_ctx *ctx, <span class="type">const</span> <span class="keyword">struct</span> rte_acl_config *cfg)</span></span><br><span class="line"><span class="comment">//è§„åˆ™é›†åŒ¹é…ï¼Œå°†åŒ¹é…ç»“æœè¿”å›ç»™resultsï¼Œresultså­˜å‚¨ç€æ¯ä¸ªdataæ‰€åŒ¹é…çš„categoriesä¸ªç±»åˆ«çš„ç»“æœï¼Œå³è¿”å›æ¯ä¸ªç±»åˆ«ä¸‹æ‰€å‘½ä¸­çš„priorityæœ€é«˜çš„è§„åˆ™çš„userdata</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_acl_classify</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_acl_ctx *ctx,</span></span><br><span class="line"><span class="params">		 <span class="type">const</span> <span class="type">uint8_t</span> **data,</span></span><br><span class="line"><span class="params">		 <span class="type">uint32_t</span> *results, <span class="type">uint32_t</span> num,</span></span><br><span class="line"><span class="params">		 <span class="type">uint32_t</span> categories)</span>;	<span class="comment">//å¿…é¡»ä¸º4çš„å€æ•°</span></span><br></pre></td></tr></table></figure>



<h2 id="ACLå®ç°åŸç†"><a href="#ACLå®ç°åŸç†" class="headerlink" title="ACLå®ç°åŸç†"></a>ACLå®ç°åŸç†</h2><p>æ ¹æ®æ‰€æä¾›çš„è§„åˆ™æ„å»ºtrieï¼Œè€Œåå°†trieè§†ä¸ºdfaï¼Œç”Ÿæˆè½¬ç§»çŸ©é˜µï¼Œç”¨äºè§„åˆ™åŒ¹é…ã€‚</p>
<h3 id="Binary-Trie"><a href="#Binary-Trie" class="headerlink" title="Binary Trie"></a>Binary Trie</h3><p>å‰ç¼€äºŒå‰æ ‘ï¼Œä¸€ç§ç”¨äºå¿«é€Ÿæ£€ç´¢çš„äºŒå‰æ ‘ç»“æ„ï¼Œå…¶åŸºæœ¬æ€§è´¨å¦‚ä¸‹ï¼š</p>
<ul>
<li>è¾¹å­˜å‚¨åŒ¹é…ä¿¡æ¯ï¼ŒèŠ‚ç‚¹å­˜å‚¨åŒ¹é…ç»“æœ</li>
<li>æ¯æ¡è¾¹éƒ½ä»£è¡¨äºŒè¿›åˆ¶ä¸²çš„ä¸€ä½ï¼ŒèŠ‚ç‚¹æŒ‡å‘å·¦å­©å­çš„è¾¹ä»£è¡¨0ï¼ŒæŒ‡å‘å³å­©å­çš„è¾¹ä»£è¡¨1ã€‚ç¬¬0å±‚èŠ‚ç‚¹çš„è¾¹ï¼ˆæ ¹èŠ‚ç‚¹æŒ‡å‘å­©å­èŠ‚ç‚¹çš„è¾¹ï¼‰å¯¹åº”äºŒè¿›åˆ¶ä¸²çš„æœ€é«˜ä½ï¼Œç¬¬1å±‚èŠ‚ç‚¹çš„è¾¹å¯¹åº”äºŒè¿›åˆ¶ä¸²çš„æ¬¡é«˜ä½ï¼Œä»¥æ­¤ç±»æ¨ã€‚</li>
<li>ä»æ ¹èŠ‚ç‚¹åˆ°æŸä¸€ç»“ç‚¹ï¼Œè·¯å¾„ä¸Šç»è¿‡çš„äºŒè¿›åˆ¶æ•°è¿æ¥èµ·æ¥ï¼Œä¸ºè¯¥èŠ‚ç‚¹å¯¹åº”çš„äºŒè¿›åˆ¶ä¸²å‰ç¼€</li>
<li>è§„åˆ™é›†æ‰€å®šä¹‰çš„è§„åˆ™åŒ¹é…é•¿åº¦ä¸ºæ ‘çš„é«˜åº¦ï¼Œä¸”æ‰€æœ‰å¶èŠ‚ç‚¹éƒ½å¤„äºåŒä¸€å±‚</li>
</ul>
<p>ä¾‹ï¼šè§„åˆ™é›†å®šä¹‰äº†è§„åˆ™åŒ¹é…é•¿åº¦ä¸º4bitï¼Œä¸”è§„åˆ™é›†ä¸­æ·»åŠ äº†ä¸‰æ¡è§„åˆ™</p>
<table>
<thead>
<tr>
<th>rule1:range</th>
<th>rule2:bitmask</th>
<th>rule3:mask</th>
</tr>
</thead>
<tbody><tr>
<td>0b1101~0b1110</td>
<td>0b1011/0xf</td>
<td>0b0100/2</td>
</tr>
</tbody></table>
<p>æ„å»ºçš„binary trieå¦‚ä¸‹ï¼š</p>
<p><a href="/images/binary_tire.svg" title="binary_trie" class="gallery-item" style="box-shadow: none;"> <img src="/images/binary_tire.svg" alt="binary_trie"></a></p>
<p>å¯¹è¯¥ACè§„åˆ™é›†è¿›è¡ŒåŒ¹é…æ—¶ï¼Œä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œæ ¹æ®è¾“å…¥çš„äºŒè¿›åˆ¶ä¸²å†³å®šä¸‹ä¸€ä¸ªéå†çš„å­©å­èŠ‚ç‚¹ï¼Œè‹¥éå†åˆ°å¶å­èŠ‚ç‚¹ï¼Œåˆ™åŒ¹é…æˆåŠŸï¼Œå¦åˆ™åŒ¹é…å¤±è´¥ã€‚</p>
<h3 id="Multi-bit-Trie"><a href="#Multi-bit-Trie" class="headerlink" title="Multi-bit Trie"></a>Multi-bit Trie</h3><p>å®é™…ä½¿ç”¨æ—¶è§„åˆ™é›†çš„è¾“å…¥åŒ¹é…é•¿åº¦æ˜¯ç”±è¾“å…¥ç»„çš„æ•°é‡å†³å®šçš„ï¼Œè€Œå¯¹äºç»å¸¸ä½¿ç”¨çš„ipv4çš„5-tupleæ¥è¯´ï¼Œå…¶è¾“å…¥ç»„æœ‰4ä¸ªï¼Œæ¢ç®—æˆbité•¿åº¦æœ‰104ä½ï¼Œåˆ©ç”¨binary trieå¯¹è¯¥è§„åˆ™é›†è¿›è¡Œæ„å»ºåˆ™æœ€å¤šéœ€è¦ç”³è¯·<code>2^105 - 1</code>ä¸ªèŠ‚ç‚¹ï¼Œå› æ­¤ç›´æ¥é‡‡ç”¨binary trieæ¥æ„å»ºè§„åˆ™é›†æ˜¯ä¸åˆ‡å®é™…çš„ã€‚</p>
<p>Multi-bit trieæ˜¯Binary trieçš„ä¸€ç§æ‰©å±•ï¼Œå…¶è¾¹çš„æƒå€¼å¯ä»¥è¡¨ç¤ºå¤šä¸ªäºŒè¿›åˆ¶ä½ï¼Œå…¶å¯ä»¥è¡¨ç¤ºäºŒè¿›åˆ¶ä½çš„ä¸ªæ•°ç§°ä¸º<strong>æ­¥é•¿</strong>ï¼Œæ¯”å¦‚Binary trieçš„æ­¥é•¿ä¸º1ï¼Œåœ¨dpdkä¸­åˆ™é‡‡ç”¨æ­¥é•¿ä¸º8çš„Multi-bit trieã€‚ç›¸æ¯”äºBinary trieï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå¯ä»¥æœ‰2^8æ¡å‡ºè¾¹ï¼Œä¸”æ ‘çš„é«˜åº¦æ”¹ä¸ºç”±åŒ¹é…é•¿åº¦çš„å­—èŠ‚æ•°è€Œéæ¯”ç‰¹æ•°å†³å®šã€‚è¿™æ ·åšå¯¹å†…éƒ¨èŠ‚ç‚¹ä¼šæœ‰äº›è®¸çš„å‡å°‘ï¼Œä½†æ•´ä½“ä¸Šå¯¹äºå†…å­˜çš„æ¶ˆè€—è¿˜æ˜¯ä¸å¯ä¼°é‡çš„ã€‚ä½¿å¾—Multi-bit trieç›¸æ¯”äºBinary trieæ›´åŠ å®ç”¨çš„åŸå› åœ¨äºï¼ŒMulti-bit trieçš„è¾¹ä¸ä»…å¯ä»¥è¡¨ç¤ºä¸€ä¸ªå€¼ï¼Œè€Œä¸”å¯ä»¥è¡¨ç¤ºä¸€ä¸ªé›†åˆï¼Œè¿™ä½¿å¾—æ„å»ºtrieæ‰€éœ€çš„èŠ‚ç‚¹å¤§å¤§å‡å°‘ã€‚</p>
<h4 id="Multi-bit-trieä¼˜åŒ–"><a href="#Multi-bit-trieä¼˜åŒ–" class="headerlink" title="Multi-bit trieä¼˜åŒ–"></a>Multi-bit trieä¼˜åŒ–</h4><p>ç”±äºfield0çš„ç‰¹æ®Šæ€§ï¼ˆåŒ¹é…ä¸Šä¸‹æ–‡åˆå§‹åŒ–æ—¶å›ºå®šè¯»å–<code>input_indexï¼š0</code>ä½œä¸ºåˆå§‹çŠ¶æ€ï¼‰ï¼Œä¸‹åˆ—ä¼˜åŒ–ä¸è€ƒè™‘è§„åˆ™çš„field0ã€‚</p>
<h5 id="ä¼˜åŒ–1"><a href="#ä¼˜åŒ–1" class="headerlink" title="ä¼˜åŒ–1"></a>ä¼˜åŒ–1</h5><p>ç»Ÿè®¡è§„åˆ™é›†ä¸­æ¯æ¡è§„åˆ™ä¸­æ¯ä¸ªfieldçš„åŒ¹é…èŒƒå›´ä¸è¯¥fieldå–å€¼èŒƒå›´ä¹‹æ¯”ï¼ˆä»£ç ä¸­é‡‡ç”¨wildnessç™¾åˆ†åˆ¶è¡¨ç¤ºï¼‰ã€‚å¯¹äºè¯¥è§„åˆ™é›†ä¸­æ‰€æœ‰è§„åˆ™æ¥è¯´ï¼Œè‹¥å­˜åœ¨æŸä¸ªinput_indexï¼Œå…¶å¯¹åº”çš„fieldçš„wildnesså‡ä¸º100ï¼Œåˆ™è¯´æ˜å¯¹äºè¯¥è§„åˆ™é›†ï¼Œæ— è®ºè¯¥input_indexæ‰€å¯¹åº”çš„è¾“å…¥æ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸€å®šå‘½ä¸­è¯¥è§„åˆ™é›†ä¸­æ‰€æœ‰çš„è§„åˆ™ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨æ„å»ºtrieæ—¶ï¼Œå¯ä»¥ä¸åŠ è½½è¯¥input_indexæ‰€å±çš„fieldï¼ŒåŒæ—¶åŒ¹é…æ—¶ä¹Ÿè·³è¿‡å¯¹è¯¥input_indexçš„è¯»å–ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<table>
<thead>
<tr>
<th>è§„åˆ™</th>
<th>field0ï¼ˆinput_indexï¼š0ï¼‰</th>
<th>field1ï¼ˆinput_indexï¼š1ï¼‰</th>
<th>field2ï¼ˆinput_indexï¼š1ï¼‰</th>
<th>field3ï¼ˆinput_indexï¼š2ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>rule1</td>
<td>0x07/0xff</td>
<td>0x0000~0xffff</td>
<td>0x0000~0xffff</td>
<td>0xf3000000/24</td>
</tr>
<tr>
<td>rule2</td>
<td>0x12/0xff</td>
<td>0x0000~0xffff</td>
<td>0x0000~0xffff</td>
<td>0x5932a124/24</td>
</tr>
<tr>
<td>rule3</td>
<td>0x12/0xff</td>
<td>0x0000~0xffff</td>
<td>0x0000~0xffff</td>
<td>0x12341355/8</td>
</tr>
</tbody></table>
<p>åœ¨è¯¥è§„åˆ™é›†ä¸­ï¼Œæ‰€æœ‰è§„åˆ™çš„<code>input_indexï¼š1</code>çš„wildnesséƒ½ä¸º100ï¼Œè¿™æ—¶æ„å»ºtrieæ—¶ï¼Œå°±å¯ä»¥å¿½ç•¥è§„åˆ™ä¸­çš„<code>field1</code>å’Œ<code>field2</code>äº†ã€‚åŒæ—¶åŒ¹é…æ—¶è·³è¿‡å¯¹<code>input_indexï¼š1</code>çš„åŒ¹é…ã€‚</p>
<h5 id="ä¼˜åŒ–2"><a href="#ä¼˜åŒ–2" class="headerlink" title="ä¼˜åŒ–2"></a>ä¼˜åŒ–2</h5><p>å°†è§„åˆ™æŒ‰ç…§wildnessè¿›è¡Œæ’åºï¼Œæ„å»ºtrieæ—¶ä¼˜å…ˆæ·»åŠ wildnesså€¼å¤§çš„è§„åˆ™åˆ°æ ‘ä¸­ã€‚ï¼ˆæš‚æ—¶è¿˜æ²¡ç ”ç©¶æ˜ç™½ï¼‰</p>
<h5 id="ä¼˜åŒ–3"><a href="#ä¼˜åŒ–3" class="headerlink" title="ä¼˜åŒ–3"></a>ä¼˜åŒ–3</h5><p>æ ¹æ®è§„åˆ™é›†è§„åˆ™åŠ è½½æƒ…å†µï¼ŒåŠ¨æ€å¢åŠ æ„å»ºçš„trieçš„æ•°ç›®ï¼Œæœ€å¤šå¯æ„å»º8é¢—trieã€‚è¿™æ ·åšå‡å°‘äº†æ„å»ºtrieæ—¶æ€»ä½“çš„å†…å­˜å ç”¨ï¼Œä½†å¢åŠ äº†æ„å»ºæ—¶é—´ã€‚</p>
<h5 id="ä¼˜åŒ–4"><a href="#ä¼˜åŒ–4" class="headerlink" title="ä¼˜åŒ–4"></a>ä¼˜åŒ–4</h5><p>å¯¹äºæ¯æ¡è§„åˆ™ï¼Œæ¯ä¸ªfieldåªåˆ›å»ºä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºåŒ¹é…æˆåŠŸçš„æ ‡å¿—ã€‚è¿™æ ·åšè¿›ä¸€æ­¥å‡å°‘äº†å†…å­˜çš„å ç”¨ã€‚</p>
<h4 id="Multi-bit-trieæ„å»ºæµç¨‹"><a href="#Multi-bit-trieæ„å»ºæµç¨‹" class="headerlink" title="Multi-bit trieæ„å»ºæµç¨‹"></a>Multi-bit trieæ„å»ºæµç¨‹</h4><p>è¯»å–è§„åˆ™é›†ä¸­çš„è§„åˆ™ï¼Œå°†æ¯æ¡è§„åˆ™éƒ½æ„å»ºæˆä¸€é¢—trieå­æ ‘ï¼Œå¹¶å°†æ¯é¢—å­æ ‘åˆå¹¶åˆ°trieçš„æ ¹èŠ‚ç‚¹ä¸­ã€‚èŠ‚ç‚¹æ˜¯trieçš„ä¸»è¦æ•°æ®ç»“æ„ï¼Œå…¶æˆå‘˜å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_node</span> {</span></span><br><span class="line">	<span class="type">uint64_t</span> node_index;  <span class="comment">/* index for this node */</span></span><br><span class="line">	<span class="type">uint32_t</span> level;       <span class="comment">/* level 0-n in the trie */</span></span><br><span class="line">    <span class="comment">//åˆå§‹ä¸º1ï¼Œæ¯æœ‰ä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘è¯¥èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹çš„å¼•ç”¨è®¡æ•°å°±åŠ 1</span></span><br><span class="line">	<span class="type">uint32_t</span> ref_count;   <span class="comment">/* ref count for this node */</span></span><br><span class="line">    <span class="comment">//æ‰€æœ‰å‡ºè¾¹çš„è¾¹æƒå€¼çš„é›†åˆï¼Œbitmapè¡¨ç¤º</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_bitset</span>  <span class="title">values</span>;</span></span><br><span class="line">	<span class="comment">/* set of all values that map to another node</span></span><br><span class="line"><span class="comment">	 * (union of bits in each transition.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">    <span class="comment">//å‡ºè¾¹ä¸ªæ•°</span></span><br><span class="line">	<span class="type">uint32_t</span>                num_ptrs; <span class="comment">/* number of ptr_set in use */</span></span><br><span class="line">    <span class="comment">//å‡ºè¾¹æ•°ç»„å¤§å°</span></span><br><span class="line">	<span class="type">uint32_t</span>                max_ptrs; <span class="comment">/* number of allocated ptr_set */</span></span><br><span class="line">    <span class="comment">//merge nodeæ—¶ä½¿ç”¨ï¼Œèµ·éš”ç¦»ä½œç”¨ã€‚</span></span><br><span class="line">	<span class="type">uint32_t</span>                min_add;  <span class="comment">/* number of ptr_set per allocation */</span></span><br><span class="line">    <span class="comment">//å‡ºè¾¹æ•°ç»„</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_ptr_set</span> *<span class="title">ptrs</span>;</span>     <span class="comment">/* transitions array for this node */</span></span><br><span class="line">    <span class="comment">//é0è¡¨ç¤ºè¯¥èŠ‚ç‚¹å‘½ä¸­è§„åˆ™</span></span><br><span class="line">	<span class="type">int32_t</span>                 match_flag;</span><br><span class="line">	<span class="type">int32_t</span>                 match_index; <span class="comment">/* index to match data */</span></span><br><span class="line">	<span class="type">uint32_t</span>                node_type;</span><br><span class="line">	<span class="type">int32_t</span>                 fanout;</span><br><span class="line">	<span class="comment">/* number of ranges (transitions w/ consecutive bits) */</span></span><br><span class="line">	<span class="type">int32_t</span>                 id;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_match_results</span> *<span class="title">mrt</span>;</span> <span class="comment">/* only valid when match_flag != 0 */</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">		<span class="type">char</span>            transitions[RTE_ACL_QUAD_SIZE];</span><br><span class="line">		<span class="comment">/* boundaries for ranged node */</span></span><br><span class="line">		<span class="type">uint8_t</span>         dfa_gr64[RTE_ACL_DFA_GR64_NUM];</span><br><span class="line">	};</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_node</span>     *<span class="title">next</span>;</span></span><br><span class="line">	<span class="comment">/* free list link or pointer to duplicate node during merge */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_acl_node</span>     *<span class="title">prev</span>;</span></span><br><span class="line">	<span class="comment">/* points to node from which this node was duplicated */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>



<h5 id="è§„åˆ™çš„æ„å»º"><a href="#è§„åˆ™çš„æ„å»º" class="headerlink" title="è§„åˆ™çš„æ„å»º"></a>è§„åˆ™çš„æ„å»º</h5><p>å¯¹äºæ¯æ¡è§„åˆ™ï¼Œæ ¹æ®è§„åˆ™åŸŸçš„å®šä¹‰ï¼ŒæŒ‰é¡ºåºå°†è§„åˆ™ä¸­çš„æ¯ä¸ªfieldè½¬ä¸ºnodeèŠ‚ç‚¹ã€‚å¯¹äºsizeä¸ºå¤šä¸ªå­—èŠ‚çš„fieldï¼Œå…ˆè½¬åŒ–fieldä¸­çš„é«˜å­—èŠ‚ã€‚</p>
<p>å¯¹äºä¸åŒç±»å‹çš„è§„åˆ™åŸŸï¼Œå…¶è½¬åŒ–nodeçš„æ–¹å¼ä¹Ÿæœ‰æ‰€ä¸åŒï¼š</p>
<ul>
<li>MASKï¼š0x83240000/16</li>
</ul>
<p><a href="/images/mask.svg" title="mask" class="gallery-item" style="box-shadow: none;"> <img src="/images/mask.svg" alt="mask"></a></p>
<ul>
<li>BITMASKï¼š0x07/0xff</li>
</ul>
<p><a href="/images/bitmask.svg" title="bitmask" class="gallery-item" style="box-shadow: none;"> <img src="/images/bitmask.svg" alt="bitmask"></a></p>
<ul>
<li>RANGEï¼š0x0012~0x0855</li>
</ul>
<p><a href="/images/range.svg" title="range" class="gallery-item" style="box-shadow: none;"> <img src="/images/range.svg" alt="range"></a></p>
<p>å°†è§„åˆ™ä¸­çš„æ¯ä¸ªfieldæ‰€ç”Ÿæˆçš„èŠ‚ç‚¹é¦–å°¾ç›¸æ¥ï¼Œå³å°†field0çš„endä½œä¸ºfield1çš„node0ã€‚æœ€åæ„æˆä¸€é¢—trieå­æ ‘ï¼Œè¯¥å­æ ‘çš„æ ‘æ ¹ä¸ºfield0çš„node0èŠ‚ç‚¹ï¼Œå¶èŠ‚ç‚¹ä¸ºfieldnçš„endï¼Œè¯¥endåŒæ—¶ä¹Ÿä»£è¡¨ç€è¯¥è§„åˆ™çš„å‘½ä¸­ã€‚</p>
<h5 id="è§„åˆ™é›†çš„æ„å»º"><a href="#è§„åˆ™é›†çš„æ„å»º" class="headerlink" title="è§„åˆ™é›†çš„æ„å»º"></a>è§„åˆ™é›†çš„æ„å»º</h5><p>ä¸ºMulti-bit trieåˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹rootï¼Œè€Œåå°†æ¯æ¡è§„åˆ™ç”Ÿæˆçš„trieå­æ ‘åˆå¹¶åˆ°rootä¸­ã€‚</p>
<p>åˆå¹¶Aã€BèŠ‚ç‚¹çš„ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>è‹¥å¾…åˆå¹¶çš„èŠ‚ç‚¹ä¸ºå¶å­èŠ‚ç‚¹ï¼Œåˆ™å°†Aã€BèŠ‚ç‚¹åˆå¹¶ä¸ºæ–°çš„èŠ‚ç‚¹ï¼Œæ–°çš„èŠ‚ç‚¹ä¸­ä¿ç•™Aã€Bä¸­å„categoriesä¸­priorityæœ€é«˜çš„userdataå¹¶è¿”å›ã€‚</p>
</li>
<li><p>è‹¥Aã€Bçš„å‡ºè¾¹å­˜åœ¨äº¤é›†ï¼Œåˆ™å¤„ç†äº¤é›†éƒ¨åˆ†ã€‚</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> childa <span class="keyword">in</span> Açš„å‡ºè¾¹ï¼š</span><br><span class="line">    <span class="keyword">for</span> childb <span class="keyword">in</span> Bçš„å‡ºè¾¹ï¼š</span><br><span class="line">        <span class="keyword">if</span> childaçš„èŠ‚ç‚¹ != childbçš„èŠ‚ç‚¹ï¼š</span><br><span class="line">            <span class="keyword">if</span> childaä¸childbçš„è¾¹æƒå€¼å­˜åœ¨äº¤é›†ï¼š</span><br><span class="line">                node = merge(childaèŠ‚ç‚¹å’ŒchildbèŠ‚ç‚¹)</span><br><span class="line">                å°†childaä¸childbçš„äº¤é›†æ‰€æŒ‡å‘çš„èŠ‚ç‚¹æ›´æ–°ä¸ºnode</span><br></pre></td></tr></table></figure>
</li>
<li><p>å°†åªåŒ…å«åœ¨Bä¸­çš„å‡ºè¾¹åŠå…¶å‡ºè¾¹èŠ‚ç‚¹æ›´æ–°åˆ°AèŠ‚ç‚¹ä¸­ã€‚</p>
</li>
</ol>
<p>åœ¨å®é™…çš„ä»£ç å®ç°è¿‡ç¨‹ä¸­ï¼Œè¿˜æ¶‰åŠåˆ°èŠ‚ç‚¹çš„å¤åˆ¶ç­‰æ“ä½œï¼Œå› ä¸ºä¸å½±å“æ•´ä½“çš„åˆå¹¶æµç¨‹ï¼Œè¿™é‡Œçœç•¥ç›¸å…³é€»è¾‘ã€‚</p>
<p>ä¾‹å¦‚ï¼šè§„åˆ™é›†ä»…ä½¿ç”¨ä¸€ä¸ªç±»åˆ«ï¼Œä¸”rule1çš„priorityä¸º100ï¼Œrule2çš„priorityä¸º50ã€‚</p>
<table>
<thead>
<tr>
<th>è§„åˆ™</th>
<th>field0ï¼ˆinput_indexï¼š0ï¼‰</th>
<th>field1ï¼ˆinput_indexï¼š1ï¼‰</th>
<th>field2ï¼ˆinput_indexï¼š1ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>rule1</td>
<td>0x07/0xff</td>
<td>0x0000~0xf000</td>
<td>0x0000/8</td>
</tr>
<tr>
<td>rule2</td>
<td>0x07/0xff</td>
<td>0x8000~0xffff</td>
<td>0x0000/8</td>
</tr>
</tbody></table>
<p>rule1åˆå¹¶åˆ°trieä¸­ï¼š</p>
<p><a href="/images/merge1.svg" title="merge1" class="gallery-item" style="box-shadow: none;"> <img src="/images/merge1.svg" alt="merge1"></a></p>
<p>rule2åˆå¹¶åˆ°trieä¸­ï¼š</p>
<p><a href="/images/merge2.svg" title="merge2" class="gallery-item" style="box-shadow: none;"> <img src="/images/merge2.svg" alt="merge2"></a></p>
<h3 id="Node-array"><a href="#Node-array" class="headerlink" title="Node_array"></a>Node_array</h3><p>Multi-bit trieå¾ˆå¥½çš„ç»„ç»‡äº†åŒ¹é…è¿‡ç¨‹ä¸­å„çŠ¶æ€ä¹‹é—´çš„å…³ç³»ï¼Œä¸ºäº†è¿›ä¸€æ­¥çš„å‡å°‘å†…å­˜æ¶ˆè€—ï¼Œæé«˜åŒ¹é…æ€§èƒ½ã€‚è¿™é‡Œå°†æ„å»ºå¥½çš„trieè§†ä¸ºDFA(Deterministic Finite Automation)ï¼Œå°†çŠ¶æ€è½¬ç§»ç”±æŒ‡é’ˆæ–¹å¼è½¬ä¸ºç´¢å¼•æ–¹å¼ï¼Œå¹¶å­˜æ”¾åˆ°node_arrayä¸­ã€‚åŒ¹é…æ—¶å°±ä¼šåŸºäºè¾“å…¥æ•°æ®å’Œå½“å‰æ‰€å¤„çš„çŠ¶æ€ï¼Œè®¡ç®—ä¸‹ä¸€ä¸ªçŠ¶æ€åœ¨node_arrayä¸­çš„åç§»ã€‚</p>
<p>node_arrayä¸­å­˜å‚¨ç€çš„nodeå…ƒç´ è¢«ç§°ä¸ºtransitionï¼Œtransitionæ˜¯ç”±64ä½äºŒè¿›åˆ¶æ•°ç»„æˆï¼Œå†…éƒ¨å­˜å‚¨ç€å½“å‰åŒ¹é…çŠ¶æ€å’ŒçŠ¶æ€è½¬ç§»æ¡ä»¶ï¼Œå…¶æ ¼å¼å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th>node_type_specific : 32</th>
<th>node_type : 3</th>
<th>node_addr : 29</th>
</tr>
</thead>
</table>
<ul>
<li><p>node_typeï¼šèŠ‚ç‚¹ç±»å‹ï¼Œæ ¹æ®å‡ºè¾¹çŠ¶æ€çš„æ•°é‡ï¼Œå®šä¹‰ä¸åŒçš„ç±»å‹ã€‚</p>
<ol>
<li>RTE_ACL_NODE_DFAï¼šå‡ºè¾¹è¾ƒå¤šçš„èŠ‚ç‚¹ï¼Œå…¶å‡ºè¾¹çŠ¶æ€æ•°é‡å¤§äº5ä¸ªæ—¶å®šä¹‰è¯¥ç±»å‹ï¼Œä¸ºäº†èŠ‚çœç©ºé—´ï¼Œå°†æ‰€æœ‰å‡ºè¾¹çŠ¶æ€åˆ’åˆ†ä¸º4ä¸ªç»„ï¼Œæ¯ç»„64ä¸ªå‡ºè¾¹çŠ¶æ€ã€‚ç¬¬iç»„åŒ…å«çŠ¶æ€[i * 64 â€¦ i * 64 + 63]ã€‚è‹¥ç¬¬jç»„çŠ¶æ€ä¸ç¬¬iç»„çŠ¶æ€ç›¸åŒï¼ˆj &gt; iï¼‰ï¼Œåˆ™åˆ é™¤ç¬¬jç»„çš„å‡ºè¾¹ã€‚</li>
<li>RTE_ACL_NODE_QRANGEï¼šå‡ºè¾¹è¾ƒå°‘çš„èŠ‚ç‚¹ï¼Œå…¶å‡ºè¾¹çŠ¶æ€æ•°é‡å°äºç­‰äº5ä¸ªæ—¶å®šä¹‰è¯¥ç±»å‹</li>
<li>RTE_ACL_NODE_SINGLEï¼šè‹¥å‡ºè¾¹ä»…ä¸ºä¸€æ¡æ—¶ï¼ˆä¹Ÿå°±æ˜¯æ— è®ºè¾“å…¥æ•°æ®ä¸ºä½•å€¼ï¼Œéƒ½åªä¼šå‘åŒä¸€ä¸ªçŠ¶æ€è¿ç§»ï¼‰å®šä¹‰è¯¥ç±»å‹</li>
<li>RTE_ACL_NODE_MATCHï¼šä¸å­˜åœ¨å‡ºè¾¹æ—¶ï¼ˆä¹Ÿå°±æ˜¯è¯¥çŠ¶æ€ä¸ºç»ˆæ­¢çŠ¶æ€ï¼‰å®šä¹‰è¯¥ç±»å‹</li>
</ol>
</li>
<li><p>node_addrï¼šæ ¹æ®node_typeï¼Œå…·æœ‰ä¸åŒçš„å«ä¹‰</p>
<ol>
<li>RTE_ACL_NODE_MATCHï¼šæ­¤æ—¶è¯¥å­—æ®µçš„å€¼æŒ‡å‘ç€è¿”å›æ•°ç»„ï¼Œæ•°ç»„å†…å­˜å‚¨ç€æ‰€å‘½ä¸­è§„åˆ™çš„æ¯ä¸ªç±»åˆ«çš„priorityå’Œuserdata</li>
<li>éRTE_ACL_NODE_MATCHï¼šæŒ‡å‘ç€ä¸‹ä¸€ä¸ªtransitionçš„åŸºåœ°å€</li>
</ol>
</li>
<li><p>node_type_specificï¼šæ ¹æ®node_typeï¼Œå…·æœ‰ä¸åŒçš„å«ä¹‰</p>
<ol>
<li><p>RTE_ACL_NODE_MATCHï¼šè¯¥å­—æ®µä¸è¢«ä½¿ç”¨</p>
</li>
<li><p>RTE_ACL_NODE_QRANGEï¼šç”¨äºçŠ¶æ€è½¬ç§»è®¡ç®—ï¼Œè¢«è§£é‡Šä¸º4ä¸ªint8_tç±»å‹çš„å€¼ï¼Œä»INT8_MINåˆ°INT8_MAXï¼Œè¿™4ä¸ªæ•°å†³å®šäº†è¯¥ç±»å‹æœ€å¤šæ‹¥æœ‰5ä¸ªå‡ºè¾¹çŠ¶æ€</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">INT8_MIN &lt;= range[<span class="number">0</span>]  &lt;= ((<span class="type">int8_t</span> *)&amp;transition)[<span class="number">4</span>]</span><br><span class="line">((<span class="type">int8_t</span> *)&amp;transition)[<span class="number">4</span>] &lt; range[<span class="number">1</span>] &lt;= ((<span class="type">int8_t</span> *)&amp;transition)[<span class="number">5</span>]</span><br><span class="line">((<span class="type">int8_t</span> *)&amp;transition)[<span class="number">5</span>] &lt; range[<span class="number">2</span>] &lt;= ((<span class="type">int8_t</span> *)&amp;transition)[<span class="number">6</span>]</span><br><span class="line">((<span class="type">int8_t</span> *)&amp;transition)[<span class="number">6</span>] &lt; range[<span class="number">3</span>] &lt;= ((<span class="type">int8_t</span> *)&amp;transition)[<span class="number">7</span>]</span><br><span class="line">((<span class="type">int8_t</span> *)&amp;transition)[<span class="number">7</span>] &lt; range[<span class="number">4</span>] &lt;= INT8_MAX</span><br></pre></td></tr></table></figure>

<p> å¯¹äºå¤„äºrange[i]èŒƒå›´å†…çš„è¾“å…¥æ•°æ®ï¼Œå¯è®¡ç®—å‡ºè¦è¿ç§»çš„ä¸‹ä¸€ä¸ªçŠ¶æ€çš„node_arrayç´¢å¼•ä¸ºï¼š<code>node_addr + i</code></p>
</li>
<li><p>RTE_ACL_NODE_DFAï¼šç”¨äºçŠ¶æ€è½¬ç§»è®¡ç®—ï¼Œè¢«è§£é‡Šä¸º4ä¸ªuint8_tç±»å‹çš„å€¼ï¼Œæ¯ä¸ªä½ç½®å¯¹åº”ä¸€ä¸ªç»„ï¼Œæ¯ä¸ªä½ç½®çš„æ•°ä»£è¡¨äº†è¯¥ç»„å‡ºè¾¹ç´¢å¼•ã€‚å¯¹äºç»™å®šçš„è¾“å…¥æ•°æ®ï¼Œå¯è®¡ç®—å‡ºè¦è¿ç§»çš„ä¸‹ä¸€ä¸ªçŠ¶æ€çš„node_arrayç´¢å¼•ä¸ºï¼š</p>
<p> <code>input_byte - ((uint8_t *)&amp;transition)[4 + input_byte / 64]</code></p>
</li>
</ol>
</li>
</ul>
<p>å¯¹äºnodeå‡ºè¾¹çŠ¶æ€çš„æ•°é‡çš„ç¡®å®šæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>è®¡ç®—trie nodeçš„valuesï¼ˆbitmapï¼‰ä¸­è¿ç»­ä¸º0çš„åŒºé—´æ•°</li>
<li>è®¡ç®—trie nodeçš„å„ä¸ªå‡ºè¾¹valuesï¼ˆbitmapï¼‰ä¸­è¿ç»­ä¸º1çš„åŒºé—´æ•°</li>
<li>å°†ä¸Šè¿°ç»“æœç›¸åŠ å³ä¸ºå‡ºè¾¹çŠ¶æ€æ•°ï¼ˆå¯¹åº”trie nodeç»“æ„ä¸­çš„fanoutå€¼ï¼‰</li>
</ol>
<h3 id="RT-Structure"><a href="#RT-Structure" class="headerlink" title="RT Structure"></a>RT Structure</h3><p>æœ€ç»ˆè§„åˆ™é›†æ‰€æ„å»ºçš„ç”¨äºåŒ¹é…çš„RT(runtime) Structureçš„å†…å­˜å¸ƒå±€å¦‚ä¸‹ï¼š</p>
<p><a href="/images/rtstruct.webp" title="rtstruct" class="gallery-item" style="box-shadow: none;"> <img src="/images/rtstruct.webp" alt="rtstruct"></a></p>
<ul>
<li>Data indexesï¼šä¿å­˜ç€æ‰€æœ‰è¾“å…¥ç»„æ‰€å¯¹åº”çš„è¾“å…¥ç¼“å†²åŒºçš„åç§»ï¼ŒåŒ¹é…æ—¶ä½¿ç”¨è¯¥å­—æ®µç¡®å®šå¾…åŒ¹é…çš„è¾“å…¥æ•°æ®çš„ä½ç½®</li>
<li>Resultsï¼šä¿å­˜ç€æ‰€æœ‰çš„è¿”å›æ•°æ®ï¼Œå½“å‘½ä¸­è§„åˆ™æ—¶è®¿é—®è¯¥æ•°ç»„å¹¶è¿”å›åŒ¹é…ç»“æœ</li>
<li>Trans tableï¼šè½¬ç§»çŸ©é˜µï¼Œç”¨äºåŒ¹é…æ—¶çš„çŠ¶æ€è·³è½¬ã€‚DFA0ç”¨äºæ„é€ å¤±æ•ˆèŠ‚ç‚¹ï¼Œå› ä¸ºæ¯åŒ¹é…ä¸€ä¸ªè¾“å…¥ç»„ï¼ˆ4ä¸ªå­—èŠ‚ï¼‰åæ‰ä¼šåˆ¤æ–­å½“å‰çŠ¶æ€æ˜¯å¦ä¸ºç»ˆæ­¢çŠ¶æ€ã€‚è‹¥åœ¨åŒ¹é…æ—¶æå‰è¿›å…¥äº†åŒ¹é…å¤±æ•ˆçŠ¶æ€ï¼Œåˆ™åœ¨åšçŠ¶æ€è½¬ç§»æ—¶ä¼šè·³åˆ°DFA0å†…ï¼Œç›´åˆ°å½“å‰è¾“å…¥ç»„åŒ¹é…å®Œæ¯•åå†è¿›è¡Œå¤±æ•ˆçŠ¶æ€å¤„ç†ã€‚idleèŠ‚ç‚¹ç”¨äºç©ºè½¬ï¼Œå½“æ²¡æœ‰é¢å¤–çš„è¾“å…¥æ•°æ®éœ€è¦å¤„ç†æ—¶ï¼Œè·³åˆ°è¯¥èŠ‚ç‚¹åšç©ºè½¬å¤„ç†ã€‚DFAsã€QUADsã€SINGLEså³ä¸ºtrieæ ‘ä¸­ä¾æ®nodeçš„ä¸åŒtypeå¯¹åº”çš„arrayæ¨¡å¼</li>
</ul>
<h3 id="åŒ¹é…ç®—æ³•"><a href="#åŒ¹é…ç®—æ³•" class="headerlink" title="åŒ¹é…ç®—æ³•"></a>åŒ¹é…ç®—æ³•</h3><p>å¯¹äºRTE_ACL_NODE_SINGLEå’ŒRTE_ACL_NODE_QRANGEç±»å‹çš„èŠ‚ç‚¹ï¼Œå…¶çŠ¶æ€è½¬æ¢å‡½æ•°å¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">c = (<span class="type">uint32_t</span>)input * SCALAR_QRANGE_MULT;</span><br><span class="line">a = ranges | SCALAR_QRANGE_MIN;</span><br><span class="line">a -= (c &amp; SCALAR_QRANGE_MASK);</span><br><span class="line">b = c &amp; SCALAR_QRANGE_MIN;</span><br><span class="line">a &amp;= SCALAR_QRANGE_MIN;</span><br><span class="line">a ^= (ranges ^ b) &amp; (a ^ b);</span><br><span class="line">x = scan_forward(a, <span class="number">32</span>) &gt;&gt; <span class="number">3</span>;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç æ˜¯ACLä¸­æœ€ä¸ºæ™¦æ¶©éš¾æ‡‚çš„éƒ¨åˆ†äº†ã€‚ä¸‹é¢ç€é‡è®²è§£ä¸‹è¿™éƒ¨åˆ†ä»£ç çš„å®ç°åŸç†ã€‚</p>
<p>ä»å¯¹RTE_ACL_NODE_QRANGEç±»å‹çš„æ³¨é‡Šå¯ä»¥å¾—çŸ¥ï¼Œrangesä¸­å­˜æ”¾çš„4ä¸ªæ•°å°†æ•´ä¸ªåŒºé—´åˆ’åˆ†ä¸º5ä¸ªéƒ¨åˆ†ï¼Œé€šè¿‡æ¯”è¾ƒè¾“å…¥æ•°æ®ä¸rangesçš„4ä¸ªæ•°å­—çš„å¤§å°ï¼Œå³å¯ç¡®å®šè¾“å…¥æ•°å­—å±äºå“ªä¸ªåŒºé—´ã€‚ä¸Šé¢çš„ä»£ç æ‰€åšçš„ï¼Œå°±æ˜¯å°†inputä¸rangesçš„æ¯ä¸ªæ•°å­—çš„æ¯”è¾ƒç»“æœå­˜æ”¾åœ¨açš„æ¯ä¸ªå­—èŠ‚çš„ç¬¦å·ä½ä¸­ï¼Œè€Œåæ ¹æ®å…¶æ‰€åœ¨çš„å­—èŠ‚ä½ç½®å¾—åˆ°åŒºé—´å·ï¼Œå…¶å¤§è‡´é€»è¾‘å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int8_t</span> a[<span class="number">4</span>] = {<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>};</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) {</span><br><span class="line">    <span class="keyword">if</span>(ranges[i] &gt;= input)</span><br><span class="line">        a[i] = <span class="number">0x80</span>;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">x = (a == <span class="number">0</span>) ? <span class="number">4</span> : (açš„æœ€ä½æœ‰æ•ˆä½ä½æ•° &gt;&gt; <span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>ä¾‹å¦‚ï¼šinput = 0x04ï¼Œranges = 0x3011fe83ï¼Œå¯æ¨å‡ºa = 0x80800000ï¼Œx = 2ï¼Œå³è¾“å…¥å­—èŠ‚å±äºrange[1]~range[2]</p>
<p>ACLä¸­çš„å®ç°é‡‡ç”¨uint32_tç±»å‹çš„å˜é‡ï¼Œé¿å…äº†forå¾ªç¯ã€‚åŒæ—¶åˆ©ç”¨é€»è¾‘è¿ç®—ï¼Œä»£æ›¿äº†if/elseçš„åˆ†æ”¯é€»è¾‘ï¼Œé¿å…cpuå› åˆ†æ”¯é¢„æµ‹å¤±è´¥å¯¼è‡´çš„æµæ°´çº¿åœé¡¿ã€‚</p>
<p>æƒ³è¦ç†è§£ä»£ç ä¸­é€»è¾‘è¿ç®—çš„åŸç†ï¼Œéœ€è¦å…ˆäº†è§£å¯¹äºè¡¥ç æ˜¯å¦‚ä½•æ¯”è¾ƒå¤§å°çš„ï¼š</p>
<ol>
<li>å½“ä¸¤ä¸ªæ•°çš„ç¬¦å·ä½ç›¸åŒæ—¶ï¼Œé™¤å»ç¬¦å·ä½ï¼Œå¤§çš„æ›´å¤§</li>
<li>å½“ä¸¤ä¸ªæ•°çš„ç¬¦å·ä½ä¸åŒæ—¶ï¼Œæ­£æ•°å¤§</li>
</ol>
<p>å®é™…ä¸Šä»£ç ä¸­çš„é€»è¾‘è¿ç®—å°±æ˜¯åˆ©ç”¨ä¸Šè¿°çš„ä¸¤æ¡åŸç†ï¼Œå…·ä½“æ³¨é‡Šå¦‚ä¸‹ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ä¸‹é¢å°†æ‰€æœ‰çš„4å­—èŠ‚çš„å˜é‡çœ‹ä½œ1å­—èŠ‚çš„æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å°†è¾“å…¥æ‰©å±•ä¸º4å­—èŠ‚</span></span><br><span class="line">c = (<span class="type">uint32_t</span>)input * SCALAR_QRANGE_MULT;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è®°å½•cçš„ç¬¦å·ä½</span></span><br><span class="line">b = c &amp; SCALAR_QRANGE_MIN;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å½“c[i]ä¸ranges[i]çš„ç¬¦å·ä½ç›¸åŒæ—¶</span></span><br><span class="line"><span class="comment">//å°†ranges[i]çš„ç¬¦å·ä½ç½®ä¸€ï¼Œc[i]çš„ç¬¦å·ä½ç½®é›¶ï¼Œä¸¤æ•°ç›¸å‡ï¼Œå¹¶å°†ç›¸å‡åçš„ç¬¦å·ä½è®°å½•åˆ°aä¸­</span></span><br><span class="line"><span class="comment">//è‹¥a[i] = 0x80åˆ™è¯´æ˜ranges[i] &gt;= c[i]ï¼Œå¦åˆ™a[i] = 0</span></span><br><span class="line">a = ranges | SCALAR_QRANGE_MIN;</span><br><span class="line">a -= (c &amp; SCALAR_QRANGE_MASK);</span><br><span class="line">a &amp;= SCALAR_QRANGE_MIN;</span><br><span class="line"></span><br><span class="line"><span class="comment">//å½“c[i]ä¸ranges[i]åŒå·æ—¶ï¼Œä¸‹åˆ—è¿ç®—ç¬¦å·ä½åŒ–ç®€ä¸º a[i] ^= 0 &amp; (a[i] ^ b[i]) ==&gt; a[i] = a[i]</span></span><br><span class="line"><span class="comment">//å½“c[i]ä¸ranges[i]å¼‚å·æ—¶ï¼Œä¸‹åˆ—è¿ç®—ç¬¦å·ä½åŒ–ç®€ä¸º a[i] ^= a[i] ^ b[i] ==&gt; a[i] = b[i]</span></span><br><span class="line"><span class="comment">//ç”±äºaå’Œbçš„éç¬¦å·ä½å‡ä¸º0ï¼Œå› æ­¤ä¸‹åˆ—è¿ç®—éç¬¦å·ä½åŒ–ç®€ä¸º a[i] ^= ranges &amp; 0 ==&gt; a[i] = 0</span></span><br><span class="line">a ^= (ranges ^ b) &amp; (a ^ b);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ­¤æ—¶aæ•°ç»„ä¸­æ‰€å‡ºç°çš„ç¬¬ä¸€ä¸ªç¬¦å·ä½ä¸º1çš„æˆå‘˜çš„ç´¢å¼•å·ï¼Œå³ä¸ºæ‰€æ±‚</span></span><br><span class="line">x = scan_forward(a, <span class="number">32</span>) &gt;&gt; <span class="number">3</span>;</span><br></pre></td></tr></table></figure>



<h1 id="EFD-Elastic-Flow-Distributor"><a href="#EFD-Elastic-Flow-Distributor" class="headerlink" title="EFD(Elastic Flow Distributor)"></a>EFD(Elastic Flow Distributor)</h1><p>å¸¸ç”¨äºé›†ç¾¤ä¹‹é—´çš„åˆ†æµ/è´Ÿè½½å‡è¡¡ï¼Œå…¶åŠŸèƒ½ä¸<a href="#Hash">Hash</a>ç±»ä¼¼ï¼Œå»ºç«‹EFDè¡¨å¹¶æ’å…¥&lt;key, value&gt;åˆ°EFDè¡¨ä¸­ï¼Œè¿è¡Œæ—¶é€šè¿‡keyå€¼æŸ¥æ‰¾EFDè¡¨ï¼Œå¹¶è·å–å¯¹åº”çš„valueï¼Œè‹¥æŸ¥æ‰¾æ—¶çš„keyå€¼æ­¤å‰å¹¶æœªè¢«æ’å…¥åˆ°EFDè¡¨ä¸­ï¼Œåˆ™è¿”å›ä¸€ä¸ªä¼ªéšæœºçš„valueã€‚è¿™é‡Œçš„keyä¸€èˆ¬ä¸ºæµçš„ç‰¹å¾ï¼Œvalueä¸€èˆ¬ä¸ºè¯¥æµæ‰€è¦å¼•å¯¼åˆ°çš„ç›®çš„èŠ‚ç‚¹idå·ã€‚</p>
<p>EFDå†…éƒ¨å­˜å‚¨äº†ä¸¤ä¸ªç±»å‹çš„è¡¨ï¼š</p>
<ul>
<li>online table(in cache)ï¼šç”¨äºé¢‘ç¹çš„æŸ¥æ‰¾æ“ä½œï¼Œå†…å­˜å¼€é”€å°ã€‚</li>
<li>offline table(in memory)ï¼šç”¨äºæ’å…¥/æ›´æ–°æ“ä½œï¼Œå­˜å‚¨key/valueï¼Œå†…å­˜å¼€é”€å¤§ã€‚</li>
</ul>
<p>EFDç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ”¯æŒä»»æ„çš„key/valueé•¿åº¦çš„é…ç½®(keyé•¿åº¦é€šè¿‡rte_efd_createé…ç½®ï¼Œvalueé•¿åº¦é€šè¿‡RTE_EFD_VALUE_NUM_BITSé…ç½®)</li>
<li>EFDè¡¨ä¸­ç”¨äºæŸ¥è¯¢çš„è¡¨(online table)ä¸å­˜å‚¨key/valueå€¼ï¼Œå…¶æ‰€éœ€çš„å†…å­˜å¤§å°ä»…ä¸è§„åˆ™æ•°é‡æœ‰å…³(rte_efd_createçš„max_num_ruleså…¥å‚)ï¼Œè¿™ä½¿å¾—å­˜å‚¨éœ€æ±‚ç›¸å¯¹è¾ƒå°ï¼Œå¯æ’å…¥ä¸Šç™¾ä¸‡æ¡è§„åˆ™</li>
<li>ä½¿ç”¨å®Œç¾å“ˆå¸Œæ¥ç¡®å®škeyæ‰€å¯¹åº”çš„valueçš„ä½ç½®ï¼ŒæŸ¥æ‰¾æ€§èƒ½ä¸å—keyé•¿åº¦çš„å½±å“</li>
<li>æ”¯æŒæ‰¹é‡æŸ¥æ‰¾</li>
</ul>
<h2 id="EFDä½¿ç”¨"><a href="#EFDä½¿ç”¨" class="headerlink" title="EFDä½¿ç”¨"></a>EFDä½¿ç”¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//valueçš„äºŒè¿›åˆ¶é•¿åº¦ï¼Œé»˜è®¤ä¸º8ä½ï¼Œç”¨æˆ·å¯è‡ªå®šä¹‰ï¼Œå…¶èŒƒå›´å¿…é¡»åœ¨1~32ä¹‹é—´ã€‚valueçš„æ•°æ®ç±»å‹ä¸ºefd_value_t</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_EFD_VALUE_NUM_BITS (8)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//efdè¡¨åˆ›å»º</span></span><br><span class="line"><span class="keyword">struct</span> rte_efd_table *</span><br><span class="line"><span class="title function_">rte_efd_create</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">uint32_t</span> max_num_rules, <span class="type">uint32_t</span> key_len,</span></span><br><span class="line"><span class="params">	<span class="type">uint64_t</span> online_cpu_socket_bitmask, <span class="comment">//è°ƒç”¨rte_efd_lookupçš„çº¿ç¨‹æ‰€åœ¨çš„socketçš„é›†åˆ</span></span></span><br><span class="line"><span class="params">    <span class="type">uint8_t</span> offline_cpu_socket)</span>;		<span class="comment">//è°ƒç”¨rte_efd_updateçš„çº¿ç¨‹æ‰€åœ¨çš„socket</span></span><br><span class="line"><span class="comment">//efdè¡¨æ’å…¥ï¼Œéçº¿ç¨‹å®‰å…¨å‡½æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_efd_update</span><span class="params">(<span class="keyword">struct</span> rte_efd_table *table, <span class="type">unsigned</span> <span class="type">int</span> socket_id,</span></span><br><span class="line"><span class="params">	<span class="type">const</span> <span class="type">void</span> *key, <span class="type">efd_value_t</span> value)</span>;</span><br><span class="line"><span class="comment">//efdè¡¨æŸ¥è¯¢ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæ‰€æŸ¥æ‰¾çš„keyå¹¶æ²¡æœ‰è¢«æ’å…¥åˆ°efdè¡¨ä¸­ï¼Œæ­¤æ—¶è¿”å›çš„valueä¸ºä¼ªéšæœºæ•°ã€‚</span></span><br><span class="line"><span class="comment">//è‹¥ä¸æƒ³å‡ºç°è¿™ç§æƒ…å†µï¼Œåº”ç”¨ç¨‹åºå¿…é¡»ä»¥æŸç§æ–¹æ³•ä¿è¯ä¼ å…¥çš„keyåœ¨efdè¡¨ä¸­ã€‚</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rte_efd_lookup_bulk</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_efd_table *table, <span class="type">unsigned</span> <span class="type">int</span> socket_id,</span></span><br><span class="line"><span class="params">		<span class="type">int</span> num_keys, <span class="type">const</span> <span class="type">void</span> **key_list,</span></span><br><span class="line"><span class="params">		<span class="type">efd_value_t</span> *value_list)</span>;</span><br></pre></td></tr></table></figure>



<h2 id="EFDåŸç†"><a href="#EFDåŸç†" class="headerlink" title="EFDåŸç†"></a>EFDåŸç†</h2><h3 id="offline-tableçš„æ„å»º"><a href="#offline-tableçš„æ„å»º" class="headerlink" title="offline tableçš„æ„å»º"></a>offline tableçš„æ„å»º</h3><p>åŸºæœ¬æ€æƒ³æ˜¯ï¼šåˆ©ç”¨åŒé‡hashï¼Œæ‰¾åˆ°ä¸€ä¸ªhash_indexï¼Œä½¿å¾—æ‰€ç»™å®šçš„æ’å…¥keyæ»¡è¶³<code>value = hash1(key) + hash_index * hash2(key)</code>ï¼Œè¿™æ ·EFDæŸ¥æ‰¾è¡¨ä¸­ä»…å­˜å‚¨å¯¹åº”çš„hash_indexï¼ŒæŸ¥æ‰¾æ—¶æ ¹æ®æ‰€è¾“å…¥çš„keyå’ŒEFDä¸­çš„hash_indexï¼Œç›´æ¥è¿›è¡Œhashè®¡ç®—å³å¯å¾—åˆ°å¯¹åº”çš„valueã€‚</p>
<p>å½“EFDè¡¨ä¸­ä»…å­˜å‚¨ä¸€ä¸ª&lt;key,value&gt;æ—¶ï¼Œä¸Šè¿°æ–¹æ³•æ˜¯å®Œå…¨å¯è¡Œçš„ï¼Œä½†å½“æ’å…¥çš„è§„åˆ™æ•°å¢åŠ ï¼Œæƒ³æ‰¾åˆ°ä¸€ä¸ªèƒ½æ»¡è¶³æ‰€æœ‰key-valueæ˜ å°„çš„hash_indexï¼Œæ˜¯å‡ ä¹ä¸å¯èƒ½çš„ã€‚å› æ­¤ï¼Œé‡‡ç”¨åˆ†æ²»çš„æ€æƒ³ï¼Œå°†ä¸Šè¿°é—®é¢˜çš„è§„æ¨¡åˆ†è§£ä¸ºæ›´å°çš„éƒ¨åˆ†ã€‚å…·ä½“åˆ†è§£æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li><p>å°†æ‰€æ’å…¥çš„keyåˆ’åˆ†æˆè®¸å¤šçš„groupï¼ˆä»£ç ä¸­é»˜è®¤åˆ†ä¸º64ä¸ªç»„ï¼‰ï¼Œæ¯ä¸ªgroupå¤§çº¦ç”±20~28ä¸ªkeyç»„æˆï¼ˆä»£ç ä¸­é»˜è®¤æ¯ç»„å®¹é‡ä¸º28ä¸ªï¼‰ï¼Œæ¯ä¸ªgroupéƒ½å­˜å‚¨ä¸€ä¸ªè¯¥ç»„çš„hash_indexã€‚è¿™æ ·é€šè¿‡é™åˆ¶key-valueçš„ä¸ªæ•°ï¼Œé™ä½hash_indexæŸ¥æ‰¾çš„éš¾åº¦ã€‚</p>
<p> <a href="/images/efd_i7.svg" title="efd_group" class="gallery-item" style="box-shadow: none;"> <img src="/images/efd_i7.svg" alt="efd_group"></a></p>
</li>
<li><p>å°†valueæŒ‰ä½è€ƒè™‘ï¼Œå³åˆ©ç”¨åŒé‡hashï¼Œæ‰¾åˆ°ä¸€ç»„hash_indexï¼Œä½¿å¾—æ‰€ç»™å®šçš„ä¸€ç»„key-valueéƒ½æ»¡è¶³<code>value[i] = (hash1(key) + hash_index[i] * hash2(key)) &amp; 0x1</code>ã€‚ä¸‹å›¾æ˜¯å¯¹äºgroupå†…value[i]çš„hash_indexçš„ç¡®å®šã€‚</p>
<p> <a href="/images/efd_i4.svg" title="efd_value" class="gallery-item" style="box-shadow: none;"> <img src="/images/efd_i4.svg" alt="efd_value"></a></p>
<blockquote>
<p>æ³¨ï¼šåœ¨è¯¥æ¨¡å—çš„è®²è§£ä¸­ï¼Œ<strong>æ‰€æœ‰çš„value[i]éƒ½è¡¨ç¤ºvalueçš„ç¬¬iä½</strong></p>
</blockquote>
</li>
<li><p>åŸºäº2çš„åˆ†è§£ï¼Œä¸ºäº†è¿›ä¸€æ­¥é™ä½è®¡ç®—valueæ¯ä¸€ä½æ—¶hashå†²çªçš„æ¦‚ç‡ï¼Œå¼•å…¥lookup_tableï¼Œå¯¹äºæ‰€ç»™å®šçš„ä¸€ç»„key-valueéƒ½æ»¡è¶³<code>value[i] = (lookup_table[i] &gt;&gt; bucket_idx) &amp; 0x1</code>ï¼Œå…¶ä¸­<code>bucket_idx = (hash1(key) + hash_index[i] * hash2(key)) &gt;&gt; 28</code>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯¹äºgroupå†…çš„æ¯ä¸ªvalueä½ï¼Œéƒ½å°†åˆ›å»ºä¸€ä¸ª16ä½çš„hash_indexå’Œ16ä½çš„lookup_tableã€‚</p>
<p> <a href="/images/efd_i8.svg" title="lookup_table" class="gallery-item" style="box-shadow: none;"> <img src="/images/efd_i8.svg" alt="lookup_table"></a></p>
</li>
</ol>
<h3 id="hash-indexçš„ç¡®å®š"><a href="#hash-indexçš„ç¡®å®š" class="headerlink" title="hash_indexçš„ç¡®å®š"></a>hash_indexçš„ç¡®å®š</h3><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œgroupå†…åŒ…å«4ä¸ªkey-valueï¼Œå…¶ä¸­valueå›¾ä¸­ä»…ç”»å‡ºç¬¬0ä½ï¼ˆå…¶ä»–ä½åŒç†ï¼‰ã€‚</p>
<p><a href="/images/efd_i10.svg" title="efd_hash_index" class="gallery-item" style="box-shadow: none;"> <img src="/images/efd_i10.svg" alt="efd_hash_index"></a></p>
<ol>
<li>ä»¤<code>hash_index = 0</code>ã€‚</li>
<li>è®¡ç®—å‡ºæ‰€æœ‰keyæ‰€å¯¹åº”çš„bucket_indexï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„positionã€‚</li>
<li>æ¯ä¸ªpositionéƒ½å¯¹åº”lookup_tableä¸­çš„ä¸€ä½ï¼Œå°†æ¯ä¸ªkeyæ‰€å¯¹åº”çš„value[0]éƒ½å†™å…¥lookup_tableçš„positionä½ä¸­ã€‚</li>
<li>è‹¥æœ‰å¤šä¸ªkeyå¯¹åº”åŒä¸€ä¸ªpositionï¼Œä¸”è¿™äº›keyæ‰€å¯¹åº”çš„value[0]çš„å€¼ä¸åŒï¼Œåˆ™å‘ç”Ÿå†²çªã€‚</li>
<li>å‘ç”Ÿå†²çªåä»¤<code>hash_index += 1</code>ï¼Œè¿”å›åˆ°æ­¥éª¤2æ‰§è¡Œï¼Œç›´åˆ°æ²¡æœ‰å†²çªæˆ–è€…è¾¾åˆ°å¾ªç¯ä¸Šé™ã€‚</li>
</ol>
<p>ä¾‹å¦‚ä¸Šå›¾ä¸­çš„key3å’Œkey7ï¼Œç”±äºæ‰€å¯¹åº”çš„value[0]ç›¸åŒï¼Œå³ä½¿ç»è¿‡hashåçš„positionç›¸åŒï¼Œä¹Ÿä¸ä¼šäº§ç”Ÿå†²çªï¼Œè€Œkey4å’Œkey7ï¼Œç”±äºæ‰€å¯¹åº”çš„value[0]ä¸åŒï¼Œåˆ™äº§ç”Ÿhashå†²çªã€‚</p>
<h3 id="chunkçš„å¼•è¿›"><a href="#chunkçš„å¼•è¿›" class="headerlink" title="chunkçš„å¼•è¿›"></a>chunkçš„å¼•è¿›</h3><p>ç”±äºä¸Šé¢çš„æ–¹æ¡ˆä¼šå°†efdè¡¨åˆ†ä¸º64ä¸ªgroupï¼Œæ¯ä¸ªgroupæœ€å¤šåŒ…å«28ä¸ªruleï¼Œè¿™æ ·å°±é™åˆ¶äº†efdè¡¨çš„ä¸Šé™ä¸º64 * 28ä¸ªè§„åˆ™ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé™åˆ¶ï¼Œå¼•å…¥chunkè¿™ä¸ªæ¦‚å¿µï¼Œefdè¡¨ä¸­åŒ…å«å¤šä¸ªchunkï¼Œæ¯ä¸ªchunkåŒ…å«64ä¸ªgroupï¼Œæ¯ä¸ªgroupåŒ…å«28ä¸ªruleã€‚é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œè§£å†³äº†è§„åˆ™æ•°é‡é™åˆ¶çš„é—®é¢˜ã€‚</p>
<p>æ’å…¥key-valueæ—¶å…ˆè¦ç¡®å®škeyæ‰€å±çš„chunkï¼Œå†ç¡®å®šæ‰€å±çš„groupã€‚</p>
<h3 id="æŸ¥æ‰¾æµç¨‹"><a href="#æŸ¥æ‰¾æµç¨‹" class="headerlink" title="æŸ¥æ‰¾æµç¨‹"></a>æŸ¥æ‰¾æµç¨‹</h3><p><a href="/images/efd_i11.svg" title="efd_lookup" class="gallery-item" style="box-shadow: none;"> <img src="/images/efd_i11.svg" alt="efd_lookup"></a></p>
<p>ä¸Šå›¾ä¸­ä»…å±•ç°äº†å¯¹äºkeyæ‰€å¯¹åº”çš„valueçš„ä¸€ä½å€¼çš„è·å–ï¼Œé€šè¿‡ä¸Šè¿°è¿‡ç¨‹çš„å¾ªç¯ï¼Œå¯å¾—åˆ°valueçš„æ‰€æœ‰ä½çš„å€¼ã€‚</p>
<h3 id="ç»„çš„é‡å¹³è¡¡"><a href="#ç»„çš„é‡å¹³è¡¡" class="headerlink" title="ç»„çš„é‡å¹³è¡¡"></a>ç»„çš„é‡å¹³è¡¡</h3><p>ç”±äºå®ç°æ—¶å¯¹groupçš„åˆ’åˆ†å¯èƒ½ä¸å¹³è¡¡ï¼Œå¯¼è‡´æœ‰äº›groupçš„è§„åˆ™å¤šï¼Œæœ‰äº›groupçš„è§„åˆ™å°‘ã€‚é€šå¸¸è§„åˆ™æ’å…¥æ‰€è€—çš„æ—¶é—´ä¼šéšç€groupå†…è§„åˆ™æ•°é‡çš„å¢åŠ è€Œå¢åŠ ï¼Œä¸”è§„åˆ™æ•°è¶Šå¤šï¼Œæ’å…¥å¤±è´¥çš„å¯èƒ½æ€§è¶Šå¤§ã€‚ä¸ºäº†é¿å…è¿™äº›é—®é¢˜ï¼Œå¼•å…¥binsæ¥å¹³è¡¡groupçš„åˆ’åˆ†ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€ä¸ªchunkåŒ…å«256ä¸ªbinï¼Œæ¯ä¸ªbinéƒ½ä¼šæ˜ å°„åˆ°å›ºå®šçš„4ä¸ªgroupã€‚binä¸­å­˜å‚¨ç€2ä½çš„ç´¢å¼•ï¼Œç”¨äºè¡¨ç¤ºå½“å‰biné€‰æ‹©ç¬¬å‡ ä¸ªæ˜ å°„çš„groupã€‚</p>
<p>åœ¨æ’å…¥æ—¶å°†ä¸å†ç›´æ¥è®¡ç®—groupï¼Œè€Œæ˜¯ç›´æ¥è®¡ç®—bin_idï¼Œæ‰¾åˆ°å¯¹åº”çš„binã€‚è‹¥binå½“å‰æ‰€æ˜ å°„çš„groupæ•°é‡è¿‡å¤šï¼Œåˆ™åˆ‡æ¢binä¸­çš„ç´¢å¼•ï¼Œä½¿å…¶æ˜ å°„åˆ°è§„åˆ™æ•°æœ€å°‘çš„groupä¸­ã€‚</p>
<p><a href="/images/efd_i12.svg" title="efd_rebalance" class="gallery-item" style="box-shadow: none;"> <img src="/images/efd_i12.svg" alt="efd_rebalance"></a></p>
<h1 id="Packet-Distributor"><a href="#Packet-Distributor" class="headerlink" title="Packet Distributor"></a>Packet Distributor</h1><p>åŒ…åˆ†å‘åº“ï¼Œè¯¥åº“å°†lcoreåˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>distributor coreï¼šä»ç½‘å¡æ¥æ”¶æŠ¥æ–‡ï¼Œå°†æŠ¥æ–‡åˆ†å‘åˆ°worker coreä¸­ï¼Œå¹¶å›æ”¶worker coreå¤„ç†å¥½çš„æŠ¥æ–‡å‘å¾€ç½‘å¡ã€‚åªèƒ½æœ‰ä¸€ä¸ªlcoreä½œä¸ºdistributor coreã€‚</li>
<li>worker coreï¼šç”¨äºå®é™…çš„æŠ¥æ–‡å¤„ç†ã€‚</li>
</ul>
<blockquote>
<p>distributor coreå’Œworker coreä¸èƒ½ä½¿ç”¨åŒä¸€ä¸ªlcoreã€‚</p>
</blockquote>
<p><a href="/images/packet_distributor2.png" title="distributor" class="gallery-item" style="box-shadow: none;"> <img src="/images/packet_distributor2.png" alt="distributor"></a></p>
<p>æ•°æ®åŒ…ä¸­çš„<code>mbuf-&gt;hash.usr</code>å†³å®šäº†distributorå‘å¾€å“ªä¸ªworkerï¼Œæ¯ä¸ªworkerä¼šå‘distributorå‘ŠçŸ¥è¯¥workeræ­£åœ¨å¤„ç†çš„æŠ¥æ–‡çš„<code>mbuf-&gt;hash.usr</code>ï¼Œdistributoråœ¨æŠ¥æ–‡åˆ†å‘æ—¶ï¼Œä¼šä¼˜å…ˆå°†æŠ¥æ–‡å‘å¾€<code>mbuf-&gt;hash.usr</code>ç›¸åŒçš„workerä¸Š</p>
<p>distributorä¼šå°†æ•°æ®åŒ…ä¸­çš„<code>mbuf-&gt;hash.usr</code>ä½œä¸ºtagï¼Œä¸”workerä¼šè®°å½•å½“å‰æ‰€å¤„ç†çš„æŠ¥æ–‡çš„tagã€‚åœ¨distributoråšæŠ¥æ–‡åˆ†å‘æ—¶ï¼Œè‹¥å­˜åœ¨yä¸å½“å‰æŠ¥æ–‡tagç›¸åŒçš„workerï¼Œåˆ™å°†æŠ¥æ–‡åˆ†å‘åˆ°è¯¥workerä¸Šï¼Œå¦åˆ™åˆ†å‘ç»™æ²¡æœ‰è¯·æ±‚åˆ°æŠ¥æ–‡çš„workerã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ç§åˆ†åŒ…æ–¹æ³•ä¸ä¿è¯åŒä¸€æ¡æµçš„æŠ¥æ–‡ä¸€å®šä¼šå‘å¾€åŒä¸€ä¸ªæ ¸ã€‚ä¾‹å¦‚å½“worker1æ”¶åˆ°tag1çš„æŠ¥æ–‡ï¼Œå¤„ç†å®Œæ¯•åå†æ”¶åˆ°tag2çš„æŠ¥æ–‡ï¼Œæ­¤æ—¶distributoråˆ†å‘tag1çš„æŠ¥æ–‡ï¼Œå¹¶ä¸ä¸€å®šä¼šå°†è¯¥æŠ¥æ–‡å‘å¾€worker1ã€‚</p>
</blockquote>
<h2 id="Distributorçš„ä½¿ç”¨"><a href="#Distributorçš„ä½¿ç”¨" class="headerlink" title="Distributorçš„ä½¿ç”¨"></a>Distributorçš„ä½¿ç”¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//distributorçš„åˆ›å»º</span></span><br><span class="line"><span class="keyword">struct</span> rte_distributor *</span><br><span class="line"><span class="title function_">rte_distributor_create</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">unsigned</span> <span class="type">int</span> socket_id,</span></span><br><span class="line"><span class="params">		<span class="type">unsigned</span> <span class="type">int</span> num_workers,</span></span><br><span class="line"><span class="params">		<span class="type">unsigned</span> <span class="type">int</span> alg_type)</span>;</span><br><span class="line"><span class="comment">//distributor coreè°ƒç”¨ï¼Œç”¨äºåˆ†å‘æŠ¥æ–‡åˆ°worker</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_distributor_process</span><span class="params">(<span class="keyword">struct</span> rte_distributor *d,</span></span><br><span class="line"><span class="params">		<span class="keyword">struct</span> rte_mbuf **mbufs, <span class="type">unsigned</span> <span class="type">int</span> num_mbufs)</span>;</span><br><span class="line"><span class="comment">//distributor coreè°ƒç”¨ï¼Œç”¨äºå›æ”¶worker coreå¤„ç†å®Œæ¯•çš„æŠ¥æ–‡</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_distributor_returned_pkts</span><span class="params">(<span class="keyword">struct</span> rte_distributor *d,</span></span><br><span class="line"><span class="params">		<span class="keyword">struct</span> rte_mbuf **mbufs, <span class="type">unsigned</span> <span class="type">int</span> max_mbufs)</span>;</span><br><span class="line"><span class="comment">//worker coreè°ƒç”¨ï¼Œæ¥æ”¶æŠ¥æ–‡å¹¶è¿”å›å¤„ç†å®Œæ¯•çš„æŠ¥æ–‡</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_distributor_get_pkt</span><span class="params">(<span class="keyword">struct</span> rte_distributor *d,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">int</span> worker_id, <span class="keyword">struct</span> rte_mbuf **pkts,</span></span><br><span class="line"><span class="params">	<span class="keyword">struct</span> rte_mbuf **oldpkt, <span class="type">unsigned</span> <span class="type">int</span> retcount)</span>;</span><br><span class="line"><span class="comment">//worker coreè°ƒç”¨ï¼Œè¿”å›å¤„ç†å®Œæ¯•çš„æŠ¥æ–‡å¹¶å‘ŠçŸ¥distributorè¯¥workerä¸å†æ¥æ”¶æŠ¥æ–‡</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_distributor_return_pkt</span><span class="params">(<span class="keyword">struct</span> rte_distributor *d,</span></span><br><span class="line"><span class="params">	<span class="type">unsigned</span> <span class="type">int</span> worker_id, <span class="keyword">struct</span> rte_mbuf **oldpkt, <span class="type">int</span> num)</span>;</span><br></pre></td></tr></table></figure>



<h1 id="Reorder"><a href="#Reorder" class="headerlink" title="Reorder"></a>Reorder</h1><p>å®ç°å¯¹ä¸€ç»„æŠ¥æ–‡çš„é‡æ’åºï¼Œæ¯”å¦‚ä½¿ç”¨[Packet Distributor](#Packet Distributor)æ—¶ï¼Œdistributor coreå°†é¡ºåºçš„æŠ¥æ–‡åˆ†å‘ç»™workerï¼Œä½†distributorå¹¶ä¸èƒ½ä¿è¯æ‰€å›æ”¶åˆ°çš„æŠ¥æ–‡è¿˜æ˜¯é¡ºåºçš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½¿ç”¨reorderåº“ï¼Œåœ¨distributor coreåˆ†å‘æŠ¥æ–‡ä¹‹å‰ï¼Œä¸ºæ¯ä¸€ä¸ªæŠ¥æ–‡åˆ†é…åºåˆ—å·ï¼Œåœ¨å›æ”¶æ—¶ï¼Œå°†å›æ”¶åˆ°çš„æŠ¥æ–‡äº¤ç»™reorderå¤„ç†ï¼Œreorderä¼šæŒ‰ç…§æŠ¥æ–‡çš„åºåˆ—å·è¿›è¡Œæ’åºï¼Œè¿™æ ·distributorå†ä»reorderå–åˆ°çš„æŠ¥æ–‡å°±æ˜¯é¡ºåºçš„æŠ¥æ–‡ã€‚</p>
<blockquote>
<p>è¯¥åº“ä»…ä¿è¯æ’å…¥åˆ°reorderä¸­çš„æŠ¥æ–‡æŒ‰åºå–å‡ºï¼Œå¹¶ä¸ä¿è¯å–å‡ºæŠ¥æ–‡çš„åºåˆ—å·è¿ç»­</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//reorderåˆ›å»º</span></span><br><span class="line"><span class="keyword">struct</span> rte_reorder_buffer *</span><br><span class="line"><span class="title function_">rte_reorder_create</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="type">unsigned</span> socket_id, <span class="type">unsigned</span> <span class="type">int</span> size)</span>;</span><br><span class="line"><span class="comment">//æŠ¥æ–‡åºåˆ—å·è®¾ç½®</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">rte_reorder_seqn_t</span> *</span><br><span class="line"><span class="title function_">rte_reorder_seqn</span><span class="params">(<span class="keyword">struct</span> rte_mbuf *mbuf)</span></span><br><span class="line"><span class="comment">//reorderæŠ¥æ–‡æ’å…¥</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_reorder_insert</span><span class="params">(<span class="keyword">struct</span> rte_reorder_buffer *b, <span class="keyword">struct</span> rte_mbuf *mbuf)</span>;</span><br><span class="line"><span class="comment">//ä»reorderä¸­å–å‡ºé‡æ’åºåçš„æŠ¥æ–‡</span></span><br><span class="line"><span class="type">unsigned</span> <span class="type">int</span></span><br><span class="line"><span class="title function_">rte_reorder_drain</span><span class="params">(<span class="keyword">struct</span> rte_reorder_buffer *b, <span class="keyword">struct</span> rte_mbuf **mbufs,</span></span><br><span class="line"><span class="params">		<span class="type">unsigned</span> max_mbufs)</span>;</span><br></pre></td></tr></table></figure>



<h1 id="IP-Frag"><a href="#IP-Frag" class="headerlink" title="IP Frag"></a>IP Frag</h1><p>æä¾›ipv4/v6çš„ipåˆ†ç‰‡/é‡ç»„åŠŸèƒ½</p>
<h2 id="Packet-fragmentation"><a href="#Packet-fragmentation" class="headerlink" title="Packet fragmentation"></a>Packet fragmentation</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¾“å…¥æŠ¥æ–‡çš„æŒ‡é’ˆåº”æŒ‡å‘ipå¤´</span></span><br><span class="line"><span class="type">int32_t</span> <span class="title function_">rte_ipv4_fragment_packet</span><span class="params">(<span class="keyword">struct</span> rte_mbuf *pkt_in,</span></span><br><span class="line"><span class="params">			<span class="keyword">struct</span> rte_mbuf **pkts_out,</span></span><br><span class="line"><span class="params">			<span class="type">uint16_t</span> nb_pkts_out, <span class="type">uint16_t</span> mtu_size,</span></span><br><span class="line"><span class="params">			<span class="keyword">struct</span> rte_mempool *pool_direct,</span></span><br><span class="line"><span class="params">			<span class="keyword">struct</span> rte_mempool *pool_indirect)</span>;</span><br></pre></td></tr></table></figure>

<p>å°†pkt_inæ ¹æ®æ‰€è¾“å…¥çš„mtu_sizeï¼ˆipæŠ¥æ–‡æœ€å¤§é•¿åº¦ï¼‰è¿›è¡Œåˆ†ç‰‡ï¼Œåˆ†ç‰‡æŠ¥æ–‡å­˜å‚¨åœ¨pkts_outä¸­ï¼Œå¯¹äºæ‰€åˆ›å»ºçš„åˆ†ç‰‡æŠ¥æ–‡ï¼Œç”±ä»¥ä¸‹ä¸¤ç±»mbufç»„æˆï¼š</p>
<ul>
<li>Direct mbufï¼šå­˜å‚¨ç€è¯¥åˆ†ç‰‡æ‰€å¯¹åº”çš„ipå¤´ã€‚</li>
<li>Indirect mbufï¼šå­˜å‚¨ç€è¯¥åˆ†ç‰‡æ‰€å¯¹åº”çš„æ•°æ®æ®µï¼Œç”±äºæ˜¯é—´æ¥çš„mbufï¼Œå…¶å­˜å‚¨çš„æ•°æ®æ®µæ˜¯é€šè¿‡æŒ‡é’ˆæŒ‡å‘pkt_inå¯¹åº”æ•°æ®æ®µä½ç½®è€Œå®ç°çš„ï¼Œå…å»äº†æ•°æ®æ®µçš„æ‹·è´ã€‚</li>
</ul>
<h2 id="Packet-reassembly"><a href="#Packet-reassembly" class="headerlink" title="Packet reassembly"></a>Packet reassembly</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ipåˆ†ç‰‡è¡¨çš„æ¯ä¸ªentryèƒ½å¤Ÿå­˜å‚¨çš„åˆ†ç‰‡æ•°</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_LIBRTE_IP_FRAG_MAX 8</span></span><br><span class="line"><span class="comment">//ipåˆ†ç‰‡è¡¨åˆ›å»ºï¼Œç”¨äºå­˜å‚¨éœ€è¦é‡ç»„çš„åˆ†ç‰‡æŠ¥æ–‡</span></span><br><span class="line"><span class="keyword">struct</span> rte_ip_frag_tbl * <span class="title function_">rte_ip_frag_table_create</span><span class="params">(<span class="type">uint32_t</span> bucket_num,	<span class="comment">//hashæ¡¶çš„æ•°ç›®</span></span></span><br><span class="line"><span class="params">		<span class="type">uint32_t</span> bucket_entries,	<span class="comment">//æ¯ä¸ªhashæ¡¶å¯å®¹çº³çš„entryçš„æ•°ç›®ï¼ˆç”¨äºè§£å†³hashå†²çªï¼‰</span></span></span><br><span class="line"><span class="params">        <span class="type">uint32_t</span> max_entries,		<span class="comment">//hashè¡¨å¯å®¹çº³çš„æœ€å¤§entryæ•°</span></span></span><br><span class="line"><span class="params">		<span class="type">uint64_t</span> max_cycles,		<span class="comment">//ipåˆ†ç‰‡è¶…æ—¶æ—¶é—´è®¾ç½®</span></span></span><br><span class="line"><span class="params">        <span class="type">int</span> socket_id)</span>;</span><br><span class="line"><span class="comment">//ipåˆ†ç‰‡é‡ç»„ï¼Œéçº¿ç¨‹å®‰å…¨å‡½æ•°</span></span><br><span class="line"><span class="keyword">struct</span> rte_mbuf * <span class="title function_">rte_ipv4_frag_reassemble_packet</span><span class="params">(<span class="keyword">struct</span> rte_ip_frag_tbl *tbl,</span></span><br><span class="line"><span class="params">		<span class="keyword">struct</span> rte_ip_frag_death_row *dr,	<span class="comment">//å­˜æ”¾å¤±æ•ˆçš„ipåˆ†ç‰‡</span></span></span><br><span class="line"><span class="params">		<span class="keyword">struct</span> rte_mbuf *mb, <span class="type">uint64_t</span> tms, <span class="keyword">struct</span> rte_ipv4_hdr *ip_hdr)</span>;</span><br><span class="line"><span class="comment">//é‡Šæ”¾å¤±æ•ˆçš„ipåˆ†ç‰‡</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rte_ip_frag_free_death_row</span><span class="params">(<span class="keyword">struct</span> rte_ip_frag_death_row *dr,</span></span><br><span class="line"><span class="params">		<span class="type">uint32_t</span> prefetch)</span>;</span><br><span class="line"><span class="comment">//æ”¶é›†ipåˆ†ç‰‡è¡¨ä¸­å¤±æ•ˆçš„ipåˆ†ç‰‡</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rte_ip_frag_table_del_expired_entries</span><span class="params">(<span class="keyword">struct</span> rte_ip_frag_tbl *tbl,</span></span><br><span class="line"><span class="params">	<span class="keyword">struct</span> rte_ip_frag_death_row *dr, <span class="type">uint64_t</span> tms)</span>;</span><br></pre></td></tr></table></figure>



<p>ipåˆ†ç‰‡è¡¨å†…éƒ¨ä½¿ç”¨hashè¡¨æ¥è¿›è¡Œç®¡ç†ï¼š</p>
<ul>
<li>keyï¼š&lt;æºip, ç›®çš„ip, Packet ID&gt;</li>
<li>valueï¼š<code>struct ip_frag_pkt</code>ï¼Œå­˜å‚¨ç€å½“å‰æŠ¥æ–‡çš„æ‰€æœ‰åˆ†ç‰‡</li>
</ul>
<p>ä¸ºäº†è§£å†³hashå†²çªï¼Œipåˆ†ç‰‡è¡¨ä½¿ç”¨ä¸¤ä¸ªhashå‡½æ•°æ¥ç”Ÿæˆbucketç´¢å¼•ï¼ŒåŒæ—¶æ¯ä¸ªbucketåŒ…å«å¤šä¸ªentryã€‚</p>
<p>å½“æ’å…¥çš„æŠ¥æ–‡çš„æœ€åä¸€ä¸ªåˆ†ç‰‡æ—¶ï¼Œipåˆ†ç‰‡è¡¨ä¼šå°†å…¶é‡ç»„ï¼Œä¿®æ”¹ç¬¬ä¸€ä¸ªåˆ†ç‰‡çš„ipå¤´ï¼Œå°†å…¶ä»–åˆ†ç‰‡çš„èµ·å§‹æŒ‡é’ˆæŒ‡åˆ°åˆ†ç‰‡çš„æ•°æ®éƒ¨åˆ†ï¼Œå¹¶ç”¨é“¾è¡¨è¿æ¥èµ·æ¥è¿”å›ç»™ç”¨æˆ·ã€‚</p>
<h1 id="Membership"><a href="#Membership" class="headerlink" title="Membership"></a>Membership</h1><p>æˆå‘˜åº“ï¼Œå‘åº”ç”¨ç¨‹åºæä¾›äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>å‘ç»™å®šé›†åˆæ’å…¥/åˆ é™¤ä¸€ä¸ªæˆå‘˜ï¼ˆkeyï¼‰</li>
<li>æŸ¥è¯¢æˆå‘˜æ˜¯å¦å±äºè¯¥é›†åˆ</li>
</ul>
<p>è¯¥åº“é‡‡ç”¨é›†åˆæ‘˜è¦çš„æ–¹å¼å®ç°ï¼Œå…·æœ‰å†…å­˜å ç”¨ä½ï¼ŒæŸ¥æ‰¾è¿…é€Ÿç­‰ç‰¹ç‚¹ï¼Œè¿™å¯¹äºå¤§æ•°æ®æ ¸æµå¼åº”ç”¨æ¥è¯´éå¸¸æœ‰ç”¨ã€‚ä½†ç”±äºé›†åˆæ‘˜è¦é‡‡ç”¨çš„æ˜¯æ¦‚ç‡æ•°æ®ç»“æ„ï¼Œå› æ­¤å…·æœ‰å‡é˜³ç‡ï¼Œå³æŸ¥è¯¢æˆå‘˜æ˜¯å¦å±äºè¯¥é›†åˆæ—¶ï¼Œè‹¥è¿”å›çœŸï¼Œåˆ™å®é™…å¯èƒ½ä¸ºå‡ã€‚</p>
<h2 id="Membershipä½¿ç”¨"><a href="#Membershipä½¿ç”¨" class="headerlink" title="Membershipä½¿ç”¨"></a>Membershipä½¿ç”¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_member_parameters</span> {</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> *name;			<span class="comment">/**&lt; Name of the hash. */</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * User to specify the type of the setsummary from one of</span></span><br><span class="line"><span class="comment">	 * rte_member_setsum_type.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * HT based setsummary is implemented like a hash table. User should use</span></span><br><span class="line"><span class="comment">	 * this type when there are many sets.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * vBF setsummary is a vector of bloom filters. It is used when number</span></span><br><span class="line"><span class="comment">	 * of sets is not big (less than 32 for current implementation).</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">rte_member_setsum_type</span> <span class="title">type</span>;</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * is_cache is only used for HT based setsummary.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * If it is HT based setsummary, user to specify the subtype or mode</span></span><br><span class="line"><span class="comment">	 * of the setsummary. It could be cache, or non-cache mode.</span></span><br><span class="line"><span class="comment">	 * Set is_cache to be 1 if to use as cache mode.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * For cache mode, keys can be evicted out of the HT setsummary. Keys</span></span><br><span class="line"><span class="comment">	 * with the same signature and map to the same bucket</span></span><br><span class="line"><span class="comment">	 * will overwrite each other in the setsummary table.</span></span><br><span class="line"><span class="comment">	 * This mode is useful for the case that the set-summary only</span></span><br><span class="line"><span class="comment">	 * needs to keep record of the recently inserted keys. Both</span></span><br><span class="line"><span class="comment">	 * false-negative and false-positive could happen.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * For non-cache mode, keys cannot be evicted out of the cache. So for</span></span><br><span class="line"><span class="comment">	 * this mode the setsummary will become full eventually. Keys with the</span></span><br><span class="line"><span class="comment">	 * same signature but map to the same bucket will still occupy multiple</span></span><br><span class="line"><span class="comment">	 * entries. This mode does not give false-negative result.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint8_t</span> is_cache;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * For HT setsummary, num_keys equals to the number of entries of the</span></span><br><span class="line"><span class="comment">	 * table. When the number of keys inserted in the HT setsummary</span></span><br><span class="line"><span class="comment">	 * approaches this number, eviction could happen. For cache mode,</span></span><br><span class="line"><span class="comment">	 * keys could be evicted out of the table. For non-cache mode, keys will</span></span><br><span class="line"><span class="comment">	 * be evicted to other buckets like cuckoo hash. The table will also</span></span><br><span class="line"><span class="comment">	 * likely to become full before the number of inserted keys equal to the</span></span><br><span class="line"><span class="comment">	 * total number of entries.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * For vBF, num_keys equal to the expected number of keys that will</span></span><br><span class="line"><span class="comment">	 * be inserted into the vBF. The implementation assumes the keys are</span></span><br><span class="line"><span class="comment">	 * evenly distributed to each BF in vBF. This is used to calculate the</span></span><br><span class="line"><span class="comment">	 * number of bits we need for each BF. User does not specify the size of</span></span><br><span class="line"><span class="comment">	 * each BF directly because the optimal size depends on the num_keys</span></span><br><span class="line"><span class="comment">	 * and false positive rate.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> num_keys;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The length of key is used for hash calculation. Since key is not</span></span><br><span class="line"><span class="comment">	 * stored in set-summary, large key does not require more memory space.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> key_len;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * num_set is only used for vBF, but not used for HT setsummary.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * num_set is equal to the number of BFs in vBF. For current</span></span><br><span class="line"><span class="comment">	 * implementation, it only supports 1,2,4,8,16,32 BFs in one vBF set</span></span><br><span class="line"><span class="comment">	 * summary. If other number of sets are needed, for example 5, the user</span></span><br><span class="line"><span class="comment">	 * should allocate the minimum available value that larger than 5,</span></span><br><span class="line"><span class="comment">	 * which is 8.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> num_set;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * false_positive_rate is only used for vBF, but not used for HT</span></span><br><span class="line"><span class="comment">	 * setsummary.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * For vBF, false_positive_rate is the user-defined false positive rate</span></span><br><span class="line"><span class="comment">	 * given expected number of inserted keys (num_keys). It is used to</span></span><br><span class="line"><span class="comment">	 * calculate the total number of bits for each BF, and the number of</span></span><br><span class="line"><span class="comment">	 * hash values used during lookup and insertion. For details please</span></span><br><span class="line"><span class="comment">	 * refer to vBF implementation and membership library documentation.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * For HT, This parameter is not directly set by users.</span></span><br><span class="line"><span class="comment">	 * HT setsummary's false positive rate is in the order of:</span></span><br><span class="line"><span class="comment">	 * false_pos = (1/bucket_count)*(1/2^16), since we use 16-bit signature.</span></span><br><span class="line"><span class="comment">	 * This is because two keys needs to map to same bucket and same</span></span><br><span class="line"><span class="comment">	 * signature to have a collision (false positive). bucket_count is equal</span></span><br><span class="line"><span class="comment">	 * to number of entries (num_keys) divided by entry count per bucket</span></span><br><span class="line"><span class="comment">	 * (RTE_MEMBER_BUCKET_ENTRIES). Thus, the false_positive_rate is not</span></span><br><span class="line"><span class="comment">	 * directly set by users for HT mode.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">float</span> false_positive_rate;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * We use two seeds to calculate two independent hashes for each key.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * For HT type, one hash is used as signature, and the other is used</span></span><br><span class="line"><span class="comment">	 * for bucket location.</span></span><br><span class="line"><span class="comment">	 * For vBF type, these two hashes and their combinations are used as</span></span><br><span class="line"><span class="comment">	 * hash locations to index the bit array.</span></span><br><span class="line"><span class="comment">	 * For Sketch type, these seeds are not used.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> prim_hash_seed;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The secondary seed should be a different value from the primary seed.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> sec_hash_seed;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * For count(min) sketch data structure, error rate defines the accuracy</span></span><br><span class="line"><span class="comment">	 * required by the user. Higher accuracy leads to more memory usage, but</span></span><br><span class="line"><span class="comment">	 * the flow size is estimated more accurately.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">float</span> error_rate;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Sampling rate means the internal sample rate of the rows of the count</span></span><br><span class="line"><span class="comment">	 * min sketches. Lower sampling rate can reduce CPU overhead, but the</span></span><br><span class="line"><span class="comment">	 * data structure will require more time to converge statistically.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">float</span> sample_rate;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * How many top heavy hitter to be reported. The library will internally</span></span><br><span class="line"><span class="comment">	 * keep the keys of heavy hitters for final report.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> top_k;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Extra flags that may passed in by user</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> extra_flag;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> socket_id;			<span class="comment">/**&lt; NUMA Socket ID for memory. */</span></span><br><span class="line">} __rte_cache_aligned;</span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªmemberå®ä¾‹</span></span><br><span class="line"><span class="keyword">struct</span> rte_member_setsum *</span><br><span class="line"><span class="title function_">rte_member_create</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_member_parameters *params)</span>;</span><br><span class="line"><span class="comment">//å‘æŒ‡å®šé›†åˆä¸­æ·»åŠ æˆå‘˜</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_member_add</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_member_setsum *setsum, <span class="type">const</span> <span class="type">void</span> *key,</span></span><br><span class="line"><span class="params">			<span class="type">member_set_t</span> set_id)</span>;</span><br><span class="line"><span class="comment">//æŸ¥è¯¢ç»™å®šæˆå‘˜æ‰€å±é›†åˆï¼Œè‹¥æŸ¥è¯¢æˆåŠŸåˆ™è¿”å›ç»™set_id</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_member_lookup</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_member_setsum *setsum, <span class="type">const</span> <span class="type">void</span> *key,</span></span><br><span class="line"><span class="params">			<span class="type">member_set_t</span> *set_id)</span>;</span><br></pre></td></tr></table></figure>



<h2 id="MembershipåŸç†"><a href="#MembershipåŸç†" class="headerlink" title="MembershipåŸç†"></a>MembershipåŸç†</h2><p>ç›®å‰dpdkå¯¹äºè¯¥åº“æœ‰ä¸‰ç§å®ç°ï¼Œä¸åŒå®ç°æ–¹å¼é€‚ç”¨äºä¸åŒçš„ä½¿ç”¨åœºæ™¯ï¼Œç”¨æˆ·å¯æ ¹æ®è‡ªèº«éœ€è¦é€‰æ‹©ä¸åŒçš„å†…éƒ¨å®ç°æ–¹å¼ã€‚</p>
<h3 id="HTSS-Hash-table-based-set-summary"><a href="#HTSS-Hash-table-based-set-summary" class="headerlink" title="HTSS(Hash-table based set-summary)"></a>HTSS(Hash-table based set-summary)</h3><p>é‡‡ç”¨Cuckoo filterå®ç°ï¼Œä¸<a href="#Hash">Cuckoo hash</a>å®ç°æ–¹å¼ç±»ä¼¼ï¼Œåªä¸è¿‡ä¸å­˜å‚¨keyå€¼ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚è¯¥å®ç°æ–¹å¼é€‚ç”¨äºé›†åˆä¸­æˆå‘˜æ•°è¾ƒå¤šçš„æƒ…å†µã€‚</p>
<p>å› ä¸ºhashè¡¨ä¸­å­˜å‚¨çš„æ˜¯keyçš„ç­¾åï¼Œæ‰€ä»¥å­˜åœ¨==å‡é˜³ç‡==ã€‚å½“å‘ç”Ÿhashå†²çªæ—¶ï¼ˆå³primaryå’Œsecondaryçš„bucketéƒ½æ»¡æ—¶ï¼‰ï¼Œæ ¹æ®HSTTæ‰€é‡‡ç”¨çš„è§£å†³å†²çªçš„æ–¹å¼ï¼Œåˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼š</p>
<ul>
<li>cache modeï¼šç›´æ¥éšæœºè¦†ç›–æ‰ä¹‹å‰æ‰€æ’å…¥çš„ä¸€ä¸ªkeyã€‚ä½¿å¾—æ’å…¥æ“ä½œçš„ä»£ä»·æ¯”non-cache modeä¸‹å°ï¼Œä½†è¿™ä¼šå¯¼è‡´è¯¥æ¨¡å¼ä¸‹å­˜åœ¨==å‡é˜´ç‡==ï¼Œå³æŸ¥è¯¢æˆå‘˜æ˜¯å¦å±äºè¯¥é›†åˆæ—¶ï¼Œè‹¥è¿”å›å‡ï¼Œåˆ™å®é™…å¯èƒ½ä¸ºçœŸã€‚å› æ­¤è¯¥æ¨¡å¼é€šå¸¸ç”¨äºç¼“å­˜æŸ¥æ‰¾ï¼ŒæŸ¥æ‰¾ç¼“å­˜å¤±è´¥æ—¶å†æŸ¥æ‰¾ä¸»è¡¨ã€‚</li>
<li>non-cache modeï¼šé‡‡ç”¨Cuckoo hashçš„å†²çªè§£å†³æ–¹æ³•ï¼Œè¸¢å‡ºä¸€ä¸ªkeyï¼Œå¹¶é€’å½’åœ°æ’å…¥æ‰€è¸¢å‡ºçš„keyã€‚</li>
</ul>
<h3 id="BF-Bloom-Filter"><a href="#BF-Bloom-Filter" class="headerlink" title="BF(Bloom Filter)"></a>BF(Bloom Filter)</h3><p>å¸ƒéš†è¿‡æ»¤å™¨ï¼Œé‡‡ç”¨ä½å›¾æ–¹å¼å®ç°ã€‚å½“ä¸€ä¸ªæˆå‘˜åŠ å…¥åˆ°é›†åˆä¸­æ—¶ï¼Œé€šè¿‡kä¸ªæ•£åˆ—å‡½æ•°å°†è¯¥å…ƒç´ æ˜ å°„åˆ°ä½å›¾ä¸­çš„kä¸ªä½ï¼Œå¹¶ç½®1ã€‚æŸ¥æ‰¾æ—¶ï¼Œè‹¥æˆå‘˜æ‰€å¯¹åº”çš„kä¸ªä½åœ¨è¯¥é›†åˆä¸­éƒ½ä¸º1ï¼Œåˆ™è¯¥æˆå‘˜å±äºè¯¥é›†åˆä¸­ï¼Œè¯¥å®ç°æ–¹å¼é€‚ç”¨äºé›†åˆä¸­æˆå‘˜æ•°è¾ƒå°‘çš„æƒ…å†µã€‚</p>
<p>ç”±äºä¸åŒæˆå‘˜å¯èƒ½æ•£åˆ—åˆ°ç›¸åŒä½ç½®ï¼Œå› æ­¤å¸ƒéš†è¿‡æ»¤å™¨å­˜åœ¨==å‡é˜³ç‡==ï¼Œå‡é˜³ç‡çš„æ¦‚ç‡å¯ä»¥é€šè¿‡å…¥å‚é…ç½®ã€‚</p>
<h4 id="å‡é˜³ç‡çš„è¡¨è¾¾å¼"><a href="#å‡é˜³ç‡çš„è¡¨è¾¾å¼" class="headerlink" title="å‡é˜³ç‡çš„è¡¨è¾¾å¼"></a>å‡é˜³ç‡çš„è¡¨è¾¾å¼</h4><p>é¦–å…ˆå®šä¹‰æ‰€ç”¨åˆ°çš„ä¸€äº›å˜é‡ï¼š</p>
<ul>
<li>mï¼šè¯¥é›†åˆæ‰€ä½¿ç”¨çš„bitmapçš„æ¯”ç‰¹æ•°</li>
<li>kï¼šå‘è¯¥é›†åˆä¸­æ’å…¥ä¸€ä¸ªæˆå‘˜éœ€è¦è¿›è¡Œçš„å“ˆå¸Œè½®æ•°</li>
<li>nï¼šè¯¥é›†åˆä¸­æˆå‘˜çš„ä¸ªæ•°ï¼ˆä¸€ä¸ªå¤§çº¦çš„ä¼°è®¡å€¼ï¼Œç”¨æˆ·é…ç½®ï¼‰</li>
<li>Ïï¼šæ’å…¥nä¸ªå…ƒç´ çš„æƒ…å†µä¸‹çš„å‡é˜³ç‡ï¼ˆç”¨æˆ·é…ç½®ï¼‰</li>
</ul>
<p>BFä¸­ä»»ä½•ä¸€ä½bitåœ¨ç¬¬1ä¸ªæˆå‘˜ç¬¬1ä¸ªhashæ‰§è¡Œå®Œæ¯•åä¸º0çš„æ¦‚ç‡ï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -1.577ex;" xmlns="http://www.w3.org/2000/svg" width="6.879ex" height="4.613ex" role="img" focusable="false" viewBox="0 -1342 3040.4 2039"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mfrac" transform="translate(1722.4,0)"><g data-mml-node="mn" transform="translate(409,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mi" transform="translate(220,-686)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><rect width="1078" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container><br>BFä¸­ä»»ä½•ä¸€ä½bitåœ¨ç¬¬1ä¸ªæˆå‘˜ç¬¬kä¸ªhashæ‰§è¡Œå®Œæ¯•åä¸º0çš„æ¦‚ç‡ï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -1.577ex;" xmlns="http://www.w3.org/2000/svg" width="9.66ex" height="4.613ex" role="img" focusable="false" viewBox="0 -1342 4269.8 2039"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mo"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(389,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1111.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mfrac" transform="translate(2111.4,0)"><g data-mml-node="mn" transform="translate(409,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mi" transform="translate(220,-686)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><rect width="1078" height="60" x="120" y="220"></rect></g><g data-mml-node="msup" transform="translate(3429.4,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mi" transform="translate(422,413) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g></svg></mjx-container><br>BFä¸­ä»»ä½•ä¸€ä½bitåœ¨æ‰€æœ‰nä¸ªæˆå‘˜éƒ½æ·»åŠ å®Œæ¯•åä¸º1çš„æ¦‚ç‡ï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -1.577ex;" xmlns="http://www.w3.org/2000/svg" width="14.517ex" height="4.613ex" role="img" focusable="false" viewBox="0 -1342 6416.6 2039"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mo" transform="translate(1722.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(2111.4,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2833.7,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mfrac" transform="translate(3833.9,0)"><g data-mml-node="mn" transform="translate(409,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mi" transform="translate(220,-686)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><rect width="1078" height="60" x="120" y="220"></rect></g><g data-mml-node="msup" transform="translate(5151.9,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="TeXAtom" transform="translate(422,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(600,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g></g></svg></mjx-container><br>ä¸€ä¸ªä¸å­˜åœ¨çš„æˆå‘˜è¢«kä¸ªhashå‡½æ•°æ˜ å°„åkä¸ªbitéƒ½ä¸º1çš„æ¦‚ç‡ï¼š<br><mjx-container class="MathJax" jax="SVG" display="true" width="full" style="min-width: 44.54ex;"><svg style="vertical-align: -1.741ex; min-width: 44.54ex;" xmlns="http://www.w3.org/2000/svg" width="100%" height="4.613ex" role="img" focusable="false"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(0.0181,-0.0181) translate(0, -1269.5)"><g data-mml-node="math"><g data-mml-node="mtable" transform="translate(2078,0) translate(-2078,0)"><g transform="translate(0 1269.5) matrix(1 0 0 -1 0 0) scale(55.25)"><svg data-table="true" preserveAspectRatio="xMidYMid" viewBox="7765.3 -1269.5 1 2039"><g transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mlabeledtr" transform="translate(0,-72.5)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D70C" d="M58 -216Q25 -216 23 -186Q23 -176 73 26T127 234Q143 289 182 341Q252 427 341 441Q343 441 349 441T359 442Q432 442 471 394T510 276Q510 219 486 165T425 74T345 13T266 -10H255H248Q197 -10 165 35L160 41L133 -71Q108 -168 104 -181T92 -202Q76 -216 58 -216ZM424 322Q424 359 407 382T357 405Q322 405 287 376T231 300Q217 269 193 170L176 102Q193 26 260 26Q298 26 334 62Q367 92 389 158T418 266T424 322Z"></path></g><g data-mml-node="mo" transform="translate(794.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(1850.6,0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mn" transform="translate(2128.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2850.8,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mo" transform="translate(3851,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(4240,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(4962.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mfrac" transform="translate(5962.4,0)"><g data-mml-node="mn" transform="translate(409,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mi" transform="translate(220,-686)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><rect width="1078" height="60" x="120" y="220"></rect></g><g data-mml-node="msup" transform="translate(7280.4,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="TeXAtom" transform="translate(422,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(600,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g><g data-mml-node="msup" transform="translate(8545.1,0)"><g data-mml-node="mo"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g><g data-mml-node="mi" transform="translate(311,413) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g><g data-mml-node="mo" transform="translate(9552.3,0)"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g><g data-mml-node="mo" transform="translate(10608.1,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(10997.1,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(11719.3,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msup" transform="translate(12719.5,0)"><g data-mml-node="mi"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="TeXAtom" transform="translate(499,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mfrac" transform="translate(778,0)"><g data-mml-node="mrow" transform="translate(220,394) scale(0.707)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(521,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mi" transform="translate(305.9,-345) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><rect width="992.7" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="msup" transform="translate(14690.3,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mi" transform="translate(422,413) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g></g></svg><svg data-labels="true" preserveAspectRatio="xMaxYMid" viewBox="1278 -1269.5 1 2039"><g data-labels="true" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mtd" id="mjx-eqn:1" transform="translate(0,677.5)"><text data-id-align="true"></text><g data-idbox="true" transform="translate(0,-750)"><g data-mml-node="mtext"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(389,0)"></path><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" transform="translate(889,0)"></path></g></g></g></g></svg></g></g></g></g></svg></mjx-container></p>
<h4 id="BFæ‰€ä½¿ç”¨çš„bitmapä½æ•°mçš„ç¡®å®š"><a href="#BFæ‰€ä½¿ç”¨çš„bitmapä½æ•°mçš„ç¡®å®š" class="headerlink" title="BFæ‰€ä½¿ç”¨çš„bitmapä½æ•°mçš„ç¡®å®š"></a>BFæ‰€ä½¿ç”¨çš„bitmapä½æ•°mçš„ç¡®å®š</h4><p>åœ¨è¿™é‡Œmå’Œkéƒ½æ˜¯æœªçŸ¥é‡ï¼Œä¸ºäº†æ±‚å¾—å‡é˜³ç‡çš„æœ€å°å€¼ï¼Œæˆ‘ä»¬å°†Ïå…ˆçœ‹åšä¸ºkçš„å‡½æ•°ï¼Œå¯¹å…¶è¿›è¡Œæ±‚å¯¼ï¼Œç¡®å®šå½“kä¸ºä½•å€¼æ—¶Ïçš„å€¼æœ€å°ã€‚</p>
<p>è¿™é‡Œé‡‡ç”¨å¯¹æ•°æ±‚å¯¼æ³•<br><mjx-container class="MathJax" jax="SVG" display="true" width="full" style="min-width: 36.612ex;"><svg style="vertical-align: -0.892ex; min-width: 36.612ex;" xmlns="http://www.w3.org/2000/svg" width="100%" height="2.915ex" role="img" focusable="false"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(0.0181,-0.0181) translate(0, -894.3)"><g data-mml-node="math"><g data-mml-node="mtable" transform="translate(2078,0) translate(-2078,0)"><g transform="translate(0 894.3) matrix(1 0 0 -1 0 0) scale(55.25)"><svg data-table="true" preserveAspectRatio="xMidYMid" viewBox="6013.3 -894.3 1 1288.6"><g transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mlabeledtr" transform="translate(0,-144.3)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mo" transform="translate(550,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(939,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(1460,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(2126.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3182.6,0)"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(4016.6,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mi" transform="translate(4183.2,0)"><path data-c="1D70C" d="M58 -216Q25 -216 23 -186Q23 -176 73 26T127 234Q143 289 182 341Q252 427 341 441Q343 441 349 441T359 442Q432 442 471 394T510 276Q510 219 486 165T425 74T345 13T266 -10H255H248Q197 -10 165 35L160 41L133 -71Q108 -168 104 -181T92 -202Q76 -216 58 -216ZM424 322Q424 359 407 382T357 405Q322 405 287 376T231 300Q217 269 193 170L176 102Q193 26 260 26Q298 26 334 62Q367 92 389 158T418 266T424 322Z"></path></g><g data-mml-node="mo" transform="translate(4978,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(6033.8,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(6721.4,0)"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(7555.4,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mo" transform="translate(7555.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(7944.4,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(8666.7,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msup" transform="translate(9666.9,0)"><g data-mml-node="mi"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="TeXAtom" transform="translate(499,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mfrac" transform="translate(778,0)"><g data-mml-node="mrow" transform="translate(220,394) scale(0.707)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(521,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mi" transform="translate(305.9,-345) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><rect width="992.7" height="60" x="120" y="220"></rect></g></g></g><g data-mml-node="mo" transform="translate(11637.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></g></svg><svg data-labels="true" preserveAspectRatio="xMaxYMid" viewBox="1278 -894.3 1 1288.6"><g data-labels="true" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mtd" id="mjx-eqn:2" transform="translate(0,605.7)"><text data-id-align="true"></text><g data-idbox="true" transform="translate(0,-750)"><g data-mml-node="mtext"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(389,0)"></path><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" transform="translate(889,0)"></path></g></g></g></g></svg></g></g></g></g></svg></mjx-container><br>ä¸ºäº†ç®€åŒ–å¼å­(2)ï¼Œä»¤<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="8.446ex" height="2.422ex" role="img" focusable="false" viewBox="0 -988.6 3733.3 1070.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mo" transform="translate(706.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msup" transform="translate(1762.6,0)"><g data-mml-node="mi"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="TeXAtom" transform="translate(499,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mfrac" transform="translate(778,0)"><g data-mml-node="mrow" transform="translate(220,394) scale(0.707)"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mi" transform="translate(521,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g></g><g data-mml-node="mi" transform="translate(305.9,-345) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><rect width="992.7" height="60" x="120" y="220"></rect></g></g></g></g></g></svg></mjx-container>ï¼Œå¯¹å¼å­(2)ä¸¤è¾¹æ±‚å¯¼ï¼Œå¾—<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -1.859ex;" xmlns="http://www.w3.org/2000/svg" width="36.38ex" height="5.397ex" role="img" focusable="false" viewBox="0 -1563.7 16079.9 2385.5"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="mi" transform="translate(636,413) scale(0.707)"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"></path></g></g><g data-mml-node="mo" transform="translate(880.5,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(1269.5,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(1790.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(2457.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3513,0)"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(4347,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mo" transform="translate(4347,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(4736,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(5458.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msup" transform="translate(6458.5,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="TeXAtom" transform="translate(462,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g><g data-mml-node="mo" transform="translate(7889,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(8500.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mfrac" transform="translate(9500.4,0)"><g data-mml-node="mrow" transform="translate(275.2,710)"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msup" transform="translate(1223,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="TeXAtom" transform="translate(462,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g><g data-mml-node="mo" transform="translate(2653.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220,-739.7)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msup" transform="translate(1722.4,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="TeXAtom" transform="translate(462,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g><rect width="3353" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(13093.4,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(13482.4,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msup" transform="translate(14260.4,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="TeXAtom" transform="translate(462,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g><g data-mml-node="mo" transform="translate(15690.9,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container><br>ä»¤å¯¼æ•°ä¸º0ï¼Œå¾—<br><mjx-container class="MathJax" jax="SVG" display="true" width="full" style="min-width: 32.325ex;"><svg style="vertical-align: -2.133ex; min-width: 32.325ex;" xmlns="http://www.w3.org/2000/svg" width="100%" height="5.397ex" role="img" focusable="false"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(0.0181,-0.0181) translate(0, -1442.7)"><g data-mml-node="math"><g data-mml-node="mtable" transform="translate(2078,0) translate(-2078,0)"><g transform="translate(0 1442.7) matrix(1 0 0 -1 0 0) scale(55.25)"><svg data-table="true" preserveAspectRatio="xMidYMid" viewBox="5065.8 -1442.7 1 2385.5"><g transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mlabeledtr" transform="translate(0,-121)"><g data-mml-node="mtd"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,710)"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(1223,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1945.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msup" transform="translate(2945.4,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="TeXAtom" transform="translate(462,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g><g data-mml-node="mo" transform="translate(4376,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="msup" transform="translate(1887.2,-739.7)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="TeXAtom" transform="translate(462,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g><rect width="4965" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(5482.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(6538.5,0)"><g data-mml-node="mrow" transform="translate(275.2,710)"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="msup" transform="translate(1223,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="TeXAtom" transform="translate(462,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g><g data-mml-node="mo" transform="translate(2653.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(220,-739.7)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(722.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="msup" transform="translate(1722.4,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="TeXAtom" transform="translate(462,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g><rect width="3353" height="60" x="120" y="220"></rect></g></g></g></g></svg><svg data-labels="true" preserveAspectRatio="xMaxYMid" viewBox="1278 -1442.7 1 2385.5"><g data-labels="true" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mtd" id="mjx-eqn:3" transform="translate(0,629)"><text data-id-align="true"></text><g data-idbox="true" transform="translate(0,-750)"><g data-mml-node="mtext"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(389,0)"></path><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" transform="translate(889,0)"></path></g></g></g></g></svg></g></g></g></g></svg></mjx-container><br>ä¸ºæ–¹ä¾¿èµ·è§ï¼Œè®¾<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="7.548ex" height="2.117ex" role="img" focusable="false" viewBox="0 -853.7 3336.1 935.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(849.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msup" transform="translate(1905.6,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="TeXAtom" transform="translate(462,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g></g></svg></mjx-container>ï¼Œä»¤<br><mjx-container class="MathJax" jax="SVG" display="true" width="full" style="min-width: 26.416ex;"><svg style="vertical-align: -1.874ex; min-width: 26.416ex;" xmlns="http://www.w3.org/2000/svg" width="100%" height="4.88ex" role="img" focusable="false"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(0.0181,-0.0181) translate(0, -1328.5)"><g data-mml-node="math"><g data-mml-node="mtable" transform="translate(2078,0) translate(-2078,0)"><g transform="translate(0 1328.5) matrix(1 0 0 -1 0 0) scale(55.25)"><svg data-table="true" preserveAspectRatio="xMidYMid" viewBox="3760 -1328.5 1 2157"><g transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mlabeledtr" transform="translate(0,-131.5)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(490,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(879,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(1451,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(2117.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(3173.6,0)"><g data-mml-node="mrow" transform="translate(220,710)"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(1223,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1945.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2945.4,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(3517.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mi" transform="translate(1887.2,-686)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><rect width="4106.4" height="60" x="120" y="220"></rect></g></g></g></g></svg><svg data-labels="true" preserveAspectRatio="xMaxYMid" viewBox="1278 -1328.5 1 2157"><g data-labels="true" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mtd" id="mjx-eqn:4" transform="translate(0,618.5)"><text data-id-align="true"></text><g data-idbox="true" transform="translate(0,-750)"><g data-mml-node="mtext"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z" transform="translate(389,0)"></path><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" transform="translate(889,0)"></path></g></g></g></g></svg></g></g></g></g></svg></mjx-container><br>è¦æƒ³ä½¿å¼å­(3)æˆç«‹ï¼Œå°±æ˜¯æ±‚<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="15.24ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 6736 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(490,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(879,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(1451,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(2117.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3173.6,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(3663.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(4052.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(4774.8,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(5775,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(6347,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container><br>ç”±äºå¼å­(4)å•è°ƒé€’å‡ï¼Œå› æ­¤å½“ä¸”ä»…å½“<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.781ex;" xmlns="http://www.w3.org/2000/svg" width="6.107ex" height="2.737ex" role="img" focusable="false" viewBox="0 -864.9 2699.1 1209.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(849.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1905.6,0)"><g data-mml-node="mn" transform="translate(220,394) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mn" transform="translate(220,-345) scale(0.707)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><rect width="553.6" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container>æ—¶ï¼Œå¼å­(3)æˆç«‹ï¼Œå³<br><mjx-container class="MathJax" jax="SVG" display="true" width="full" style="min-width: 43.981ex;"><svg style="vertical-align: -1.773ex; min-width: 43.981ex;" xmlns="http://www.w3.org/2000/svg" width="100%" height="4.676ex" role="img" focusable="false"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(0.0181,-0.0181) translate(0, -1283.5)"><g data-mml-node="math"><g data-mml-node="mtable" transform="translate(2078,0) translate(-2078,0)"><g transform="translate(0 1283.5) matrix(1 0 0 -1 0 0) scale(55.25)"><svg data-table="true" preserveAspectRatio="xMidYMid" viewBox="7641.8 -1283.5 1 2067"><g transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mlabeledtr" transform="translate(0,-86.5)"><g data-mml-node="mtd"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="TeXAtom" transform="translate(462,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(778,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g><g data-mml-node="mo" transform="translate(1708.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(2764.1,0)"><g data-mml-node="mn" transform="translate(220,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mn" transform="translate(220,-686)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><rect width="700" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(3981.9,0)"><path data-c="21D2" d="M580 514Q580 525 596 525Q601 525 604 525T609 525T613 524T615 523T617 520T619 517T622 512Q659 438 720 381T831 300T927 263Q944 258 944 250T935 239T898 228T840 204Q696 134 622 -12Q618 -21 615 -22T600 -24Q580 -24 580 -17Q580 -13 585 0Q620 69 671 123L681 133H70Q56 140 56 153Q56 168 72 173H725L735 181Q774 211 852 250Q851 251 834 259T789 283T735 319L725 327H72Q56 332 56 347Q56 360 70 367H681L671 377Q638 412 609 458T580 514Z"></path></g><g data-mml-node="mi" transform="translate(5259.6,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(6058.4,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(7114.2,0)"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mn" transform="translate(1000.7,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mrow" transform="translate(255.5,-686)"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mi" transform="translate(1000.7,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g></g><rect width="1700.7" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(9332.6,0)"><path data-c="21D2" d="M580 514Q580 525 596 525Q601 525 604 525T609 525T613 524T615 523T617 520T619 517T622 512Q659 438 720 381T831 300T927 263Q944 258 944 250T935 239T898 228T840 204Q696 134 622 -12Q618 -21 615 -22T600 -24Q580 -24 580 -17Q580 -13 585 0Q620 69 671 123L681 133H70Q56 140 56 153Q56 168 72 173H725L735 181Q774 211 852 250Q851 251 834 259T789 283T735 319L725 327H72Q56 332 56 347Q56 360 70 367H681L671 377Q638 412 609 458T580 514Z"></path></g><g data-mml-node="mi" transform="translate(10610.4,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(11409.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(12465,0)"><g data-mml-node="mi" transform="translate(220,676)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(359,-686)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><rect width="1078" height="60" x="120" y="220"></rect></g><g data-mml-node="mi" transform="translate(13783,0)"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(14617,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mn" transform="translate(14783.6,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g></svg><svg data-labels="true" preserveAspectRatio="xMaxYMid" viewBox="1278 -1283.5 1 2067"><g data-labels="true" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="mtd" id="mjx-eqn:5" transform="translate(0,663.5)"><text data-id-align="true"></text><g data-idbox="true" transform="translate(0,-750)"><g data-mml-node="mtext"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(389,0)"></path><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z" transform="translate(889,0)"></path></g></g></g></g></svg></g></g></g></g></svg></mjx-container><br>å› æ­¤å½“ä¸”ä»…å½“<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex;" xmlns="http://www.w3.org/2000/svg" width="9.991ex" height="2.397ex" role="img" focusable="false" viewBox="0 -706.5 4416.1 1059.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(798.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1854.6,0)"><g data-mml-node="mi" transform="translate(220,394) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(318.3,-345) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><rect width="820.8" height="60" x="120" y="220"></rect></g><g data-mml-node="mi" transform="translate(2915.4,0)"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(3749.4,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mn" transform="translate(3916.1,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></svg></mjx-container>æ—¶ï¼Œå‡é˜³ç‡å–å¾—æå€¼ï¼Œé€šè¿‡å¯¹kå¸¦æ•°å¯çŸ¥ï¼Œè¯¥æå€¼ä¸ºæå°å€¼ã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œå°±å¯ä»¥è®¡ç®—BFæ‰€ä½¿ç”¨çš„bitmapä½æ•°äº†ã€‚å°†<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.798ex;" xmlns="http://www.w3.org/2000/svg" width="9.991ex" height="2.397ex" role="img" focusable="false" viewBox="0 -706.5 4416.1 1059.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(798.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1854.6,0)"><g data-mml-node="mi" transform="translate(220,394) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(318.3,-345) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><rect width="820.8" height="60" x="120" y="220"></rect></g><g data-mml-node="mi" transform="translate(2915.4,0)"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(3749.4,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mn" transform="translate(3916.1,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></svg></mjx-container>å¸¦å…¥å¼å­(1)ï¼Œå¾—<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.752ex;" xmlns="http://www.w3.org/2000/svg" width="29.715ex" height="5.851ex" role="img" focusable="false" viewBox="0 -1370 13134.2 2586.3"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D70C" d="M58 -216Q25 -216 23 -186Q23 -176 73 26T127 234Q143 289 182 341Q252 427 341 441Q343 441 349 441T359 442Q432 442 471 394T510 276Q510 219 486 165T425 74T345 13T266 -10H255H248Q197 -10 165 35L160 41L133 -71Q108 -168 104 -181T92 -202Q76 -216 58 -216ZM424 322Q424 359 407 382T357 405Q322 405 287 376T231 300Q217 269 193 170L176 102Q193 26 260 26Q298 26 334 62Q367 92 389 158T418 266T424 322Z"></path></g><g data-mml-node="mo" transform="translate(794.8,0)"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g><g data-mml-node="mo" transform="translate(1850.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mo" transform="translate(2239.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mfrac" transform="translate(2628.6,0)"><g data-mml-node="mn" transform="translate(220,676)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mn" transform="translate(220,-686)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><rect width="700" height="60" x="120" y="220"></rect></g><g data-mml-node="msup" transform="translate(3568.6,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="TeXAtom" transform="translate(422,413) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mn" transform="translate(1000.7,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="msup" transform="translate(5101.7,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mfrac" transform="translate(422,413) scale(0.707)"><g data-mml-node="mi" transform="translate(220,394) scale(0.707)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(318.3,-345) scale(0.707)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><rect width="820.8" height="60" x="120" y="220"></rect></g></g><g data-mml-node="mo" transform="translate(6601.6,0)"><path data-c="21D2" d="M580 514Q580 525 596 525Q601 525 604 525T609 525T613 524T615 523T617 520T619 517T622 512Q659 438 720 381T831 300T927 263Q944 258 944 250T935 239T898 228T840 204Q696 134 622 -12Q618 -21 615 -22T600 -24Q580 -24 580 -17Q580 -13 585 0Q620 69 671 123L681 133H70Q56 140 56 153Q56 168 72 173H725L735 181Q774 211 852 250Q851 251 834 259T789 283T735 319L725 327H72Q56 332 56 347Q56 360 70 367H681L671 377Q638 412 609 458T580 514Z"></path></g><g data-mml-node="mi" transform="translate(7879.4,0)"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(9035.1,0)"><path data-c="2248" d="M55 319Q55 360 72 393T114 444T163 472T205 482Q207 482 213 482T223 483Q262 483 296 468T393 413L443 381Q502 346 553 346Q609 346 649 375T694 454Q694 465 698 474T708 483Q722 483 722 452Q722 386 675 338T555 289Q514 289 468 310T388 357T308 404T224 426Q164 426 125 393T83 318Q81 289 69 289Q55 289 55 319ZM55 85Q55 126 72 159T114 210T163 238T205 248Q207 248 213 248T223 249Q262 249 296 234T393 179L443 147Q502 112 553 112Q609 112 649 141T694 220Q694 249 708 249T722 217Q722 153 675 104T555 55Q514 55 468 76T388 123T308 170T224 192Q164 192 125 159T83 84Q80 55 69 55Q55 55 55 85Z"></path></g><g data-mml-node="mfrac" transform="translate(10090.9,0)"><g data-mml-node="mrow" transform="translate(379.5,676)"><g data-mml-node="mi"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(766.7,0)"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(1600.7,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mi" transform="translate(1767.3,0)"><path data-c="1D70C" d="M58 -216Q25 -216 23 -186Q23 -176 73 26T127 234Q143 289 182 341Q252 427 341 441Q343 441 349 441T359 442Q432 442 471 394T510 276Q510 219 486 165T425 74T345 13T266 -10H255H248Q197 -10 165 35L160 41L133 -71Q108 -168 104 -181T92 -202Q76 -216 58 -216ZM424 322Q424 359 407 382T357 405Q322 405 287 376T231 300Q217 269 193 170L176 102Q193 26 260 26Q298 26 334 62Q367 92 389 158T418 266T424 322Z"></path></g></g><g data-mml-node="mrow" transform="translate(220,-824.9)"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="2061" d=""></path></g><g data-mml-node="TeXAtom" data-mjx-texclass="ORD" transform="translate(1000.7,0)"><g data-mml-node="mfrac"><g data-mml-node="mn" transform="translate(624.5,394) scale(0.707)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="msup" transform="translate(220,-391.4) scale(0.707)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(533,289) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mn" transform="translate(1000.7,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><rect width="1362.6" height="60" x="120" y="220"></rect></g></g></g><rect width="2803.2" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></p>
<h4 id="BFæ‰€ä½¿ç”¨çš„hashæ•°kçš„ç¡®å®š"><a href="#BFæ‰€ä½¿ç”¨çš„hashæ•°kçš„ç¡®å®š" class="headerlink" title="BFæ‰€ä½¿ç”¨çš„hashæ•°kçš„ç¡®å®š"></a>BFæ‰€ä½¿ç”¨çš„hashæ•°kçš„ç¡®å®š</h4><p>æ­¤æ—¶må·²çŸ¥ï¼Œç”±å¼å­(5)å³å¯ç®—å‡ºBFæ‰€ä½¿ç”¨çš„hashæ•°kã€‚</p>
<p>ä¸ºäº†æŸ¥æ‰¾æ—¶çš„æ€§èƒ½è€ƒè™‘mä¼šå–å€¼ä¸º2çš„æ•´æ•°æ¬¡æ–¹ï¼Œæ­¤æ—¶æ‰€å¾—åˆ°çš„å‡é˜³ç‡Ïä¸€å®šæ˜¯ä¿å®ˆçš„ï¼Œå³å°äºç”¨æˆ·æ‰€æŒ‡å®šçš„å‡é˜³ç‡ã€‚å› æ­¤ä¸ºäº†è¿›ä¸€æ­¥å‡å°‘æ’å…¥/æŸ¥æ‰¾ä¸€ä¸ªæˆå‘˜æ‰€éœ€è¿›è¡Œçš„hashæ¬¡æ•°kï¼Œä¾æ¬¡é€’å‡kçš„å€¼ï¼Œå¸¦å…¥å¼å­(1)ä¸­ï¼Œæœ€åç¡®å®šä¸€ä¸ªä½¿å¾—å‡é˜³ç‡ä½äºç”¨æˆ·æ‰€ç»™å®šçš„å‡é˜³ç‡çš„æœ€å°kå€¼ã€‚</p>
<h4 id="å¤šé›†åˆçš„æ”¯æŒ"><a href="#å¤šé›†åˆçš„æ”¯æŒ" class="headerlink" title="å¤šé›†åˆçš„æ”¯æŒ"></a>å¤šé›†åˆçš„æ”¯æŒ</h4><p>ä¼ ç»Ÿçš„BFä»…æ”¯æŒä¸€ä¸ªé›†åˆï¼Œè€Œåœ¨dpdkä¸­è¿›è¡Œäº†å‘é‡åŒ–ï¼Œä½¿å…¶æ”¯æŒå¤šä¸ªé›†åˆã€‚</p>
<p><a href="/images/vbf.svg" title="vbf" class="gallery-item" style="box-shadow: none;"> <img src="/images/vbf.svg" alt="vbf"></a></p>
<h3 id="Sketch"><a href="#Sketch" class="headerlink" title="Sketch"></a>Sketch</h3><p>Count-Min Sketchï¼šä½¿ç”¨ä¸€ä¸ªäºŒç»´çš„ï¼ˆd*wï¼‰è®¡æ•°å™¨é˜µåˆ—æ¥ç»Ÿè®¡è¾“å…¥keyï¼ŒäºŒç»´é˜µåˆ—çš„æ¯ä¸€è¡Œéƒ½å¯¹åº”ä¸€ä¸ªhashå‡½æ•°ï¼Œæ€»å…±æœ‰dä¸ªhashå‡½æ•°ï¼Œå…¶å€¼åŸŸéƒ½åœ¨wå†…ã€‚æ¯æ·»åŠ ä¸€ä¸ªkeyï¼Œéƒ½éœ€è¦è®¡ç®—dæ¬¡hashï¼Œå¹¶æ›´æ–°å¯¹åº”ä½ç½®ä¸Šçš„è®¡æ•°å™¨ã€‚keyçš„è®¡æ•°ä¼°è®¡å€¼æ˜¯ç”±dä¸ªhashå‡½æ•°æ‰€æ˜ å°„åˆ°çš„é˜µåˆ—ä½ç½®çš„æœ€å°è®°æ•°å€¼è€Œç¡®å®šã€‚</p>
<p>![sketch](/images/count-min sketch.png)</p>
<p>è¯¥æ–¹æ³•ä»…æ”¯æŒä¸€ä¸ªé›†åˆï¼Œè¯¥é›†åˆä¸ºä¸€ä¸ªå¤§å°ä¸ºtopkçš„æœ€å°å †ï¼Œå †ä¸­å­˜å‚¨è®°æ•°ä¼°è®¡å€¼æœ€å¤§çš„å‰topkï¼ˆç”¨æˆ·é…ç½®ï¼‰ä¸ªkeyã€‚æŸ¥è¯¢æ—¶ï¼Œè‹¥æŸ¥è¯¢çš„keyåœ¨è¯¥å †ä¸­ï¼Œåˆ™å±äºè¯¥é›†åˆï¼Œå¦åˆ™ä¸å±äºè¯¥é›†åˆã€‚</p>
<p>ä¸ºäº†æé«˜æ€§èƒ½ï¼Œdpdké‡‡ç”¨äº†NitroSketchæ¥å®ç°ã€‚ç›¸æ¯”äºCount-Min Sketchï¼ŒNitroSketchåšäº†ä»¥ä¸‹ä¼˜åŒ–ï¼š</p>
<h4 id="ä¼˜åŒ–1-1"><a href="#ä¼˜åŒ–1-1" class="headerlink" title="ä¼˜åŒ–1"></a>ä¼˜åŒ–1</h4><p>å¯¹è®¡æ•°å™¨è¿›è¡Œé‡‡æ ·ï¼Œé€šè¿‡è®¾ç½®é‡‡æ ·ç‡pï¼Œæ’å…¥keyæ—¶å¯¹æ¯ä¸ªè®¡æ•°å™¨ä»¥pçš„æ¦‚ç‡è¿›è¡Œæ›´æ–°ï¼Œå…¶æ›´æ–°å€¼ä¸º<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="3.37ex" height="2.326ex" role="img" focusable="false" viewBox="0 -833.9 1489.7 1027.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="TeXAtom" transform="translate(536,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></g></g></svg></mjx-container></p>
<p><a href="/images/sample-counter.png" title="sample-counter" class="gallery-item" style="box-shadow: none;"> <img src="/images/sample-counter.png" alt="sample-counter"></a></p>
<p>æ­¤æ—¶å¯¹äºkeyçš„è®°æ•°ä¼°è®¡å€¼çš„è·å–ä¸å†ä½¿ç”¨æœ€å°è®°æ•°å€¼ï¼Œè€Œæ˜¯ä½¿ç”¨ä¸­ä½æ•°æŠ€æœ¯å€¼ï¼Œä»¥æé«˜å‡†ç¡®æ€§ã€‚</p>
<h4 id="ä¼˜åŒ–2-1"><a href="#ä¼˜åŒ–2-1" class="headerlink" title="ä¼˜åŒ–2"></a>ä¼˜åŒ–2</h4><p>æ’å…¥keyæ—¶ï¼Œæ¯ä¸ªè®¡æ•°å™¨æ˜¯å¦æ›´æ–°ï¼Œä¸€èˆ¬æ¥è¯´æ˜¯é€šè¿‡æŠ›ç¡¬å¸ï¼ˆå‚æ•°ä¸ºpçš„0-1åˆ†å¸ƒï¼‰çš„æ–¹å¼å†³å®šã€‚è¿™æ ·ä¸€æ¥æ¯æ’å…¥ä¸€ä¸ªkeyå°±éœ€è¦è¿›è¡Œdæ¬¡æŠ›ç¡¬å¸æ“ä½œï¼Œæ›´åŠ é«˜æ•ˆçš„å®ç°æ–¹å¼æ˜¯é€šè¿‡å‡ ä½•æ ·æœ¬ï¼ˆæœä»å‚æ•°ä¸ºpçš„å‡ ä½•åˆ†å¸ƒçš„å˜é‡ï¼‰æ¥è·å–ä¸‹ä¸€ä¸ªéœ€è¦æ›´æ–°çš„è®¡æ•°å™¨çš„ä½ç½®ï¼Œé¿å…äº†æ¯æ¬¡æŠ›ç¡¬å¸å¸¦æ¥çš„æ€§èƒ½çš„æŸè€—ã€‚</p>
<p><a href="/images/geometric-sampling.png" title="geometric" class="gallery-item" style="box-shadow: none;"> <img src="/images/geometric-sampling.png" alt="geometric"></a></p>
<p>åˆ©ç”¨<strong>é€†å˜æ¢é‡‡æ ·</strong>æ„é€ å‡ ä½•æ ·æœ¬ï¼š</p>
<blockquote>
<p>å‡è®¾Xä¸ºä¸€ä¸ªè¿ç»­éšæœºå˜é‡ï¼Œå…¶ç´¯ç§¯åˆ†å¸ƒå‡½æ•°ä¸º<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.339ex;" xmlns="http://www.w3.org/2000/svg" width="3.006ex" height="1.878ex" role="img" focusable="false" viewBox="0 -680 1328.5 830"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mi" transform="translate(676,-150) scale(0.707)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g></g></g></g></svg></mjx-container>ã€‚æ­¤æ—¶ï¼Œéšæœºå˜é‡<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="11.437ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 5055 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44C" d="M66 637Q54 637 49 637T39 638T32 641T30 647T33 664T42 682Q44 683 56 683Q104 680 165 680Q288 680 306 683H316Q322 677 322 674T320 656Q316 643 310 637H298Q242 637 242 624Q242 619 292 477T343 333L346 336Q350 340 358 349T379 373T411 410T454 461Q546 568 561 587T577 618Q577 634 545 637Q528 637 528 647Q528 649 530 661Q533 676 535 679T549 683Q551 683 578 682T657 680Q684 680 713 681T746 682Q763 682 763 673Q763 669 760 657T755 643Q753 637 734 637Q662 632 617 587Q608 578 477 424L348 273L322 169Q295 62 295 57Q295 46 363 46Q379 46 384 45T390 35Q390 33 388 23Q384 6 382 4T366 1Q361 1 324 1T232 2Q170 2 138 2T102 1Q84 1 84 9Q84 14 87 24Q88 27 89 30T90 35T91 39T93 42T96 44T101 45T107 45T116 46T129 46Q168 47 180 50T198 63Q201 68 227 171L252 274L129 623Q128 624 127 625T125 627T122 629T118 631T113 633T105 634T96 635T83 636T66 637Z"></path></g><g data-mml-node="mo" transform="translate(1040.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msub" transform="translate(2096.6,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mi" transform="translate(676,-150) scale(0.707)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g></g><g data-mml-node="mo" transform="translate(3425,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(3814,0)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g><g data-mml-node="mo" transform="translate(4666,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>æœä»åŒºé—´[0,1]ä¸Šçš„å‡åŒ€åˆ†å¸ƒã€‚é€†å˜æ¢é‡‡æ ·å³æ˜¯å°†è¯¥è¿‡ç¨‹åè¿‡æ¥è¿›è¡Œï¼šé¦–å…ˆå¯¹äºéšæœºå˜é‡ Yï¼Œæˆ‘ä»¬ä»0è‡³1ä¸­éšæœºå‡åŒ€æŠ½å–ä¸€ä¸ªæ•°uã€‚ä¹‹åï¼Œç”±äºéšæœºå˜é‡<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.7ex;" xmlns="http://www.w3.org/2000/svg" width="7.538ex" height="2.697ex" role="img" focusable="false" viewBox="0 -882.5 3332 1191.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(837.3,411.6) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mi" transform="translate(676,-309.4) scale(0.707)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g></g><g data-mml-node="mo" transform="translate(1791,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(2180,0)"><path data-c="1D44C" d="M66 637Q54 637 49 637T39 638T32 641T30 647T33 664T42 682Q44 683 56 683Q104 680 165 680Q288 680 306 683H316Q322 677 322 674T320 656Q316 643 310 637H298Q242 637 242 624Q242 619 292 477T343 333L346 336Q350 340 358 349T379 373T411 410T454 461Q546 568 561 587T577 618Q577 634 545 637Q528 637 528 647Q528 649 530 661Q533 676 535 679T549 683Q551 683 578 682T657 680Q684 680 713 681T746 682Q763 682 763 673Q763 669 760 657T755 643Q753 637 734 637Q662 632 617 587Q608 578 477 424L348 273L322 169Q295 62 295 57Q295 46 363 46Q379 46 384 45T390 35Q390 33 388 23Q384 6 382 4T366 1Q361 1 324 1T232 2Q170 2 138 2T102 1Q84 1 84 9Q84 14 87 24Q88 27 89 30T90 35T91 39T93 42T96 44T101 45T107 45T116 46T129 46Q168 47 180 50T198 63Q201 68 227 171L252 274L129 623Q128 624 127 625T125 627T122 629T118 631T113 633T105 634T96 635T83 636T66 637Z"></path></g><g data-mml-node="mo" transform="translate(2943,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>ä¸Xæœ‰ç€ç›¸åŒçš„åˆ†å¸ƒï¼Œ<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.7ex;" xmlns="http://www.w3.org/2000/svg" width="11.418ex" height="2.697ex" role="img" focusable="false" viewBox="0 -882.5 5046.5 1191.9"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(849.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msubsup" transform="translate(1905.6,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="TeXAtom" transform="translate(837.3,411.6) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mo"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mn" transform="translate(778,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mi" transform="translate(676,-309.4) scale(0.707)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g></g><g data-mml-node="mo" transform="translate(3696.5,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(4085.5,0)"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(4657.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g></g></svg></mjx-container>å³å¯çœ‹ä½œæ˜¯ä»åˆ†å¸ƒ<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.339ex;" xmlns="http://www.w3.org/2000/svg" width="3.006ex" height="1.878ex" role="img" focusable="false" viewBox="0 -680 1328.5 830"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mi" transform="translate(676,-150) scale(0.707)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g></g></g></g></svg></mjx-container>ä¸­ç”Ÿæˆçš„éšæœºæ ·æœ¬ã€‚</p>
</blockquote>
<p>éšæœºå˜é‡X~G(p)çš„ç´¯ç§¯åˆ†å¸ƒå‡½æ•°å¯è¡¨ç¤ºä¸ºï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="33.275ex" height="2.61ex" role="img" focusable="false" viewBox="0 -903.7 14707.4 1153.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mi" transform="translate(676,-150) scale(0.707)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g></g><g data-mml-node="mo" transform="translate(1328.5,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(1717.5,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(2238.5,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(2905.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3961,0)"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(4712,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(5101,0)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g><g data-mml-node="mo" transform="translate(6230.8,0)"><path data-c="2264" d="M674 636Q682 636 688 630T694 615T687 601Q686 600 417 472L151 346L399 228Q687 92 691 87Q694 81 694 76Q694 58 676 56H670L382 192Q92 329 90 331Q83 336 83 348Q84 359 96 365Q104 369 382 500T665 634Q669 636 674 636ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path></g><g data-mml-node="mi" transform="translate(7286.6,0)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g><g data-mml-node="mo" transform="translate(7807.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(8474.3,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(9530.1,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(10252.3,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mo" transform="translate(11252.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(11641.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(12363.8,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(13364,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="msup" transform="translate(13867,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mi" transform="translate(422,413) scale(0.707)"><path data-c="1D458" d="M121 647Q121 657 125 670T137 683Q138 683 209 688T282 694Q294 694 294 686Q294 679 244 477Q194 279 194 272Q213 282 223 291Q247 309 292 354T362 415Q402 442 438 442Q468 442 485 423T503 369Q503 344 496 327T477 302T456 291T438 288Q418 288 406 299T394 328Q394 353 410 369T442 390L458 393Q446 405 434 405H430Q398 402 367 380T294 316T228 255Q230 254 243 252T267 246T293 238T320 224T342 206T359 180T365 147Q365 130 360 106T354 66Q354 26 381 26Q429 26 459 145Q461 153 479 153H483Q499 153 499 144Q499 139 496 130Q455 -11 378 -11Q333 -11 305 15T277 90Q277 108 280 121T283 145Q283 167 269 183T234 206T200 217T182 220H180Q168 178 159 139T145 81T136 44T129 20T122 7T111 -2Q98 -11 83 -11Q66 -11 57 -1T48 16Q48 26 85 176T158 471L195 616Q196 629 188 632T149 637H144Q134 637 131 637T124 640T121 647Z"></path></g></g></g></g></svg></mjx-container><br>é‡‡ç”¨é€†å˜æ¢é‡‡æ ·å¾—åˆ°ï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="37.898ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 16751 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(849.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="msub" transform="translate(1905.6,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g><g data-mml-node="mi" transform="translate(676,-150) scale(0.707)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g></g><g data-mml-node="mo" transform="translate(3234,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(3623,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(4195,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(4861.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(5917.6,0)"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mo" transform="translate(6668.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(7057.6,0)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g><g data-mml-node="mo" transform="translate(8187.3,0)"><path data-c="2264" d="M674 636Q682 636 688 630T694 615T687 601Q686 600 417 472L151 346L399 228Q687 92 691 87Q694 81 694 76Q694 58 676 56H670L382 192Q92 329 90 331Q83 336 83 348Q84 359 96 365Q104 369 382 500T665 634Q669 636 674 636ZM84 -118Q84 -108 99 -98H678Q694 -104 694 -118Q694 -130 679 -138H98Q84 -131 84 -118Z"></path></g><g data-mml-node="mi" transform="translate(9243.1,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(9815.1,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(10481.9,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(11537.7,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(12259.9,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mo" transform="translate(13260.1,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(13649.1,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(14371.3,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(15371.6,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="msup" transform="translate(15874.6,0)"><g data-mml-node="mo"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mi" transform="translate(422,413) scale(0.707)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g></g></g></g></svg></mjx-container><br>å¾—å‡ºéšæœºå˜é‡Xçš„å‡ ä½•æ ·æœ¬xä¸ºï¼š<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.172ex;" xmlns="http://www.w3.org/2000/svg" width="14.145ex" height="5.475ex" role="img" focusable="false" viewBox="0 -1460 6252 2420"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(849.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(1905.6,0)"><g data-mml-node="mrow" transform="translate(220,710)"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(1223,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1945.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2945.4,0)"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mo" transform="translate(3517.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><g data-mml-node="mrow" transform="translate(254.5,-710)"><g data-mml-node="mi"><path data-c="6C" d="M42 46H56Q95 46 103 60V68Q103 77 103 91T103 124T104 167T104 217T104 272T104 329Q104 366 104 407T104 482T104 542T103 586T103 603Q100 622 89 628T44 637H26V660Q26 683 28 683L38 684Q48 685 67 686T104 688Q121 689 141 690T171 693T182 694H185V379Q185 62 186 60Q190 52 198 49Q219 46 247 46H263V0H255L232 1Q209 2 183 2T145 3T107 3T57 1L34 0H26V46H42Z"></path><path data-c="6E" d="M41 46H55Q94 46 102 60V68Q102 77 102 91T102 122T103 161T103 203Q103 234 103 269T102 328V351Q99 370 88 376T43 385H25V408Q25 431 27 431L37 432Q47 433 65 434T102 436Q119 437 138 438T167 441T178 442H181V402Q181 364 182 364T187 369T199 384T218 402T247 421T285 437Q305 442 336 442Q450 438 463 329Q464 322 464 190V104Q464 66 466 59T477 49Q498 46 526 46H542V0H534L510 1Q487 2 460 2T422 3Q319 3 310 0H302V46H318Q379 46 379 62Q380 64 380 200Q379 335 378 343Q372 371 358 385T334 402T308 404Q263 404 229 370Q202 343 195 315T187 232V168V108Q187 78 188 68T191 55T200 49Q221 46 249 46H265V0H257L234 1Q210 2 183 2T145 3Q42 3 33 0H25V46H41Z" transform="translate(278,0)"></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="2061" d=""></path></g><g data-mml-node="mo" transform="translate(834,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mn" transform="translate(1223,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(1945.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(2945.4,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"></path></g><g data-mml-node="mo" transform="translate(3448.4,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g></g><rect width="4106.4" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></p>
<h4 id="ä¼˜åŒ–3-1"><a href="#ä¼˜åŒ–3-1" class="headerlink" title="ä¼˜åŒ–3"></a>ä¼˜åŒ–3</h4><p>åœ¨å¼€å§‹é˜¶æ®µæ—¶ä¸ä½¿ç”¨NitroSketchæ–¹æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨Count-Min Sketchæ–¹æ³•ï¼Œåœ¨æ¥æ”¶ä¸€å®šæ•°é‡çš„keyï¼ˆç»Ÿè®¡è®°æ•°æ”¶æ•›ï¼‰åï¼Œå†é‡‡å–NitroSketchæ–¹æ³•ã€‚è¿™æ ·å³ä¿è¯äº†ç»Ÿè®¡çš„å‡†ç¡®æ€§ï¼Œä¹Ÿæå‡äº†æ€§èƒ½ã€‚</p>
<h4 id="é¢å¤–API"><a href="#é¢å¤–API" class="headerlink" title="é¢å¤–API"></a>é¢å¤–API</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–ç‰¹å®škeyçš„è®°æ•°ä¼°è®¡å€¼</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_member_query_count</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_member_setsum *setsum,</span></span><br><span class="line"><span class="params">		       <span class="type">const</span> <span class="type">void</span> *key, <span class="type">uint64_t</span> *count)</span>;</span><br><span class="line"><span class="comment">//è·å–top-kçš„keyå’Œè®°æ•°ä¼°è®¡å€¼</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_member_report_heavyhitter</span><span class="params">(<span class="type">const</span> <span class="keyword">struct</span> rte_member_setsum *setsum,</span></span><br><span class="line"><span class="params">			      <span class="type">void</span> **keys, <span class="type">uint64_t</span> *counts)</span>;</span><br></pre></td></tr></table></figure>



<h1 id="Graph"><a href="#Graph" class="headerlink" title="Graph"></a>Graph</h1><p>åˆ©ç”¨æœ‰å‘å›¾å»æ„å»ºdpdkçš„æŠ¥æ–‡å¤„ç†æ¡†æ¶ï¼Œè¯¥æ¡†æ¶æ”¯æŒä¸¤ç§è¿è¡Œæ¨¡å‹</p>
<ul>
<li><p>RTC(Run-To-Completion)ï¼šé»˜è®¤çš„å›¾è¿è¡Œæ¨¡å‹ï¼Œä»…éœ€è¦ä¸€ä¸ªworkerçº¿ç¨‹è¿›è¡Œå›¾éå†ã€‚å¦‚æœå­˜åœ¨nä¸ªworkerçº¿ç¨‹ï¼Œéœ€åˆ›å»ºnä¸ªå›¾ã€‚</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Graph: node-0 -&gt; node-1 -&gt; node-2 @Core0.</span><br><span class="line">+ - - - - - - - - - - - - - - - - - - - - - +</span><br><span class="line">'                  Core #0                  '</span><br><span class="line">'                                           '</span><br><span class="line">' +--------+     +---------+     +--------+ '</span><br><span class="line">' | Node-0 | --&gt; | Node-1  | --&gt; | Node-2 | '</span><br><span class="line">' +--------+     +---------+     +--------+ '</span><br><span class="line">'                                           '</span><br><span class="line">+ - - - - - - - - - - - - - - - - - - - - - +</span><br></pre></td></tr></table></figure>
</li>
<li><p>Dispatch modelï¼šå°†å›¾ä¸­å„ä¸ªèŠ‚ç‚¹çš„æ‰§è¡Œæƒé™åˆ†é…ç»™ä¸åŒçš„workerçº¿ç¨‹ï¼Œæ¯ä¸ªworkerçº¿ç¨‹åœ¨è¿›è¡Œå›¾éå†æ—¶ï¼Œè‹¥éå†åˆ°éœ€è¦å…¶ä»–çº¿ç¨‹æ‰èƒ½æ‰§è¡Œçš„èŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡è·¨æ ¸è°ƒåº¦æœºåˆ¶å°†ç›¸å…³ä¿¡æ¯è½¬äº¤ç»™å…¶ä»–çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚</p>
  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Graph topo: node-0 -&gt; node1 -&gt; node-2 -&gt; node-3. </span><br><span class="line">Config graph: node-0 @Core0; node-1/3 @Core1; node-2 @Core2.</span><br><span class="line">+ - - - - - -+     +- - - - - - - - - - - - - +     + - - - - - -+</span><br><span class="line">'  Core #0   '     '          Core #1         '     '  Core #2   '</span><br><span class="line">'            '     '                          '     '            '</span><br><span class="line">' +--------+ '     ' +--------+    +--------+ '     ' +--------+ '</span><br><span class="line">' | Node-0 | - - - -&gt;| Node-1 |    | Node-3 |&lt;- - - - | Node-2 | '</span><br><span class="line">' +--------+ '     ' +--------+    +--------+ '     ' +--------+ '</span><br><span class="line">'            '     '     |                    '     '      ^     '</span><br><span class="line">+ - - - - - -+     +- - -|- - - - - - - - - - +     + - - -|- - -+</span><br><span class="line">                         |                                 |</span><br><span class="line">                         + - - - - - - - - - - - - - - - - +</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h2><p>å›¾ç”±èŠ‚ç‚¹æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¤„ç†æµç¨‹ã€‚dpdkå¯¹äºèŠ‚ç‚¹åšäº†å•ç‹¬çš„æŠ½è±¡<code>struct node</code>ã€‚åœ¨å›¾åˆ›å»ºæ—¶ï¼Œdpdkä¼šè·å–æ‰€éœ€çš„èŠ‚ç‚¹æ¥æ„å»ºå›¾ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå›¾ä¸­çš„å›¾èŠ‚ç‚¹<code>struct rte_node</code>ä¸èŠ‚ç‚¹<code>struct node</code>æ˜¯ä¸¤ä¸ªä¸åŒçš„æ•°æ®ç»“æ„ï¼ŒèŠ‚ç‚¹æ›´åƒæ˜¯<strong>ç±»</strong>ï¼Œè€Œå›¾ä¸­çš„å›¾èŠ‚ç‚¹æ›´åƒæ˜¯<strong>å®ä¾‹</strong>ã€‚</p>
<p><a href="/images/anatomy_of_a_node.svg" title="node" class="gallery-item" style="box-shadow: none;"> <img src="/images/anatomy_of_a_node.svg" alt="node"></a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> {</span></span><br><span class="line">	STAILQ_ENTRY(node) next;      <span class="comment">/**&lt; Next node in the list. */</span></span><br><span class="line">	<span class="type">char</span> name[RTE_NODE_NAMESIZE]; <span class="comment">/**&lt; Name of the node. */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_NODE_SOURCE_F (1ULL &lt;&lt; 0) <span class="comment">/**&lt; Node type is source. */</span></span></span><br><span class="line">	<span class="type">uint64_t</span> flags;		      <span class="comment">/**&lt; Node configuration flag. */</span></span><br><span class="line">	<span class="type">unsigned</span> <span class="type">int</span> lcore_id;</span><br><span class="line">	<span class="comment">/**&lt; Node runs on the Lcore ID used for mcore dispatch model. */</span></span><br><span class="line">	<span class="type">rte_node_process_t</span> process;   <span class="comment">/**&lt; Node process function. */</span></span><br><span class="line">	<span class="type">rte_node_init_t</span> init;         <span class="comment">/**&lt; Node init function. */</span></span><br><span class="line">	<span class="type">rte_node_fini_t</span> fini;	      <span class="comment">/**&lt; Node fini function. */</span></span><br><span class="line">	<span class="type">rte_node_t</span> id;		      <span class="comment">/**&lt; Allocated identifier for the node. */</span></span><br><span class="line">	<span class="type">rte_node_t</span> parent_id;	      <span class="comment">/**&lt; Parent node identifier. */</span></span><br><span class="line">	<span class="type">rte_edge_t</span> nb_edges;	      <span class="comment">/**&lt; Number of edges from this node. */</span></span><br><span class="line">	<span class="type">char</span> next_nodes[][RTE_NODE_NAMESIZE]; <span class="comment">/**&lt; Names of next nodes. */</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">//èŠ‚ç‚¹æ³¨å†Œå‡½æ•°</span></span><br><span class="line">RTE_NODE_REGISTER(node)</span><br><span class="line"><span class="comment">//é€šè¿‡å…‹éš†æ¥æ³¨å†Œæ–°èŠ‚ç‚¹ï¼Œæ–°èŠ‚ç‚¹çš„åç§°ä¸º"oldname-newname"ã€‚è¿™åœ¨éœ€è¦åˆ›å»ºå¤šä¸ªRx/TxèŠ‚ç‚¹æ—¶å¾ˆæœ‰ç”¨</span></span><br><span class="line"><span class="type">rte_node_t</span> <span class="title function_">rte_node_clone</span><span class="params">(<span class="type">rte_node_t</span> id, <span class="type">const</span> <span class="type">char</span> *name)</span>;</span><br></pre></td></tr></table></figure>



<h3 id="Nodeå‡ºè¾¹çš„æ›´æ–°"><a href="#Nodeå‡ºè¾¹çš„æ›´æ–°" class="headerlink" title="Nodeå‡ºè¾¹çš„æ›´æ–°"></a>Nodeå‡ºè¾¹çš„æ›´æ–°</h3><p>èŠ‚ç‚¹é€šè¿‡å‡ºè¾¹<code>next_nodes</code>ä¸å…¶ä»–èŠ‚ç‚¹å…³è”èµ·æ¥ï¼Œæ„æˆæ‹“æ‰‘å›¾</p>
<p><a href="/images/link_the_nodes.svg" title="topology" class="gallery-item" style="box-shadow: none;"> <img src="/images/link_the_nodes.svg" alt="topology"></a></p>
<p>ä¸€èˆ¬æ¥è¯´èŠ‚ç‚¹çš„å‡ºè¾¹åœ¨èŠ‚ç‚¹æ³¨å†Œæ—¶å°±å·²ç»å†³å®šä¸‹æ¥äº†ï¼Œè‹¥æƒ³åœ¨èŠ‚ç‚¹æ³¨å†Œåè·å–/ä¿®æ”¹èŠ‚ç‚¹çš„å‡ºè¾¹ï¼Œå¯è°ƒç”¨<code>rte_node_edge_get()</code>, <code>rte_node_edge_update()</code>, <code>rte_node_edge_shrink()</code>å‡½æ•°</p>
<h2 id="Graph-object"><a href="#Graph-object" class="headerlink" title="Graph object"></a>Graph object</h2><p>dpdkå°†å›¾æŠ½è±¡ä¸º<code>struct graph</code>ç»“æ„ï¼Œå­˜æ”¾ç€å›¾çš„å„ç±»ä¿¡æ¯ï¼Œå…¶ä¸­æœ€é‡è¦çš„æˆå‘˜æ˜¯<code>struct rte_graph</code>ï¼Œè¯¥æˆå‘˜ä¿å­˜ç€å›¾èŠ‚ç‚¹ä»¥åŠå›¾éå†æ—¶æ‰€éœ€è¦çš„é˜Ÿåˆ—åŠå…¶ç›¸å…³ä¿¡æ¯ã€‚</p>
<p><a href="/images/graph_mem_layout.svg" title="graph" class="gallery-item" style="box-shadow: none;"> <img src="/images/graph_mem_layout.svg" alt="graph"></a></p>
<ul>
<li><p>Circular Bufferï¼šå›¾éå†æ—¶æ‰€ç”¨åˆ°çš„é˜Ÿåˆ—</p>
</li>
<li><p>Source Nodeï¼šå›¾ä¸­çš„æºç‚¹ï¼Œå›¾éå†çš„èµ·ç‚¹</p>
</li>
<li><p>Enqueue Nodeï¼šå›¾ä¸­éœ€è¦è¢«æ‰§è¡Œçš„èŠ‚ç‚¹ï¼Œå›¾éå†æ—¶æ·»åŠ </p>
</li>
<li><p>Fastpath areaï¼šå­˜æ”¾ç€è¯¥èŠ‚ç‚¹å¾…å¤„ç†çš„æ•°æ®</p>
</li>
</ul>
<h3 id="å›¾éå†"><a href="#å›¾éå†" class="headerlink" title="å›¾éå†"></a>å›¾éå†</h3><p>dpdkå¯¹äºæŠ¥æ–‡çš„å¤„ç†ï¼Œåœ¨å›¾æ¡†æ¶ä¸­å°±æ˜¯å¯¹å›¾çš„éå†ã€‚dpdkå¯¹å›¾éå†é‡‡ç”¨BFSç®—æ³•ï¼Œä»æºèŠ‚ç‚¹å¼€å§‹è®¿é—®ï¼Œæ ¹æ®æŠ¥æ–‡å†…å®¹ï¼Œç¡®å®šè¦è®¿é—®çš„ä¸‹ä¸€ä¸ªå›¾èŠ‚ç‚¹ï¼Œå°†æŠ¥æ–‡æŒ‡é’ˆæ”¾åˆ°å¯¹åº”å›¾èŠ‚ç‚¹çš„<code>Fastpath area</code>ä¸­ï¼Œå¹¶å°†è¯¥å›¾èŠ‚ç‚¹åœ¨å›¾<code>struct rte_graph</code>ä¸­çš„ç´¢å¼•æ”¾åˆ°<code>Circular Buffer</code>ä¸­ã€‚</p>
<p>æ ¹æ®å„èŠ‚ç‚¹ç¡®å®šnext nodeçš„æ–¹æ³•çš„ä¸åŒï¼Œdpdkå°†èŠ‚ç‚¹åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>é™æ€èŠ‚ç‚¹ï¼šè¯¥ç±»èŠ‚ç‚¹å¯¹äºnext nodeçš„é€‰æ‹©æ˜¯å›ºå®šçš„ï¼Œå³å¯¹äºè¯¥èŠ‚ç‚¹æ‰€æ”¶åˆ°çš„æ‰¹é‡æŠ¥æ–‡ï¼Œéƒ½è½¬äº¤ç»™å›ºå®šçš„å›¾èŠ‚ç‚¹ä¸­ã€‚è¯¥ç±»èŠ‚ç‚¹çš„<code>process()</code>å¯ä»¥ä½¿ç”¨<code>rte_node_next_stream_move()</code>å‡½æ•°æ¥è½¬äº¤æ‰¹é‡æŠ¥æ–‡åˆ°next nodeå¹¶å°†next nodeæ·»åŠ åˆ°BFSçš„é˜Ÿåˆ—ä¸­ã€‚</li>
<li>ä¸­é—´èŠ‚ç‚¹ï¼šè¯¥ç±»èŠ‚ç‚¹å¯¹äºnext nodeçš„é€‰æ‹©æ˜¯ä¸å›ºå®šçš„ï¼Œå³å¯¹äºè¯¥èŠ‚ç‚¹æ‰€æ”¶åˆ°çš„æ‰€æœ‰æŠ¥æ–‡ï¼ŒæŒ‰èŠ‚ç‚¹çš„å¤„ç†ç»“æœè½¬äº¤ç»™ä¸åŒçš„å›¾èŠ‚ç‚¹ã€‚ç›¸æ¯”äºé™æ€èŠ‚ç‚¹ï¼Œè¯¥ç±»èŠ‚ç‚¹çš„æŠ¥æ–‡è½¬äº¤å¼€é”€è¾ƒå¤§ã€‚å®é™…ä¸Šåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œè¯¥ç±»èŠ‚ç‚¹æ‰€æ”¶åˆ°çš„æ‰¹é‡æŠ¥æ–‡çš„next nodeéƒ½æŒ‡å‘åŒä¸€ä¸ªï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨<code>rte_node_next_stream_move()</code>å‡½æ•°æ¥æ‰¹é‡è½¬äº¤æŠ¥æ–‡åˆ°next nodeï¼Œè¿™ç§å¤„ç†è¢«ç§°ä¸º==home run==ã€‚</li>
</ul>
<p>å¯¹äºä¸­é—´èŠ‚ç‚¹çš„<code>process()</code>å‡½æ•°çš„å®ç°ï¼Œdpdkç»™å‡ºäº†ä¸€å¥—æµç¨‹ï¼š</p>
<ol>
<li><p>é¦–å…ˆæ ¹æ®node-&gt;ctxï¼ŒçŒœæµ‹ä¸€ä¸ªnext nodeï¼ˆä¹Ÿå¯ä»¥ä¸é€šè¿‡node-&gt;ctxï¼Œç›´æ¥ç¡¬ç¼–ç å®ç°ï¼‰ï¼š</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">next_index = node-&gt;ctx</span><br></pre></td></tr></table></figure>
</li>
<li><p>è°ƒç”¨<code>rte_node_next_stream_get()</code>è·å–next nodeçš„<code>Fastpath area</code>ï¼š</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">to_next = rte_node_next_stream_get(graph, node, next_index, nb_mbufs)</span><br></pre></td></tr></table></figure>
</li>
<li><p>éå†è¯¥èŠ‚ç‚¹æ”¶åˆ°çš„æ‰¹é‡æŠ¥æ–‡ï¼Œå¹¶æ ¹æ®æŠ¥æ–‡å†…å®¹ï¼Œç¡®å®šè¯¥æŠ¥æ–‡è¦è½¬äº¤çš„next nodeï¼Œå¦‚æœæ‰€ç¡®å®šçš„next nodeä¸çŒœæµ‹çš„<code>next_index</code>ç›¸ç­‰ï¼Œåˆ™ç›´æ¥å°†æŠ¥æ–‡æŒ‡é’ˆæ”¾å…¥<code>to_next</code>ä¸­ï¼Œå¦åˆ™è°ƒç”¨<code>rte_node_enqueue_x1()</code>å°†è¯¥æŠ¥æ–‡è½¬å…¥æ‰€ç¡®å®šçš„next nodeä¸­ï¼š</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">next = do_something(mbuf)</span><br><span class="line"><span class="keyword">if</span>(next == next_index)</span><br><span class="line">    to_next[i++] = mbuf</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    rte_node_enqueue_x1(graph, node, next, mbuf)</span><br></pre></td></tr></table></figure>
</li>
<li><p>å¦‚æœæ‰€æœ‰æŠ¥æ–‡éƒ½è½¬äº¤ç»™æ‰€çŒœæµ‹çš„<code>next_index</code>ä¸­ï¼Œåˆ™åš==home run==å¤„ç†ï¼Œå¦åˆ™è°ƒç”¨<code>rte_node_next_stream_put()</code>è¿›è¡ŒæŠ¥æ–‡è½¬äº¤ï¼š</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(i == nb_mbufs)</span><br><span class="line">    rte_node_next_stream_move(graph, node, next_index)</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    rte_node_next_stream_put(graph, node, next_index, i)</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¹æ®è¯¥èŠ‚ç‚¹ä¸­å„æŠ¥æ–‡å¯¹äºnext nodeçš„é€‰æ‹©æƒ…å†µï¼Œæ›´æ–°node-&gt;ctx</p>
</li>
</ol>
<blockquote>
<p>ä¸Šè¿°æµç¨‹çš„ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†å°½å¯èƒ½æ‰§è¡Œ==home run==å¤„ç†ï¼Œå› ä¸º==home run==å¤„ç†å¯ä»¥é¿å…ä¸å¿…è¦çš„å†…å­˜æ‹·è´ï¼Œæé«˜æ€§èƒ½</p>
</blockquote>
<h2 id="Graphä½¿ç”¨"><a href="#Graphä½¿ç”¨" class="headerlink" title="Graphä½¿ç”¨"></a>Graphä½¿ç”¨</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_graph_param</span> {</span></span><br><span class="line">	<span class="type">int</span> socket_id; <span class="comment">/**&lt; Socket id where memory is allocated. */</span></span><br><span class="line">	<span class="type">uint16_t</span> nb_node_patterns;  <span class="comment">/**&lt; Number of node patterns. */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">char</span> **node_patterns;</span><br><span class="line">	<span class="comment">/**&lt; Array of node patterns based on shell pattern. */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">bool</span> pcap_enable; <span class="comment">/**&lt; Pcap enable. */</span></span><br><span class="line">	<span class="type">uint64_t</span> num_pkt_to_capture; <span class="comment">/**&lt; Number of packets to capture. */</span></span><br><span class="line">	<span class="type">char</span> *pcap_filename; <span class="comment">/**&lt; Filename in which packets to be captured.*/</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">			<span class="type">uint64_t</span> rsvd; <span class="comment">/**&lt; Reserved for rtc model. */</span></span><br><span class="line">		} rtc;</span><br><span class="line">		<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">			<span class="type">uint32_t</span> wq_size_max; <span class="comment">/**&lt; Maximum size of workqueue for dispatch model. */</span></span><br><span class="line">			<span class="type">uint32_t</span> mp_capacity; <span class="comment">/**&lt; Capacity of memory pool for dispatch model. */</span></span><br><span class="line">		} dispatch;</span><br><span class="line">	};</span><br><span class="line">}</span><br><span class="line"><span class="comment">//åˆ›å»ºè¿è¡Œæ¨¡å‹ä¸ºRTCçš„å›¾</span></span><br><span class="line"><span class="type">rte_graph_t</span> <span class="title function_">rte_graph_create</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name, <span class="keyword">struct</span> rte_graph_param *prm)</span>;</span><br><span class="line"><span class="comment">//å›¾è¿è¡Œæ¨¡å‹çš„è®¾ç½®ï¼Œéœ€åœ¨å›¾åˆ›å»ºåè°ƒç”¨(è¿è¡Œæ¨¡å‹è‹¥ä¸ºRTCåˆ™ä¸éœ€è¦è°ƒç”¨è¯¥å‡½æ•°)</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_graph_worker_model_set</span><span class="params">(<span class="type">uint8_t</span> model)</span>;</span><br><span class="line"><span class="comment">//ç»‘å®šèŠ‚ç‚¹æ‰€èƒ½è¿è¡Œçš„lcoreï¼Œå›¾çš„è¿è¡Œæ¨¡å‹ä¸ºDispatch modelæ—¶ä½¿ç”¨ï¼Œéœ€è¦åœ¨rte_graph_clone()ä¹‹å‰è®¾ç½®å¥½</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_graph_model_mcore_dispatch_node_lcore_affinity_set</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *name,</span></span><br><span class="line"><span class="params">							   <span class="type">unsigned</span> <span class="type">int</span> lcore_id)</span>;</span><br><span class="line"><span class="comment">//é€šè¿‡å…‹éš†æ¥åˆ›å»ºå­å›¾ï¼Œå­å›¾ä¸åŸå›¾ç±»ä¼¼ï¼Œä½†å¤šäº†å¯¹Dispatch modelçš„åˆå§‹åŒ–ã€‚åœ¨é€‰æ‹©äº†Dispatch modelä½œä¸ºè¿è¡Œæ¨¡å‹çš„æƒ…å†µä¸‹ï¼Œéœ€è°ƒç”¨è¯¥å‡½æ•°æ¥åˆ›å»ºworkerçº¿ç¨‹è¿›è¡Œå›¾éå†æ—¶æ‰€éœ€çš„å›¾</span></span><br><span class="line"><span class="type">rte_graph_t</span> <span class="title function_">rte_graph_clone</span><span class="params">(<span class="type">rte_graph_t</span> id, <span class="type">const</span> <span class="type">char</span> *name, <span class="keyword">struct</span> rte_graph_param *prm)</span>;</span><br><span class="line"><span class="comment">//å°†å›¾ç»‘å®šåˆ°å¯¹åº”çš„workerçº¿ç¨‹ä¸Šï¼Œè¯¥å›¾å¿…é¡»æ˜¯é€šè¿‡rte_graph_clone()åˆ›å»ºå‡ºæ¥çš„</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_graph_model_mcore_dispatch_core_bind</span><span class="params">(<span class="type">rte_graph_t</span> id, <span class="type">int</span> lcore)</span>;</span><br><span class="line"><span class="comment">//å›¾éå†å‡½æ•°</span></span><br><span class="line"><span class="type">static</span> <span class="keyword">inline</span> <span class="type">void</span> <span class="title function_">rte_graph_walk</span><span class="params">(<span class="keyword">struct</span> rte_graph *graph)</span></span><br><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªç”¨äºæ•´åˆå›¾ç°‡(ä¸€ç»„å›¾)ä¸­å„èŠ‚ç‚¹ç»Ÿè®¡æ•°æ®çš„ç»“æ„</span></span><br><span class="line"><span class="keyword">struct</span> rte_graph_cluster_stats *<span class="title function_">rte_graph_cluster_stats_create</span><span class="params">(</span></span><br><span class="line"><span class="params">			<span class="type">const</span> <span class="keyword">struct</span> rte_graph_cluster_stats_param *prm)</span>;</span><br><span class="line"><span class="comment">//è·å–è¯¥å›¾ç°‡çš„ç»Ÿè®¡ä¿¡æ¯</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">rte_graph_cluster_stats_get</span><span class="params">(<span class="keyword">struct</span> rte_graph_cluster_stats *stat,</span></span><br><span class="line"><span class="params">				 <span class="type">bool</span> skip_cb)</span>;</span><br></pre></td></tr></table></figure>



<h1 id="PacketFrame"><a href="#PacketFrame" class="headerlink" title="PacketFrame"></a>PacketFrame</h1><p>ä»¥åå†è¯´ã€‚</p>
<h2 id="Port"><a href="#Port" class="headerlink" title="Port"></a>Port</h2><h2 id="Table"><a href="#Table" class="headerlink" title="Table"></a>Table</h2><h2 id="Pipeline"><a href="#Pipeline" class="headerlink" title="Pipeline"></a>Pipeline</h2><h1 id="Ethdev"><a href="#Ethdev" class="headerlink" title="Ethdev"></a>Ethdev</h1><p>dpdkä½¿ç”¨å¤§äºç­‰äº0çš„æ•´æ•°ï¼ˆport idï¼‰ç”¨æ¥å……å½“dpdkæ‰€æ¥ç®¡çš„ç½‘å¡çš„æ ‡è¯†ç¬¦ã€‚</p>
<p>ç½‘å¡é…ç½®æµç¨‹ï¼š</p>
<ul>
<li>rte_eth_dev_configure()</li>
<li>rte_eth_tx_queue_setup()</li>
<li>rte_eth_rx_queue_setup()</li>
<li>rte_eth_dev_start()</li>
</ul>
<p>ç½‘å¡åœ¨å¯åŠ¨åå¦‚æœéœ€è¦é‡æ–°é…ç½®ï¼Œåˆ™éœ€è¦å…ˆè°ƒç”¨<code>rte_eth_dev_stop()</code>åœæ­¢ç½‘å¡ï¼Œé…ç½®å®Œæ¯•åå†è°ƒç”¨<code>rte_eth_dev_start()</code>å¯åŠ¨ç½‘å¡ã€‚åœ¨ç½‘å¡åœæ­¢åˆ°å¯åŠ¨æœŸé—´ï¼Œä¸€äº›é…ç½®ä¼šè¢«ä¿ç•™ï¼š</p>
<ul>
<li>MTU</li>
<li>æµæ§åˆ¶çš„è®¾ç½®</li>
<li>æ¥æ”¶æ¨¡å¼çš„é…ç½®ï¼ˆå¦‚æ··æ‚æ¨¡å¼ã€å¹¿æ’­æ¨¡å¼ã€ç¡¬ä»¶æ ¡éªŒæ¨¡å¼â€¦ï¼‰</li>
<li>VLANè¿‡æ»¤é…ç½®</li>
<li>é»˜è®¤çš„MACåœ°å€</li>
<li>æµè¿‡æ»¤æ¨¡å¼ï¼ˆä¸åŒ…æ‹¬è¿‡æ»¤è§„åˆ™ï¼‰</li>
<li>ç½‘å¡é˜Ÿåˆ—ç»Ÿè®¡æ˜ å°„</li>
</ul>
<p>ä¸‹åˆ—é…ç½®å¯èƒ½ä¼šè¢«ä¿ç•™ï¼š</p>
<ul>
<li>æµè§„åˆ™</li>
<li>æµç›¸å…³çš„å…±äº«ç›®æ ‡</li>
</ul>
<p>æœ€åï¼Œåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡è°ƒç”¨<code>rte_eth_dev_close()</code>æ¥å…³é—­ç½‘å¡ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–ç½‘å¡ä¿¡æ¯</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_eth_dev_info_get</span><span class="params">(<span class="type">uint16_t</span> port_id, <span class="keyword">struct</span> rte_eth_dev_info *dev_info)</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_conf</span> {</span></span><br><span class="line">	<span class="type">uint32_t</span> link_speeds; <span class="comment">/**&lt; bitmap of RTE_ETH_LINK_SPEED_XXX of speeds to be</span></span><br><span class="line"><span class="comment">				used. RTE_ETH_LINK_SPEED_FIXED disables link</span></span><br><span class="line"><span class="comment">				autonegotiation, and a unique speed shall be</span></span><br><span class="line"><span class="comment">				set. Otherwise, the bitmap defines the set of</span></span><br><span class="line"><span class="comment">				speeds to be advertised. If the special value</span></span><br><span class="line"><span class="comment">				RTE_ETH_LINK_SPEED_AUTONEG (0) is used, all speeds</span></span><br><span class="line"><span class="comment">				supported are advertised. */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_rxmode</span> <span class="title">rxmode</span>;</span> <span class="comment">/**&lt; Port Rx configuration. */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_txmode</span> <span class="title">txmode</span>;</span> <span class="comment">/**&lt; Port Tx configuration. */</span></span><br><span class="line">	<span class="type">uint32_t</span> lpbk_mode; <span class="comment">/**&lt; Loopback operation mode. By default the value</span></span><br><span class="line"><span class="comment">			         is 0, meaning the loopback mode is disabled.</span></span><br><span class="line"><span class="comment">				 Read the datasheet of given Ethernet controller</span></span><br><span class="line"><span class="comment">				 for details. The possible values of this field</span></span><br><span class="line"><span class="comment">				 are defined in implementation of each driver. */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_rss_conf</span> <span class="title">rss_conf</span>;</span> <span class="comment">/**&lt; Port RSS configuration */</span></span><br><span class="line">		<span class="comment">/** Port VMDq+DCB configuration. */</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_vmdq_dcb_conf</span> <span class="title">vmdq_dcb_conf</span>;</span></span><br><span class="line">		<span class="comment">/** Port DCB Rx configuration. */</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_dcb_rx_conf</span> <span class="title">dcb_rx_conf</span>;</span></span><br><span class="line">		<span class="comment">/** Port VMDq Rx configuration. */</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_vmdq_rx_conf</span> <span class="title">vmdq_rx_conf</span>;</span></span><br><span class="line">	} rx_adv_conf; <span class="comment">/**&lt; Port Rx filtering configuration. */</span></span><br><span class="line">	<span class="class"><span class="keyword">union</span> {</span></span><br><span class="line">		<span class="comment">/** Port VMDq+DCB Tx configuration. */</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_vmdq_dcb_tx_conf</span> <span class="title">vmdq_dcb_tx_conf</span>;</span></span><br><span class="line">		<span class="comment">/** Port DCB Tx configuration. */</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_dcb_tx_conf</span> <span class="title">dcb_tx_conf</span>;</span></span><br><span class="line">		<span class="comment">/** Port VMDq Tx configuration. */</span></span><br><span class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_vmdq_tx_conf</span> <span class="title">vmdq_tx_conf</span>;</span></span><br><span class="line">	} tx_adv_conf; <span class="comment">/**&lt; Port Tx DCB configuration (union). */</span></span><br><span class="line">	<span class="comment">/** Currently,Priority Flow Control(PFC) are supported,if DCB with PFC</span></span><br><span class="line"><span class="comment">	    is needed,and the variable must be set RTE_ETH_DCB_PFC_SUPPORT. */</span></span><br><span class="line">	<span class="type">uint32_t</span> dcb_capability_en;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_intr_conf</span> <span class="title">intr_conf</span>;</span> <span class="comment">/**&lt; Interrupt mode configuration. */</span></span><br><span class="line">};</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç½‘å¡è®¾ç½®ï¼Œé€šè¿‡è¯¥å‡½æ•°æ‰€è®¾ç½®çš„æ‰€æœ‰offloadç‰¹æ€§ä¼šåº”ç”¨åˆ°è¯¥ç½‘å¡çš„æ‰€æœ‰é˜Ÿåˆ—ä¸Š</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_eth_dev_configure</span><span class="params">(<span class="type">uint16_t</span> port_id, <span class="type">uint16_t</span> nb_rx_queue,</span></span><br><span class="line"><span class="params">		<span class="type">uint16_t</span> nb_tx_queue, <span class="type">const</span> <span class="keyword">struct</span> rte_eth_conf *eth_conf)</span>;</span><br></pre></td></tr></table></figure>



<h2 id="ç½‘å¡ç¡¬ä»¶ç‰¹æ€§"><a href="#ç½‘å¡ç¡¬ä»¶ç‰¹æ€§" class="headerlink" title="ç½‘å¡ç¡¬ä»¶ç‰¹æ€§"></a>ç½‘å¡ç¡¬ä»¶ç‰¹æ€§</h2><h3 id="RSS-Receiver-Side-Scaling"><a href="#RSS-Receiver-Side-Scaling" class="headerlink" title="RSS(Receiver Side Scaling)"></a>RSS(Receiver Side Scaling)</h3><p>å°†ç½‘å¡æ”¶åˆ°çš„æŠ¥æ–‡åˆ†å‘è‡³ä¸åŒçš„æ¥æ”¶é˜Ÿåˆ—ä¸­ï¼Œå®ç°äº†å¯¹CPUè´Ÿè½½çš„å‡è¡¡åˆ†é…ã€‚åº”ç”¨ç¨‹åºå¯åœ¨<code>mbuf.rss</code>ä¸­è·å–ç¡¬ä»¶å¯¹è¯¥æŠ¥æ–‡æ‰€è®¡ç®—å‡ºæ¥çš„hashå€¼ã€‚</p>
<p><a href="/images/rss.png" title="rss" class="gallery-item" style="box-shadow: none;"> <img src="/images/rss.png" alt="rss"></a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Below macros are defined for RSS offload types, they can be used to</span></span><br><span class="line"><span class="comment"> * fill rte_eth_rss_conf.rss_hf or rte_flow_action_rss.types.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_IPV4               RTE_BIT64(2)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_FRAG_IPV4          RTE_BIT64(3)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_NONFRAG_IPV4_TCP   RTE_BIT64(4)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_NONFRAG_IPV4_UDP   RTE_BIT64(5)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_NONFRAG_IPV4_SCTP  RTE_BIT64(6)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_NONFRAG_IPV4_OTHER RTE_BIT64(7)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_IPV6               RTE_BIT64(8)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_FRAG_IPV6          RTE_BIT64(9)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_NONFRAG_IPV6_TCP   RTE_BIT64(10)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_NONFRAG_IPV6_UDP   RTE_BIT64(11)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_NONFRAG_IPV6_SCTP  RTE_BIT64(12)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_NONFRAG_IPV6_OTHER RTE_BIT64(13)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_L2_PAYLOAD         RTE_BIT64(14)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_IPV6_EX            RTE_BIT64(15)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_IPV6_TCP_EX        RTE_BIT64(16)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_IPV6_UDP_EX        RTE_BIT64(17)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_PORT               RTE_BIT64(18)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_VXLAN              RTE_BIT64(19)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_GENEVE             RTE_BIT64(20)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_NVGRE              RTE_BIT64(21)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_GTPU               RTE_BIT64(23)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_ETH                RTE_BIT64(24)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_S_VLAN             RTE_BIT64(25)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_C_VLAN             RTE_BIT64(26)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_ESP                RTE_BIT64(27)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_AH                 RTE_BIT64(28)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_L2TPV3             RTE_BIT64(29)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_PFCP               RTE_BIT64(30)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_PPPOE              RTE_BIT64(31)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_ECPRI              RTE_BIT64(32)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_MPLS               RTE_BIT64(33)</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> RTE_ETH_RSS_IPV4_CHKSUM        RTE_BIT64(34)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">rte_eth_hash_function</span> {</span></span><br><span class="line">	<span class="comment">/** DEFAULT means driver decides which hash algorithm to pick. */</span></span><br><span class="line">	RTE_ETH_HASH_FUNCTION_DEFAULT = <span class="number">0</span>,</span><br><span class="line">	RTE_ETH_HASH_FUNCTION_TOEPLITZ, <span class="comment">/**&lt; Toeplitz */</span></span><br><span class="line">	RTE_ETH_HASH_FUNCTION_SIMPLE_XOR, <span class="comment">/**&lt; Simple XOR */</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Symmetric Toeplitz: src, dst will be replaced by</span></span><br><span class="line"><span class="comment">	 * xor(src, dst). For the case with src/dst only,</span></span><br><span class="line"><span class="comment">	 * src or dst address will xor with zero pair.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	RTE_ETH_HASH_FUNCTION_SYMMETRIC_TOEPLITZ,</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Symmetric Toeplitz: L3 and L4 fields are sorted prior to</span></span><br><span class="line"><span class="comment">	 * the hash function.</span></span><br><span class="line"><span class="comment">	 *  If src_ip &gt; dst_ip, swap src_ip and dst_ip.</span></span><br><span class="line"><span class="comment">	 *  If src_port &gt; dst_port, swap src_port and dst_port.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	RTE_ETH_HASH_FUNCTION_SYMMETRIC_TOEPLITZ_SORT,</span><br><span class="line">	RTE_ETH_HASH_FUNCTION_MAX,</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> rte_eth_rss_conf {</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * In rte_eth_dev_rss_hash_conf_get(), the *rss_key_len* should be</span></span><br><span class="line"><span class="comment">	 * greater than or equal to the *hash_key_size* which get from</span></span><br><span class="line"><span class="comment">	 * rte_eth_dev_info_get() API. And the *rss_key* should contain at least</span></span><br><span class="line"><span class="comment">	 * *hash_key_size* bytes. If not meet these requirements, the query</span></span><br><span class="line"><span class="comment">	 * result is unreliable even if the operation returns success.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * In rte_eth_dev_rss_hash_update() or rte_eth_dev_configure(), if</span></span><br><span class="line"><span class="comment">	 * *rss_key* is not NULL, the *rss_key_len* indicates the length of the</span></span><br><span class="line"><span class="comment">	 * *rss_key* in bytes and it should be equal to *hash_key_size*.</span></span><br><span class="line"><span class="comment">	 * If *rss_key* is NULL, drivers are free to use a random or a default key.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint8_t</span> *rss_key;</span><br><span class="line">	<span class="type">uint8_t</span> rss_key_len; <span class="comment">/**&lt; hash key length in bytes. */</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Indicates the type of packets or the specific part of packets to</span></span><br><span class="line"><span class="comment">	 * which RSS hashing is to be applied.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint64_t</span> rss_hf;</span><br><span class="line">    <span class="comment">//é€‰æ‹©å¯¹ç§°çš„hashç®—æ³•å¯ä»¥ä¿è¯ä¸€æ¡æµä¸Šçš„åŒå‘æŠ¥æ–‡åˆ†é…åˆ°åŒä¸€ä¸ªæ¥æ”¶é˜Ÿåˆ—ä¸­</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">rte_eth_hash_function</span> <span class="title">algorithm</span>;</span>	<span class="comment">/**&lt; Hash algorithm. */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>



<h3 id="LRO-Large-Receive-Offload"><a href="#LRO-Large-Receive-Offload" class="headerlink" title="LRO(Large Receive Offload)"></a>LRO(Large Receive Offload)</h3><p>ç½‘å¡å°†æ”¶åˆ°çš„åŒä¸€TCPæµä¸­è¿ç»­çš„åˆ†æ®µæŠ¥æ–‡é‡ç»„æˆä¸€ä¸ªå¤§çš„æ•°æ®åŒ…ï¼Œè¿”å›ç»™ç”¨æˆ·ã€‚ç”¨æˆ·å¯é€šè¿‡åˆ¤æ–­<code>mbuf.ol_flags</code>å­—æ®µæ˜¯å¦è®¾ç½®äº†<code>RTE_MBUF_F_RX_LRO</code>æ¥ç¡®å®šå½“å‰æŠ¥æ–‡æ˜¯å¦è¢«ç½‘å¡åˆå¹¶è¿‡ã€‚</p>
<h3 id="TSO-TCP-Segmentation-Offloading"><a href="#TSO-TCP-Segmentation-Offloading" class="headerlink" title="TSO(TCP Segmentation Offloading)"></a>TSO(TCP Segmentation Offloading)</h3><p>ç½‘å¡å°†å‘é€ä¾§æ‰€æ”¶åˆ°çš„å¤§çš„TCPæŠ¥æ–‡ï¼ˆå¤§å°è¶…è¿‡ç½‘å¡MTUï¼‰æ‹†åˆ†æˆå¤šä¸ªå°åŒ…å‘é€ã€‚éœ€è¦æ‹†åˆ†çš„æŠ¥æ–‡éœ€è¦åœ¨<code>mbuf.ol_flags</code>å­—æ®µè®¾ç½®<code>RTE_MBUF_F_TX_TCP_SEG</code></p>
<h3 id="VMDq-Virtual-Machine-Device-Queues"><a href="#VMDq-Virtual-Machine-Device-Queues" class="headerlink" title="VMDq(Virtual Machine Device Queues)"></a>VMDq(Virtual Machine Device Queues)</h3><p>è™šæ‹ŸåŒ–ç³»ç»Ÿä¸­ï¼Œä¸ºäº†ä½¿æ¯å°è™šæœºéƒ½èƒ½ä½¿ç”¨ç½‘ç»œåŠŸèƒ½ï¼Œè™šæœºç®¡ç†å™¨å†…ç½®äº†è™šæ‹Ÿäº¤æ¢æœºï¼Œå°†å¤šå°è™šæœºè¿æˆä¸€ä¸ªæˆ–å¤šä¸ªç½‘ç»œã€‚è€Œè¿™ä¸ªè™šæ‹Ÿäº¤æ¢æœºå°±ä¼šè´Ÿè´£æ¥æ”¶ä»ç½‘å¡æ”¶ä¸Šæ¥çš„æŠ¥æ–‡ï¼Œå¹¶è¿›è¡Œåˆ†ç±»å’Œæ’åºï¼Œå°†å…¶å‘é€ç»™å¯¹åº”çš„è™šæœºã€‚VMDqå®é™…ä¸Šå®ç°äº†ä¸€ä¸ªåŠè½¯åŠç¡¬çš„è™šæ‹Ÿäº¤æ¢æœºï¼Œç½‘å¡ä¾§ç”¨ç¡¬ä»¶å®ç°äº†ä¸€ä¸ªåˆ†ç±»/æ’åºå™¨ï¼Œé€šè¿‡è¯†åˆ«æŠ¥æ–‡çš„MAC/VLANæ¥å°†æ”¶åˆ°çš„æ•°æ®åŒ…å‘é€åˆ°æŒ‡å®šçš„poolä¸­ï¼ˆæ¯ä¸ªpoolä¼šå¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªæ¥æ”¶é˜Ÿåˆ—ï¼‰ï¼ŒVMMä¾§åªéœ€è¦å°†æ”¶åˆ°çš„æŠ¥æ–‡å‘é€åˆ°è¯¥poolæ‰€å¯¹åº”çš„è™šæœºç½‘å¡ä¸­å³å¯ã€‚</p>
<p>ç”±äºä¸€ä¸ªpoolå¯èƒ½å¯¹åº”å¤šä¸ªæ¥æ”¶é˜Ÿåˆ—ï¼Œæ­¤æ—¶å¦‚æœé…ç½®äº†RSSåˆ™ä¼šæ ¹æ®æŠ¥æ–‡çš„hashç»“æœé€‰æ‹©å…¶ä¸­ä¸€ä¸ªæ¥æ”¶é˜Ÿåˆ—ï¼Œæ²¡æœ‰é…ç½®çš„è¯é»˜è®¤é€‰æ‹©poolä¸­çš„ç¬¬ä¸€ä¸ªæ¥æ”¶é˜Ÿåˆ—ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A structure used to configure the VMDq feature of an Ethernet port when</span></span><br><span class="line"><span class="comment"> * not combined with the DCB feature.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Using this feature, packets are routed to a pool of queues. By default,</span></span><br><span class="line"><span class="comment"> * the pool selection is based on the MAC address, the VLAN ID in the</span></span><br><span class="line"><span class="comment"> * VLAN tag as specified in the pool_map array.</span></span><br><span class="line"><span class="comment"> * Passing the RTE_ETH_VMDQ_ACCEPT_UNTAG in the rx_mode field allows pool</span></span><br><span class="line"><span class="comment"> * selection using only the MAC address. MAC address to pool mapping is done</span></span><br><span class="line"><span class="comment"> * using the rte_eth_dev_mac_addr_add function, with the pool parameter</span></span><br><span class="line"><span class="comment"> * corresponding to the pool ID.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Queue selection within the selected pool will be done using RSS when</span></span><br><span class="line"><span class="comment"> * it is enabled or revert to the first queue of the pool if not.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * A default pool may be used, if desired, to route all traffic which</span></span><br><span class="line"><span class="comment"> * does not match the VLAN filter rules or any pool MAC address.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_vmdq_rx_conf</span> {</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">rte_eth_nb_pools</span> <span class="title">nb_queue_pools</span>;</span> <span class="comment">/**&lt; VMDq only mode, 8 or 64 pools */</span></span><br><span class="line">	<span class="type">uint8_t</span> enable_default_pool; <span class="comment">/**&lt; If non-zero, use a default pool */</span></span><br><span class="line">	<span class="type">uint8_t</span> default_pool; <span class="comment">/**&lt; The default pool, if applicable */</span></span><br><span class="line">	<span class="type">uint8_t</span> enable_loop_back; <span class="comment">/**&lt; Enable VT loop back */</span></span><br><span class="line">	<span class="type">uint8_t</span> nb_pool_maps; <span class="comment">/**&lt; We can have up to 64 filters/mappings */</span></span><br><span class="line">	<span class="type">uint32_t</span> rx_mode; <span class="comment">/**&lt; Flags from RTE_ETH_VMDQ_ACCEPT_* */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> {</span></span><br><span class="line">		<span class="type">uint16_t</span> vlan_id; <span class="comment">/**&lt; The VLAN ID of the received frame */</span></span><br><span class="line">		<span class="type">uint64_t</span> pools;   <span class="comment">/**&lt; Bitmask of pools for packet Rx */</span></span><br><span class="line">	} pool_map[RTE_ETH_VMDQ_MAX_VLAN_FILTERS]; <span class="comment">/**&lt; VMDq VLAN pool maps. */</span></span><br><span class="line">};</span><br><span class="line"><span class="comment">//å‘ç½‘å¡æ·»åŠ macåœ°å€æ—¶æŒ‡æ˜è¯¥macåœ°å€æ‰€å¯¹åº”çš„pool_index</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_eth_dev_mac_addr_add</span><span class="params">(<span class="type">uint16_t</span> port_id, <span class="keyword">struct</span> rte_ether_addr *addr,</span></span><br><span class="line"><span class="params">			<span class="type">uint32_t</span> pool)</span></span><br></pre></td></tr></table></figure>



<h3 id="DCB-Data-Center-Bridging"><a href="#DCB-Data-Center-Bridging" class="headerlink" title="DCB(Data Center Bridging)"></a>DCB(Data Center Bridging)</h3><p>DCBä¸­çš„TC(Traffic Class)å…è®¸å¯¹ç½‘ç»œæµé‡è¿›è¡Œç»†ç²’åº¦çš„æ§åˆ¶å’Œç®¡ç†ï¼Œä»¥æ»¡è¶³ä¸åŒåº”ç”¨åœºæ™¯ä¸‹çš„æ€§èƒ½å’Œå¯é æ€§éœ€æ±‚ã€‚ç½‘å¡ä¾é æŠ¥æ–‡ä¸­VLANå¤´çš„PRIå­—æ®µï¼ˆ3bité•¿ï¼Œä¹Ÿç§°upå­—æ®µï¼‰æ¥ç¡®å®šå…¶å±äºå“ªä¸ªTCã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_eth_dcb_rx_conf</span> {</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">rte_eth_nb_tcs</span> <span class="title">nb_tcs</span>;</span> <span class="comment">/**&lt; Possible DCB TCs, 4 or 8 TCs */</span></span><br><span class="line">	<span class="comment">/** Traffic class each UP mapped to. */</span></span><br><span class="line">	<span class="type">uint8_t</span> dcb_tc[RTE_ETH_DCB_NUM_USER_PRIORITIES];</span><br><span class="line">};</span><br></pre></td></tr></table></figure>



<h2 id="Flow"><a href="#Flow" class="headerlink" title="Flow"></a>Flow</h2><p>å°†æµè§„åˆ™ä¸‹å‘åˆ°ç½‘å¡ä¸­ï¼Œç½‘å¡æ ¹æ®ä¸‹å‘çš„è§„åˆ™å¯¹æŠ¥æ–‡å»åšåŒ¹é…ï¼Œå¹¶å°†å‘½ä¸­çš„æŠ¥æ–‡æŒ‰è§„åˆ™å®šä¹‰çš„åŠ¨ä½œæ”¹å˜æŠ¥æ–‡çš„å‘½è¿ã€‚</p>
<p>æµè§„åˆ™ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p>
<ul>
<li>è§„åˆ™å±æ€§ï¼ˆstruct rte_flow_attrï¼‰ï¼šå®šä¹‰è¯¥è§„åˆ™çš„ä¸€äº›ç‰¹æ€§ï¼Œå¦‚è§„åˆ™åŒ¹é…æ–¹å‘ï¼ˆåŒ¹é…å…¥å£/å‡ºå£ï¼‰ï¼Œè§„åˆ™çš„ä¼˜å…ˆçº§ç­‰ã€‚</li>
<li>æ¨¡å¼åŒ¹é…ï¼ˆstruct rte_flow_itemï¼‰ï¼šç”±ä¸€ç³»åˆ—æ¨¡å¼é¡¹ç»„æˆï¼Œæ¯ä¸ªæ¨¡å¼é¡¹éƒ½åŒ¹é…æŠ¥æ–‡æ•°æ®çš„ç‰¹å®šéƒ¨åˆ†ã€‚</li>
<li>åŠ¨ä½œï¼ˆstruct rte_flow_actionï¼‰ï¼šç”±ä¸€ç³»åˆ—åŠ¨ä½œç»„æˆï¼ŒæŒ‡æ˜äº†æµè§„åˆ™å‘½ä¸­åå¯¹è¯¥æŠ¥æ–‡çš„æ“ä½œã€‚</li>
</ul>
<h3 id="è§„åˆ™å±æ€§"><a href="#è§„åˆ™å±æ€§" class="headerlink" title="è§„åˆ™å±æ€§"></a>è§„åˆ™å±æ€§</h3><ul>
<li>groupï¼šç”¨äºæŒ‡æ˜è¯¥è§„åˆ™çš„æ‰€å±ç»„ã€‚ç½‘å¡é»˜è®¤ä½¿ç”¨0ç»„çš„è§„åˆ™å¯¹æŠ¥æ–‡è¿›è¡ŒåŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨æµè§„åˆ™åŠ¨ä½œä¸­çš„<code>JUMP</code>åŠ¨ä½œå°†å‘½ä¸­çš„æŠ¥æ–‡é€åˆ°æŒ‡å®šç»„è¿›è¡Œå†æ¬¡åŒ¹é…ã€‚</li>
<li>priorityï¼šè§„åˆ™ä¼˜å…ˆçº§ï¼Œ0ä¸ºæœ€é«˜ä¼˜å…ˆçº§ã€‚è‹¥æœ‰å¤šä¸ªè§„åˆ™å‘½ä¸­ï¼Œä»…æ‰§è¡Œæœ€é«˜ä¼˜å…ˆçº§çš„è§„åˆ™çš„åŠ¨ä½œã€‚</li>
<li>traffic directionï¼šæŒ‡æ˜è¯¥è§„åˆ™åº”ç”¨äºç½‘å¡çš„å…¥å£æµé‡è¿˜æ˜¯å‡ºå£æµé‡ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_flow_attr</span> {</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * A group is a superset of multiple rules.</span></span><br><span class="line"><span class="comment">	 * The default group is 0 and is processed for all packets.</span></span><br><span class="line"><span class="comment">	 * Rules in other groups are processed only if the group is chained</span></span><br><span class="line"><span class="comment">	 * by a jump action from a previously matched rule.</span></span><br><span class="line"><span class="comment">	 * It means the group hierarchy is made by the flow rules,</span></span><br><span class="line"><span class="comment">	 * and the group 0 is the hierarchy root.</span></span><br><span class="line"><span class="comment">	 * Note there is no automatic dead loop protection.</span></span><br><span class="line"><span class="comment">	 * @see rte_flow_action_jump</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> group;</span><br><span class="line">	<span class="type">uint32_t</span> priority; <span class="comment">/**&lt; Rule priority level within group. */</span></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The rule in question applies to ingress traffic (non-"transfer").</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> ingress:<span class="number">1</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * The rule in question applies to egress traffic (non-"transfer").</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> egress:<span class="number">1</span>;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 * Instead of simply matching the properties of traffic as it would</span></span><br><span class="line"><span class="comment">	 * appear on a given DPDK port ID, enabling this attribute transfers</span></span><br><span class="line"><span class="comment">	 * a flow rule to the lowest possible level of any device endpoints</span></span><br><span class="line"><span class="comment">	 * found in the pattern.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * When supported, this effectively enables an application to</span></span><br><span class="line"><span class="comment">	 * re-route traffic not necessarily intended for it (e.g. coming</span></span><br><span class="line"><span class="comment">	 * from or addressed to different physical ports, VFs or</span></span><br><span class="line"><span class="comment">	 * applications) at the device level.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * The application should match traffic originating from precise</span></span><br><span class="line"><span class="comment">	 * locations. See items PORT_REPRESENTOR and REPRESENTED_PORT.</span></span><br><span class="line"><span class="comment">	 *</span></span><br><span class="line"><span class="comment">	 * Managing "transfer" flows requires that the user communicate them</span></span><br><span class="line"><span class="comment">	 * through a suitable port. @see rte_flow_pick_transfer_proxy().</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">	<span class="type">uint32_t</span> transfer:<span class="number">1</span>;</span><br><span class="line">	<span class="type">uint32_t</span> reserved:<span class="number">29</span>; <span class="comment">/**&lt; Reserved, must be zero. */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>



<h3 id="æ¨¡å¼åŒ¹é…"><a href="#æ¨¡å¼åŒ¹é…" class="headerlink" title="æ¨¡å¼åŒ¹é…"></a>æ¨¡å¼åŒ¹é…</h3><p>åŒ¹é…é¡¹é€šå¸¸åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>data matchingï¼šåŒ¹é…åè®®å¤´/æŠ¥æ–‡æ•°æ®ï¼Œé€šå¸¸ä¸ç‰¹å®šçš„æ•°æ®ç»“æ„ç›¸è”ç³»</li>
<li>metaï¼šå½±å“åç»­åŒ¹é…é¡¹çš„åŒ¹é…è¡Œä¸º</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Matching pattern item definition.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * A pattern is formed by stacking items starting from the lowest protocol</span></span><br><span class="line"><span class="comment"> * layer to match. This stacking restriction does not apply to meta items</span></span><br><span class="line"><span class="comment"> * which can be placed anywhere in the stack without affecting the meaning</span></span><br><span class="line"><span class="comment"> * of the resulting pattern.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Patterns are terminated by END items.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * The spec field should be a valid pointer to a structure of the related</span></span><br><span class="line"><span class="comment"> * item type. It may remain unspecified (NULL) in many cases to request</span></span><br><span class="line"><span class="comment"> * broad (nonspecific) matching. In such cases, last and mask must also be</span></span><br><span class="line"><span class="comment"> * set to NULL.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Optionally, last can point to a structure of the same type to define an</span></span><br><span class="line"><span class="comment"> * inclusive range. This is mostly supported by integer and address fields,</span></span><br><span class="line"><span class="comment"> * may cause errors otherwise. Fields that do not support ranges must be set</span></span><br><span class="line"><span class="comment"> * to 0 or to the same value as the corresponding fields in spec.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Only the fields defined to nonzero values in the default masks (see</span></span><br><span class="line"><span class="comment"> * rte_flow_item_{name}_mask constants) are considered relevant by</span></span><br><span class="line"><span class="comment"> * default. This can be overridden by providing a mask structure of the</span></span><br><span class="line"><span class="comment"> * same type with applicable bits set to one. It can also be used to</span></span><br><span class="line"><span class="comment"> * partially filter out specific fields (e.g. as an alternate mean to match</span></span><br><span class="line"><span class="comment"> * ranges of IP addresses).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Mask is a simple bit-mask applied before interpreting the contents of</span></span><br><span class="line"><span class="comment"> * spec and last, which may yield unexpected results if not used</span></span><br><span class="line"><span class="comment"> * carefully. For example, if for an IPv4 address field, spec provides</span></span><br><span class="line"><span class="comment"> * 10.1.2.3, last provides 10.3.4.5 and mask provides 255.255.0.0, the</span></span><br><span class="line"><span class="comment"> * effective range becomes 10.1.0.0 to 10.3.255.255.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">rte_flow_item</span> {</span></span><br><span class="line">	<span class="class"><span class="keyword">enum</span> <span class="title">rte_flow_item_type</span> <span class="title">type</span>;</span> <span class="comment">/**&lt; Item type. */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">void</span> *spec; <span class="comment">/**&lt; Pointer to item specification structure. */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">void</span> *last; <span class="comment">/**&lt; Defines an inclusive range (spec to last). */</span></span><br><span class="line">	<span class="type">const</span> <span class="type">void</span> *mask; <span class="comment">/**&lt; Bit-mask applied to spec and last. */</span></span><br><span class="line">};</span><br></pre></td></tr></table></figure>



<h4 id="Meta-item"><a href="#Meta-item" class="headerlink" title="Meta item"></a>Meta item</h4><p>å¸¸è§çš„itemç±»å‹ï¼š</p>
<ul>
<li>ENDï¼šæ”¾åœ¨æ¨¡å¼åŒ¹é…çš„æœ€åä¸€é¡¹ï¼Œç”¨äºæŒ‡æ˜åŒ¹é…ç»“æŸ</li>
<li>VOIDï¼šå ä½ç¬¦ï¼Œæ²¡æœ‰ä»»ä½•ä½œç”¨ã€‚æœªæ¥è¯¥è§„åˆ™çš„æ¨¡å¼é¡¹è¿›è¡Œæ‰©å±•æ—¶å¯ä»¥å¤ç”¨è¯¥æ¨¡å¼é¡¹</li>
<li>INVERTï¼šåå‘åŒ¹é…ï¼Œå…¶åé¢çš„æ¨¡å¼é¡¹ä¸ä¸æŠ¥æ–‡åŒ¹é…æ‰ç®—å‘½ä¸­</li>
</ul>
<h4 id="Data-matching-item"><a href="#Data-matching-item" class="headerlink" title="Data matching item"></a>Data matching item</h4><p>å¸¸è§çš„itemç±»å‹ï¼š</p>
<ul>
<li>ANYï¼šåŒ¹é…å½“å‰çš„åè®®å¤´ï¼Œæ— è®ºæŠ¥æ–‡å†…å®¹æ˜¯ä»€ä¹ˆéƒ½ä¼šå‘½ä¸­</li>
<li>RAWï¼šåœ¨ç»™å®šåç§»å¤„å»åŒ¹é…ç»™å®šé•¿åº¦çš„å­—ç¬¦ä¸²</li>
<li>ETHï¼šåŒ¹é…ä»¥å¤ªå¤´ï¼Œå¯¹åº”<code>struct rte_flow_item_eth</code></li>
</ul>
<h3 id="åŠ¨ä½œ"><a href="#åŠ¨ä½œ" class="headerlink" title="åŠ¨ä½œ"></a>åŠ¨ä½œ</h3><p>åŠ¨ä½œåˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ul>
<li>æ”¹å˜æŠ¥æ–‡å‘½è¿çš„åŠ¨ä½œï¼šå¦‚ä¸¢åŒ…ï¼Œæˆ–è€…å°†æŠ¥æ–‡é€åˆ°æŒ‡å®šé˜Ÿåˆ—ä¸­</li>
<li>ä¿®æ”¹æŠ¥æ–‡å†…å®¹çš„åŠ¨ä½œï¼šå¦‚æ·»åŠ /åˆ é™¤åè®®å¤´</li>
<li>ä¸æµè§„åˆ™è‡ªèº«å…³è”çš„åŠ¨ä½œï¼šå¦‚ç»Ÿè®¡è§„åˆ™å‘½ä¸­æ¬¡æ•°</li>
</ul>
<p>å¸¸è§çš„itemç±»å‹ï¼š</p>
<ul>
<li>ENDï¼šæ”¾åœ¨åŠ¨ä½œåˆ—è¡¨çš„æœ€åä¸€é¡¹ï¼Œç”¨äºæŒ‡æ˜åŠ¨ä½œç»“æŸ</li>
<li>VOIDï¼šå ä½ç¬¦</li>
<li>PASSTHRUï¼šä¸ç»ˆæ­¢å¯¹è¯¥æŠ¥æ–‡çš„åŒ¹é…ï¼Œä½¿å…¶å¯ä»¥ç»§ç»­åŒ¹é…å…¶ä»–è§„åˆ™</li>
<li>JUMPï¼šå°†è¯¥æŠ¥æ–‡é‡å®šå‘åˆ°å…¶ä»–è§„åˆ™ç»„è¿›è¡ŒåŒ¹é…</li>
<li>QUEUEï¼šå°†è¯¥æŠ¥æ–‡åˆ†é…åˆ°æŒ‡å®šé˜Ÿåˆ—</li>
<li>DROPï¼šä¸¢å¼ƒè¯¥æŠ¥æ–‡</li>
<li>COUNTï¼šæ›´æ–°æŒ‡å®šçš„è®¡æ•°å™¨</li>
</ul>
<h3 id="Flowçš„ä½¿ç”¨"><a href="#Flowçš„ä½¿ç”¨" class="headerlink" title="Flowçš„ä½¿ç”¨"></a>Flowçš„ä½¿ç”¨</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//éªŒè¯æµè§„åˆ™çš„æœ‰æ•ˆæ€§</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_flow_validate</span><span class="params">(<span class="type">uint16_t</span> port_id,</span></span><br><span class="line"><span class="params">		  <span class="type">const</span> <span class="keyword">struct</span> rte_flow_attr *attr,</span></span><br><span class="line"><span class="params">		  <span class="type">const</span> <span class="keyword">struct</span> rte_flow_item pattern[],</span></span><br><span class="line"><span class="params">		  <span class="type">const</span> <span class="keyword">struct</span> rte_flow_action actions[],</span></span><br><span class="line"><span class="params">		  <span class="keyword">struct</span> rte_flow_error *error)</span>;</span><br><span class="line"><span class="comment">//åˆ›å»ºæµè§„åˆ™</span></span><br><span class="line"><span class="keyword">struct</span> rte_flow *</span><br><span class="line"><span class="title function_">rte_flow_create</span><span class="params">(<span class="type">uint16_t</span> port_id,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="keyword">struct</span> rte_flow_attr *attr,</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="keyword">struct</span> rte_flow_item pattern[],</span></span><br><span class="line"><span class="params">		<span class="type">const</span> <span class="keyword">struct</span> rte_flow_action actions[],</span></span><br><span class="line"><span class="params">		<span class="keyword">struct</span> rte_flow_error *error)</span>;</span><br><span class="line"><span class="comment">//åˆ é™¤è¯¥ç½‘å¡æ‰€åˆ›å»ºçš„æ‰€æœ‰æµè§„åˆ™</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">rte_flow_flush</span><span class="params">(<span class="type">uint16_t</span> port_id,</span></span><br><span class="line"><span class="params">	       <span class="keyword">struct</span> rte_flow_error *error)</span>;</span><br></pre></td></tr></table></figure>



<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span></span><br><span class="line"><span class="title function_">rte_thread_create_internal_control</span><span class="params">(<span class="type">rte_thread_t</span> *id, <span class="type">const</span> <span class="type">char</span> *name,</span></span><br><span class="line"><span class="params">		rte_thread_func func, <span class="type">void</span> *arg)</span></span><br></pre></td></tr></table></figure>

<p>è¯¥å‡½æ•°ç”¨äºåˆ›å»ºä¸€ä¸ªæ§åˆ¶çº¿ç¨‹ï¼Œç›¸æ¯”ä¸ä¸€èˆ¬çº¿ç¨‹ï¼Œæ§åˆ¶çº¿ç¨‹ä¼šè®¾ç½®socket IDä¸ºSOCKET_ID_ANYï¼Œä½¿å¾—è¯¥çº¿ç¨‹å¯ä»¥åœ¨ä»»æ„numaèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œå¹¶è®¾ç½®è¯¥çº¿ç¨‹çš„cpuäº²å’Œæ€§ä¸ºæ§åˆ¶çº¿ç¨‹çš„cpusetã€‚</p>
<hr>
<h1 id="ASAN-AddressSanitizer"><a href="#ASAN-AddressSanitizer" class="headerlink" title="ASAN(AddressSanitizer)"></a>ASAN(AddressSanitizer)</h1><p>åŠ¨æ€å†…å­˜æ£€æµ‹ï¼Œdpdkéœ€è¦åœ¨ç¼–è¯‘æ—¶é…ç½®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">meson -Db_sanitize=address &lt;build_dir&gt;</span><br></pre></td></tr></table></figure>



<h2 id="ASANåŸç†"><a href="#ASANåŸç†" class="headerlink" title="ASANåŸç†"></a>ASANåŸç†</h2><h3 id="å†…å­˜æ£€æµ‹"><a href="#å†…å­˜æ£€æµ‹" class="headerlink" title="å†…å­˜æ£€æµ‹"></a>å†…å­˜æ£€æµ‹</h3><p>æ¯å½“è¿›ç¨‹è¿›è¡Œå†…å­˜è®¿é—®ï¼ˆè¯»/å†™ï¼‰çš„æ—¶å€™ï¼Œasanéƒ½ä¼šå»å…ˆæ£€æŸ¥è®¿é—®çš„åœ°å€æ˜¯å¦è¢«æŠ•æ¯’(poisoned)ï¼Œè‹¥è¢«æŠ•æ¯’ï¼Œåˆ™æŠ¥å‘Šé”™è¯¯ã€‚</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Before:</span></span><br><span class="line">*address = ...; <span class="comment">// or: ... = *address;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//After:</span></span><br><span class="line"><span class="keyword">if</span> (IsPoisoned(address)) {</span><br><span class="line">    ReportError(address, kAccessSize, kIsWrite);</span><br><span class="line">}</span><br><span class="line">*address = ...; <span class="comment">//or: ... = *address;</span></span><br></pre></td></tr></table></figure>



<h3 id="å†…å­˜æ˜ å°„"><a href="#å†…å­˜æ˜ å°„" class="headerlink" title="å†…å­˜æ˜ å°„"></a>å†…å­˜æ˜ å°„</h3><p>ä¸ºäº†å®ç°ä¸Šè¿°åŠŸèƒ½ï¼Œéœ€è¦åŠ¨æ€è·Ÿè¸ªè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚asanä½¿ç”¨å½±å­å†…å­˜çš„æŠ€æœ¯æ¥å­˜å‚¨ä¸€ä¸ªåœ°å€æ˜¯å¦å¤„äºpoisonedçŠ¶æ€ã€‚</p>
<p>asanå°†è¿›ç¨‹çš„va(è™šæ‹Ÿåœ°å€)åˆ†ä¸ºä¸¤ä¸ªä¸ç›¸äº¤çš„éƒ¨åˆ†ï¼š</p>
<ul>
<li>ä¸»å†…å­˜(Mem)ï¼šè¿›ç¨‹æ­£å¸¸ä½¿ç”¨æ‰€éœ€çš„å†…å­˜</li>
<li>å½±å­å†…å­˜(Shadow)ï¼šä¸»å†…å­˜ä¸å½±å­å†…å­˜çš„åœ°å€æœ‰ç€å›ºå®šçš„æ˜ å°„å…³ç³»ã€‚å½±å­å†…å­˜ä¸­è®°å½•ç€ä¸»å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼ˆæ˜¯å¦è¢«æŠ•æ¯’ï¼‰ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">shadow_address = MemToShadow(address);</span><br><span class="line"><span class="keyword">if</span> (ShadowIsPoisoned(shadow_address)) {</span><br><span class="line">    ReportError(address, kAccessSize, kIsWrite);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>



<p>asanå°†8ä¸ªå­—èŠ‚çš„ä¸»å†…å­˜æ˜ å°„è¿›1ä¸ªå­—èŠ‚çš„å½±å­å†…å­˜ã€‚</p>
<p>1ä¸ªå­—èŠ‚çš„å½±å­å†…å­˜åªä¼šå­˜å‚¨9ç§å€¼ï¼š</p>
<ul>
<li>0ï¼šå¯¹åº”çš„8ä¸ªå­—èŠ‚çš„ä¸»å†…å­˜éƒ½æ²¡æœ‰è¢«æŠ•æ¯’(unpoisoned)ï¼Œè¿™8ä¸ªå­—èŠ‚éƒ½å¯ä»¥è¢«è¿›ç¨‹æ‰€è®¿é—®ã€‚</li>
<li>è´Ÿæ•°ï¼šå¯¹åº”çš„8ä¸ªå­—èŠ‚çš„ä¸»å†…å­˜éƒ½è¢«æŠ•æ¯’(poisoned)ï¼Œè¿™8ä¸ªå­—èŠ‚ä¸å¯ä»¥è¢«è¿›ç¨‹æ‰€è®¿é—®ã€‚</li>
<li>kï¼šè¡¨ç¤ºå‰<code>k</code>ä¸ªå­—èŠ‚æ²¡æœ‰è¢«æŠ•æ¯’ï¼Œå‰©ä½™çš„<code>8-k</code>ä¸ªå­—èŠ‚è¢«æŠ•æ¯’ã€‚ä¾‹å¦‚<code>malloc(13)</code>ï¼Œä¼šå¾—åˆ°1å­—èŠ‚å€¼ä¸º0çš„å½±å­å†…å­˜å’Œ1å­—èŠ‚å€¼ä¸º5çš„å½±å­å†…å­˜ã€‚</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Check the cases where we access first k bytes of the qword</span></span><br><span class="line"><span class="comment">// and these k bytes are unpoisoned.</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">SlowPathCheck</span><span class="params">(shadow_value, address, kAccessSize)</span> {</span><br><span class="line">  last_accessed_byte = (address &amp; <span class="number">7</span>) + kAccessSize - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">return</span> (last_accessed_byte &gt;= shadow_value);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">byte *shadow_address = MemToShadow(address);</span><br><span class="line">byte shadow_value = *shadow_address;</span><br><span class="line"><span class="keyword">if</span> (shadow_value) {</span><br><span class="line">  <span class="keyword">if</span> (SlowPathCheck(shadow_value, address, kAccessSize)) {</span><br><span class="line">    ReportError(address, kAccessSize, kIsWrite);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></table></figure>



<p>åœ¨64ä½çš„x86æ¶æ„ä¸‹ï¼Œä¸»å†…å­˜ä¸å½±å­å†…å­˜çš„æ˜ å°„å…³ç³»å’Œå†…å­˜åˆ†å¸ƒå¦‚ä¸‹</p>
<p>å†…å­˜æ˜ å°„å…³ç³»ï¼š</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Shadow = (Mem &gt;&gt; <span class="number">3</span>) + <span class="number">0x7fff8000</span>;</span><br></pre></td></tr></table></figure>

<p>å†…å­˜åˆ†å¸ƒï¼š</p>
<table>
<thead>
<tr>
<th>Address</th>
<th>Type</th>
</tr>
</thead>
<tbody><tr>
<td>[0x1000 7fff 8000, 0x7fff ffff ffff]</td>
<td>Mem: HighMem</td>
</tr>
<tr>
<td>[0x0200 8fff 7000, 0x1000 7fff 7fff]</td>
<td>Shadow: HighShadow</td>
</tr>
<tr>
<td>[0x0000 8fff 7000, 0x0200 8fff 6fff]</td>
<td>ShadowGap</td>
</tr>
<tr>
<td>[0x0000 7fff 8000, 0x0000 8fff 6fff]</td>
<td>Shadow: LowShadow</td>
</tr>
<tr>
<td>[0x0000 0000 0000, 0x0000 7fff 7fff]</td>
<td>Mem: LowMem</td>
</tr>
</tbody></table>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HighShadow = (HighMem &gt;&gt; <span class="number">3</span>) + <span class="number">0x7fff8000</span>;</span><br><span class="line">LowShadow = (LowMem &gt;&gt; <span class="number">3</span>) + <span class="number">0x7fff8000</span>;</span><br><span class="line">ShadowGap = (HighShadow &gt;&gt; <span class="number">3</span>) + <span class="number">0x7fff8000</span>;</span><br><span class="line">ShadowGap = (LowShadow &gt;&gt; <span class="number">3</span>) + <span class="number">0x7fff8000</span>;</span><br><span class="line">ShadowGap = (ShadowGap &gt;&gt; <span class="number">3</span>) + <span class="number">0x7fff8000</span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>å…¶ä¸­<code>ShadowGap</code>æ˜¯ä¸€ç‰‡ä¸å¯è®¿é—®çš„å†…å­˜åŒºåŸŸï¼Œè‹¥è¿›ç¨‹å°è¯•è®¿é—®Shadowæˆ–è€…ShadowGapå†…å­˜åŒºåŸŸï¼Œåˆ™è¿›ç¨‹ä¼šcrash</p>
</blockquote>
<h2 id="dpdkå¯¹asançš„æ”¯æŒ"><a href="#dpdkå¯¹asançš„æ”¯æŒ" class="headerlink" title="dpdkå¯¹asançš„æ”¯æŒ"></a>dpdkå¯¹asançš„æ”¯æŒ</h2><p>dpdkä¸­æ‰€æœ‰çš„å¤§é¡µéƒ½é€šè¿‡<code>mmap()</code>æ¥åˆ†é…ï¼Œè€Œè¿™éƒ¨åˆ†å†…å­˜æ˜¯ä¸ä¼šè¢«asanæ‰€ç®¡ç†çš„ï¼Œæ‰€å¯¹åº”çš„shadowä¸ºå¯è®¿é—®<code>0x00</code>çŠ¶æ€ã€‚</p>
<p>åœ¨åˆ†é…å®Œå¤§é¡µä¹‹åï¼Œdpdkä¼šå°†è¿™äº›å¤§é¡µå†…å­˜æ”¾åˆ°heapä¸­è¿›è¡Œç®¡ç†ã€‚</p>
<ul>
<li>ç”³è¯·å†…å­˜ï¼šdpdkä¼šå°†æ‰€ç”³è¯·å†…å­˜çš„å‰å16å­—èŠ‚åŒºåŸŸè®¾ç½®ä¸ºçº¢åŒº(çº¢åŒºæ‰€å¯¹åº”çš„Shadowä¸º<code>0xfa</code>ï¼Œè¡¨ç¤ºè¯¥åŒºåŸŸè¢«æŠ•æ¯’)ã€‚</li>
<li>é‡Šæ”¾å†…å­˜ï¼šdpdkä¼šå°†è¯¥å†…å­˜å‰åçš„çº¢åŒºå–æ¶ˆæ‰(Shadowè®¾ç½®ä¸º<code>0x00</code>ï¼Œè¡¨ç¤ºè¯¥åŒºåŸŸæœªè¢«æŠ•æ¯’)ï¼ŒåŒæ—¶å°†é‡Šæ”¾æ‰çš„å†…å­˜åŒºåŸŸè®¾ç½®ä¸º<code>0xfd</code>ï¼Œè¡¨ç¤ºè¯¥åŒºåŸŸå·²è¢«é‡Šæ”¾ã€‚åé¢å¦‚æœå¯¹è¯¥å†…å­˜åŒºåŸŸè¿›è¡Œè¯»å†™æ“ä½œï¼Œä¼šè§¦å‘<code>Use After Free</code>é”™è¯¯ã€‚</li>
</ul>
<blockquote>
<p><strong>æ³¨æ„</strong>ï¼šåœ¨å¤šè¿›ç¨‹æƒ…å†µä¸‹ï¼Œdpdkä¸èƒ½ä½¿ç”¨asanã€‚å› ä¸ºprimaryå’Œsecondaryè¿›ç¨‹çš„å½±å­å†…å­˜æ˜¯æ²¡æœ‰å…±äº«çš„ã€‚</p>
<p>æ‰€ä»¥å¯èƒ½ä¼šå‡ºç°ä¸‹é¢è¿™ç§æƒ…å†µï¼š</p>
<p>secondaryç”³è¯·å†…å­˜ï¼Œè¯¥å†…å­˜åœ¨secondaryä¸­å½±å­å†…å­˜å€¼ä¸º<code>0x00</code>ï¼Œè€Œåœ¨primaryä¸­å½±å­å†…å­˜å€¼ä¸º<code>0xfd</code>ã€‚æ­¤æ—¶åœ¨primaryä¸­è®¿é—®è¯¥å†…å­˜æ—¶ï¼Œå°±ä¼šå‡ºç°<code>Use After Free</code>é”™è¯¯ã€‚</p>
</blockquote>
</div>
    </div>

    <div class="post-meta">
        <i>
        
            <span>2024-01-01</span>
            
            
             
        
        </i>
    </div>
    <br>
    
    
        
            
    
            <div class="post-footer-pre-next">
                
                    <span>ä¸Šä¸€ç¯‡ï¼š<a href='/2025/04/06/ovs/'>ovs</a></span>
                

                
                    <span class="post-footer-pre-next-last-span-right">ä¸‹ä¸€ç¯‡ï¼š<a href="/2024/01/01/record/">è®°å½•</a>
                    </span>
                
            </div>
    
        
    

    
        

     
</div>



                                      
                    
                    
                    <div class="footer">
    
        <span> 
            Â© 1949-2024 China 

            
                

            
        </span>
       
    
</div>



<!--è¿™æ˜¯æŒ‡ä¸€æ¡çº¿å¾€ä¸‹çš„å†…å®¹-->
<div class="footer-last">
    
            <span>ğŸŒŠçœ‹è¿‡å¤§æµ·çš„äººä¸ä¼šå¿˜è®°æµ·çš„å¹¿é˜”ğŸŒŠ</span>
            
                <span class="footer-last-span-right"><i>æœ¬ç«™ç”±<a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/index.html">Hexo</a>é©±åŠ¨ï½œä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/HiNinoJay/hexo-theme-A4">Hexo-theme-A4</a>ä¸»é¢˜</i></span>
            
    
</div>


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

    <!--ç›®å½•-->
    
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" type="text/javascript" ></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.tocify/1.9.0/javascripts/jquery.tocify.min.js" type="text/javascript" ></script>
        
<script src="/js/toc.js"></script>

    

    
<script src="/js/randomHeaderContent.js"></script>

    <!--å›åˆ°é¡¶éƒ¨æŒ‰é’®-->
    
        
<script src="/js/returnToTop.js"></script>

    

    
        
<script src="/js/returnToLastPage.js"></script>

    





<script src="/js/lightgallery/lightgallery.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-thumbnail.umd.min.js"></script>



<script src="/js/lightgallery/plugins/lg-fullscreen.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-autoplay.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-zoom.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-rotate.umd.min.js"></script>


<script src="/js/lightgallery/plugins/lg-paper.umd.min.js"></script>




<script type="text/javascript">
     
    if (typeof lightGallery !== "undefined") {
        var options1 = {
            selector: '.gallery-item',
            plugins: [lgThumbnail, lgFullscreen, lgAutoplay, lgZoom, lgRotate, lgPager], // å¯ç”¨æ’ä»¶
            thumbnail: true,          // æ˜¾ç¤ºç¼©ç•¥å›¾
            zoom: true,               // å¯ç”¨ç¼©æ”¾åŠŸ
            rotate: true,             // å¯ç”¨æ—‹è½¬åŠŸèƒ½èƒ½
            autoplay: true,        // å¯ç”¨è‡ªåŠ¨æ’­æ”¾åŠŸèƒ½
            fullScreen: true,      // å¯ç”¨å…¨å±åŠŸèƒ½
            pager: false, //é¡µç ,
            zoomFromOrigin: true,   // ä»åŸå§‹ä½ç½®ç¼©æ”¾
            actualSize: true,       // å¯ç”¨æŸ¥çœ‹å®é™…å¤§å°çš„åŠŸèƒ½
            enableZoomAfter: 300,    // å»¶è¿Ÿç¼©æ”¾ï¼Œç¡®ä¿å›¾ç‰‡åŠ è½½å®Œæˆåå¯ç¼©æ”¾
        };
        lightGallery(document.getElementsByClassName('.article-gallery')[0], options1); // ä¿®å¤é€‰æ‹©å™¨
    }
    
</script>


    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> 

                </div>
            
            
                <!-- å›åˆ°é¡¶éƒ¨çš„æŒ‰é’®-->  
                <div class="progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
            
                <!-- è¿”å›çš„æŒ‰é’®-->  
                <div class="return-to-last-progress-wrap shadow-drop-2-bottom">
                    <svg class="progress-circle svg-content" width="100%" height="100%" viewBox="-1 -1 102 102">
                        <path d="M50,1 a49,49 0 0,1 0,98 a49,49 0 0,1 0,-98"/>
                    </svg>
                </div>
            
    </body>
</html>
<script src="/js/emojiHandler.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    wrapEmojis('.paper');
  });
</script>